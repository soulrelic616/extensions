/*
 * ADOBE CONFIDENTIAL
 *
 * Copyright (c) 2014 Adobe Systems Incorporated. All rights reserved.
 *
 * NOTICE:  All information contained herein is, and remains
 * the property of Adobe Systems Incorporated and its suppliers,
 * if any.  The intellectual and technical concepts contained
 * herein are proprietary to Adobe Systems Incorporated and its
 * suppliers and are protected by trade secret or copyright law.
 * Dissemination of this information or reproduction of this material
 * is strictly forbidden unless prior written permission is obtained
 * from Adobe Systems Incorporated.
 */
eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n/*global define*/\ndefine('jquery',[], function () {\n    \"use strict\";\n    return window.jQuery;\n});\n//# sourceURL=/jquery-brackets.js"),function(root){define("underscore",[],function(){return function(){return eval('(function(){var n=this,t=n._,r={},e=Array.prototype,u=Object.prototype,i=Function.prototype,a=e.push,o=e.slice,c=e.concat,l=u.toString,f=u.hasOwnProperty,s=e.forEach,p=e.map,h=e.reduce,v=e.reduceRight,d=e.filter,g=e.every,m=e.some,y=e.indexOf,b=e.lastIndexOf,x=Array.isArray,_=Object.keys,j=i.bind,w=function(n){return n instanceof w?n:this instanceof w?(this._wrapped=n,void 0):new w(n)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=w),exports._=w):n._=w,w.VERSION="1.4.4";var A=w.each=w.forEach=function(n,t,e){if(null!=n)if(s&&n.forEach===s)n.forEach(t,e);else if(n.length===+n.length){for(var u=0,i=n.length;i>u;u++)if(t.call(e,n[u],u,n)===r)return}else for(var a in n)if(w.has(n,a)&&t.call(e,n[a],a,n)===r)return};w.map=w.collect=function(n,t,r){var e=[];return null==n?e:p&&n.map===p?n.map(t,r):(A(n,function(n,u,i){e[e.length]=t.call(r,n,u,i)}),e)};var O="Reduce of empty array with no initial value";w.reduce=w.foldl=w.inject=function(n,t,r,e){var u=arguments.length>2;if(null==n&&(n=[]),h&&n.reduce===h)return e&&(t=w.bind(t,e)),u?n.reduce(t,r):n.reduce(t);if(A(n,function(n,i,a){u?r=t.call(e,r,n,i,a):(r=n,u=!0)}),!u)throw new TypeError(O);return r},w.reduceRight=w.foldr=function(n,t,r,e){var u=arguments.length>2;if(null==n&&(n=[]),v&&n.reduceRight===v)return e&&(t=w.bind(t,e)),u?n.reduceRight(t,r):n.reduceRight(t);var i=n.length;if(i!==+i){var a=w.keys(n);i=a.length}if(A(n,function(o,c,l){c=a?a[--i]:--i,u?r=t.call(e,r,n[c],c,l):(r=n[c],u=!0)}),!u)throw new TypeError(O);return r},w.find=w.detect=function(n,t,r){var e;return E(n,function(n,u,i){return t.call(r,n,u,i)?(e=n,!0):void 0}),e},w.filter=w.select=function(n,t,r){var e=[];return null==n?e:d&&n.filter===d?n.filter(t,r):(A(n,function(n,u,i){t.call(r,n,u,i)&&(e[e.length]=n)}),e)},w.reject=function(n,t,r){return w.filter(n,function(n,e,u){return!t.call(r,n,e,u)},r)},w.every=w.all=function(n,t,e){t||(t=w.identity);var u=!0;return null==n?u:g&&n.every===g?n.every(t,e):(A(n,function(n,i,a){return(u=u&&t.call(e,n,i,a))?void 0:r}),!!u)};var E=w.some=w.any=function(n,t,e){t||(t=w.identity);var u=!1;return null==n?u:m&&n.some===m?n.some(t,e):(A(n,function(n,i,a){return u||(u=t.call(e,n,i,a))?r:void 0}),!!u)};w.contains=w.include=function(n,t){return null==n?!1:y&&n.indexOf===y?n.indexOf(t)!=-1:E(n,function(n){return n===t})},w.invoke=function(n,t){var r=o.call(arguments,2),e=w.isFunction(t);return w.map(n,function(n){return(e?t:n[t]).apply(n,r)})},w.pluck=function(n,t){return w.map(n,function(n){return n[t]})},w.where=function(n,t,r){return w.isEmpty(t)?r?null:[]:w[r?"find":"filter"](n,function(n){for(var r in t)if(t[r]!==n[r])return!1;return!0})},w.findWhere=function(n,t){return w.where(n,t,!0)},w.max=function(n,t,r){if(!t&&w.isArray(n)&&n[0]===+n[0]&&65535>n.length)return Math.max.apply(Math,n);if(!t&&w.isEmpty(n))return-1/0;var e={computed:-1/0,value:-1/0};return A(n,function(n,u,i){var a=t?t.call(r,n,u,i):n;a>=e.computed&&(e={value:n,computed:a})}),e.value},w.min=function(n,t,r){if(!t&&w.isArray(n)&&n[0]===+n[0]&&65535>n.length)return Math.min.apply(Math,n);if(!t&&w.isEmpty(n))return 1/0;var e={computed:1/0,value:1/0};return A(n,function(n,u,i){var a=t?t.call(r,n,u,i):n;e.computed>a&&(e={value:n,computed:a})}),e.value},w.shuffle=function(n){var t,r=0,e=[];return A(n,function(n){t=w.random(r++),e[r-1]=e[t],e[t]=n}),e};var k=function(n){return w.isFunction(n)?n:function(t){return t[n]}};w.sortBy=function(n,t,r){var e=k(t);return w.pluck(w.map(n,function(n,t,u){return{value:n,index:t,criteria:e.call(r,n,t,u)}}).sort(function(n,t){var r=n.criteria,e=t.criteria;if(r!==e){if(r>e||r===void 0)return 1;if(e>r||e===void 0)return-1}return n.index<t.index?-1:1}),"value")};var F=function(n,t,r,e){var u={},i=k(t||w.identity);return A(n,function(t,a){var o=i.call(r,t,a,n);e(u,o,t)}),u};w.groupBy=function(n,t,r){return F(n,t,r,function(n,t,r){(w.has(n,t)?n[t]:n[t]=[]).push(r)})},w.countBy=function(n,t,r){return F(n,t,r,function(n,t){w.has(n,t)||(n[t]=0),n[t]++})},w.sortedIndex=function(n,t,r,e){r=null==r?w.identity:k(r);for(var u=r.call(e,t),i=0,a=n.length;a>i;){var o=i+a>>>1;u>r.call(e,n[o])?i=o+1:a=o}return i},w.toArray=function(n){return n?w.isArray(n)?o.call(n):n.length===+n.length?w.map(n,w.identity):w.values(n):[]},w.size=function(n){return null==n?0:n.length===+n.length?n.length:w.keys(n).length},w.first=w.head=w.take=function(n,t,r){return null==n?void 0:null==t||r?n[0]:o.call(n,0,t)},w.initial=function(n,t,r){return o.call(n,0,n.length-(null==t||r?1:t))},w.last=function(n,t,r){return null==n?void 0:null==t||r?n[n.length-1]:o.call(n,Math.max(n.length-t,0))},w.rest=w.tail=w.drop=function(n,t,r){return o.call(n,null==t||r?1:t)},w.compact=function(n){return w.filter(n,w.identity)};var R=function(n,t,r){return A(n,function(n){w.isArray(n)?t?a.apply(r,n):R(n,t,r):r.push(n)}),r};w.flatten=function(n,t){return R(n,t,[])},w.without=function(n){return w.difference(n,o.call(arguments,1))},w.uniq=w.unique=function(n,t,r,e){w.isFunction(t)&&(e=r,r=t,t=!1);var u=r?w.map(n,r,e):n,i=[],a=[];return A(u,function(r,e){(t?e&&a[a.length-1]===r:w.contains(a,r))||(a.push(r),i.push(n[e]))}),i},w.union=function(){return w.uniq(c.apply(e,arguments))},w.intersection=function(n){var t=o.call(arguments,1);return w.filter(w.uniq(n),function(n){return w.every(t,function(t){return w.indexOf(t,n)>=0})})},w.difference=function(n){var t=c.apply(e,o.call(arguments,1));return w.filter(n,function(n){return!w.contains(t,n)})},w.zip=function(){for(var n=o.call(arguments),t=w.max(w.pluck(n,"length")),r=Array(t),e=0;t>e;e++)r[e]=w.pluck(n,""+e);return r},w.object=function(n,t){if(null==n)return{};for(var r={},e=0,u=n.length;u>e;e++)t?r[n[e]]=t[e]:r[n[e][0]]=n[e][1];return r},w.indexOf=function(n,t,r){if(null==n)return-1;var e=0,u=n.length;if(r){if("number"!=typeof r)return e=w.sortedIndex(n,t),n[e]===t?e:-1;e=0>r?Math.max(0,u+r):r}if(y&&n.indexOf===y)return n.indexOf(t,r);for(;u>e;e++)if(n[e]===t)return e;return-1},w.lastIndexOf=function(n,t,r){if(null==n)return-1;var e=null!=r;if(b&&n.lastIndexOf===b)return e?n.lastIndexOf(t,r):n.lastIndexOf(t);for(var u=e?r:n.length;u--;)if(n[u]===t)return u;return-1},w.range=function(n,t,r){1>=arguments.length&&(t=n||0,n=0),r=arguments[2]||1;for(var e=Math.max(Math.ceil((t-n)/r),0),u=0,i=Array(e);e>u;)i[u++]=n,n+=r;return i},w.bind=function(n,t){if(n.bind===j&&j)return j.apply(n,o.call(arguments,1));var r=o.call(arguments,2);return function(){return n.apply(t,r.concat(o.call(arguments)))}},w.partial=function(n){var t=o.call(arguments,1);return function(){return n.apply(this,t.concat(o.call(arguments)))}},w.bindAll=function(n){var t=o.call(arguments,1);return 0===t.length&&(t=w.functions(n)),A(t,function(t){n[t]=w.bind(n[t],n)}),n},w.memoize=function(n,t){var r={};return t||(t=w.identity),function(){var e=t.apply(this,arguments);return w.has(r,e)?r[e]:r[e]=n.apply(this,arguments)}},w.delay=function(n,t){var r=o.call(arguments,2);return setTimeout(function(){return n.apply(null,r)},t)},w.defer=function(n){return w.delay.apply(w,[n,1].concat(o.call(arguments,1)))},w.throttle=function(n,t){var r,e,u,i,a=0,o=function(){a=new Date,u=null,i=n.apply(r,e)};return function(){var c=new Date,l=t-(c-a);return r=this,e=arguments,0>=l?(clearTimeout(u),u=null,a=c,i=n.apply(r,e)):u||(u=setTimeout(o,l)),i}},w.debounce=function(n,t,r){var e,u;return function(){var i=this,a=arguments,o=function(){e=null,r||(u=n.apply(i,a))},c=r&&!e;return clearTimeout(e),e=setTimeout(o,t),c&&(u=n.apply(i,a)),u}},w.once=function(n){var t,r=!1;return function(){return r?t:(r=!0,t=n.apply(this,arguments),n=null,t)}},w.wrap=function(n,t){return function(){var r=[n];return a.apply(r,arguments),t.apply(this,r)}},w.compose=function(){var n=arguments;return function(){for(var t=arguments,r=n.length-1;r>=0;r--)t=[n[r].apply(this,t)];return t[0]}},w.after=function(n,t){return 0>=n?t():function(){return 1>--n?t.apply(this,arguments):void 0}},w.keys=_||function(n){if(n!==Object(n))throw new TypeError("Invalid object");var t=[];for(var r in n)w.has(n,r)&&(t[t.length]=r);return t},w.values=function(n){var t=[];for(var r in n)w.has(n,r)&&t.push(n[r]);return t},w.pairs=function(n){var t=[];for(var r in n)w.has(n,r)&&t.push([r,n[r]]);return t},w.invert=function(n){var t={};for(var r in n)w.has(n,r)&&(t[n[r]]=r);return t},w.functions=w.methods=function(n){var t=[];for(var r in n)w.isFunction(n[r])&&t.push(r);return t.sort()},w.extend=function(n){return A(o.call(arguments,1),function(t){if(t)for(var r in t)n[r]=t[r]}),n},w.pick=function(n){var t={},r=c.apply(e,o.call(arguments,1));return A(r,function(r){r in n&&(t[r]=n[r])}),t},w.omit=function(n){var t={},r=c.apply(e,o.call(arguments,1));for(var u in n)w.contains(r,u)||(t[u]=n[u]);return t},w.defaults=function(n){return A(o.call(arguments,1),function(t){if(t)for(var r in t)null==n[r]&&(n[r]=t[r])}),n},w.clone=function(n){return w.isObject(n)?w.isArray(n)?n.slice():w.extend({},n):n},w.tap=function(n,t){return t(n),n};var I=function(n,t,r,e){if(n===t)return 0!==n||1/n==1/t;if(null==n||null==t)return n===t;n instanceof w&&(n=n._wrapped),t instanceof w&&(t=t._wrapped);var u=l.call(n);if(u!=l.call(t))return!1;switch(u){case"[object String]":return n==t+"";case"[object Number]":return n!=+n?t!=+t:0==n?1/n==1/t:n==+t;case"[object Date]":case"[object Boolean]":return+n==+t;case"[object RegExp]":return n.source==t.source&&n.global==t.global&&n.multiline==t.multiline&&n.ignoreCase==t.ignoreCase}if("object"!=typeof n||"object"!=typeof t)return!1;for(var i=r.length;i--;)if(r[i]==n)return e[i]==t;r.push(n),e.push(t);var a=0,o=!0;if("[object Array]"==u){if(a=n.length,o=a==t.length)for(;a--&&(o=I(n[a],t[a],r,e)););}else{var c=n.constructor,f=t.constructor;if(c!==f&&!(w.isFunction(c)&&c instanceof c&&w.isFunction(f)&&f instanceof f))return!1;for(var s in n)if(w.has(n,s)&&(a++,!(o=w.has(t,s)&&I(n[s],t[s],r,e))))break;if(o){for(s in t)if(w.has(t,s)&&!a--)break;o=!a}}return r.pop(),e.pop(),o};w.isEqual=function(n,t){return I(n,t,[],[])},w.isEmpty=function(n){if(null==n)return!0;if(w.isArray(n)||w.isString(n))return 0===n.length;for(var t in n)if(w.has(n,t))return!1;return!0},w.isElement=function(n){return!(!n||1!==n.nodeType)},w.isArray=x||function(n){return"[object Array]"==l.call(n)},w.isObject=function(n){return n===Object(n)},A(["Arguments","Function","String","Number","Date","RegExp"],function(n){w["is"+n]=function(t){return l.call(t)=="[object "+n+"]"}}),w.isArguments(arguments)||(w.isArguments=function(n){return!(!n||!w.has(n,"callee"))}),"function"!=typeof/./&&(w.isFunction=function(n){return"function"==typeof n}),w.isFinite=function(n){return isFinite(n)&&!isNaN(parseFloat(n))},w.isNaN=function(n){return w.isNumber(n)&&n!=+n},w.isBoolean=function(n){return n===!0||n===!1||"[object Boolean]"==l.call(n)},w.isNull=function(n){return null===n},w.isUndefined=function(n){return n===void 0},w.has=function(n,t){return f.call(n,t)},w.noConflict=function(){return n._=t,this},w.identity=function(n){return n},w.times=function(n,t,r){for(var e=Array(n),u=0;n>u;u++)e[u]=t.call(r,u);return e},w.random=function(n,t){return null==t&&(t=n,n=0),n+Math.floor(Math.random()*(t-n+1))};var M={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",\'"\':"&quot;","\'":"&#x27;","/":"&#x2F;"}};M.unescape=w.invert(M.escape);var S={escape:RegExp("["+w.keys(M.escape).join("")+"]","g"),unescape:RegExp("("+w.keys(M.unescape).join("|")+")","g")};w.each(["escape","unescape"],function(n){w[n]=function(t){return null==t?"":(""+t).replace(S[n],function(t){return M[n][t]})}}),w.result=function(n,t){if(null==n)return null;var r=n[t];return w.isFunction(r)?r.call(n):r},w.mixin=function(n){A(w.functions(n),function(t){var r=w[t]=n[t];w.prototype[t]=function(){var n=[this._wrapped];return a.apply(n,arguments),D.call(this,r.apply(w,n))}})};var N=0;w.uniqueId=function(n){var t=++N+"";return n?n+t:t},w.templateSettings={evaluate:/<%([\\s\\S]+?)%>/g,interpolate:/<%=([\\s\\S]+?)%>/g,escape:/<%-([\\s\\S]+?)%>/g};var T=/(.)^/,q={"\'":"\'","\\\\":"\\\\","\\r":"r","\\n":"n","	":"t","\\u2028":"u2028","\\u2029":"u2029"},B=/\\\\|\'|\\r|\\n|\\t|\\u2028|\\u2029/g;w.template=function(n,t,r){var e;r=w.defaults({},r,w.templateSettings);var u=RegExp([(r.escape||T).source,(r.interpolate||T).source,(r.evaluate||T).source].join("|")+"|$","g"),i=0,a="__p+=\'";n.replace(u,function(t,r,e,u,o){return a+=n.slice(i,o).replace(B,function(n){return"\\\\"+q[n]}),r&&(a+="\'+\\n((__t=("+r+"))==null?\'\':_.escape(__t))+\\n\'"),e&&(a+="\'+\\n((__t=("+e+"))==null?\'\':__t)+\\n\'"),u&&(a+="\';\\n"+u+"\\n__p+=\'"),i=o+t.length,t}),a+="\';\\n",r.variable||(a="with(obj||{}){\\n"+a+"}\\n"),a="var __t,__p=\'\',__j=Array.prototype.join,"+"print=function(){__p+=__j.call(arguments,\'\');};\\n"+a+"return __p;\\n";try{e=Function(r.variable||"obj","_",a)}catch(o){throw o.source=a,o}if(t)return e(t,w);var c=function(n){return e.call(this,n,w)};return c.source="function("+(r.variable||"obj")+"){\\n"+a+"}",c},w.chain=function(n){return w(n).chain()};var D=function(n){return this._chain?w(n).chain():n};w.mixin(w),A(["pop","push","reverse","shift","sort","splice","unshift"],function(n){var t=e[n];w.prototype[n]=function(){var r=this._wrapped;return t.apply(r,arguments),"shift"!=n&&"splice"!=n||0!==r.length||delete r[0],D.call(this,r)}}),A(["concat","join","slice"],function(n){var t=e[n];w.prototype[n]=function(){return D.call(this,t.apply(this._wrapped,arguments))}}),w.extend(w.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}).call(this);\n//# sourceURL=/lib/graphite-api/public/js/libs/underscore/underscore-min.js'),root._=_}.apply(root,arguments)})}(this),function(root){define("backbone",["underscore","jquery"],function(){return function(){return eval('(function(){var t=this;var e=t.Backbone;var i=[];var r=i.push;var s=i.slice;var n=i.splice;var a;if(typeof exports!=="undefined"){a=exports}else{a=t.Backbone={}}a.VERSION="1.0.0";var h=t._;if(!h&&typeof require!=="undefined")h=require("underscore");a.$=t.jQuery||t.Zepto||t.ender||t.$;a.noConflict=function(){t.Backbone=e;return this};a.emulateHTTP=false;a.emulateJSON=false;var o=a.Events={on:function(t,e,i){if(!l(this,"on",t,[e,i])||!e)return this;this._events||(this._events={});var r=this._events[t]||(this._events[t]=[]);r.push({callback:e,context:i,ctx:i||this});return this},once:function(t,e,i){if(!l(this,"once",t,[e,i])||!e)return this;var r=this;var s=h.once(function(){r.off(t,s);e.apply(this,arguments)});s._callback=e;return this.on(t,s,i)},off:function(t,e,i){var r,s,n,a,o,u,c,f;if(!this._events||!l(this,"off",t,[e,i]))return this;if(!t&&!e&&!i){this._events={};return this}a=t?[t]:h.keys(this._events);for(o=0,u=a.length;o<u;o++){t=a[o];if(n=this._events[t]){this._events[t]=r=[];if(e||i){for(c=0,f=n.length;c<f;c++){s=n[c];if(e&&e!==s.callback&&e!==s.callback._callback||i&&i!==s.context){r.push(s)}}}if(!r.length)delete this._events[t]}}return this},trigger:function(t){if(!this._events)return this;var e=s.call(arguments,1);if(!l(this,"trigger",t,e))return this;var i=this._events[t];var r=this._events.all;if(i)c(i,e);if(r)c(r,arguments);return this},stopListening:function(t,e,i){var r=this._listeners;if(!r)return this;var s=!e&&!i;if(typeof e==="object")i=this;if(t)(r={})[t._listenerId]=t;for(var n in r){r[n].off(e,i,this);if(s)delete this._listeners[n]}return this}};var u=/\\s+/;var l=function(t,e,i,r){if(!i)return true;if(typeof i==="object"){for(var s in i){t[e].apply(t,[s,i[s]].concat(r))}return false}if(u.test(i)){var n=i.split(u);for(var a=0,h=n.length;a<h;a++){t[e].apply(t,[n[a]].concat(r))}return false}return true};var c=function(t,e){var i,r=-1,s=t.length,n=e[0],a=e[1],h=e[2];switch(e.length){case 0:while(++r<s)(i=t[r]).callback.call(i.ctx);return;case 1:while(++r<s)(i=t[r]).callback.call(i.ctx,n);return;case 2:while(++r<s)(i=t[r]).callback.call(i.ctx,n,a);return;case 3:while(++r<s)(i=t[r]).callback.call(i.ctx,n,a,h);return;default:while(++r<s)(i=t[r]).callback.apply(i.ctx,e)}};var f={listenTo:"on",listenToOnce:"once"};h.each(f,function(t,e){o[e]=function(e,i,r){var s=this._listeners||(this._listeners={});var n=e._listenerId||(e._listenerId=h.uniqueId("l"));s[n]=e;if(typeof i==="object")r=this;e[t](i,r,this);return this}});o.bind=o.on;o.unbind=o.off;h.extend(a,o);var d=a.Model=function(t,e){var i;var r=t||{};e||(e={});this.cid=h.uniqueId("c");this.attributes={};h.extend(this,h.pick(e,p));if(e.parse)r=this.parse(r,e)||{};if(i=h.result(this,"defaults")){r=h.defaults({},r,i)}this.set(r,e);this.changed={};this.initialize.apply(this,arguments)};var p=["url","urlRoot","collection"];h.extend(d.prototype,o,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(t){return h.clone(this.attributes)},sync:function(){return a.sync.apply(this,arguments)},get:function(t){return this.attributes[t]},escape:function(t){return h.escape(this.get(t))},has:function(t){return this.get(t)!=null},set:function(t,e,i){var r,s,n,a,o,u,l,c;if(t==null)return this;if(typeof t==="object"){s=t;i=e}else{(s={})[t]=e}i||(i={});if(!this._validate(s,i))return false;n=i.unset;o=i.silent;a=[];u=this._changing;this._changing=true;if(!u){this._previousAttributes=h.clone(this.attributes);this.changed={}}c=this.attributes,l=this._previousAttributes;if(this.idAttribute in s)this.id=s[this.idAttribute];for(r in s){e=s[r];if(!h.isEqual(c[r],e))a.push(r);if(!h.isEqual(l[r],e)){this.changed[r]=e}else{delete this.changed[r]}n?delete c[r]:c[r]=e}if(!o){if(a.length)this._pending=true;for(var f=0,d=a.length;f<d;f++){this.trigger("change:"+a[f],this,c[a[f]],i)}}if(u)return this;if(!o){while(this._pending){this._pending=false;this.trigger("change",this,i)}}this._pending=false;this._changing=false;return this},unset:function(t,e){return this.set(t,void 0,h.extend({},e,{unset:true}))},clear:function(t){var e={};for(var i in this.attributes)e[i]=void 0;return this.set(e,h.extend({},t,{unset:true}))},hasChanged:function(t){if(t==null)return!h.isEmpty(this.changed);return h.has(this.changed,t)},changedAttributes:function(t){if(!t)return this.hasChanged()?h.clone(this.changed):false;var e,i=false;var r=this._changing?this._previousAttributes:this.attributes;for(var s in t){if(h.isEqual(r[s],e=t[s]))continue;(i||(i={}))[s]=e}return i},previous:function(t){if(t==null||!this._previousAttributes)return null;return this._previousAttributes[t]},previousAttributes:function(){return h.clone(this._previousAttributes)},fetch:function(t){t=t?h.clone(t):{};if(t.parse===void 0)t.parse=true;var e=this;var i=t.success;t.success=function(r){if(!e.set(e.parse(r,t),t))return false;if(i)i(e,r,t);e.trigger("sync",e,r,t)};R(this,t);return this.sync("read",this,t)},save:function(t,e,i){var r,s,n,a=this.attributes;if(t==null||typeof t==="object"){r=t;i=e}else{(r={})[t]=e}if(r&&(!i||!i.wait)&&!this.set(r,i))return false;i=h.extend({validate:true},i);if(!this._validate(r,i))return false;if(r&&i.wait){this.attributes=h.extend({},a,r)}if(i.parse===void 0)i.parse=true;var o=this;var u=i.success;i.success=function(t){o.attributes=a;var e=o.parse(t,i);if(i.wait)e=h.extend(r||{},e);if(h.isObject(e)&&!o.set(e,i)){return false}if(u)u(o,t,i);o.trigger("sync",o,t,i)};R(this,i);s=this.isNew()?"create":i.patch?"patch":"update";if(s==="patch")i.attrs=r;n=this.sync(s,this,i);if(r&&i.wait)this.attributes=a;return n},destroy:function(t){t=t?h.clone(t):{};var e=this;var i=t.success;var r=function(){e.trigger("destroy",e,e.collection,t)};t.success=function(s){if(t.wait||e.isNew())r();if(i)i(e,s,t);if(!e.isNew())e.trigger("sync",e,s,t)};if(this.isNew()){t.success();return false}R(this,t);var s=this.sync("delete",this,t);if(!t.wait)r();return s},url:function(){var t=h.result(this,"urlRoot")||h.result(this.collection,"url")||U();if(this.isNew())return t;return t+(t.charAt(t.length-1)==="/"?"":"/")+encodeURIComponent(this.id)},parse:function(t,e){return t},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return this.id==null},isValid:function(t){return this._validate({},h.extend(t||{},{validate:true}))},_validate:function(t,e){if(!e.validate||!this.validate)return true;t=h.extend({},this.attributes,t);var i=this.validationError=this.validate(t,e)||null;if(!i)return true;this.trigger("invalid",this,i,h.extend(e||{},{validationError:i}));return false}});var v=["keys","values","pairs","invert","pick","omit"];h.each(v,function(t){d.prototype[t]=function(){var e=s.call(arguments);e.unshift(this.attributes);return h[t].apply(h,e)}});var g=a.Collection=function(t,e){e||(e={});if(e.url)this.url=e.url;if(e.model)this.model=e.model;if(e.comparator!==void 0)this.comparator=e.comparator;this._reset();this.initialize.apply(this,arguments);if(t)this.reset(t,h.extend({silent:true},e))};var m={add:true,remove:true,merge:true};var y={add:true,merge:false,remove:false};h.extend(g.prototype,o,{model:d,initialize:function(){},toJSON:function(t){return this.map(function(e){return e.toJSON(t)})},sync:function(){return a.sync.apply(this,arguments)},add:function(t,e){return this.set(t,h.defaults(e||{},y))},remove:function(t,e){t=h.isArray(t)?t.slice():[t];e||(e={});var i,r,s,n;for(i=0,r=t.length;i<r;i++){n=this.get(t[i]);if(!n)continue;delete this._byId[n.id];delete this._byId[n.cid];s=this.indexOf(n);this.models.splice(s,1);this.length--;if(!e.silent){e.index=s;n.trigger("remove",n,this,e)}this._removeReference(n)}return this},set:function(t,e){e=h.defaults(e||{},m);if(e.parse)t=this.parse(t,e);if(!h.isArray(t))t=t?[t]:[];var i,s,a,o,u,l;var c=e.at;var f=this.comparator&&c==null&&e.sort!==false;var d=h.isString(this.comparator)?this.comparator:null;var p=[],v=[],g={};for(i=0,s=t.length;i<s;i++){if(!(a=this._prepareModel(t[i],e)))continue;if(u=this.get(a)){if(e.remove)g[u.cid]=true;if(e.merge){u.set(a.attributes,e);if(f&&!l&&u.hasChanged(d))l=true}}else if(e.add){p.push(a);a.on("all",this._onModelEvent,this);this._byId[a.cid]=a;if(a.id!=null)this._byId[a.id]=a}}if(e.remove){for(i=0,s=this.length;i<s;++i){if(!g[(a=this.models[i]).cid])v.push(a)}if(v.length)this.remove(v,e)}if(p.length){if(f)l=true;this.length+=p.length;if(c!=null){n.apply(this.models,[c,0].concat(p))}else{r.apply(this.models,p)}}if(l)this.sort({silent:true});if(e.silent)return this;for(i=0,s=p.length;i<s;i++){(a=p[i]).trigger("add",a,this,e)}if(l)this.trigger("sort",this,e);return this},reset:function(t,e){e||(e={});for(var i=0,r=this.models.length;i<r;i++){this._removeReference(this.models[i])}e.previousModels=this.models;this._reset();this.add(t,h.extend({silent:true},e));if(!e.silent)this.trigger("reset",this,e);return this},push:function(t,e){t=this._prepareModel(t,e);this.add(t,h.extend({at:this.length},e));return t},pop:function(t){var e=this.at(this.length-1);this.remove(e,t);return e},unshift:function(t,e){t=this._prepareModel(t,e);this.add(t,h.extend({at:0},e));return t},shift:function(t){var e=this.at(0);this.remove(e,t);return e},slice:function(t,e){return this.models.slice(t,e)},get:function(t){if(t==null)return void 0;return this._byId[t.id!=null?t.id:t.cid||t]},at:function(t){return this.models[t]},where:function(t,e){if(h.isEmpty(t))return e?void 0:[];return this[e?"find":"filter"](function(e){for(var i in t){if(t[i]!==e.get(i))return false}return true})},findWhere:function(t){return this.where(t,true)},sort:function(t){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");t||(t={});if(h.isString(this.comparator)||this.comparator.length===1){this.models=this.sortBy(this.comparator,this)}else{this.models.sort(h.bind(this.comparator,this))}if(!t.silent)this.trigger("sort",this,t);return this},sortedIndex:function(t,e,i){e||(e=this.comparator);var r=h.isFunction(e)?e:function(t){return t.get(e)};return h.sortedIndex(this.models,t,r,i)},pluck:function(t){return h.invoke(this.models,"get",t)},fetch:function(t){t=t?h.clone(t):{};if(t.parse===void 0)t.parse=true;var e=t.success;var i=this;t.success=function(r){var s=t.reset?"reset":"set";i[s](r,t);if(e)e(i,r,t);i.trigger("sync",i,r,t)};R(this,t);return this.sync("read",this,t)},create:function(t,e){e=e?h.clone(e):{};if(!(t=this._prepareModel(t,e)))return false;if(!e.wait)this.add(t,e);var i=this;var r=e.success;e.success=function(s){if(e.wait)i.add(t,e);if(r)r(t,s,e)};t.save(null,e);return t},parse:function(t,e){return t},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0;this.models=[];this._byId={}},_prepareModel:function(t,e){if(t instanceof d){if(!t.collection)t.collection=this;return t}e||(e={});e.collection=this;var i=new this.model(t,e);if(!i._validate(t,e)){this.trigger("invalid",this,t,e);return false}return i},_removeReference:function(t){if(this===t.collection)delete t.collection;t.off("all",this._onModelEvent,this)},_onModelEvent:function(t,e,i,r){if((t==="add"||t==="remove")&&i!==this)return;if(t==="destroy")this.remove(e,r);if(e&&t==="change:"+e.idAttribute){delete this._byId[e.previous(e.idAttribute)];if(e.id!=null)this._byId[e.id]=e}this.trigger.apply(this,arguments)}});var _=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","indexOf","shuffle","lastIndexOf","isEmpty","chain"];h.each(_,function(t){g.prototype[t]=function(){var e=s.call(arguments);e.unshift(this.models);return h[t].apply(h,e)}});var w=["groupBy","countBy","sortBy"];h.each(w,function(t){g.prototype[t]=function(e,i){var r=h.isFunction(e)?e:function(t){return t.get(e)};return h[t](this.models,r,i)}});var b=a.View=function(t){this.cid=h.uniqueId("view");this._configure(t||{});this._ensureElement();this.initialize.apply(this,arguments);this.delegateEvents()};var x=/^(\\S+)\\s*(.*)$/;var E=["model","collection","el","id","attributes","className","tagName","events"];h.extend(b.prototype,o,{tagName:"div",$:function(t){return this.$el.find(t)},initialize:function(){},render:function(){return this},remove:function(){this.$el.remove();this.stopListening();return this},setElement:function(t,e){if(this.$el)this.undelegateEvents();this.$el=t instanceof a.$?t:a.$(t);this.el=this.$el[0];if(e!==false)this.delegateEvents();return this},delegateEvents:function(t){if(!(t||(t=h.result(this,"events"))))return this;this.undelegateEvents();for(var e in t){var i=t[e];if(!h.isFunction(i))i=this[t[e]];if(!i)continue;var r=e.match(x);var s=r[1],n=r[2];i=h.bind(i,this);s+=".delegateEvents"+this.cid;if(n===""){this.$el.on(s,i)}else{this.$el.on(s,n,i)}}return this},undelegateEvents:function(){this.$el.off(".delegateEvents"+this.cid);return this},_configure:function(t){if(this.options)t=h.extend({},h.result(this,"options"),t);h.extend(this,h.pick(t,E));this.options=t},_ensureElement:function(){if(!this.el){var t=h.extend({},h.result(this,"attributes"));if(this.id)t.id=h.result(this,"id");if(this.className)t["class"]=h.result(this,"className");var e=a.$("<"+h.result(this,"tagName")+">").attr(t);this.setElement(e,false)}else{this.setElement(h.result(this,"el"),false)}}});a.sync=function(t,e,i){var r=k[t];h.defaults(i||(i={}),{emulateHTTP:a.emulateHTTP,emulateJSON:a.emulateJSON});var s={type:r,dataType:"json"};if(!i.url){s.url=h.result(e,"url")||U()}if(i.data==null&&e&&(t==="create"||t==="update"||t==="patch")){s.contentType="application/json";s.data=JSON.stringify(i.attrs||e.toJSON(i))}if(i.emulateJSON){s.contentType="application/x-www-form-urlencoded";s.data=s.data?{model:s.data}:{}}if(i.emulateHTTP&&(r==="PUT"||r==="DELETE"||r==="PATCH")){s.type="POST";if(i.emulateJSON)s.data._method=r;var n=i.beforeSend;i.beforeSend=function(t){t.setRequestHeader("X-HTTP-Method-Override",r);if(n)return n.apply(this,arguments)}}if(s.type!=="GET"&&!i.emulateJSON){s.processData=false}if(s.type==="PATCH"&&window.ActiveXObject&&!(window.external&&window.external.msActiveXFilteringEnabled)){s.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")}}var o=i.xhr=a.ajax(h.extend(s,i));e.trigger("request",e,o,i);return o};var k={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};a.ajax=function(){return a.$.ajax.apply(a.$,arguments)};var S=a.Router=function(t){t||(t={});if(t.routes)this.routes=t.routes;this._bindRoutes();this.initialize.apply(this,arguments)};var $=/\\((.*?)\\)/g;var T=/(\\(\\?)?:\\w+/g;var H=/\\*\\w+/g;var A=/[\\-{}\\[\\]+?.,\\\\\\^$|#\\s]/g;h.extend(S.prototype,o,{initialize:function(){},route:function(t,e,i){if(!h.isRegExp(t))t=this._routeToRegExp(t);if(h.isFunction(e)){i=e;e=""}if(!i)i=this[e];var r=this;a.history.route(t,function(s){var n=r._extractParameters(t,s);i&&i.apply(r,n);r.trigger.apply(r,["route:"+e].concat(n));r.trigger("route",e,n);a.history.trigger("route",r,e,n)});return this},navigate:function(t,e){a.history.navigate(t,e);return this},_bindRoutes:function(){if(!this.routes)return;this.routes=h.result(this,"routes");var t,e=h.keys(this.routes);while((t=e.pop())!=null){this.route(t,this.routes[t])}},_routeToRegExp:function(t){t=t.replace(A,"\\\\$&").replace($,"(?:$1)?").replace(T,function(t,e){return e?t:"([^/]+)"}).replace(H,"(.*?)");return new RegExp("^"+t+"$")},_extractParameters:function(t,e){var i=t.exec(e).slice(1);return h.map(i,function(t){return t?decodeURIComponent(t):null})}});var I=a.History=function(){this.handlers=[];h.bindAll(this,"checkUrl");if(typeof window!=="undefined"){this.location=window.location;this.history=window.history}};var N=/^[#\\/]|\\s+$/g;var P=/^\\/+|\\/+$/g;var O=/msie [\\w.]+/;var C=/\\/$/;I.started=false;h.extend(I.prototype,o,{interval:50,getHash:function(t){var e=(t||this).location.href.match(/#(.*)$/);return e?e[1]:""},getFragment:function(t,e){if(t==null){if(this._hasPushState||!this._wantsHashChange||e){t=this.location.pathname;var i=this.root.replace(C,"");if(!t.indexOf(i))t=t.substr(i.length)}else{t=this.getHash()}}return t.replace(N,"")},start:function(t){if(I.started)throw new Error("Backbone.history has already been started");I.started=true;this.options=h.extend({},{root:"/"},this.options,t);this.root=this.options.root;this._wantsHashChange=this.options.hashChange!==false;this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var e=this.getFragment();var i=document.documentMode;var r=O.exec(navigator.userAgent.toLowerCase())&&(!i||i<=7);this.root=("/"+this.root+"/").replace(P,"/");if(r&&this._wantsHashChange){this.iframe=a.$(\'<iframe src="javascript:0" tabindex="-1" />\').hide().appendTo("body")[0].contentWindow;this.navigate(e)}if(this._hasPushState){a.$(window).on("popstate",this.checkUrl)}else if(this._wantsHashChange&&"onhashchange"in window&&!r){a.$(window).on("hashchange",this.checkUrl)}else if(this._wantsHashChange){this._checkUrlInterval=setInterval(this.checkUrl,this.interval)}this.fragment=e;var s=this.location;var n=s.pathname.replace(/[^\\/]$/,"$&/")===this.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!n){this.fragment=this.getFragment(null,true);this.location.replace(this.root+this.location.search+"#"+this.fragment);return true}else if(this._wantsPushState&&this._hasPushState&&n&&s.hash){this.fragment=this.getHash().replace(N,"");this.history.replaceState({},document.title,this.root+this.fragment+s.search)}if(!this.options.silent)return this.loadUrl()},stop:function(){a.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl);clearInterval(this._checkUrlInterval);I.started=false},route:function(t,e){this.handlers.unshift({route:t,callback:e})},checkUrl:function(t){var e=this.getFragment();if(e===this.fragment&&this.iframe){e=this.getFragment(this.getHash(this.iframe))}if(e===this.fragment)return false;if(this.iframe)this.navigate(e);this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(t){var e=this.fragment=this.getFragment(t);var i=h.any(this.handlers,function(t){if(t.route.test(e)){t.callback(e);return true}});return i},navigate:function(t,e){if(!I.started)return false;if(!e||e===true)e={trigger:e};t=this.getFragment(t||"");if(this.fragment===t)return;this.fragment=t;var i=this.root+t;if(this._hasPushState){this.history[e.replace?"replaceState":"pushState"]({},document.title,i)}else if(this._wantsHashChange){this._updateHash(this.location,t,e.replace);if(this.iframe&&t!==this.getFragment(this.getHash(this.iframe))){if(!e.replace)this.iframe.document.open().close();this._updateHash(this.iframe.location,t,e.replace)}}else{return this.location.assign(i)}if(e.trigger)this.loadUrl(t)},_updateHash:function(t,e,i){if(i){var r=t.href.replace(/(javascript:|#).*$/,"");t.replace(r+"#"+e)}else{t.hash="#"+e}}});a.history=new I;var j=function(t,e){var i=this;var r;if(t&&h.has(t,"constructor")){r=t.constructor}else{r=function(){return i.apply(this,arguments)}}h.extend(r,i,e);var s=function(){this.constructor=r};s.prototype=i.prototype;r.prototype=new s;if(t)h.extend(r.prototype,t);r.__super__=i.prototype;return r};d.extend=g.extend=S.extend=b.extend=I.extend=j;var U=function(){throw new Error(\'A "url" property or function must be specified\')};var R=function(t,e){var i=e.error;e.error=function(r){if(i)i(t,r,e);t.trigger("error",t,r,e)}}}).call(this);\n\n//# sourceURL=/lib/graphite-api/public/js/libs/backbone/backbone-min.js'),
root.Backbone=Backbone}.apply(root,arguments)})}(this),function(root){define("modernizr",[],function(){return function(){return eval("/*!\n * Modernizr v2.6.2\n * www.modernizr.com\n *\n * Copyright (c) Faruk Ates, Paul Irish, Alex Sexton\n * Available under the BSD and MIT licenses: www.modernizr.com/license/\n */\n\n/*\n * Modernizr tests which native CSS3 and HTML5 features are available in\n * the current UA and makes the results available to you in two ways:\n * as properties on a global Modernizr object, and as classes on the\n * <html> element. This information allows you to progressively enhance\n * your pages with a granular level of control over the experience.\n *\n * Modernizr has an optional (not included) conditional resource loader\n * called Modernizr.load(), based on Yepnope.js (yepnopejs.com).\n * To get a build that includes Modernizr.load(), as well as choosing\n * which tests to include, go to www.modernizr.com/download/\n *\n * Authors        Faruk Ates, Paul Irish, Alex Sexton\n * Contributors   Ryan Seddon, Ben Alman\n */\n\nwindow.Modernizr = (function( window, document, undefined ) {\n\n    var version = '2.6.2',\n\n    Modernizr = {},\n\n    /*>>cssclasses*/\n    // option for enabling the HTML classes to be added\n    enableClasses = true,\n    /*>>cssclasses*/\n\n    docElement = document.documentElement,\n\n    /**\n     * Create our \"modernizr\" element that we do most feature tests on.\n     */\n    mod = 'modernizr',\n    modElem = document.createElement(mod),\n    mStyle = modElem.style,\n\n    /**\n     * Create the input element for various Web Forms feature tests.\n     */\n    inputElem /*>>inputelem*/ = document.createElement('input') /*>>inputelem*/ ,\n\n    /*>>smile*/\n    smile = ':)',\n    /*>>smile*/\n\n    toString = {}.toString,\n\n    // TODO :: make the prefixes more granular\n    /*>>prefixes*/\n    // List of property values to set for css tests. See ticket #21\n    prefixes = ' -webkit- -moz- -o- -ms- '.split(' '),\n    /*>>prefixes*/\n\n    /*>>domprefixes*/\n    // Following spec is to expose vendor-specific style properties as:\n    //   elem.style.WebkitBorderRadius\n    // and the following would be incorrect:\n    //   elem.style.webkitBorderRadius\n\n    // Webkit ghosts their properties in lowercase but Opera & Moz do not.\n    // Microsoft uses a lowercase `ms` instead of the correct `Ms` in IE8+\n    //   erik.eae.net/archives/2008/03/10/21.48.10/\n\n    // More here: github.com/Modernizr/Modernizr/issues/issue/21\n    omPrefixes = 'Webkit Moz O ms',\n\n    cssomPrefixes = omPrefixes.split(' '),\n\n    domPrefixes = omPrefixes.toLowerCase().split(' '),\n    /*>>domprefixes*/\n\n    /*>>ns*/\n    ns = {'svg': 'http://www.w3.org/2000/svg'},\n    /*>>ns*/\n\n    tests = {},\n    inputs = {},\n    attrs = {},\n\n    classes = [],\n\n    slice = classes.slice,\n\n    featureName, // used in testing loop\n\n\n    /*>>teststyles*/\n    // Inject element with style element and some CSS rules\n    injectElementWithStyles = function( rule, callback, nodes, testnames ) {\n\n      var style, ret, node, docOverflow,\n          div = document.createElement('div'),\n          // After page load injecting a fake body doesn't work so check if body exists\n          body = document.body,\n          // IE6 and 7 won't return offsetWidth or offsetHeight unless it's in the body element, so we fake it.\n          fakeBody = body || document.createElement('body');\n\n      if ( parseInt(nodes, 10) ) {\n          // In order not to give false positives we create a node for each test\n          // This also allows the method to scale for unspecified uses\n          while ( nodes-- ) {\n              node = document.createElement('div');\n              node.id = testnames ? testnames[nodes] : mod + (nodes + 1);\n              div.appendChild(node);\n          }\n      }\n\n      // <style> elements in IE6-9 are considered 'NoScope' elements and therefore will be removed\n      // when injected with innerHTML. To get around this you need to prepend the 'NoScope' element\n      // with a 'scoped' element, in our case the soft-hyphen entity as it won't mess with our measurements.\n      // msdn.microsoft.com/en-us/library/ms533897%28VS.85%29.aspx\n      // Documents served as xml will throw if using &shy; so use xml friendly encoded version. See issue #277\n      style = ['&#173;','<style id=\"s', mod, '\">', rule, '</style>'].join('');\n      div.id = mod;\n      // IE6 will false positive on some tests due to the style element inside the test div somehow interfering offsetHeight, so insert it into body or fakebody.\n      // Opera will act all quirky when injecting elements in documentElement when page is served as xml, needs fakebody too. #270\n      (body ? div : fakeBody).innerHTML += style;\n      fakeBody.appendChild(div);\n      if ( !body ) {\n          //avoid crashing IE8, if background image is used\n          fakeBody.style.background = '';\n          //Safari 5.13/5.1.4 OSX stops loading if ::-webkit-scrollbar is used and scrollbars are visible\n          fakeBody.style.overflow = 'hidden';\n          docOverflow = docElement.style.overflow;\n          docElement.style.overflow = 'hidden';\n          docElement.appendChild(fakeBody);\n      }\n\n      ret = callback(div, rule);\n      // If this is done after page load we don't want to remove the body so check if body exists\n      if ( !body ) {\n          fakeBody.parentNode.removeChild(fakeBody);\n          docElement.style.overflow = docOverflow;\n      } else {\n          div.parentNode.removeChild(div);\n      }\n\n      return !!ret;\n\n    },\n    /*>>teststyles*/\n\n    /*>>mq*/\n    // adapted from matchMedia polyfill\n    // by Scott Jehl and Paul Irish\n    // gist.github.com/786768\n    testMediaQuery = function( mq ) {\n\n      var matchMedia = window.matchMedia || window.msMatchMedia;\n      if ( matchMedia ) {\n        return matchMedia(mq).matches;\n      }\n\n      var bool;\n\n      injectElementWithStyles('@media ' + mq + ' { #' + mod + ' { position: absolute; } }', function( node ) {\n        bool = (window.getComputedStyle ?\n                  getComputedStyle(node, null) :\n                  node.currentStyle)['position'] == 'absolute';\n      });\n\n      return bool;\n\n     },\n     /*>>mq*/\n\n\n    /*>>hasevent*/\n    //\n    // isEventSupported determines if a given element supports the given event\n    // kangax.github.com/iseventsupported/\n    //\n    // The following results are known incorrects:\n    //   Modernizr.hasEvent(\"webkitTransitionEnd\", elem) // false negative\n    //   Modernizr.hasEvent(\"textInput\") // in Webkit. github.com/Modernizr/Modernizr/issues/333\n    //   ...\n    isEventSupported = (function() {\n\n      var TAGNAMES = {\n        'select': 'input', 'change': 'input',\n        'submit': 'form', 'reset': 'form',\n        'error': 'img', 'load': 'img', 'abort': 'img'\n      };\n\n      function isEventSupported( eventName, element ) {\n\n        element = element || document.createElement(TAGNAMES[eventName] || 'div');\n        eventName = 'on' + eventName;\n\n        // When using `setAttribute`, IE skips \"unload\", WebKit skips \"unload\" and \"resize\", whereas `in` \"catches\" those\n        var isSupported = eventName in element;\n\n        if ( !isSupported ) {\n          // If it has no `setAttribute` (i.e. doesn't implement Node interface), try generic element\n          if ( !element.setAttribute ) {\n            element = document.createElement('div');\n          }\n          if ( element.setAttribute && element.removeAttribute ) {\n            element.setAttribute(eventName, '');\n            isSupported = is(element[eventName], 'function');\n\n            // If property was created, \"remove it\" (by setting value to `undefined`)\n            if ( !is(element[eventName], 'undefined') ) {\n              element[eventName] = undefined;\n            }\n            element.removeAttribute(eventName);\n          }\n        }\n\n        element = null;\n        return isSupported;\n      }\n      return isEventSupported;\n    })(),\n    /*>>hasevent*/\n\n    // TODO :: Add flag for hasownprop ? didn't last time\n\n    // hasOwnProperty shim by kangax needed for Safari 2.0 support\n    _hasOwnProperty = ({}).hasOwnProperty, hasOwnProp;\n\n    if ( !is(_hasOwnProperty, 'undefined') && !is(_hasOwnProperty.call, 'undefined') ) {\n      hasOwnProp = function (object, property) {\n        return _hasOwnProperty.call(object, property);\n      };\n    }\n    else {\n      hasOwnProp = function (object, property) { /* yes, this can give false positives/negatives, but most of the time we don't care about those */\n        return ((property in object) && is(object.constructor.prototype[property], 'undefined'));\n      };\n    }\n\n    // Adapted from ES5-shim https://github.com/kriskowal/es5-shim/blob/master/es5-shim.js\n    // es5.github.com/#x15.3.4.5\n\n    if (!Function.prototype.bind) {\n      Function.prototype.bind = function bind(that) {\n\n        var target = this;\n\n        if (typeof target != \"function\") {\n            throw new TypeError();\n        }\n\n        var args = slice.call(arguments, 1),\n            bound = function () {\n\n            if (this instanceof bound) {\n\n              var F = function(){};\n              F.prototype = target.prototype;\n              var self = new F();\n\n              var result = target.apply(\n                  self,\n                  args.concat(slice.call(arguments))\n              );\n              if (Object(result) === result) {\n                  return result;\n              }\n              return self;\n\n            } else {\n\n              return target.apply(\n                  that,\n                  args.concat(slice.call(arguments))\n              );\n\n            }\n\n        };\n\n        return bound;\n      };\n    }\n\n    /**\n     * setCss applies given styles to the Modernizr DOM node.\n     */\n    function setCss( str ) {\n        mStyle.cssText = str;\n    }\n\n    /**\n     * setCssAll extrapolates all vendor-specific css strings.\n     */\n    function setCssAll( str1, str2 ) {\n        return setCss(prefixes.join(str1 + ';') + ( str2 || '' ));\n    }\n\n    /**\n     * is returns a boolean for if typeof obj is exactly type.\n     */\n    function is( obj, type ) {\n        return typeof obj === type;\n    }\n\n    /**\n     * contains returns a boolean for if substr is found within str.\n     */\n    function contains( str, substr ) {\n        return !!~('' + str).indexOf(substr);\n    }\n\n    /*>>testprop*/\n\n    // testProps is a generic CSS / DOM property test.\n\n    // In testing support for a given CSS property, it's legit to test:\n    //    `elem.style[styleName] !== undefined`\n    // If the property is supported it will return an empty string,\n    // if unsupported it will return undefined.\n\n    // We'll take advantage of this quick test and skip setting a style\n    // on our modernizr element, but instead just testing undefined vs\n    // empty string.\n\n    // Because the testing of the CSS property names (with \"-\", as\n    // opposed to the camelCase DOM properties) is non-portable and\n    // non-standard but works in WebKit and IE (but not Gecko or Opera),\n    // we explicitly reject properties with dashes so that authors\n    // developing in WebKit or IE first don't end up with\n    // browser-specific content by accident.\n\n    function testProps( props, prefixed ) {\n        for ( var i in props ) {\n            var prop = props[i];\n            if ( !contains(prop, \"-\") && mStyle[prop] !== undefined ) {\n                return prefixed == 'pfx' ? prop : true;\n            }\n        }\n        return false;\n    }\n    /*>>testprop*/\n\n    // TODO :: add testDOMProps\n    /**\n     * testDOMProps is a generic DOM property test; if a browser supports\n     *   a certain property, it won't return undefined for it.\n     */\n    function testDOMProps( props, obj, elem ) {\n        for ( var i in props ) {\n            var item = obj[props[i]];\n            if ( item !== undefined) {\n\n                // return the property name as a string\n                if (elem === false) return props[i];\n\n                // let's bind a function\n                if (is(item, 'function')){\n                  // default to autobind unless override\n                  return item.bind(elem || obj);\n                }\n\n                // return the unbound function or obj or value\n                return item;\n            }\n        }\n        return false;\n    }\n\n    /*>>testallprops*/\n    /**\n     * testPropsAll tests a list of DOM properties we want to check against.\n     *   We specify literally ALL possible (known and/or likely) properties on\n     *   the element including the non-vendor prefixed one, for forward-\n     *   compatibility.\n     */\n    function testPropsAll( prop, prefixed, elem ) {\n\n        var ucProp  = prop.charAt(0).toUpperCase() + prop.slice(1),\n            props   = (prop + ' ' + cssomPrefixes.join(ucProp + ' ') + ucProp).split(' ');\n\n        // did they call .prefixed('boxSizing') or are we just testing a prop?\n        if(is(prefixed, \"string\") || is(prefixed, \"undefined\")) {\n          return testProps(props, prefixed);\n\n        // otherwise, they called .prefixed('requestAnimationFrame', window[, elem])\n        } else {\n          props = (prop + ' ' + (domPrefixes).join(ucProp + ' ') + ucProp).split(' ');\n          return testDOMProps(props, prefixed, elem);\n        }\n    }\n    /*>>testallprops*/\n\n\n    /**\n     * Tests\n     * -----\n     */\n\n    // The *new* flexbox\n    // dev.w3.org/csswg/css3-flexbox\n\n    tests['flexbox'] = function() {\n      return testPropsAll('flexWrap');\n    };\n\n    // The *old* flexbox\n    // www.w3.org/TR/2009/WD-css3-flexbox-20090723/\n\n    tests['flexboxlegacy'] = function() {\n        return testPropsAll('boxDirection');\n    };\n\n    // On the S60 and BB Storm, getContext exists, but always returns undefined\n    // so we actually have to call getContext() to verify\n    // github.com/Modernizr/Modernizr/issues/issue/97/\n\n    tests['canvas'] = function() {\n        var elem = document.createElement('canvas');\n        return !!(elem.getContext && elem.getContext('2d'));\n    };\n\n    tests['canvastext'] = function() {\n        return !!(Modernizr['canvas'] && is(document.createElement('canvas').getContext('2d').fillText, 'function'));\n    };\n\n    // webk.it/70117 is tracking a legit WebGL feature detect proposal\n\n    // We do a soft detect which may false positive in order to avoid\n    // an expensive context creation: bugzil.la/732441\n\n    tests['webgl'] = function() {\n        return !!window.WebGLRenderingContext;\n    };\n\n    /*\n     * The Modernizr.touch test only indicates if the browser supports\n     *    touch events, which does not necessarily reflect a touchscreen\n     *    device, as evidenced by tablets running Windows 7 or, alas,\n     *    the Palm Pre / WebOS (touch) phones.\n     *\n     * Additionally, Chrome (desktop) used to lie about its support on this,\n     *    but that has since been rectified: crbug.com/36415\n     *\n     * We also test for Firefox 4 Multitouch Support.\n     *\n     * For more info, see: modernizr.github.com/Modernizr/touch.html\n     */\n\n    tests['touch'] = function() {\n        var bool;\n\n        if(('ontouchstart' in window) || window.DocumentTouch && document instanceof DocumentTouch) {\n          bool = true;\n        } else {\n          injectElementWithStyles(['@media (',prefixes.join('touch-enabled),('),mod,')','{#modernizr{top:9px;position:absolute}}'].join(''), function( node ) {\n            bool = node.offsetTop === 9;\n          });\n        }\n\n        return bool;\n    };\n\n\n    // geolocation is often considered a trivial feature detect...\n    // Turns out, it's quite tricky to get right:\n    //\n    // Using !!navigator.geolocation does two things we don't want. It:\n    //   1. Leaks memory in IE9: github.com/Modernizr/Modernizr/issues/513\n    //   2. Disables page caching in WebKit: webk.it/43956\n    //\n    // Meanwhile, in Firefox < 8, an about:config setting could expose\n    // a false positive that would throw an exception: bugzil.la/688158\n\n    tests['geolocation'] = function() {\n        return 'geolocation' in navigator;\n    };\n\n\n    tests['postmessage'] = function() {\n      return !!window.postMessage;\n    };\n\n\n    // Chrome incognito mode used to throw an exception when using openDatabase\n    // It doesn't anymore.\n    tests['websqldatabase'] = function() {\n      return !!window.openDatabase;\n    };\n\n    // Vendors had inconsistent prefixing with the experimental Indexed DB:\n    // - Webkit's implementation is accessible through webkitIndexedDB\n    // - Firefox shipped moz_indexedDB before FF4b9, but since then has been mozIndexedDB\n    // For speed, we don't test the legacy (and beta-only) indexedDB\n    tests['indexedDB'] = function() {\n      return !!testPropsAll(\"indexedDB\", window);\n    };\n\n    // documentMode logic from YUI to filter out IE8 Compat Mode\n    //   which false positives.\n    tests['hashchange'] = function() {\n      return isEventSupported('hashchange', window) && (document.documentMode === undefined || document.documentMode > 7);\n    };\n\n    // Per 1.6:\n    // This used to be Modernizr.historymanagement but the longer\n    // name has been deprecated in favor of a shorter and property-matching one.\n    // The old API is still available in 1.6, but as of 2.0 will throw a warning,\n    // and in the first release thereafter disappear entirely.\n    tests['history'] = function() {\n      return !!(window.history && history.pushState);\n    };\n\n    tests['draganddrop'] = function() {\n        var div = document.createElement('div');\n        return ('draggable' in div) || ('ondragstart' in div && 'ondrop' in div);\n    };\n\n    // FF3.6 was EOL'ed on 4/24/12, but the ESR version of FF10\n    // will be supported until FF19 (2/12/13), at which time, ESR becomes FF17.\n    // FF10 still uses prefixes, so check for it until then.\n    // for more ESR info, see: mozilla.org/en-US/firefox/organizations/faq/\n    tests['websockets'] = function() {\n        return 'WebSocket' in window || 'MozWebSocket' in window;\n    };\n\n\n    // css-tricks.com/rgba-browser-support/\n    tests['rgba'] = function() {\n        // Set an rgba() color and check the returned value\n\n        setCss('background-color:rgba(150,255,150,.5)');\n\n        return contains(mStyle.backgroundColor, 'rgba');\n    };\n\n    tests['hsla'] = function() {\n        // Same as rgba(), in fact, browsers re-map hsla() to rgba() internally,\n        //   except IE9 who retains it as hsla\n\n        setCss('background-color:hsla(120,40%,100%,.5)');\n\n        return contains(mStyle.backgroundColor, 'rgba') || contains(mStyle.backgroundColor, 'hsla');\n    };\n\n    tests['multiplebgs'] = function() {\n        // Setting multiple images AND a color on the background shorthand property\n        //  and then querying the style.background property value for the number of\n        //  occurrences of \"url(\" is a reliable method for detecting ACTUAL support for this!\n\n        setCss('background:url(https://),url(https://),red url(https://)');\n\n        // If the UA supports multiple backgrounds, there should be three occurrences\n        //   of the string \"url(\" in the return value for elemStyle.background\n\n        return (/(url\\s*\\(.*?){3}/).test(mStyle.background);\n    };\n\n\n\n    // this will false positive in Opera Mini\n    //   github.com/Modernizr/Modernizr/issues/396\n\n    tests['backgroundsize'] = function() {\n        return testPropsAll('backgroundSize');\n    };\n\n    tests['borderimage'] = function() {\n        return testPropsAll('borderImage');\n    };\n\n\n    // Super comprehensive table about all the unique implementations of\n    // border-radius: muddledramblings.com/table-of-css3-border-radius-compliance\n\n    tests['borderradius'] = function() {\n        return testPropsAll('borderRadius');\n    };\n\n    // WebOS unfortunately false positives on this test.\n    tests['boxshadow'] = function() {\n        return testPropsAll('boxShadow');\n    };\n\n    // FF3.0 will false positive on this test\n    tests['textshadow'] = function() {\n        return document.createElement('div').style.textShadow === '';\n    };\n\n\n    tests['opacity'] = function() {\n        // Browsers that actually have CSS Opacity implemented have done so\n        //  according to spec, which means their return values are within the\n        //  range of [0.0,1.0] - including the leading zero.\n\n        setCssAll('opacity:.55');\n\n        // The non-literal . in this regex is intentional:\n        //   German Chrome returns this value as 0,55\n        // github.com/Modernizr/Modernizr/issues/#issue/59/comment/516632\n        return (/^0.55$/).test(mStyle.opacity);\n    };\n\n\n    // Note, Android < 4 will pass this test, but can only animate\n    //   a single property at a time\n    //   daneden.me/2011/12/putting-up-with-androids-bullshit/\n    tests['cssanimations'] = function() {\n        return testPropsAll('animationName');\n    };\n\n\n    tests['csscolumns'] = function() {\n        return testPropsAll('columnCount');\n    };\n\n\n    tests['cssgradients'] = function() {\n        /**\n         * For CSS Gradients syntax, please see:\n         * webkit.org/blog/175/introducing-css-gradients/\n         * developer.mozilla.org/en/CSS/-moz-linear-gradient\n         * developer.mozilla.org/en/CSS/-moz-radial-gradient\n         * dev.w3.org/csswg/css3-images/#gradients-\n         */\n\n        var str1 = 'background-image:',\n            str2 = 'gradient(linear,left top,right bottom,from(#9f9),to(white));',\n            str3 = 'linear-gradient(left top,#9f9, white);';\n\n        setCss(\n             // legacy webkit syntax (FIXME: remove when syntax not in use anymore)\n              (str1 + '-webkit- '.split(' ').join(str2 + str1) +\n             // standard syntax             // trailing 'background-image:'\n              prefixes.join(str3 + str1)).slice(0, -str1.length)\n        );\n\n        return contains(mStyle.backgroundImage, 'gradient');\n    };\n\n\n    tests['cssreflections'] = function() {\n        return testPropsAll('boxReflect');\n    };\n\n\n    tests['csstransforms'] = function() {\n        return !!testPropsAll('transform');\n    };\n\n\n    tests['csstransforms3d'] = function() {\n\n        var ret = !!testPropsAll('perspective');\n\n        // Webkit's 3D transforms are passed off to the browser's own graphics renderer.\n        //   It works fine in Safari on Leopard and Snow Leopard, but not in Chrome in\n        //   some conditions. As a result, Webkit typically recognizes the syntax but\n        //   will sometimes throw a false positive, thus we must do a more thorough check:\n        if ( ret && 'webkitPerspective' in docElement.style ) {\n\n          // Webkit allows this media query to succeed only if the feature is enabled.\n          // `@media (transform-3d),(-webkit-transform-3d){ ... }`\n          injectElementWithStyles('@media (transform-3d),(-webkit-transform-3d){#modernizr{left:9px;position:absolute;height:3px;}}', function( node, rule ) {\n            ret = node.offsetLeft === 9 && node.offsetHeight === 3;\n          });\n        }\n        return ret;\n    };\n\n\n    tests['csstransitions'] = function() {\n        return testPropsAll('transition');\n    };\n\n\n    /*>>fontface*/\n    // @font-face detection routine by Diego Perini\n    // javascript.nwbox.com/CSSSupport/\n\n    // false positives:\n    //   WebOS github.com/Modernizr/Modernizr/issues/342\n    //   WP7   github.com/Modernizr/Modernizr/issues/538\n    tests['fontface'] = function() {\n        var bool;\n\n        injectElementWithStyles('@font-face {font-family:\"font\";src:url(\"https://\")}', function( node, rule ) {\n          var style = document.getElementById('smodernizr'),\n              sheet = style.sheet || style.styleSheet,\n              cssText = sheet ? (sheet.cssRules && sheet.cssRules[0] ? sheet.cssRules[0].cssText : sheet.cssText || '') : '';\n\n          bool = /src/i.test(cssText) && cssText.indexOf(rule.split(' ')[0]) === 0;\n        });\n\n        return bool;\n    };\n    /*>>fontface*/\n\n    // CSS generated content detection\n    tests['generatedcontent'] = function() {\n        var bool;\n\n        injectElementWithStyles(['#',mod,'{font:0/0 a}#',mod,':after{content:\"',smile,'\";visibility:hidden;font:3px/1 a}'].join(''), function( node ) {\n          bool = node.offsetHeight >= 3;\n        });\n\n        return bool;\n    };\n\n\n\n    // These tests evaluate support of the video/audio elements, as well as\n    // testing what types of content they support.\n    //\n    // We're using the Boolean constructor here, so that we can extend the value\n    // e.g.  Modernizr.video     // true\n    //       Modernizr.video.ogg // 'probably'\n    //\n    // Codec values from : github.com/NielsLeenheer/html5test/blob/9106a8/index.html#L845\n    //                     thx to NielsLeenheer and zcorpan\n\n    // Note: in some older browsers, \"no\" was a return value instead of empty string.\n    //   It was live in FF3.5.0 and 3.5.1, but fixed in 3.5.2\n    //   It was also live in Safari 4.0.0 - 4.0.4, but fixed in 4.0.5\n\n    tests['video'] = function() {\n        var elem = document.createElement('video'),\n            bool = false;\n\n        // IE9 Running on Windows Server SKU can cause an exception to be thrown, bug #224\n        try {\n            if ( bool = !!elem.canPlayType ) {\n                bool      = new Boolean(bool);\n                bool.ogg  = elem.canPlayType('video/ogg; codecs=\"theora\"')      .replace(/^no$/,'');\n\n                // Without QuickTime, this value will be `undefined`. github.com/Modernizr/Modernizr/issues/546\n                bool.h264 = elem.canPlayType('video/mp4; codecs=\"avc1.42E01E\"') .replace(/^no$/,'');\n\n                bool.webm = elem.canPlayType('video/webm; codecs=\"vp8, vorbis\"').replace(/^no$/,'');\n            }\n\n        } catch(e) { }\n\n        return bool;\n    };\n\n    tests['audio'] = function() {\n        var elem = document.createElement('audio'),\n            bool = false;\n\n        try {\n            if ( bool = !!elem.canPlayType ) {\n                bool      = new Boolean(bool);\n                bool.ogg  = elem.canPlayType('audio/ogg; codecs=\"vorbis\"').replace(/^no$/,'');\n                bool.mp3  = elem.canPlayType('audio/mpeg;')               .replace(/^no$/,'');\n\n                // Mimetypes accepted:\n                //   developer.mozilla.org/En/Media_formats_supported_by_the_audio_and_video_elements\n                //   bit.ly/iphoneoscodecs\n                bool.wav  = elem.canPlayType('audio/wav; codecs=\"1\"')     .replace(/^no$/,'');\n                bool.m4a  = ( elem.canPlayType('audio/x-m4a;')            ||\n                              elem.canPlayType('audio/aac;'))             .replace(/^no$/,'');\n            }\n        } catch(e) { }\n\n        return bool;\n    };\n\n\n    // In FF4, if disabled, window.localStorage should === null.\n\n    // Normally, we could not test that directly and need to do a\n    //   `('localStorage' in window) && ` test first because otherwise Firefox will\n    //   throw bugzil.la/365772 if cookies are disabled\n\n    // Also in iOS5 Private Browsing mode, attempting to use localStorage.setItem\n    // will throw the exception:\n    //   QUOTA_EXCEEDED_ERRROR DOM Exception 22.\n    // Peculiarly, getItem and removeItem calls do not throw.\n\n    // Because we are forced to try/catch this, we'll go aggressive.\n\n    // Just FWIW: IE8 Compat mode supports these features completely:\n    //   www.quirksmode.org/dom/html5.html\n    // But IE8 doesn't support either with local files\n\n    tests['localstorage'] = function() {\n        try {\n            localStorage.setItem(mod, mod);\n            localStorage.removeItem(mod);\n            return true;\n        } catch(e) {\n            return false;\n        }\n    };\n\n    tests['sessionstorage'] = function() {\n        try {\n            sessionStorage.setItem(mod, mod);\n            sessionStorage.removeItem(mod);\n            return true;\n        } catch(e) {\n            return false;\n        }\n    };\n\n\n    tests['webworkers'] = function() {\n        return !!window.Worker;\n    };\n\n\n    tests['applicationcache'] = function() {\n        return !!window.applicationCache;\n    };\n\n\n    // Thanks to Erik Dahlstrom\n    tests['svg'] = function() {\n        return !!document.createElementNS && !!document.createElementNS(ns.svg, 'svg').createSVGRect;\n    };\n\n    // specifically for SVG inline in HTML, not within XHTML\n    // test page: paulirish.com/demo/inline-svg\n    tests['inlinesvg'] = function() {\n      var div = document.createElement('div');\n      div.innerHTML = '<svg/>';\n      return (div.firstChild && div.firstChild.namespaceURI) == ns.svg;\n    };\n\n    // SVG SMIL animation\n    tests['smil'] = function() {\n        return !!document.createElementNS && /SVGAnimate/.test(toString.call(document.createElementNS(ns.svg, 'animate')));\n    };\n\n    // This test is only for clip paths in SVG proper, not clip paths on HTML content\n    // demo: srufaculty.sru.edu/david.dailey/svg/newstuff/clipPath4.svg\n\n    // However read the comments to dig into applying SVG clippaths to HTML content here:\n    //   github.com/Modernizr/Modernizr/issues/213#issuecomment-1149491\n    tests['svgclippaths'] = function() {\n        return !!document.createElementNS && /SVGClipPath/.test(toString.call(document.createElementNS(ns.svg, 'clipPath')));\n    };\n\n    /*>>webforms*/\n    // input features and input types go directly onto the ret object, bypassing the tests loop.\n    // Hold this guy to execute in a moment.\n    function webforms() {\n        /*>>input*/\n        // Run through HTML5's new input attributes to see if the UA understands any.\n        // We're using f which is the <input> element created early on\n        // Mike Taylr has created a comprehensive resource for testing these attributes\n        //   when applied to all input types:\n        //   miketaylr.com/code/input-type-attr.html\n        // spec: www.whatwg.org/specs/web-apps/current-work/multipage/the-input-element.html#input-type-attr-summary\n\n        // Only input placeholder is tested while textarea's placeholder is not.\n        // Currently Safari 4 and Opera 11 have support only for the input placeholder\n        // Both tests are available in feature-detects/forms-placeholder.js\n        Modernizr['input'] = (function( props ) {\n            for ( var i = 0, len = props.length; i < len; i++ ) {\n                attrs[ props[i] ] = !!(props[i] in inputElem);\n            }\n            if (attrs.list){\n              // safari false positive's on datalist: webk.it/74252\n              // see also github.com/Modernizr/Modernizr/issues/146\n              attrs.list = !!(document.createElement('datalist') && window.HTMLDataListElement);\n            }\n            return attrs;\n        })('autocomplete autofocus list placeholder max min multiple pattern required step'.split(' '));\n        /*>>input*/\n\n        /*>>inputtypes*/\n        // Run through HTML5's new input types to see if the UA understands any.\n        //   This is put behind the tests runloop because it doesn't return a\n        //   true/false like all the other tests; instead, it returns an object\n        //   containing each input type with its corresponding true/false value\n\n        // Big thanks to @miketaylr for the html5 forms expertise. miketaylr.com/\n        Modernizr['inputtypes'] = (function(props) {\n\n            for ( var i = 0, bool, inputElemType, defaultView, len = props.length; i < len; i++ ) {\n\n                inputElem.setAttribute('type', inputElemType = props[i]);\n                bool = inputElem.type !== 'text';\n\n                // We first check to see if the type we give it sticks..\n                // If the type does, we feed it a textual value, which shouldn't be valid.\n                // If the value doesn't stick, we know there's input sanitization which infers a custom UI\n                if ( bool ) {\n\n                    inputElem.value         = smile;\n                    inputElem.style.cssText = 'position:absolute;visibility:hidden;';\n\n                    if ( /^range$/.test(inputElemType) && inputElem.style.WebkitAppearance !== undefined ) {\n\n                      docElement.appendChild(inputElem);\n                      defaultView = document.defaultView;\n\n                      // Safari 2-4 allows the smiley as a value, despite making a slider\n                      bool =  defaultView.getComputedStyle &&\n                              defaultView.getComputedStyle(inputElem, null).WebkitAppearance !== 'textfield' &&\n                              // Mobile android web browser has false positive, so must\n                              // check the height to see if the widget is actually there.\n                              (inputElem.offsetHeight !== 0);\n\n                      docElement.removeChild(inputElem);\n\n                    } else if ( /^(search|tel)$/.test(inputElemType) ){\n                      // Spec doesn't define any special parsing or detectable UI\n                      //   behaviors so we pass these through as true\n\n                      // Interestingly, opera fails the earlier test, so it doesn't\n                      //  even make it here.\n\n                    } else if ( /^(url|email)$/.test(inputElemType) ) {\n                      // Real url and email support comes with prebaked validation.\n                      bool = inputElem.checkValidity && inputElem.checkValidity() === false;\n\n                    } else {\n                      // If the upgraded input compontent rejects the :) text, we got a winner\n                      bool = inputElem.value != smile;\n                    }\n                }\n\n                inputs[ props[i] ] = !!bool;\n            }\n            return inputs;\n        })('search tel url email datetime date month week time datetime-local number range color'.split(' '));\n        /*>>inputtypes*/\n    }\n    /*>>webforms*/\n\n\n    // End of test definitions\n    // -----------------------\n\n\n\n    // Run through all tests and detect their support in the current UA.\n    // todo: hypothetically we could be doing an array of tests and use a basic loop here.\n    for ( var feature in tests ) {\n        if ( hasOwnProp(tests, feature) ) {\n            // run the test, throw the return value into the Modernizr,\n            //   then based on that boolean, define an appropriate className\n            //   and push it into an array of classes we'll join later.\n            featureName  = feature.toLowerCase();\n            Modernizr[featureName] = tests[feature]();\n\n            classes.push((Modernizr[featureName] ? '' : 'no-') + featureName);\n        }\n    }\n\n    /*>>webforms*/\n    // input tests need to run.\n    Modernizr.input || webforms();\n    /*>>webforms*/\n\n\n    /**\n     * addTest allows the user to define their own feature tests\n     * the result will be added onto the Modernizr object,\n     * as well as an appropriate className set on the html element\n     *\n     * @param feature - String naming the feature\n     * @param test - Function returning true if feature is supported, false if not\n     */\n     Modernizr.addTest = function ( feature, test ) {\n       if ( typeof feature == 'object' ) {\n         for ( var key in feature ) {\n           if ( hasOwnProp( feature, key ) ) {\n             Modernizr.addTest( key, feature[ key ] );\n           }\n         }\n       } else {\n\n         feature = feature.toLowerCase();\n\n         if ( Modernizr[feature] !== undefined ) {\n           // we're going to quit if you're trying to overwrite an existing test\n           // if we were to allow it, we'd do this:\n           //   var re = new RegExp(\"\\\\b(no-)?\" + feature + \"\\\\b\");\n           //   docElement.className = docElement.className.replace( re, '' );\n           // but, no rly, stuff 'em.\n           return Modernizr;\n         }\n\n         test = typeof test == 'function' ? test() : test;\n\n         if (typeof enableClasses !== \"undefined\" && enableClasses) {\n           docElement.className += ' ' + (test ? '' : 'no-') + feature;\n         }\n         Modernizr[feature] = test;\n\n       }\n\n       return Modernizr; // allow chaining.\n     };\n\n\n    // Reset modElem.cssText to nothing to reduce memory footprint.\n    setCss('');\n    modElem = inputElem = null;\n\n    /*>>shiv*/\n    /*! HTML5 Shiv v3.6.1 | @afarkas @jdalton @jon_neal @rem | MIT/GPL2 Licensed */\n    ;(function(window, document) {\n    /*jshint evil:true */\n      /** Preset options */\n      var options = window.html5 || {};\n\n      /** Used to skip problem elements */\n      var reSkip = /^<|^(?:button|map|select|textarea|object|iframe|option|optgroup)$/i;\n\n      /** Not all elements can be cloned in IE **/\n      var saveClones = /^(?:a|b|code|div|fieldset|h1|h2|h3|h4|h5|h6|i|label|li|ol|p|q|span|strong|style|table|tbody|td|th|tr|ul)$/i;\n\n      /** Detect whether the browser supports default html5 styles */\n      var supportsHtml5Styles;\n\n      /** Name of the expando, to work with multiple documents or to re-shiv one document */\n      var expando = '_html5shiv';\n\n      /** The id for the the documents expando */\n      var expanID = 0;\n\n      /** Cached data for each document */\n      var expandoData = {};\n\n      /** Detect whether the browser supports unknown elements */\n      var supportsUnknownElements;\n\n      (function() {\n        try {\n            var a = document.createElement('a');\n            a.innerHTML = '<xyz></xyz>';\n            //if the hidden property is implemented we can assume, that the browser supports basic HTML5 Styles\n            supportsHtml5Styles = ('hidden' in a);\n\n            supportsUnknownElements = a.childNodes.length == 1 || (function() {\n              // assign a false positive if unable to shiv\n              (document.createElement)('a');\n              var frag = document.createDocumentFragment();\n              return (\n                typeof frag.cloneNode == 'undefined' ||\n                typeof frag.createDocumentFragment == 'undefined' ||\n                typeof frag.createElement == 'undefined'\n              );\n            }());\n        } catch(e) {\n          supportsHtml5Styles = true;\n          supportsUnknownElements = true;\n        }\n\n      }());\n\n      /*--------------------------------------------------------------------------*/\n\n      /**\n       * Creates a style sheet with the given CSS text and adds it to the document.\n       * @private\n       * @param {Document} ownerDocument The document.\n       * @param {String} cssText The CSS text.\n       * @returns {StyleSheet} The style element.\n       */\n      function addStyleSheet(ownerDocument, cssText) {\n        var p = ownerDocument.createElement('p'),\n            parent = ownerDocument.getElementsByTagName('head')[0] || ownerDocument.documentElement;\n\n        p.innerHTML = 'x<style>' + cssText + '</style>';\n        return parent.insertBefore(p.lastChild, parent.firstChild);\n      }\n\n      /**\n       * Returns the value of `html5.elements` as an array.\n       * @private\n       * @returns {Array} An array of shived element node names.\n       */\n      function getElements() {\n        var elements = html5.elements;\n        return typeof elements == 'string' ? elements.split(' ') : elements;\n      }\n\n        /**\n       * Returns the data associated to the given document\n       * @private\n       * @param {Document} ownerDocument The document.\n       * @returns {Object} An object of data.\n       */\n      function getExpandoData(ownerDocument) {\n        var data = expandoData[ownerDocument[expando]];\n        if (!data) {\n            data = {};\n            expanID++;\n            ownerDocument[expando] = expanID;\n            expandoData[expanID] = data;\n        }\n        return data;\n      }\n\n      /**\n       * returns a shived element for the given nodeName and document\n       * @memberOf html5\n       * @param {String} nodeName name of the element\n       * @param {Document} ownerDocument The context document.\n       * @returns {Object} The shived element.\n       */\n      function createElement(nodeName, ownerDocument, data){\n        if (!ownerDocument) {\n            ownerDocument = document;\n        }\n        if(supportsUnknownElements){\n            return ownerDocument.createElement(nodeName);\n        }\n        if (!data) {\n            data = getExpandoData(ownerDocument);\n        }\n        var node;\n\n        if (data.cache[nodeName]) {\n            node = data.cache[nodeName].cloneNode();\n        } else if (saveClones.test(nodeName)) {\n            node = (data.cache[nodeName] = data.createElem(nodeName)).cloneNode();\n        } else {\n            node = data.createElem(nodeName);\n        }\n\n        // Avoid adding some elements to fragments in IE < 9 because\n        // * Attributes like `name` or `type` cannot be set/changed once an element\n        //   is inserted into a document/fragment\n        // * Link elements with `src` attributes that are inaccessible, as with\n        //   a 403 response, will cause the tab/window to crash\n        // * Script elements appended to fragments will execute when their `src`\n        //   or `text` property is set\n        return node.canHaveChildren && !reSkip.test(nodeName) ? data.frag.appendChild(node) : node;\n      }\n\n      /**\n       * returns a shived DocumentFragment for the given document\n       * @memberOf html5\n       * @param {Document} ownerDocument The context document.\n       * @returns {Object} The shived DocumentFragment.\n       */\n      function createDocumentFragment(ownerDocument, data){\n        if (!ownerDocument) {\n            ownerDocument = document;\n        }\n        if(supportsUnknownElements){\n            return ownerDocument.createDocumentFragment();\n        }\n        data = data || getExpandoData(ownerDocument);\n        var clone = data.frag.cloneNode(),\n            i = 0,\n            elems = getElements(),\n            l = elems.length;\n        for(;i<l;i++){\n            clone.createElement(elems[i]);\n        }\n        return clone;\n      }\n\n      /**\n       * Shivs the `createElement` and `createDocumentFragment` methods of the document.\n       * @private\n       * @param {Document|DocumentFragment} ownerDocument The document.\n       * @param {Object} data of the document.\n       */\n      function shivMethods(ownerDocument, data) {\n        if (!data.cache) {\n            data.cache = {};\n            data.createElem = ownerDocument.createElement;\n            data.createFrag = ownerDocument.createDocumentFragment;\n            data.frag = data.createFrag();\n        }\n\n\n        ownerDocument.createElement = function(nodeName) {\n          //abort shiv\n          if (!html5.shivMethods) {\n              return data.createElem(nodeName);\n          }\n          return createElement(nodeName, ownerDocument, data);\n        };\n\n        ownerDocument.createDocumentFragment = Function('h,f', 'return function(){' +\n          'var n=f.cloneNode(),c=n.createElement;' +\n          'h.shivMethods&&(' +\n            // unroll the `createElement` calls\n            getElements().join().replace(/\\w+/g, function(nodeName) {\n              data.createElem(nodeName);\n              data.frag.createElement(nodeName);\n              return 'c(\"' + nodeName + '\")';\n            }) +\n          ');return n}'\n        )(html5, data.frag);\n      }\n\n      /*--------------------------------------------------------------------------*/\n\n      /**\n       * Shivs the given document.\n       * @memberOf html5\n       * @param {Document} ownerDocument The document to shiv.\n       * @returns {Document} The shived document.\n       */\n      function shivDocument(ownerDocument) {\n        if (!ownerDocument) {\n            ownerDocument = document;\n        }\n        var data = getExpandoData(ownerDocument);\n\n        if (html5.shivCSS && !supportsHtml5Styles && !data.hasCSS) {\n          data.hasCSS = !!addStyleSheet(ownerDocument,\n            // corrects block display not defined in IE6/7/8/9\n            'article,aside,figcaption,figure,footer,header,hgroup,nav,section{display:block}' +\n            // adds styling not present in IE6/7/8/9\n            'mark{background:#FF0;color:#000}'\n          );\n        }\n        if (!supportsUnknownElements) {\n          shivMethods(ownerDocument, data);\n        }\n        return ownerDocument;\n      }\n\n      /*--------------------------------------------------------------------------*/\n\n      /**\n       * The `html5` object is exposed so that more elements can be shived and\n       * existing shiving can be detected on iframes.\n       * @type Object\n       * @example\n       *\n       * // options can be changed before the script is included\n       * html5 = { 'elements': 'mark section', 'shivCSS': false, 'shivMethods': false };\n       */\n      var html5 = {\n\n        /**\n         * An array or space separated string of node names of the elements to shiv.\n         * @memberOf html5\n         * @type Array|String\n         */\n        'elements': options.elements || 'abbr article aside audio bdi canvas data datalist details figcaption figure footer header hgroup mark meter nav output progress section summary time video',\n\n        /**\n         * A flag to indicate that the HTML5 style sheet should be inserted.\n         * @memberOf html5\n         * @type Boolean\n         */\n        'shivCSS': (options.shivCSS !== false),\n\n        /**\n         * Is equal to true if a browser supports creating unknown/HTML5 elements\n         * @memberOf html5\n         * @type boolean\n         */\n        'supportsUnknownElements': supportsUnknownElements,\n\n        /**\n         * A flag to indicate that the document's `createElement` and `createDocumentFragment`\n         * methods should be overwritten.\n         * @memberOf html5\n         * @type Boolean\n         */\n        'shivMethods': (options.shivMethods !== false),\n\n        /**\n         * A string to describe the type of `html5` object (\"default\" or \"default print\").\n         * @memberOf html5\n         * @type String\n         */\n        'type': 'default',\n\n        // shivs the document according to the specified `html5` object options\n        'shivDocument': shivDocument,\n\n        //creates a shived element\n        createElement: createElement,\n\n        //creates a shived documentFragment\n        createDocumentFragment: createDocumentFragment\n      };\n\n      /*--------------------------------------------------------------------------*/\n\n      // expose html5\n      window.html5 = html5;\n\n      // shiv the document\n      shivDocument(document);\n\n    }(this, document));\n    /*>>shiv*/\n\n    // Assign private properties to the return object with prefix\n    Modernizr._version      = version;\n\n    // expose these for the plugin API. Look in the source for how to join() them against your input\n    /*>>prefixes*/\n    Modernizr._prefixes     = prefixes;\n    /*>>prefixes*/\n    /*>>domprefixes*/\n    Modernizr._domPrefixes  = domPrefixes;\n    Modernizr._cssomPrefixes  = cssomPrefixes;\n    /*>>domprefixes*/\n\n    /*>>mq*/\n    // Modernizr.mq tests a given media query, live against the current state of the window\n    // A few important notes:\n    //   * If a browser does not support media queries at all (eg. oldIE) the mq() will always return false\n    //   * A max-width or orientation query will be evaluated against the current state, which may change later.\n    //   * You must specify values. Eg. If you are testing support for the min-width media query use:\n    //       Modernizr.mq('(min-width:0)')\n    // usage:\n    // Modernizr.mq('only screen and (max-width:768)')\n    Modernizr.mq            = testMediaQuery;\n    /*>>mq*/\n\n    /*>>hasevent*/\n    // Modernizr.hasEvent() detects support for a given event, with an optional element to test on\n    // Modernizr.hasEvent('gesturestart', elem)\n    Modernizr.hasEvent      = isEventSupported;\n    /*>>hasevent*/\n\n    /*>>testprop*/\n    // Modernizr.testProp() investigates whether a given style property is recognized\n    // Note that the property names must be provided in the camelCase variant.\n    // Modernizr.testProp('pointerEvents')\n    Modernizr.testProp      = function(prop){\n        return testProps([prop]);\n    };\n    /*>>testprop*/\n\n    /*>>testallprops*/\n    // Modernizr.testAllProps() investigates whether a given style property,\n    //   or any of its vendor-prefixed variants, is recognized\n    // Note that the property names must be provided in the camelCase variant.\n    // Modernizr.testAllProps('boxSizing')\n    Modernizr.testAllProps  = testPropsAll;\n    /*>>testallprops*/\n\n\n    /*>>teststyles*/\n    // Modernizr.testStyles() allows you to add custom styles to the document and test an element afterwards\n    // Modernizr.testStyles('#modernizr { position:absolute }', function(elem, rule){ ... })\n    Modernizr.testStyles    = injectElementWithStyles;\n    /*>>teststyles*/\n\n\n    /*>>prefixed*/\n    // Modernizr.prefixed() returns the prefixed or nonprefixed property name variant of your input\n    // Modernizr.prefixed('boxSizing') // 'MozBoxSizing'\n\n    // Properties must be passed as dom-style camelcase, rather than `box-sizing` hypentated style.\n    // Return values will also be the camelCase variant, if you need to translate that to hypenated style use:\n    //\n    //     str.replace(/([A-Z])/g, function(str,m1){ return '-' + m1.toLowerCase(); }).replace(/^ms-/,'-ms-');\n\n    // If you're trying to ascertain which transition end event to bind to, you might do something like...\n    //\n    //     var transEndEventNames = {\n    //       'WebkitTransition' : 'webkitTransitionEnd',\n    //       'MozTransition'    : 'transitionend',\n    //       'OTransition'      : 'oTransitionEnd',\n    //       'msTransition'     : 'MSTransitionEnd',\n    //       'transition'       : 'transitionend'\n    //     },\n    //     transEndEventName = transEndEventNames[ Modernizr.prefixed('transition') ];\n\n    Modernizr.prefixed      = function(prop, obj, elem){\n      if(!obj) {\n        return testPropsAll(prop, 'pfx');\n      } else {\n        // Testing DOM property e.g. Modernizr.prefixed('requestAnimationFrame', window) // 'mozRequestAnimationFrame'\n        return testPropsAll(prop, obj, elem);\n      }\n    };\n    /*>>prefixed*/\n\n\n    /*>>cssclasses*/\n    // Remove \"no-js\" class from <html> element, if it exists:\n    docElement.className = docElement.className.replace(/(^|\\s)no-js(\\s|$)/, '$1$2') +\n\n                            // Add the new classes to the <html> element.\n                            (enableClasses ? ' js ' + classes.join(' ') : '');\n    /*>>cssclasses*/\n\n    return Modernizr;\n\n})(this, this.document);\n\n//# sourceURL=/lib/graphite-api/public/js/libs/modernizr.js"),
root.Modernizr=Modernizr}.apply(root,arguments)})}(this),eval('define(\'text!config-json\',[],function () { return \'{\\n    "MIXPANEL_TOKEN": "9b5a750f43106227e95a0df67e846eab",\\n    "IMS_CLIENT_ID": "bracketsextract1",\\n    "IMSLIB_URL": "https://static.adobelogin.com/renga-idprovider/resources/js/imslib_b_01.min.js",\\n    "ASSETS_HOST": "assets.adobe.com",\\n    "IMAGE_SERVICE_HOST" : "https://cc-api-image.adobe.io",\\n    "IMAGE_SERVICE_PORT": 443,\\n    "FILESTORAGE_HOST": "https://cc-api-storage.adobe.io",\\n    "ADOBE_ANALYTICS_ACCOUNT": "adbemextract4brackets.rebootprod2",\\n    "COLLAB_SERVICE_HOST": "https://cc-collab.adobe.io",\\n    "COLLAB_IMAGE_SERVICE_HOST": "https://cc-api-image-x.adobe.io",\\n    "API_KEY": "bracketsextract1"\\n}\';});\n\n//# sourceURL=/text!config-json'),eval('/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4, maxerr: 50, bitwise: true */\n/*global define, document, window*/\ndefine(\'mixpanel-brackets\',["text!config-json"], function (configText) {\n    "use strict";\n\n    // HACK\n    // https://git.corp.adobe.com/jhagenst/brackets-parfait-extension/issues/331\n    // Eventually, Brackets should allow cookies\n    var localStorageKey = "brackets-cookie",\n        canWriteCookie = false;\n\n    // Test writing to document.cookie\n    var cookieString = "__mixpanel_test_cookie__=" + Math.random();\n    document.cookie = cookieString;\n    canWriteCookie = (document.cookie.indexOf(cookieString) !== -1);\n\n    if (!canWriteCookie) {\n        // Use defineProperty to shim document.cookie\n        // Note that the get/set properties are not symmetrical\n        // `set` assigns a new singular cookie, but `get` returns all cookies\n        Object.defineProperty(\n            document,\n            "cookie",\n            {\n                // Return all cookies by reading keys from JSON object,\n                // concatenated using cookie key1=value1; ... keyN=valueN format\n                get: function () {\n                    var localStorageString = window.localStorage.getItem(localStorageKey),\n                        json = {},\n                        retVal = "",\n                        separator = "";\n                    \n                    if (localStorageString) {\n                        json = JSON.parse(localStorageString);\n                    }\n                    \n                    Object.keys(json).forEach(function (key) {\n                        retVal += separator + key + "=" + json[key];\n\n                        // separator is inserted before each pair, no separator\n                        // after last pair\n                        if (!separator) {\n                            separator = "; ";\n                        }\n                    });\n                    \n                    return retVal;\n                },\n                set: function (cookie) {\n                    var indexOfAssign = cookie.indexOf("="),\n                        indexOfAttrs = cookie.indexOf(";");\n                    \n                    if (indexOfAssign < 0) {\n                        return;\n                    }\n\n                    // Ignore attributes "; <attr>=<attrValue>" (e.g. path, domain, expires, etc.)\n                    indexOfAttrs = (indexOfAttrs >= 0) ? indexOfAttrs : undefined;\n                    \n                    var key = cookie.substring(0, indexOfAssign),\n                        value = cookie.substring(indexOfAssign + 1, indexOfAttrs),\n                        jsonString = window.localStorage.getItem(localStorageKey),\n                        json;\n                    \n                    // Change localStorage string to JSON\n                    json = (jsonString && JSON.parse(jsonString)) || {};\n                    \n                    // Create/Update key\n                    json[key] = value;\n                    \n                    // Change JSON back to localStorage String\n                    window.localStorage.setItem(localStorageKey, JSON.stringify(json));\n                }\n            }\n        );\n    }\n\n    // this is a stripped down version of the mixpanel snippet that removes the loading of the lib via external script tag and the stubs for queuing calls\n    var b=window.mixpanel=window.mixpanel||[];var i,g;b._i=[];b.init=function(a,e,d){function f(b,h){var a=h.split(".");2==a.length&&(b=b[a[0]],h=a[1]);b[h]=function(){b.push([h].concat(Array.prototype.slice.call(arguments,0)))}}"undefined"!==typeof d?c=b[d]=[]:d="mixpanel";b._i.push([a,e,d])};b.__SV=1.2;\n    b.init(JSON.parse(configText).MIXPANEL_TOKEN);\n});\n//# sourceURL=/mixpanel-brackets.js'),function(root){define("mixpanel",["mixpanel-brackets"],function(){return function(){return eval("/*\n * Mixpanel JS Library v2.2.3\n *\n * Copyright 2012, Mixpanel, Inc. All Rights Reserved\n * http://mixpanel.com/\n *\n * Includes portions of Underscore.js\n * http://documentcloud.github.com/underscore/\n * (c) 2011 Jeremy Ashkenas, DocumentCloud Inc.\n * Released under the MIT License.\n */\n\n// ==ClosureCompiler==\n// @compilation_level ADVANCED_OPTIMIZATIONS\n// @output_file_name mixpanel-2.2.min.js\n// ==/ClosureCompiler==\n\n/*\nWill export window.mixpanel\n*/\n\n/*\nSIMPLE STYLE GUIDE:\n\nthis.x == public function\nthis._x == internal - only use within this file\nthis.__x == private - only use within the class\n\nGlobals should be all caps\n*/\n(function (mixpanel) {\n\n/*\n * Saved references to long variable names, so that closure compiler can\n * minimize file size.\n */\n    var   ArrayProto        = Array.prototype\n        , ObjProto          = Object.prototype\n        , slice             = ArrayProto.slice\n        , toString          = ObjProto.toString\n        , hasOwnProperty    = ObjProto.hasOwnProperty\n        , windowConsole     = window.console\n        , navigator         = window.navigator\n        , document          = window.document\n        , userAgent         = navigator.userAgent;\n\n/*\n * Constants\n */\n/** @const */   var   PRIMARY_INSTANCE_NAME     = \"mixpanel\"\n/** @const */       , SET_QUEUE_KEY             = \"__mps\"\n/** @const */       , SET_ONCE_QUEUE_KEY        = \"__mpso\"\n/** @const */       , ADD_QUEUE_KEY             = \"__mpa\"\n/** @const */       , APPEND_QUEUE_KEY          = \"__mpap\"\n/** @const */       , SET_ACTION                = \"$set\"\n/** @const */       , SET_ONCE_ACTION           = \"$set_once\"\n/** @const */       , ADD_ACTION                = \"$add\"\n/** @const */       , APPEND_ACTION             = \"$append\"\n// This key is deprecated, but we want to check for it to see whether aliasing is allowed.\n/** @const */       , PEOPLE_DISTINCT_ID_KEY    = \"$people_distinct_id\"\n/** @const */       , ALIAS_ID_KEY              = \"__alias\"\n/** @const */       , RESERVED_PROPERTIES       = [SET_QUEUE_KEY, SET_ONCE_QUEUE_KEY, ADD_QUEUE_KEY, APPEND_QUEUE_KEY, PEOPLE_DISTINCT_ID_KEY, ALIAS_ID_KEY];\n\n/*\n * Dynamic... constants? Is that an oxymoron?\n */\n    var   HTTP_PROTOCOL     = ((\"https:\" == document.location.protocol) ? \"https://\" : \"http://\")\n        , SNIPPET_VERSION   = (mixpanel && mixpanel['__SV']) || 0\n        // http://hacks.mozilla.org/2009/07/cross-site-xmlhttprequest-with-cors/\n        // https://developer.mozilla.org/en-US/docs/DOM/XMLHttpRequest#withCredentials\n        , USE_XHR           = (window.XMLHttpRequest && 'withCredentials' in new XMLHttpRequest())\n        // IE<10 does not support cross-origin XHR's but script tags\n        // with defer won't block window.onload; ENQUEUE_REQUESTS\n        // should only be true for Opera<12\n        , ENQUEUE_REQUESTS  = !USE_XHR && (userAgent.indexOf('MSIE') == -1);\n\n/*\n * Closure-level globals\n */\n    var   _                 = {}\n        , DEBUG             = false\n        , DEFAULT_CONFIG    = {\n              \"api_host\":                   HTTP_PROTOCOL + 'api.mixpanel.com'\n            , \"cross_subdomain_cookie\":     true\n            , \"cookie_name\":                \"\"\n            , \"loaded\":                     function() {}\n            , \"store_google\":               true\n            , \"save_referrer\":              true\n            , \"test\":                       false\n            , \"verbose\":                    false\n            , \"img\":                        false\n            , \"track_pageview\":             true\n            , \"debug\":                      false\n            , \"track_links_timeout\":        300\n            , \"cookie_expiration\":          365\n            , \"upgrade\":                    false\n            , \"disable_cookie\":             false\n            , \"secure_cookie\":              false\n            , \"ip\":                         true\n        }\n        , DOM_LOADED        = false;\n\n    // UNDERSCORE\n    // Embed part of the Underscore Library\n\n    (function() {\n        var nativeForEach = ArrayProto.forEach,\n            nativeIndexOf = ArrayProto.indexOf,\n            nativeIsArray = Array.isArray,\n            breaker = {};\n\n        /**\n         * @param {*=} obj\n         * @param {function(...[*])=} iterator\n         * @param {Object=} context\n         */\n        var each = _.each = function(obj, iterator, context) {\n            if (obj == null) return;\n            if (nativeForEach && obj.forEach === nativeForEach) {\n                obj.forEach(iterator, context);\n            } else if (obj.length === +obj.length) {\n                for (var i = 0, l = obj.length; i < l; i++) {\n                    if (i in obj && iterator.call(context, obj[i], i, obj) === breaker) return;\n                }\n            } else {\n                for (var key in obj) {\n                    if (hasOwnProperty.call(obj, key)) {\n                        if (iterator.call(context, obj[key], key, obj) === breaker) return;\n                    }\n                }\n            }\n        };\n\n        _.extend = function(obj) {\n            each(slice.call(arguments, 1), function(source) {\n                for (var prop in source) {\n                    if (source[prop] !== void 0) obj[prop] = source[prop];\n                }\n            });\n            return obj;\n        };\n\n        _.isArray = nativeIsArray || function(obj) {\n            return toString.call(obj) === '[object Array]';\n        };\n\n        // from a comment on http://dbj.org/dbj/?p=286\n        // fails on only one very rare and deliberate custom object:\n        // var bomb = { toString : undefined, valueOf: function(o) { return \"function BOMBA!\"; }};\n        _.isFunction = function (f) {\n            try {\n                return /^\\s*\\bfunction\\b/.test(f);\n            } catch (x) {\n                return false;\n            }\n        };\n\n        _.isArguments = function(obj) {\n            return !!(obj && hasOwnProperty.call(obj, 'callee'));\n        };\n\n        _.toArray = function(iterable) {\n            if (!iterable)                return [];\n            if (iterable.toArray)         return iterable.toArray();\n            if (_.isArray(iterable))      return slice.call(iterable);\n            if (_.isArguments(iterable))  return slice.call(iterable);\n            return _.values(iterable);\n        };\n\n        _.values = function(obj) {\n            var results = [];\n            if (obj == null) return results;\n            each(obj, function(value) {\n                results[results.length] = value;\n            });\n            return results;\n        };\n\n        _.identity = function(value) {\n            return value;\n        };\n\n        _.include = function(obj, target) {\n            var found = false;\n            if (obj == null) return found;\n            if (nativeIndexOf && obj.indexOf === nativeIndexOf) return obj.indexOf(target) != -1;\n            each(obj, function(value) {\n                if (found || (found = (value === target))) { return breaker; }\n            });\n            return found;\n        };\n\n        _.includes = function(str, needle) {\n            return str.indexOf(needle) !== -1;\n        };\n\n    })();\n\n    // Underscore Addons\n    _.inherit = function(subclass, superclass) {\n        subclass.prototype = new superclass();\n        subclass.prototype.constructor = subclass;\n        subclass.superclass = superclass.prototype;\n        return subclass;\n    };\n\n    _.isObject = function(obj) {\n        return (obj === Object(obj) && !_.isArray(obj));\n    };\n\n    _.isEmptyObject = function(obj) {\n        if (_.isObject(obj)) {\n            for (var key in obj) {\n                if (hasOwnProperty.call(obj, key)) {\n                    return false;\n                }\n            }\n            return true;\n        }\n        return false;\n    };\n\n    _.isUndefined = function(obj) {\n        return obj === void 0;\n    };\n\n    _.isString = function(obj) {\n        return toString.call(obj) == '[object String]';\n    };\n\n    _.isDate = function(obj) {\n        return toString.call(obj) == '[object Date]';\n    };\n\n    _.isNumber = function(obj) {\n        return toString.call(obj) == '[object Number]';\n    };\n\n    _.encodeDates = function(obj) {\n        _.each(obj, function(v, k) {\n            if (_.isDate(v)) {\n                obj[k] = _.formatDate(v);\n            } else if (_.isObject(v)) {\n                obj[k] = _.encodeDates(v); // recurse\n            }\n        });\n        return obj;\n    };\n\n    _.formatDate = function(d) {\n        // YYYY-MM-DDTHH:MM:SS in UTC\n        function pad(n) {return n < 10 ? '0' + n : n}\n        return d.getUTCFullYear() + '-'\n            + pad(d.getUTCMonth() + 1) + '-'\n            + pad(d.getUTCDate()) + 'T'\n            + pad(d.getUTCHours()) + ':'\n            + pad(d.getUTCMinutes()) + ':'\n            + pad(d.getUTCSeconds());\n    };\n\n    _.strip_empty_properties = function(p) {\n        var ret = {};\n        _.each(p, function(v, k) {\n            if (_.isString(v) && v.length > 0) { ret[k] = v; }\n        });\n        return ret;\n    };\n\n    /*\n     * this function returns a copy of object after truncating it.  If\n     * passed an Array or Object it will iterate through obj and\n     * truncate all the values recursively.\n     */\n    _.truncate = function(obj, length) {\n        var ret;\n\n        if (typeof(obj) === \"string\") {\n            ret = obj.slice(0, length);\n        } else if (_.isArray(obj)) {\n            ret = [];\n            _.each(obj, function(val) {\n                ret.push(_.truncate(val, length));\n            });\n        } else if (_.isObject(obj)) {\n            ret = {};\n            _.each(obj, function(val, key) {\n                ret[key] = _.truncate(val, length);\n            });\n        } else {\n            ret = obj;\n        }\n\n        return ret;\n    };\n\n    _.JSONEncode = (function() {\n        return function(mixed_val) {\n            var indent;\n            var value = mixed_val;\n            var i;\n\n            var quote = function (string) {\n                var escapable = /[\\\\\\\"\\x00-\\x1f\\x7f-\\x9f\\u00ad\\u0600-\\u0604\\u070f\\u17b4\\u17b5\\u200c-\\u200f\\u2028-\\u202f\\u2060-\\u206f\\ufeff\\ufff0-\\uffff]/g;\n                var meta = {    // table of character substitutions\n                    '\\b': '\\\\b',\n                    '\\t': '\\\\t',\n                    '\\n': '\\\\n',\n                    '\\f': '\\\\f',\n                    '\\r': '\\\\r',\n                    '\"' : '\\\\\"',\n                    '\\\\': '\\\\\\\\'\n                };\n\n                escapable.lastIndex = 0;\n                return escapable.test(string) ?\n                '\"' + string.replace(escapable, function (a) {\n                    var c = meta[a];\n                    return typeof c === 'string' ? c :\n                    '\\\\u' + ('0000' + a.charCodeAt(0).toString(16)).slice(-4);\n                }) + '\"' :\n                '\"' + string + '\"';\n            };\n\n            var str = function(key, holder) {\n                var gap = '';\n                var indent = '    ';\n                var i = 0;          // The loop counter.\n                var k = '';          // The member key.\n                var v = '';          // The member value.\n                var length = 0;\n                var mind = gap;\n                var partial = [];\n                var value = holder[key];\n\n                // If the value has a toJSON method, call it to obtain a replacement value.\n                if (value && typeof value === 'object' &&\n                    typeof value.toJSON === 'function') {\n                    value = value.toJSON(key);\n                }\n\n                // What happens next depends on the value's type.\n                switch (typeof value) {\n                    case 'string':\n                        return quote(value);\n\n                    case 'number':\n                        // JSON numbers must be finite. Encode non-finite numbers as null.\n                        return isFinite(value) ? String(value) : 'null';\n\n                    case 'boolean':\n                    case 'null':\n                        // If the value is a boolean or null, convert it to a string. Note:\n                        // typeof null does not produce 'null'. The case is included here in\n                        // the remote chance that this gets fixed someday.\n\n                        return String(value);\n\n                    case 'object':\n                        // If the type is 'object', we might be dealing with an object or an array or\n                        // null.\n                        // Due to a specification blunder in ECMAScript, typeof null is 'object',\n                        // so watch out for that case.\n                        if (!value) {\n                            return 'null';\n                        }\n\n                        // Make an array to hold the partial results of stringifying this object value.\n                        gap += indent;\n                        partial = [];\n\n                        // Is the value an array?\n                        if (toString.apply(value) === '[object Array]') {\n                            // The value is an array. Stringify every element. Use null as a placeholder\n                            // for non-JSON values.\n\n                            length = value.length;\n                            for (i = 0; i < length; i += 1) {\n                                partial[i] = str(i, value) || 'null';\n                            }\n\n                            // Join all of the elements together, separated with commas, and wrap them in\n                            // brackets.\n                            v = partial.length === 0 ? '[]' :\n                            gap ? '[\\n' + gap +\n                            partial.join(',\\n' + gap) + '\\n' +\n                            mind + ']' :\n                            '[' + partial.join(',') + ']';\n                            gap = mind;\n                            return v;\n                        }\n\n                        // Iterate through all of the keys in the object.\n                        for (k in value) {\n                            if (hasOwnProperty.call(value, k)) {\n                                v = str(k, value);\n                                if (v) {\n                                    partial.push(quote(k) + (gap ? ': ' : ':') + v);\n                                }\n                            }\n                        }\n\n                        // Join all of the member texts together, separated with commas,\n                        // and wrap them in braces.\n                        v = partial.length === 0 ? '{}' :\n                        gap ? '{' + partial.join(',') + '' +\n                        mind + '}' : '{' + partial.join(',') + '}';\n                        gap = mind;\n                        return v;\n                }\n            };\n\n            // Make a fake root object containing our value under the key of ''.\n            // Return the result of stringifying the value.\n            return str('', {\n                '': value\n            });\n        };\n    })();\n\n    _.JSONDecode = (function() { // https://github.com/douglascrockford/JSON-js/blob/master/json_parse.js\n        var at,     // The index of the current character\n            ch,     // The current character\n            escapee = {\n                '\"':  '\"',\n                '\\\\': '\\\\',\n                '/':  '/',\n                'b':  '\\b',\n                'f':  '\\f',\n                'n':  '\\n',\n                'r':  '\\r',\n                't':  '\\t'\n            },\n            text,\n            error = function (m) {\n                throw {\n                    name:    'SyntaxError',\n                    message: m,\n                    at:      at,\n                    text:    text\n                };\n            },\n            next = function (c) {\n                // If a c parameter is provided, verify that it matches the current character.\n                if (c && c !== ch) {\n                    error(\"Expected '\" + c + \"' instead of '\" + ch + \"'\");\n                }\n                // Get the next character. When there are no more characters,\n                // return the empty string.\n                ch = text.charAt(at);\n                at += 1;\n                return ch;\n            },\n            number = function () {\n                // Parse a number value.\n                var number,\n                    string = '';\n\n                if (ch === '-') {\n                    string = '-';\n                    next('-');\n                }\n                while (ch >= '0' && ch <= '9') {\n                    string += ch;\n                    next();\n                }\n                if (ch === '.') {\n                    string += '.';\n                    while (next() && ch >= '0' && ch <= '9') {\n                        string += ch;\n                    }\n                }\n                if (ch === 'e' || ch === 'E') {\n                    string += ch;\n                    next();\n                    if (ch === '-' || ch === '+') {\n                        string += ch;\n                        next();\n                    }\n                    while (ch >= '0' && ch <= '9') {\n                        string += ch;\n                        next();\n                    }\n                }\n                number = +string;\n                if (!isFinite(number)) {\n                    error(\"Bad number\");\n                } else {\n                    return number;\n                }\n            },\n\n            string = function () {\n                // Parse a string value.\n                var hex,\n                    i,\n                    string = '',\n                    uffff;\n                // When parsing for string values, we must look for \" and \\ characters.\n                if (ch === '\"') {\n                    while (next()) {\n                        if (ch === '\"') {\n                            next();\n                            return string;\n                        }\n                        if (ch === '\\\\') {\n                            next();\n                            if (ch === 'u') {\n                                uffff = 0;\n                                for (i = 0; i < 4; i += 1) {\n                                    hex = parseInt(next(), 16);\n                                    if (!isFinite(hex)) {\n                                        break;\n                                    }\n                                    uffff = uffff * 16 + hex;\n                                }\n                                string += String.fromCharCode(uffff);\n                            } else if (typeof escapee[ch] === 'string') {\n                                string += escapee[ch];\n                            } else {\n                                break;\n                            }\n                        } else {\n                            string += ch;\n                        }\n                    }\n                }\n                error(\"Bad string\");\n            },\n            white = function () {\n                // Skip whitespace.\n                while (ch && ch <= ' ') {\n                    next();\n                }\n            },\n            word = function () {\n                // true, false, or null.\n                switch (ch) {\n                case 't':\n                    next('t');\n                    next('r');\n                    next('u');\n                    next('e');\n                    return true;\n                case 'f':\n                    next('f');\n                    next('a');\n                    next('l');\n                    next('s');\n                    next('e');\n                    return false;\n                case 'n':\n                    next('n');\n                    next('u');\n                    next('l');\n                    next('l');\n                    return null;\n                }\n                error(\"Unexpected '\" + ch + \"'\");\n            },\n            value,  // Placeholder for the value function.\n            array = function () {\n                // Parse an array value.\n                var array = [];\n\n                if (ch === '[') {\n                    next('[');\n                    white();\n                    if (ch === ']') {\n                        next(']');\n                        return array;   // empty array\n                    }\n                    while (ch) {\n                        array.push(value());\n                        white();\n                        if (ch === ']') {\n                            next(']');\n                            return array;\n                        }\n                        next(',');\n                        white();\n                    }\n                }\n                error(\"Bad array\");\n            },\n            object = function () {\n                // Parse an object value.\n                var key,\n                    object = {};\n\n                if (ch === '{') {\n                    next('{');\n                    white();\n                    if (ch === '}') {\n                        next('}');\n                        return object;   // empty object\n                    }\n                    while (ch) {\n                        key = string();\n                        white();\n                        next(':');\n                        if (Object.hasOwnProperty.call(object, key)) {\n                            error('Duplicate key \"' + key + '\"');\n                        }\n                        object[key] = value();\n                        white();\n                        if (ch === '}') {\n                            next('}');\n                            return object;\n                        }\n                        next(',');\n                        white();\n                    }\n                }\n                error(\"Bad object\");\n            };\n\n        value = function () {\n            // Parse a JSON value. It could be an object, an array, a string,\n            // a number, or a word.\n            white();\n            switch (ch) {\n            case '{':\n                return object();\n            case '[':\n                return array();\n            case '\"':\n                return string();\n            case '-':\n                return number();\n            default:\n                return ch >= '0' && ch <= '9' ? number() : word();\n            }\n        };\n\n        // Return the json_parse function. It will have access to all of the\n        // above functions and variables.\n        return function (source) {\n            var result;\n\n            text = source;\n            at = 0;\n            ch = ' ';\n            result = value();\n            white();\n            if (ch) {\n                error(\"Syntax error\");\n            }\n\n            return result;\n        };\n    })();\n\n    _.base64Encode = function(data) {\n        var b64 = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\";\n        var o1, o2, o3, h1, h2, h3, h4, bits, i = 0, ac = 0, enc=\"\", tmp_arr = [];\n\n        if (!data) {\n            return data;\n        }\n\n        data = _.utf8Encode(data);\n\n        do { // pack three octets into four hexets\n            o1 = data.charCodeAt(i++);\n            o2 = data.charCodeAt(i++);\n            o3 = data.charCodeAt(i++);\n\n            bits = o1<<16 | o2<<8 | o3;\n\n            h1 = bits>>18 & 0x3f;\n            h2 = bits>>12 & 0x3f;\n            h3 = bits>>6 & 0x3f;\n            h4 = bits & 0x3f;\n\n            // use hexets to index into b64, and append result to encoded string\n            tmp_arr[ac++] = b64.charAt(h1) + b64.charAt(h2) + b64.charAt(h3) + b64.charAt(h4);\n        } while (i < data.length);\n\n        enc = tmp_arr.join('');\n\n        switch( data.length % 3 ){\n            case 1:\n                enc = enc.slice(0, -2) + '==';\n                break;\n            case 2:\n                enc = enc.slice(0, -1) + '=';\n                break;\n        }\n\n        return enc;\n    };\n\n    _.utf8Encode = function(string) {\n        string = (string+'').replace(/\\r\\n/g, \"\\n\").replace(/\\r/g, \"\\n\");\n\n        var utftext = \"\",\n            start,\n            end;\n        var stringl = 0,\n            n;\n\n        start = end = 0;\n        stringl = string.length;\n\n        for (n = 0; n < stringl; n++) {\n            var c1 = string.charCodeAt(n);\n            var enc = null;\n\n            if (c1 < 128) {\n                end++;\n            } else if((c1 > 127) && (c1 < 2048)) {\n                enc = String.fromCharCode((c1 >> 6) | 192, (c1 & 63) | 128);\n            } else {\n                enc = String.fromCharCode((c1 >> 12) | 224, ((c1 >> 6) & 63) | 128, (c1 & 63) | 128);\n            }\n            if (enc !== null) {\n                if (end > start) {\n                    utftext += string.substring(start, end);\n                }\n                utftext += enc;\n                start = end = n+1;\n            }\n        }\n\n        if (end > start) {\n            utftext += string.substring(start, string.length);\n        }\n\n        return utftext;\n    };\n\n    _.UUID = (function() {\n\n        // Time/ticks information\n        // 1*new Date() is a cross browser version of Date.now()\n        var T = function() {\n            var d = 1*new Date()\n            , i = 0;\n\n            // this while loop figures how many browser ticks go by\n            // before 1*new Date() returns a new number, ie the amount\n            // of ticks that go by per millisecond\n            while (d == 1*new Date()) { i++; }\n\n            return d.toString(16) + i.toString(16);\n        };\n\n        // Math.Random entropy\n        var R = function() {\n            return Math.random().toString(16).replace('.','');\n        };\n\n        // User agent entropy\n        // This function takes the user agent string, and then xors\n        // together each sequence of 8 bytes.  This produces a final\n        // sequence of 8 bytes which it returns as hex.\n        var UA = function(n) {\n            var ua = userAgent, i, ch, buffer = [], ret = 0;\n\n            function xor(result, byte_array) {\n                var j, tmp = 0;\n                for (j = 0; j < byte_array.length; j++) {\n                    tmp |= (buffer[j] << j*8);\n                }\n                return result ^ tmp;\n            }\n\n            for (i = 0; i < ua.length; i++) {\n                ch = ua.charCodeAt(i);\n                buffer.unshift(ch & 0xFF);\n                if (buffer.length >= 4) {\n                    ret = xor(ret, buffer);\n                    buffer = [];\n                }\n            }\n\n            if (buffer.length > 0) { ret = xor(ret, buffer); }\n\n            return ret.toString(16);\n        };\n\n        return function() {\n            var se = (screen.height*screen.width).toString(16);\n            return (T()+\"-\"+R()+\"-\"+UA()+\"-\"+se+\"-\"+T());\n        };\n    })();\n\n    // _.isBlockedUA()\n    // This is to block various web spiders from executing our JS and\n    // sending false tracking data\n    _.isBlockedUA = function(ua) {\n        if (/(google web preview|baiduspider|yandexbot|bingbot|googlebot|yahoo! slurp)/i.test(ua)) {\n            return true;\n        }\n        return false;\n    };\n\n    /**\n     * @param {Object=} formdata\n     * @param {string=} arg_separator\n     */\n    _.HTTPBuildQuery = function(formdata, arg_separator) {\n        var key, use_val, use_key, tmp_arr = [];\n\n        if (typeof(arg_separator) === \"undefined\") {\n            arg_separator = '&';\n        }\n\n        _.each(formdata, function(val, key) {\n            use_val = encodeURIComponent(val.toString());\n            use_key = encodeURIComponent(key);\n            tmp_arr[tmp_arr.length] = use_key + '=' + use_val;\n        });\n\n        return tmp_arr.join(arg_separator);\n    };\n\n    _.getQueryParam = function(url, param) {\n        // Expects a raw URL\n\n        param = param.replace(/[\\[]/, \"\\\\\\[\").replace(/[\\]]/, \"\\\\\\]\");\n        var regexS = \"[\\\\?&]\" + param + \"=([^&#]*)\",\n            regex = new RegExp( regexS ),\n            results = regex.exec(url);\n        if (results === null || (results && typeof(results[1]) !== 'string' && results[1].length)) {\n            return '';\n        } else {\n            return decodeURIComponent(results[1]).replace(/\\+/g, ' ');\n        }\n    };\n\n    // _.cookie\n    // Methods partially borrowed from quirksmode.org/js/cookies.html\n    _.cookie = {\n        get: function(name) {\n            var nameEQ = name + \"=\";\n            var ca = document.cookie.split(';');\n            for(var i=0;i < ca.length;i++) {\n                var c = ca[i];\n                while (c.charAt(0)==' ') c = c.substring(1,c.length);\n                if (c.indexOf(nameEQ) == 0) return decodeURIComponent(c.substring(nameEQ.length,c.length));\n            }\n            return null;\n        },\n\n        parse: function(name) {\n            var cookie;\n            try {\n                cookie = _.JSONDecode(_.cookie.get(name)) || {};\n            } catch (err) {}\n            return cookie;\n        },\n\n        set: function(name, value, days, cross_subdomain, is_secure) {\n            var cdomain = \"\", expires = \"\", secure = \"\";\n\n            if (cross_subdomain) {\n                var matches = document.location.hostname.match(/[a-z0-9][a-z0-9\\-]+\\.[a-z\\.]{2,6}$/i)\n                    , domain = matches ? matches[0] : '';\n\n                cdomain   = ((domain) ? \"; domain=.\" + domain : \"\");\n            }\n\n            if (days) {\n                var date = new Date();\n                date.setTime(date.getTime()+(days*24*60*60*1000));\n                expires = \"; expires=\" + date.toGMTString();\n            }\n\n            if (is_secure) {\n                secure = \"; secure\";\n            }\n\n            document.cookie = name + \"=\" + encodeURIComponent(value) + expires + \"; path=/\" + cdomain + secure;\n        },\n\n        remove: function(name, cross_subdomain) {\n            _.cookie.set(name, '', -1, cross_subdomain);\n        }\n    };\n\n    _.register_event = (function() {\n        // written by Dean Edwards, 2005\n        // with input from Tino Zijdel - crisp@xs4all.nl\n        // with input from Carl Sverre - mail@carlsverre.com\n        // with input from Mixpanel\n        // http://dean.edwards.name/weblog/2005/10/add-event/\n        // https://gist.github.com/1930440\n\n        /**\n        * @param {Object} element\n        * @param {string} type\n        * @param {function(...[*])} handler\n        * @param {boolean=} oldSchool\n        */\n        var register_event = function(element, type, handler, oldSchool) {\n            if (!element) {\n                console.error(\"No valid element provided to register_event\");\n                return;\n            }\n\n            if (element.addEventListener && !oldSchool) {\n                element.addEventListener(type, handler, false);\n            } else {\n                var ontype = 'on' + type;\n                var old_handler = element[ontype]; // can be undefined\n                element[ontype] = makeHandler(element, handler, old_handler);\n            }\n        };\n\n        function makeHandler(element, new_handler, old_handlers) {\n            var handler = function(event) {\n                event = event || fixEvent(window.event);\n\n                // this basically happens in firefox whenever another script\n                // overwrites the onload callback and doesn't pass the event\n                // object to previously defined callbacks.  All the browsers\n                // that don't define window.event implement addEventListener\n                // so the dom_loaded handler will still be fired as usual.\n                if (!event) { return undefined; }\n\n                var ret = true;\n                var old_result, new_result;\n\n                if (_.isFunction(old_handlers)) {\n                    old_result = old_handlers(event);\n                }\n                new_result = new_handler.call(element, event);\n\n                if ((false === old_result) || (false === new_result)) {\n                    ret = false;\n                }\n\n                return ret;\n            };\n\n            return handler;\n        };\n\n        function fixEvent(event) {\n            if (event) {\n                event.preventDefault = fixEvent.preventDefault;\n                event.stopPropagation = fixEvent.stopPropagation;\n            }\n            return event;\n        };\n        fixEvent.preventDefault = function() {\n            this.returnValue = false;\n        };\n        fixEvent.stopPropagation = function() {\n            this.cancelBubble = true;\n        };\n\n        return register_event;\n    })();\n\n    _.dom_query = (function() {\n        /* document.getElementsBySelector(selector)\n        - returns an array of element objects from the current document\n        matching the CSS selector. Selectors can contain element names,\n        class names and ids and can be nested. For example:\n\n        elements = document.getElementsBySelector('div#main p a.external')\n\n        Will return an array of all 'a' elements with 'external' in their\n        class attribute that are contained inside 'p' elements that are\n        contained inside the 'div' element which has id=\"main\"\n\n        New in version 0.4: Support for CSS2 and CSS3 attribute selectors:\n        See http://www.w3.org/TR/css3-selectors/#attribute-selectors\n\n        Version 0.4 - Simon Willison, March 25th 2003\n        -- Works in Phoenix 0.5, Mozilla 1.3, Opera 7, Internet Explorer 6, Internet Explorer 5 on Windows\n        -- Opera 7 fails\n\n        Version 0.5 - Carl Sverre, Jan 7th 2013\n        -- Now uses jQuery-esque `hasClass` for testing class name\n        equality.  This fixes a bug related to '-' characters being\n        considered not part of a 'word' in regex.\n        */\n\n        function getAllChildren(e) {\n            // Returns all children of element. Workaround required for IE5/Windows. Ugh.\n            return e.all ? e.all : e.getElementsByTagName('*');\n        }\n\n        var bad_whitespace = /[\\t\\r\\n]/g;\n        function hasClass(elem, selector) {\n            var className = \" \" + selector + \" \";\n            return ((\" \" + elem.className + \" \").replace(bad_whitespace, \" \").indexOf(className) >= 0);\n        }\n\n        function getElementsBySelector(selector) {\n            // Attempt to fail gracefully in lesser browsers\n            if (!document.getElementsByTagName) {\n                return new Array();\n            }\n            // Split selector in to tokens\n            var tokens = selector.split(' ');\n            var token;\n            var currentContext = new Array(document);\n            for (var i = 0; i < tokens.length; i++) {\n                token = tokens[i].replace(/^\\s+/,'').replace(/\\s+$/,'');\n                if (token.indexOf('#') > -1) {\n                    // Token is an ID selector\n                    var bits = token.split('#');\n                    var tagName = bits[0];\n                    var id = bits[1];\n                    var element = document.getElementById(id);\n                    if (!element || (tagName && element.nodeName.toLowerCase() != tagName)) {\n                        // element not found or tag with that ID not found, return false\n                        return new Array();\n                    }\n                    // Set currentContext to contain just this element\n                    currentContext = new Array(element);\n                    continue; // Skip to next token\n                }\n                if (token.indexOf('.') > -1) {\n                    // Token contains a class selector\n                    var bits = token.split('.');\n                    var tagName = bits[0];\n                    var className = bits[1];\n                    if (!tagName) {\n                        tagName = '*';\n                    }\n                    // Get elements matching tag, filter them for class selector\n                    var found = new Array;\n                    var foundCount = 0;\n                    for (var h = 0; h < currentContext.length; h++) {\n                        var elements;\n                        if (tagName == '*') {\n                            elements = getAllChildren(currentContext[h]);\n                        } else {\n                            elements = currentContext[h].getElementsByTagName(tagName);\n                        }\n                        for (var j = 0; j < elements.length; j++) {\n                            found[foundCount++] = elements[j];\n                        }\n                    }\n                    currentContext = new Array;\n                    var currentContextIndex = 0;\n                    for (var k = 0; k < found.length; k++) {\n                        if (found[k].className\n                            && _.isString(found[k].className)   // some SVG elements have classNames which are not strings\n                            && hasClass(found[k], className)\n                        ) {\n                            currentContext[currentContextIndex++] = found[k];\n                        }\n                    }\n                    continue; // Skip to next token\n                }\n                // Code to deal with attribute selectors\n                if (token.match(/^(\\w*)\\[(\\w+)([=~\\|\\^\\$\\*]?)=?\"?([^\\]\"]*)\"?\\]$/)) {\n                    var tagName = RegExp.$1;\n                    var attrName = RegExp.$2;\n                    var attrOperator = RegExp.$3;\n                    var attrValue = RegExp.$4;\n                    if (!tagName) {\n                        tagName = '*';\n                    }\n                    // Grab all of the tagName elements within current context\n                    var found = new Array;\n                    var foundCount = 0;\n                    for (var h = 0; h < currentContext.length; h++) {\n                        var elements;\n                        if (tagName == '*') {\n                            elements = getAllChildren(currentContext[h]);\n                        } else {\n                            elements = currentContext[h].getElementsByTagName(tagName);\n                        }\n                        for (var j = 0; j < elements.length; j++) {\n                            found[foundCount++] = elements[j];\n                        }\n                    }\n                    currentContext = new Array;\n                    var currentContextIndex = 0;\n                    var checkFunction; // This function will be used to filter the elements\n                    switch (attrOperator) {\n                        case '=': // Equality\n                            checkFunction = function(e) { return (e.getAttribute(attrName) == attrValue); };\n                            break;\n                        case '~': // Match one of space seperated words\n                            checkFunction = function(e) { return (e.getAttribute(attrName).match(new RegExp('\\\\b'+attrValue+'\\\\b'))); };\n                            break;\n                        case '|': // Match start with value followed by optional hyphen\n                            checkFunction = function(e) { return (e.getAttribute(attrName).match(new RegExp('^'+attrValue+'-?'))); };\n                            break;\n                        case '^': // Match starts with value\n                            checkFunction = function(e) { return (e.getAttribute(attrName).indexOf(attrValue) == 0); };\n                            break;\n                        case '$': // Match ends with value - fails with \"Warning\" in Opera 7\n                            checkFunction = function(e) { return (e.getAttribute(attrName).lastIndexOf(attrValue) == e.getAttribute(attrName).length - attrValue.length); };\n                            break;\n                        case '*': // Match ends with value\n                            checkFunction = function(e) { return (e.getAttribute(attrName).indexOf(attrValue) > -1); };\n                            break;\n                        default :\n                            // Just test for existence of attribute\n                            checkFunction = function(e) { return e.getAttribute(attrName); };\n                    }\n                    currentContext = new Array;\n                    currentContextIndex = 0;\n                    for (var k = 0; k < found.length; k++) {\n                        if (checkFunction(found[k])) {\n                            currentContext[currentContextIndex++] = found[k];\n                        }\n                    }\n                    // alert('Attribute Selector: '+tagName+' '+attrName+' '+attrOperator+' '+attrValue);\n                    continue; // Skip to next token\n                }\n                // If we get here, token is JUST an element (not a class or ID selector)\n                tagName = token;\n                var found = new Array;\n                var foundCount = 0;\n                for (var h = 0; h < currentContext.length; h++) {\n                    var elements = currentContext[h].getElementsByTagName(tagName);\n                    for (var j = 0; j < elements.length; j++) {\n                        found[foundCount++] = elements[j];\n                    }\n                }\n                currentContext = found;\n            }\n            return currentContext;\n        };\n\n        return getElementsBySelector;\n    })();\n\n    _.info = {\n        campaignParams: function() {\n            var campaign_keywords = 'utm_source utm_medium utm_campaign utm_content utm_term'.split(' ')\n                , kw = ''\n                , params = {};\n            _.each(campaign_keywords, function(kwkey) {\n                kw = _.getQueryParam(document.URL, kwkey);\n                if (kw.length) {\n                    params[kwkey] = kw;\n                }\n            });\n\n            return params;\n        },\n\n        searchEngine: function(referrer) {\n            if (referrer.search('https?://(.*)google.([^/?]*)') === 0) {\n                return 'google';\n            } else if (referrer.search('https?://(.*)bing.com') === 0) {\n                return 'bing';\n            } else if (referrer.search('https?://(.*)yahoo.com') === 0) {\n                return 'yahoo';\n            } else if (referrer.search('https?://(.*)duckduckgo.com') === 0) {\n                return 'duckduckgo';\n            } else {\n                return null;\n            }\n        },\n\n        searchInfo: function(referrer) {\n            var search = _.info.searchEngine(referrer)\n                , param = (search != \"yahoo\") ? \"q\" : \"p\"\n                , ret = {};\n\n            if (search !== null) {\n                ret[\"$search_engine\"] = search;\n\n                var keyword = _.getQueryParam(referrer, param);\n                if (keyword.length) {\n                    ret[\"mp_keyword\"] = keyword;\n                }\n            }\n\n            return ret;\n        },\n\n        /**\n         * This function detects which browser is running this script.\n         * The order of the checks are important since many user agents\n         * include key words used in later checks.\n         */\n        browser: function(user_agent, vendor, opera) {\n            var vendor = vendor || ''; // vendor is undefined for at least IE9\n            if (opera) {\n                if (_.includes(user_agent, \"Mini\")) {\n                    return \"Opera Mini\";\n                }\n                return \"Opera\";\n            } else if (/(BlackBerry|PlayBook|BB10)/i.test(user_agent)) {\n                return 'BlackBerry';\n            } else if (_.includes(user_agent, \"FBIOS\")) {\n                return \"Facebook Mobile\";\n            } else if (_.includes(user_agent, \"Chrome\")) {\n                return \"Chrome\";\n            } else if (_.includes(user_agent, \"CriOS\")) {\n                return \"Chrome iOS\";\n            } else if (_.includes(vendor, \"Apple\")) {\n                if (_.includes(user_agent, \"Mobile\")) {\n                    return \"Mobile Safari\";\n                }\n                return \"Safari\";\n            } else if (_.includes(user_agent, \"Android\")) {\n                return \"Android Mobile\";\n            } else if (_.includes(user_agent, \"Konqueror\")) {\n                return \"Konqueror\";\n            } else if (_.includes(user_agent, \"Firefox\")) {\n                return \"Firefox\";\n            } else if (_.includes(user_agent, \"MSIE\") || _.includes(user_agent, \"Trident/\")) {\n                return \"Internet Explorer\";\n            } else if (_.includes(user_agent, \"Gecko\")) {\n                return \"Mozilla\";\n            } else {\n                return \"\";\n            }\n        },\n\n        os: function() {\n            var a = userAgent;\n            if (/Windows/i.test(a)) {\n                if (/Phone/.test(a)) { return 'Windows Mobile'; }\n                return 'Windows';\n            } else if (/(iPhone|iPad|iPod)/.test(a)) {\n                return 'iOS';\n            } else if (/Android/.test(a)) {\n                return 'Android';\n            } else if (/(BlackBerry|PlayBook|BB10)/i.test(a)) {\n                return 'BlackBerry';\n            } else if (/Mac/i.test(a)) {\n                return 'Mac OS X';\n            } else if (/Linux/.test(a)) {\n                return 'Linux';\n            } else {\n                return '';\n            }\n        },\n\n        device: function(user_agent) {\n            if (/iPad/.test(user_agent)) {\n                return 'iPad';\n            } else if (/iPod/.test(user_agent)) {\n                return 'iPod Touch';\n            } else if (/iPhone/.test(user_agent)) {\n                return 'iPhone';\n            } else if (/(BlackBerry|PlayBook|BB10)/i.test(user_agent)) {\n                return 'BlackBerry';\n            } else if (/Windows Phone/i.test(user_agent)) {\n                return 'Windows Phone';\n            } else if (/Android/.test(user_agent)) {\n                return 'Android';\n            } else {\n                return '';\n            }\n        },\n\n        referringDomain: function(referrer) {\n            var split = referrer.split(\"/\");\n            if (split.length >= 3) {\n                return split[2];\n            }\n            return \"\";\n        },\n\n        properties: function() {\n            return _.extend(_.strip_empty_properties({\n                '$os': _.info.os(),\n                '$browser': _.info.browser(userAgent, navigator.vendor, window.opera),\n                '$referrer': document.referrer,\n                '$referring_domain': _.info.referringDomain(document.referrer),\n                '$device': _.info.device(userAgent)\n            }), {\n                '$screen_height': screen.height,\n                '$screen_width': screen.width,\n                'mp_lib': 'web'\n            });\n        },\n\n        people_properties: function() {\n            return _.strip_empty_properties({\n                '$os': _.info.os(),\n                '$browser': _.info.browser(userAgent, navigator.vendor, window.opera)\n            });\n        },\n\n        pageviewInfo: function(page) {\n            return _.strip_empty_properties({\n                'mp_page': page\n                , 'mp_referrer': document.referrer\n                , 'mp_browser': _.info.browser(userAgent, navigator.vendor, window.opera)\n                , 'mp_platform': _.info.os()\n            });\n        }\n    };\n\n    // Console override\n    var console = {\n        /** @type {function(...[*])} */\n        log: function() {\n            if (DEBUG && !_.isUndefined(windowConsole) && windowConsole) {\n                try {\n                    windowConsole.log.apply(windowConsole, arguments);\n                } catch(err) {\n                    _.each(arguments, function(arg) {\n                        windowConsole.log(arg);\n                    });\n                }\n            }\n        },\n        /** @type {function(...[*])} */\n        error: function() {\n            if (DEBUG && !_.isUndefined(windowConsole) && windowConsole) {\n                var args = [\"Mixpanel error:\"].concat(_.toArray(arguments));\n                try {\n                    windowConsole.error.apply(windowConsole, args);\n                } catch(err) {\n                    _.each(args, function(arg) {\n                        windowConsole.error(arg);\n                    });\n                }\n            }\n        },\n        /** @type {function(...[*])} */\n        critical: function() {\n            if (!_.isUndefined(windowConsole) && windowConsole) {\n                var args = [\"Mixpanel error:\"].concat(_.toArray(arguments));\n                try {\n                    windowConsole.error.apply(windowConsole, args);\n                } catch(err) {\n                    _.each(args, function(arg) {\n                        windowConsole.error(arg);\n                    });\n                }\n            }\n        }\n    };\n\n    /**\n     * DomTracker Object\n     * @constructor\n     */\n    var DomTracker = function() {};\n\n    // interface\n    DomTracker.prototype.create_properties = function() {};\n    DomTracker.prototype.event_handler = function() {};\n    DomTracker.prototype.after_track_handler = function() {};\n\n    DomTracker.prototype.init = function(mixpanel_instance) {\n        this.mp = mixpanel_instance;\n        return this;\n    };\n\n    /**\n     * @param {string} query\n     * @param {string} event_name\n     * @param {Object=} properties\n     * @param {function(...[*])=} user_callback\n     */\n    DomTracker.prototype.track = function(query, event_name, properties, user_callback) {\n        var that = this\n        , elements = _.dom_query(query);\n\n        if (elements.length == 0) {\n            console.error(\"The DOM query (\" + query + \") returned 0 elements\");\n            return;\n        }\n\n        _.each(elements, function(element) {\n            _.register_event(element, this.override_event, function(e) {\n                var options = {}\n                    , props = that.create_properties(properties, this)\n                    , timeout = that.mp.get_config(\"track_links_timeout\");\n\n                that.event_handler(e, this, options);\n\n                // in case the mixpanel servers don't get back to us in time\n                window.setTimeout(that.track_callback(user_callback, props, options, true), timeout);\n\n                // fire the tracking event\n                that.mp.track(event_name, props, that.track_callback(user_callback, props, options));\n            });\n        }, this);\n\n        return true;\n    };\n\n    /**\n     * @param {function(...[*])} user_callback\n     * @param {Object} props\n     * @param {boolean=} timeout_occured\n     */\n    DomTracker.prototype.track_callback = function(user_callback, props, options, timeout_occured) {\n        timeout_occured = timeout_occured || false;\n        var that = this;\n\n        return function() {\n            // options is referenced from both callbacks, so we can have\n            // a \"lock\" of sorts to ensure only one fires\n            if (options.callback_fired) { return; }\n            options.callback_fired = true;\n\n            if (user_callback && user_callback(timeout_occured, props) === false) {\n                // user can prevent the default functionality by\n                // returning false from their callback\n                return;\n            }\n\n            that.after_track_handler(props, options, timeout_occured);\n        };\n    };\n\n    DomTracker.prototype.create_properties = function(properties, element) {\n        var props;\n\n        if (typeof(properties) === \"function\") {\n            props = properties(element);\n        } else {\n            props = _.extend({}, properties);\n        }\n\n        return props;\n    };\n\n    /**\n     * LinkTracker Object\n     * @constructor\n     * @extends DomTracker\n     */\n    var LinkTracker = function() {\n        this.override_event = \"click\";\n    };\n    _.inherit(LinkTracker, DomTracker);\n\n    LinkTracker.prototype.create_properties = function(properties, element) {\n        var props = LinkTracker.superclass.create_properties.apply(this, arguments);\n\n        if (element.href) { props[\"url\"] = element.href; }\n\n        return props;\n    };\n\n    LinkTracker.prototype.event_handler = function(evt, element, options) {\n        options.new_tab = (evt.which === 2 || evt.metaKey || element.target === \"_blank\");\n        options.href = element.href;\n\n        if (!options.new_tab) {\n            evt.preventDefault();\n        }\n    };\n\n    LinkTracker.prototype.after_track_handler = function(props, options, timeout_occured) {\n        if (options.new_tab) { return; }\n\n        setTimeout(function() {\n            window.location = options.href;\n        }, 0);\n    };\n\n    /**\n     * FormTracker Object\n     * @constructor\n     * @extends DomTracker\n     */\n    var FormTracker = function() {\n        this.override_event = \"submit\";\n    };\n    _.inherit(FormTracker, DomTracker);\n\n    FormTracker.prototype.event_handler = function(evt, element, options) {\n        options.element = element;\n        evt.preventDefault();\n    };\n\n    FormTracker.prototype.after_track_handler = function(props, options, timeout_occured) {\n        setTimeout(function() {\n            options.element.submit();\n        }, 0);\n    };\n\n    /**\n     * Mixpanel Cookie Object\n     * @constructor\n     */\n    var MixpanelCookie = function(config) {\n        this['props'] = {};\n        this.campaign_params_saved = false;\n\n        if (config['cookie_name']) {\n            this.name = \"mp_\" + config['cookie_name'];\n        } else {\n            this.name = \"mp_\" + config['token'] + \"_mixpanel\";\n        }\n        this.load();\n        this.update_config(config);\n        this.upgrade(config);\n        this.save();\n    };\n\n    MixpanelCookie.prototype.properties = function() {\n        var p = {};\n        // Filter out reserved properties\n        _.each(this['props'], function(v, k) {\n            if (!_.include(RESERVED_PROPERTIES, k)) {\n                p[k] = v;\n            }\n        });\n        return p;\n    };\n\n    MixpanelCookie.prototype.load = function() {\n        if (this.disabled) { return; }\n\n        var cookie = _.cookie.parse(this.name);\n\n        if (cookie) {\n            this['props'] = _.extend({}, cookie);\n        }\n    };\n\n    MixpanelCookie.prototype.upgrade = function(config) {\n        var should_upgrade = config['upgrade'],\n            old_cookie_name,\n            old_cookie;\n\n        if (should_upgrade) {\n            old_cookie_name = \"mp_super_properties\";\n            // Case where they had a custom cookie name before.\n            if (typeof(should_upgrade) === \"string\") {\n                old_cookie_name = should_upgrade;\n            }\n\n            old_cookie = _.cookie.parse(old_cookie_name);\n\n            // remove the cookie\n            _.cookie.remove(old_cookie_name);\n            _.cookie.remove(old_cookie_name, true);\n\n            if (old_cookie) {\n                this['props'] = _.extend(\n                    this['props'],\n                    old_cookie['all'],\n                    old_cookie['events']\n                );\n            }\n        }\n\n        if (!config['cookie_name'] && config['name'] !== 'mixpanel') {\n            // special case to handle people with cookies of the form\n            // mp_TOKEN_INSTANCENAME from the first release of this library\n            old_cookie_name = \"mp_\" + config['token'] + \"_\" + config['name'];\n            old_cookie = _.cookie.parse(old_cookie_name);\n\n            if (old_cookie) {\n                _.cookie.remove(old_cookie_name);\n                _.cookie.remove(old_cookie_name, true);\n\n                // Save the prop values that were in the cookie from before -\n                // this should only happen once as we delete the old one.\n                this.register_once(old_cookie);\n            }\n        }\n    };\n\n    MixpanelCookie.prototype.save = function() {\n        if (this.disabled) { return; }\n        _.cookie.set(\n            this.name,\n            _.JSONEncode(this['props']),\n            this.expire_days,\n            this.cross_subdomain,\n            this.secure\n        );\n    };\n\n    MixpanelCookie.prototype.remove = function() {\n        // remove both domain and subdomain cookies\n        _.cookie.remove(this.name, false);\n        _.cookie.remove(this.name, true);\n    };\n\n    // removes the cookie and deletes all loaded data\n    // forced name for tests\n    MixpanelCookie.prototype.clear = function() {\n        this.remove();\n        this['props'] = {};\n    };\n\n    /**\n     * @param {Object} props\n     * @param {*=} default_value\n     * @param {number=} days\n     */\n    MixpanelCookie.prototype.register_once = function(props, default_value, days) {\n        if (_.isObject(props)) {\n            if (typeof(default_value) === 'undefined') { default_value = \"None\"; }\n            this.expire_days = (typeof(days) === 'undefined') ? this.default_expiry : days;\n\n            _.each(props, function(val, prop) {\n                if (!this['props'][prop] || this['props'][prop] === default_value) {\n                    this['props'][prop] = val;\n                }\n            }, this);\n\n            this.save();\n\n            return true;\n        }\n        return false;\n    };\n\n    /**\n     * @param {Object} props\n     * @param {number=} days\n     */\n    MixpanelCookie.prototype.register = function(props, days) {\n        if (_.isObject(props)) {\n            this.expire_days = (typeof(days) === 'undefined') ? this.default_expiry : days;\n\n            _.extend(this['props'], props);\n\n            this.save();\n\n            return true;\n        }\n        return false;\n    };\n\n    MixpanelCookie.prototype.unregister = function(prop) {\n        if (prop in this['props']) {\n            delete this['props'][prop];\n            this.save();\n        }\n    };\n\n    MixpanelCookie.prototype.update_campaign_params = function() {\n        if (!this.campaign_params_saved) {\n            this.register_once(_.info.campaignParams());\n            this.campaign_params_saved = true;\n        }\n    };\n\n    MixpanelCookie.prototype.update_search_keyword = function(referrer) {\n        this.register(_.info.searchInfo(referrer));\n    };\n\n    // EXPORTED METHOD, we test this directly.\n    MixpanelCookie.prototype.update_referrer_info = function(referrer) {\n        // If referrer doesn't exist, we want to note the fact that it was type-in traffic.\n        this.register_once({\n            \"$initial_referrer\": referrer || \"$direct\",\n            \"$initial_referring_domain\": _.info.referringDomain(referrer) || \"$direct\"\n        }, \"\");\n    };\n\n    MixpanelCookie.prototype.get_referrer_info = function() {\n        return _.strip_empty_properties({\n            '$initial_referrer': this['props']['$initial_referrer'],\n            '$initial_referring_domain': this['props']['$initial_referring_domain']\n        });\n    };\n\n    // safely fills the passed in object with the cookies properties,\n    // does not override any properties defined in both\n    // returns the passed in object\n    MixpanelCookie.prototype.safe_merge = function(props) {\n        _.each(this['props'], function(val, prop) {\n            if (!(prop in props)) {\n                props[prop] = val;\n            }\n        });\n\n        return props;\n    };\n\n    MixpanelCookie.prototype.update_config = function(config) {\n        this.default_expiry = this.expire_days = config['cookie_expiration'];\n        this.set_disabled(config['disable_cookie']);\n        this.set_cross_subdomain(config['cross_subdomain_cookie']);\n        this.set_secure(config['secure_cookie']);\n    };\n\n    MixpanelCookie.prototype.set_disabled = function(disabled) {\n        this.disabled = disabled;\n        if (this.disabled) {\n            this.remove();\n        }\n    };\n\n    MixpanelCookie.prototype.set_cross_subdomain = function(cross_subdomain) {\n        if (cross_subdomain !== this.cross_subdomain) {\n            this.cross_subdomain = cross_subdomain;\n            this.remove();\n            this.save();\n        }\n    };\n\n    MixpanelCookie.prototype.get_cross_subdomain = function() {\n        return this.cross_subdomain;\n    };\n\n    MixpanelCookie.prototype.set_secure = function(secure) {\n        if (secure !== this.secure) {\n            this.secure = secure ? true : false;\n            this.remove();\n            this.save();\n        }\n    };\n\n    MixpanelCookie.prototype._add_to_people_queue = function(queue, data) {\n        var q_key = this._get_queue_key(queue),\n            q_data = data[queue],\n            set_q = this._get_or_create_queue(SET_ACTION),\n            set_once_q = this._get_or_create_queue(SET_ONCE_ACTION),\n            add_q = this._get_or_create_queue(ADD_ACTION),\n            append_q = this._get_or_create_queue(APPEND_ACTION, []);\n\n        if (q_key === SET_QUEUE_KEY) {\n            // Update the set queue - we can override any existing values\n            _.extend(set_q, q_data);\n            // if there was a pending increment, override it\n            // with the set.\n            this._pop_from_people_queue(ADD_ACTION, q_data);\n        } else if (q_key === SET_ONCE_QUEUE_KEY) {\n            // only queue the data if there is not already a set_once call for it.\n            _.each(q_data, function(v, k) {\n                if (!(k in set_once_q)) {\n                    set_once_q[k] = v;\n                }\n            });\n        } else if (q_key === ADD_QUEUE_KEY) {\n            _.each(q_data, function(v, k) {\n                // If it exists in the set queue, increment\n                // the value\n                if (k in set_q) {\n                    set_q[k] += v;\n                } else {\n                    // If it doesn't exist, update the add\n                    // queue\n                    if (!(k in add_q)) {\n                        add_q[k] = 0;\n                    }\n                    add_q[k] += v;\n                }\n            }, this);\n        } else if (q_key === APPEND_QUEUE_KEY) {\n            append_q.push(q_data);\n        }\n\n        console.log(\"MIXPANEL PEOPLE REQUEST (QUEUED, PENDING IDENTIFY):\");\n        console.log(data);\n\n        this.save();\n    };\n\n    MixpanelCookie.prototype._pop_from_people_queue = function(queue, data) {\n        var q = this._get_queue(queue);\n        if (!_.isUndefined(q)) {\n            _.each(data, function(v, k) {\n                delete q[k];\n            }, this);\n\n            this.save();\n        }\n    };\n\n    MixpanelCookie.prototype._get_queue_key = function(queue) {\n        if (queue === SET_ACTION) {\n            return SET_QUEUE_KEY;\n        } else if (queue === SET_ONCE_ACTION) {\n            return SET_ONCE_QUEUE_KEY;\n        } else if (queue === ADD_ACTION) {\n            return ADD_QUEUE_KEY;\n        } else if (queue === APPEND_ACTION) {\n            return APPEND_QUEUE_KEY;\n        } else {\n            console.error(\"Invalid queue:\", queue);\n        }\n    };\n\n    MixpanelCookie.prototype._get_queue = function(queue) {\n        return this['props'][this._get_queue_key(queue)];\n    };\n    MixpanelCookie.prototype._get_or_create_queue = function(queue, default_val) {\n        var key = this._get_queue_key(queue),\n            default_val = _.isUndefined(default_val) ? {} : default_val;\n\n        return this['props'][key] || (this['props'][key] = default_val);\n    };\n\n    /**\n     * create_mplib(token:string, config:object, name:string)\n     *\n     * This function is used by the init method of MixpanelLib objects\n     * as well as the main initializer at the end of the JSLib (that\n     * initializes document.mixpanel as well as any additional instances\n     * declared before this file has loaded).\n     */\n    var create_mplib = function(token, config, name) {\n        var instance, target = (name === PRIMARY_INSTANCE_NAME) ? mixpanel : mixpanel[name];\n\n        if (target && !_.isArray(target)) {\n            console.error(\"You have already initialized \" + name);\n            return;\n        }\n\n        instance = new MixpanelLib();\n        instance._init(token, config, name);\n\n        instance['people'] = new MixpanelPeople();\n        instance['people']._init(instance);\n\n        // if any instance on the page has debug = true, we set the\n        // global debug to be true\n        DEBUG = DEBUG || instance.get_config('debug');\n\n        // if target is not defined, we called init after the lib already\n        // loaded, so there won't be an array of things to execute\n        if (!_.isUndefined(target)) {\n            // Crunch through the people queue first - we queue this data up &\n            // flush on identify, so it's better to do all these operations first\n            instance._execute_array.call(instance['people'], target['people']);\n            instance._execute_array(target);\n        }\n\n        return instance;\n    };\n\n    /**\n     * Mixpanel Library Object\n     * @constructor\n     */\n    var MixpanelLib = function() { };\n\n    // Initialization methods\n\n    /**\n     * This function initialize a new instance of the Mixpanel tracking object.\n     * All new instances are added to the main mixpanel object as sub properties (such as\n     * mixpanel.your_library_name) and also returned by this function.  If you wanted\n     * to define a second instance on the page you would do it like so:\n     *\n     *      mixpanel.init(\"new token\", { your: \"config\" }, \"library_name\")\n     *\n     * and use it like this:\n     *\n     *      mixpanel.library_name.track(...)\n     *\n     * @param {String} token   Your Mixpanel API token\n     * @param {Object} [config]  A dictionary of config options to override\n     * @param {String} [name]    The name for the new mixpanel instance that you want created\n     */\n    MixpanelLib.prototype.init = function (token, config, name) {\n        if (typeof(name) === \"undefined\") {\n            console.error(\"You must name your new library: init(token, config, name)\");\n            return;\n        }\n        if (name === PRIMARY_INSTANCE_NAME) {\n            console.error(\"You must initialize the main mixpanel object right after you include the Mixpanel js snippet\");\n            return;\n        }\n\n        var instance = create_mplib(token, config, name);\n        mixpanel[name] = instance;\n        instance._loaded();\n\n        return instance;\n    };\n\n    // mixpanel._init(token:string, config:object, name:string)\n    //\n    // This function sets up the current instance of the mixpanel\n    // library.  The difference between this method and the init(...)\n    // method is this one initializes the actual instance, whereas the\n    // init(...) method sets up a new library and calls _init on it.\n    //\n    MixpanelLib.prototype._init = function(token, config, name) {\n        this['__loaded'] = true;\n        this['config'] = {};\n\n        this.set_config(_.extend({}, DEFAULT_CONFIG, config, {\n              \"name\": name\n            , \"token\": token\n            , \"callback_fn\": ((name === PRIMARY_INSTANCE_NAME) ? name : PRIMARY_INSTANCE_NAME + '.' + name) + '._jsc'\n        }));\n\n        this['_jsc'] = function() {};\n\n        this.__dom_loaded_queue = [];\n        this.__request_queue = [];\n        this.__disabled_events = [];\n        this._flags = {\n              \"disable_all_events\": false\n            , \"identify_called\": false\n        };\n\n        this['cookie'] = new MixpanelCookie(this['config']);\n        this.register_once({'distinct_id': _.UUID()}, \"\");\n    };\n\n    // Private methods\n\n    MixpanelLib.prototype._loaded = function() {\n        this.get_config('loaded')(this);\n\n        // this happens after so a user can call identify/name_tag in\n        // the loaded callback\n        if (this.get_config('track_pageview')) {\n            this.track_pageview();\n        }\n    };\n\n    MixpanelLib.prototype._dom_loaded = function() {\n        _.each(this.__dom_loaded_queue, function(item) {\n            this._track_dom.apply(this, item);\n        }, this);\n        _.each(this.__request_queue, function(item) {\n            this._send_request.apply(this, item);\n        }, this);\n        delete this.__dom_loaded_queue;\n        delete this.__request_queue;\n    };\n\n    MixpanelLib.prototype._track_dom = function(DomClass, args) {\n        if (this.get_config('img')) {\n            console.error(\"You can't use DOM tracking functions with img = true.\");\n            return false;\n        }\n\n        if (!DOM_LOADED) {\n            this.__dom_loaded_queue.push([DomClass, args]);\n            return false;\n        }\n\n        var dt = new DomClass().init(this);\n        return dt.track.apply(dt, args);\n    };\n\n    /**\n     * _prepare_callback() should be called by callers of _send_request for use\n     * as the callback argument.\n     *\n     * If there is no callback, this returns null.\n     * If we are going to make XHR/XDR requests, this returns a function.\n     * If we are going to use script tags, this returns a string to use as the\n     * callback GET param.\n     */\n    MixpanelLib.prototype._prepare_callback = function(callback, data) {\n        if (_.isUndefined(callback)) {\n            return null;\n        }\n\n        if (USE_XHR) {\n            var callback_function = function(response) {\n                callback(response, data);\n            };\n            return callback_function;\n        } else {\n            // if the user gives us a callback, we store as a random\n            // property on this instances jsc function and update our\n            // callback string to reflect that.\n            var jsc = this['_jsc']\n                , randomized_cb = '' + Math.floor(Math.random() * 100000000)\n                , callback_string = this.get_config('callback_fn') + '[\"' + randomized_cb + '\"]';\n            jsc[randomized_cb] = function(response) {\n                delete jsc[randomized_cb];\n                callback(response, data);\n            };\n            return callback_string;\n        }\n    };\n\n    MixpanelLib.prototype._send_request = function(url, data, callback) {\n        if (ENQUEUE_REQUESTS) {\n            this.__request_queue.push(arguments);\n            return;\n        }\n\n        // needed to correctly format responses\n        var verbose_mode = this.get_config('verbose');\n\n        if (this.get_config('test')) { data['test'] = 1; }\n        if (verbose_mode) { data['verbose'] = 1; }\n        if (this.get_config('img')) { data['img'] = 1; }\n        if (!USE_XHR) {\n            if (callback) {\n                data['callback'] = callback;\n            } else if (verbose_mode || this.get_config('test')) {\n                // Verbose output (from verbose mode, or an error in test mode) is a json blob,\n                // which by itself is not valid javascript. Without a callback, this verbose output will\n                // cause an error when returned via jsonp, so we force a no-op callback param.\n                // See the ECMA script spec: http://www.ecma-international.org/ecma-262/5.1/#sec-12.4\n                data['callback'] = '(function(){})';\n            }\n        }\n\n        data['ip'] = this.get_config('ip')?1:0;\n        data['_'] = new Date().getTime().toString();\n        url += '?' + _.HTTPBuildQuery(data);\n\n        if ('img' in data) {\n            var img = document.createElement(\"img\");\n                img.src = url;\n            document.body.appendChild(img);\n        } else if (USE_XHR) {\n            var req = new XMLHttpRequest();\n            req.open(\"GET\", url, true);\n            // send the mp_optout cookie\n            // withCredentials cannot be modified until after calling .open on Android and Mobile Safari\n            req.withCredentials = true;\n            req.onreadystatechange = function (e) {\n                if (req.readyState === 4) { // XMLHttpRequest.DONE == 4, except in safari 4\n                    if (req.status === 200) {\n                        if (callback) {\n                            if (verbose_mode) { callback(_.JSONDecode(req.responseText)); }\n                            else { callback(Number(req.responseText)); }\n                        }\n                    } else {\n                        var error = 'Bad HTTP status: ' + req.status + ' ' + req.statusText;\n                        console.error(error);\n                        if (callback) {\n                            if (verbose_mode) { callback({ status: 0, error: error }); }\n                            else { callback(0); }\n                        }\n                    }\n                }\n            };\n            req.send(null);\n        } else {\n            var script = document.createElement(\"script\");\n                script.type = \"text/javascript\";\n                script.async = true;\n                script.defer = true;\n                script.src = url;\n            var s = document.getElementsByTagName(\"script\")[0];\n            s.parentNode.insertBefore(script, s);\n        }\n    };\n\n    /**\n     * _execute_array() deals with processing any mixpanel function\n     * calls that were called before the Mixpanel library were loaded\n     * (and are thus stored in an array so they can be called later)\n     *\n     * Note: we fire off all the mixpanel function calls && user defined\n     * functions BEFORE we fire off mixpanel tracking calls.  This is so\n     * identify/register/set_config calls can properly modify early\n     * tracking calls.\n     *\n     * @param {Array} array\n     */\n    MixpanelLib.prototype._execute_array = function(array) {\n        var fn_name, alias_calls = [], other_calls = [], tracking_calls = [];\n        _.each(array, function(item) {\n            if (item) {\n                fn_name = item[0];\n                if (typeof(item) === \"function\") {\n                    item.call(this);\n                } else if (_.isArray(item) && fn_name === 'alias') {\n                    alias_calls.push(item);\n                } else if (_.isArray(item) && fn_name.indexOf('track') != -1 && typeof(this[fn_name]) === \"function\") {\n                    tracking_calls.push(item);\n                } else {\n                    other_calls.push(item);\n                }\n            }\n        }, this);\n\n        var execute = function(calls, context) {\n            _.each(calls, function(item) {\n                this[item[0]].apply(this, item.slice(1));\n            }, context);\n        };\n\n        execute(alias_calls, this);\n        execute(other_calls, this);\n        execute(tracking_calls, this);\n    };\n\n    /**\n     * push() keeps the standard async-array-push\n     * behavior around after the lib is loaded.\n     * This is only useful for external integrations that\n     * do not wish to rely on our convenience methods\n     * (created in the snippet). Good example is Optimizely.\n     *\n     * ### Usage:\n     *     mixpanel.push(['register', { a: 'b' }]);\n     *\n     * @param {Array} item A [function_name, args...] array to be executed\n     */\n    MixpanelLib.prototype.push = function(item) {\n        this._execute_array([item]);\n    };\n\n    /**\n     * Disable events on the Mixpanel object.  If passed no arguments,\n     * this function disables tracking of any event.  If passed an\n     * array of event names, those events will be disabled, but other\n     * events will continue to be tracked.\n     *\n     * Note: this function doesn't stop regular mixpanel functions from\n     * firing such as register and name_tag.\n     *\n     * @param {Array} [events] An array of event names to disable\n     */\n    MixpanelLib.prototype.disable = function(events) {\n        if (typeof(events) === 'undefined') {\n            this._flags.disable_all_events = true;\n        } else {\n            this.__disabled_events = this.__disabled_events.concat(events);\n        }\n    };\n\n    /**\n     * Track an event.  This is the most important Mixpanel function and\n     * the one you will be using the most.\n     *\n     * ### Usage:\n     *\n     *     // track an event named \"Registered\"\n     *     mixpanel.track(\"Registered\", {\"Gender\": \"Male\", \"Age\": 21});\n     *\n     * For tracking link clicks or form submissions, see mixpanel.track_links or mixpanel.track_forms.\n     *\n     * @param {String} event_name The name of the event. This can be anything the user does - \"Button Click\", \"Sign Up\", \"Item Purchased\", etc.\n     * @param {Object} [properties] A set of properties to include with the event you're sending. These describe the user who did the event or details about the event itself.\n     * @param {Function} [callback] If provided, the callback function will be called after tracking the event.\n     */\n    MixpanelLib.prototype.track = function(event_name, properties, callback) {\n        if (typeof(event_name) === \"undefined\") {\n            console.error(\"No event name provided to mixpanel.track\");\n            return;\n        }\n\n        if (_.isBlockedUA(userAgent)\n        ||  this._flags.disable_all_events\n        ||  _.include(this.__disabled_events, event_name)) {\n            if (typeof(callback) !== 'undefined') { callback(0); }\n            return;\n        }\n\n        // set defaults\n        properties = properties || {};\n        properties['token'] = properties.token || this.get_config('token');\n\n        // update cookie\n        this['cookie'].update_search_keyword(document.referrer);\n\n        if (this.get_config('store_google')) { this['cookie'].update_campaign_params(); }\n        if (this.get_config('save_referrer')) { this['cookie'].update_referrer_info(document.referrer); }\n\n        // note: extend writes to the first object, so lets make sure we\n        // don't write to the cookie properties object and info\n        // properties object by passing in a new object\n\n        // update properties with pageview info and super-properties\n        properties = _.extend(\n            {}\n            , _.info.properties()\n            , this['cookie'].properties()\n            , properties\n        );\n\n        var data = {\n              'event': event_name\n            , 'properties': properties\n        };\n\n        var truncated_data  = _.truncate(data, 255)\n            , json_data     = _.JSONEncode(truncated_data)\n            , encoded_data  = _.base64Encode(json_data);\n\n        console.log(\"MIXPANEL REQUEST:\");\n        console.log(truncated_data);\n\n        this._send_request(\n            this.get_config('api_host') + \"/track/\",\n            { 'data': encoded_data },\n            this._prepare_callback(callback, truncated_data)\n        );\n\n        return truncated_data;\n    };\n\n    /**\n     * Track a page view event, which is currently ignored by the server.\n     * This function is called by default on page load unless the\n     * track_pageview configuration variable is false.\n     *\n     * @param {String} [page] The url of the page to record. If you don't include this, it defaults to the current url.\n     * @api private\n     */\n    MixpanelLib.prototype.track_pageview = function(page) {\n        if (typeof(page) === \"undefined\") { page = document.location.href; }\n        this.track(\"mp_page_view\", _.info.pageviewInfo(page));\n    };\n\n    /**\n     * Track clicks on a set of document elements.  Selector must be a\n     * valid query. Elements must exist on the page at the time track_links is called.\n     *\n     * ### Usage:\n     *\n     *     // track click for link id #nav\n     *     mixpanel.track_links(\"#nav\", \"Clicked Nav Link\");\n     *\n     * ### Notes:\n     *\n     * This function will wait up to 300 ms for the Mixpanel\n     * servers to respond. If they have not responded by that time\n     * it will head to the link without ensuring that your event\n     * has been tracked.  To configure this timeout please see the\n     * mixpanel.set_config docs below.\n     *\n     * If you pass a function in as the properties argument, the\n     * function will receive the DOMElement which triggered the\n     * event as an argument.  You are expected to return an object\n     * from the function; any properties defined on this object\n     * will be sent to mixpanel as event properties.\n     *\n     * @type {Function}\n     * @param {String} query A valid DOM query\n     * @param {String} event_name The name of the event to track\n     * @param {Object|Function} [properties] A properties object or function that returns a dictionary of properties when passed a DOMElement\n     */\n    MixpanelLib.prototype.track_links = function() {\n        return this._track_dom.call(this, LinkTracker, arguments);\n    };\n\n    /**\n     * Tracks form submissions. Selector must be a valid query.\n     *\n     * ### Usage:\n     *\n     *     // track submission for form id \"register\"\n     *     mixpanel.track_forms(\"#register\", \"Created Account\");\n     *\n     * ### Notes:\n     *\n     * This function will wait up to 300 ms for the mixpanel\n     * servers to respond, if they have not responded by that time\n     * it will head to the link without ensuring that your event\n     * has been tracked.  To configure this timeout please see the\n     * mixpanel.set_config docs below.\n     *\n     * If you pass a function in as the properties argument, the\n     * function will receive the DOMElement which triggered the\n     * event as an argument.  You are expected to return an object\n     * from the function; any properties defined on this object\n     * will be sent to mixpanel as event properties.\n     *\n     * @type {Function}\n     * @param {String} query  A valid DOM query\n     * @param {String} event_name The name of the event to track\n     * @param {Object|Function} [properties] This can be a set of properties, or a function that returns a set of properties after being passed a DOMElement\n     */\n    MixpanelLib.prototype.track_forms = function() {\n        return this._track_dom.call(this, FormTracker, arguments);\n    };\n\n    /**\n     * Register a set of super properties, which are included with all\n     * events.  This will overwrite previous super property values.\n     *\n     * @param {Object} properties An associative array of properties to store about the user\n     * @param {Number} [days] How many days since the user's last visit to store the super properties\n     */\n    MixpanelLib.prototype.register = function(props, days) {\n        this['cookie'].register(props, days);\n    };\n\n    /**\n     * Register a set of super properties only once.  This will not\n     * overwrite previous super property values, unlike register().\n     *\n     * ### Notes:\n     *\n     * If default_value is specified, current super properties\n     * with that value will be overwritten.\n     *\n     * @param {Object} properties An associative array of properties to store about the user\n     * @param {*} [default_value] Value to override if already set in super properties (ex: \"False\") Default: \"None\"\n     * @param {Number} [days] How many days since the users last visit to store the super properties\n     */\n    MixpanelLib.prototype.register_once = function(props, default_value, days) {\n        this['cookie'].register_once(props, default_value, days);\n    };\n\n    /**\n     * Delete a super property stored with the current user.\n     *\n     * @param {String} property The name of the super property to remove\n     */\n    MixpanelLib.prototype.unregister = function(property) {\n        this['cookie'].unregister(property);\n    };\n\n    MixpanelLib.prototype._register_single = function(prop, value) {\n        var props = {};\n        props[prop] = value;\n        this.register(props);\n    };\n\n    /**\n     * Identify a user with a unique id.  All subsequent\n     * actions caused by this user will be tied to this identity.  This\n     * property is used to track unique visitors.  If the method is\n     * never called, then unique visitors will be identified by a UUID\n     * generated the first time they visit the site.\n     *\n     * ### Note:\n     *\n     * You can call this function to overwrite a previously set\n     * unique id for the current user.  Mixpanel cannot translate\n     * between ids at this time, so when you change a users id\n     * they will appear to be a new user.\n     *\n     * @param {String} unique_id A string that uniquely identifies a user\n     */\n    MixpanelLib.prototype.identify = function(unique_id, _set_callback, _add_callback, _append_callback, _set_once_callback) {\n        // Optional Parameters\n        //  _set_callback:function  A callback to be run if and when the People set queue is flushed\n        //  _add_callback:function  A callback to be run if and when the People add queue is flushed\n        //  _append_callback:function  A callback to be run if and when the People append queue is flushed\n        //  _set_once_callback:function  A callback to be run if and when the People set_once queue is flushed\n\n        // identify only changes the distinct id if it doesn't match either the existing or the alias;\n        // if it's new, blow away the alias as well.\n        if (unique_id != this.get_distinct_id() && unique_id != this.get_property(ALIAS_ID_KEY)) {\n            this.unregister(ALIAS_ID_KEY);\n            this._register_single('distinct_id', unique_id);\n        }\n        this._flags.identify_called = true;\n        // Flush any queued up people requests\n        this['people']._flush(_set_callback, _add_callback, _append_callback, _set_once_callback);\n    };\n\n    /**\n     * Returns the current distinct id of the user. This is either the id automatically\n     * generated by the library or the id that has been passed by a call to mixpanel.identify\n     */\n    MixpanelLib.prototype.get_distinct_id = function() {\n        return this.get_property('distinct_id');\n    };\n\n    /**\n     * Create an alias, which Mixpanel will use to link two distinct_ids going forward (not retroactively).\n     *  Multiple aliases can map to the same original ID, but not vice-versa. Aliases can also be chained - the\n     *  following is a valid scenario:\n     *\n     *      mixpanel.alias(\"new_id\", \"existing_id\");\n     *      ...\n     *      mixpanel.alias(\"newer_id\", \"new_id\");\n     *\n     * If the original ID is not passed in, we will use the current distinct_id - probably the auto-generated GUID.\n     *\n     * @param {String} alias A unique identifier that you want to use for this user in the future.\n     * @param {String} [original] The current identifier being used for this user.\n     */\n    MixpanelLib.prototype.alias = function(alias, original) {\n        // If the $people_distinct_id key exists in the cookie, there has been a previous\n        // mixpanel.people.identify() call made for this user. It is VERY BAD to make an alias with\n        // this ID, as it will duplicate users.\n        if (alias === this.get_property(PEOPLE_DISTINCT_ID_KEY)) {\n            console.critical(\"Attempting to create alias for existing People user - aborting.\");\n            return -2;\n        }\n\n        var _this = this;\n        if (_.isUndefined(original)) {\n            original = this.get_distinct_id();\n        }\n        if (alias !== original) {\n            this._register_single(ALIAS_ID_KEY, alias);\n            return this.track(\"$create_alias\", { \"alias\": alias, \"distinct_id\": original }, function(response) {\n                // Flush the people queue\n                _this.identify(alias);\n            });\n        } else {\n            console.error(\"alias matches current distinct_id - skipping api call.\");\n            this.identify(alias);\n            return -1;\n        }\n    };\n\n    /**\n     * Provide a string to recognize the user by.  The string passed to\n     * this method will appear in the Mixpanel Streams product rather\n     * than an automatically generated name.  Name tags do not have to\n     * be unique.\n     *\n     * This value will only be included in Streams data.\n     *\n     * @param {String} name_tag A human readable name for the user\n     * @api private\n     */\n    MixpanelLib.prototype.name_tag = function(name_tag) {\n        this._register_single('mp_name_tag', name_tag);\n    };\n\n    /**\n     * Update the configuration of a mixpanel library instance.\n     *\n     * The default config is:\n     *\n     *     {\n     *       // super properties span subdomains\n     *       cross_subdomain_cookie:     true\n     *\n     *       // super properties cookie name\n     *       cookie_name:                \"\"\n     *\n     *       // super properties cookie expiration (in days)\n     *       cookie_expiration:          365\n     *\n     *       // should we track a page view on page load\n     *       track_pageview:             true\n     *\n     *       // the amount of time track_links will\n     *       // wait for Mixpanel's servers to respond\n     *       track_links_timeout:        300\n     *\n     *       // if this is true, the mixpanel cookie will be deleted,\n     *       // and no user persistence will take place\n     *       disable_cookie:             false\n     *\n     *       // if this is true, the mixpanel cookie will be marked as\n     *       // secure, meaning it will only be transmitted over https\n     *       secure_cookie:              false\n     *\n     *       // if you set upgrade to be true, the library will check for a\n     *       // cookie from our old js library and import super\n     *       // properties from it, then the old cookie is deleted\n     *       // The upgrade config option only works in the initialization, so\n     *       // make sure you set it when you create the library.\n     *       upgrade:                    false\n     *     }\n     *\n     *\n     * @param {Object} config A dictionary of new configuration values to update\n     */\n    MixpanelLib.prototype.set_config = function(config) {\n        if (_.isObject(config)) {\n            _.extend(this['config'], config);\n            if (this['cookie']) { this['cookie'].update_config(this['config']); }\n            DEBUG = DEBUG || this.get_config('debug');\n        }\n    };\n\n    /**\n     * returns the current config object for the library.\n     */\n    MixpanelLib.prototype.get_config = function(prop_name) {\n        return this['config'][prop_name];\n    };\n\n    /**\n     * Returns the value of the super property named property_name. If no such\n     * property is set, get_property will return the undefined value.\n     *\n     * @param {String} property_name The name of the super property you want to retrieve\n     */\n    MixpanelLib.prototype.get_property = function(property_name) {\n        return this['cookie']['props'][property_name];\n    };\n\n    MixpanelLib.prototype.toString = function() {\n        var name = this.get_config(\"name\");\n        if (name !== PRIMARY_INSTANCE_NAME) {\n            name = PRIMARY_INSTANCE_NAME + \".\" + name;\n        }\n        return name;\n    };\n\n    /**\n     * Mixpanel People Object\n     * @constructor\n     */\n    var MixpanelPeople = function(){ };\n\n    MixpanelPeople.prototype._init = function(mixpanel) {\n        this._mixpanel = mixpanel;\n    };\n\n    /*\n     * Set properties on a user record.\n     *\n     * ### Usage:\n     *\n     *     mixpanel.people.set('gender', 'm');\n     *\n     *     // or set multiple properties at once\n     *     mixpanel.people.set({\n     *         'Company': 'Acme',\n     *         'Plan': 'Premium',\n     *         'Upgrade date': new Date()\n     *     });\n     *     // properties can be strings, integers, dates, or lists\n     *\n     * @param {Object|String} prop If a string, this is the name of the property. If an object, this is an associative array of names and values.\n     * @param {*} [to] A value to set on the given property name\n     * @param {Function} [callback] If provided, the callback will be called after the tracking event\n     */\n    MixpanelPeople.prototype.set = function(prop, to, callback) {\n        var data = {};\n        var $set = {};\n        if (_.isObject(prop)) {\n            _.each(prop, function(v, k) {\n                // We will get these ourselves\n                if (k == '$distinct_id' || k == '$token') {\n                    return;\n                } else {\n                    $set[k] = v;\n                }\n            });\n            callback = to;\n        } else {\n            $set[prop] = to;\n        }\n\n        // make sure that the referrer info has been updated and saved\n        if (this._get_config('save_referrer')) {\n            this._mixpanel.cookie.update_referrer_info(document.referrer);\n        }\n\n        // update $set object with default people properties\n        $set = _.extend({}\n            , _.info.people_properties()\n            , this._mixpanel.cookie.get_referrer_info()\n            , $set\n        );\n\n        data[SET_ACTION] = $set;\n\n        return this._send_request(data, callback);\n    };\n\n    /*\n     * Set properties on a user record, only if they do not yet exist.\n     *\n     * ### Usage:\n     *\n     *     mixpanel.people.set_once('First Login Date', new Date());\n     *\n     *     // or set multiple properties at once\n     *     mixpanel.people.set_once({\n     *         'First Login Date': new Date(),\n     *         'Starting Plan': 'Premium'\n     *     });\n     *\n     *     // properties can be strings, integers or dates\n     *\n     * @param {Object|String} prop If a string, this is the name of the property. If an object, this is an associative array of names and values.\n     * @param {*} [to] A value to set on the given property name\n     * @param {Function} [callback] If provided, the callback will be called after the tracking event\n     */\n    MixpanelPeople.prototype.set_once = function(prop, to, callback) {\n        var data = {};\n        var $set_once = {};\n        if (_.isObject(prop)) {\n            _.each(prop, function(v, k) {\n                // We will get these ourselves\n                if (k == '$distinct_id' || k == '$token') {\n                    return;\n                } else {\n                    $set_once[k] = v;\n                }\n            });\n            callback = to;\n        } else {\n            $set_once[prop] = to;\n        }\n        data[SET_ONCE_ACTION] = $set_once;\n        return this._send_request(data, callback);\n    };\n\n    /*\n     * Increment/decrement numeric people analytics properties.\n     *\n     * ### Usage:\n     *\n     *     mixpanel.people.increment('page_views', 1);\n     *\n     *     // or, for convenience, if you're just incrementing a counter by 1, you can\n     *     // simply do\n     *     mixpanel.people.increment('page_views');\n     *\n     *     // to decrement a counter, pass a negative number\n     *     mixpanel.people.increment('credits_left': -1);\n     *\n     *     // like mixpanel.people.set(), you can increment multiple properties at once:\n     *     mixpanel.people.increment({\n     *         counter1: 1,\n     *         counter2: 1\n     *     });\n     *\n     * @param {Object|String} prop If a string, this is the name of the property. If an object, this is an associative array of names and numeric values.\n     * @param {Number} [by] An amount to increment the given property\n     * @param {Function} [callback] If provided, the callback will be called after the tracking event\n     */\n    MixpanelPeople.prototype.increment = function(prop, by, callback) {\n        var data = {};\n        var $add = {};\n        if (_.isObject(prop)) {\n            _.each(prop, function(v, k) {\n                if (k == '$distinct_id' || k == '$token') {\n                    return;\n                } else if (isNaN(parseFloat(v))) {\n                    console.error(\"Invalid increment value passed to mixpanel.people.increment - must be a number\");\n                    return;\n                } else {\n                    $add[k] = v;\n                }\n            });\n            callback = by;\n        } else {\n            // convenience: mixpanel.people.increment('property'); will\n            // increment 'property' by 1\n            if (_.isUndefined(by)) {\n                by = 1;\n            }\n            $add[prop] = by;\n        }\n        data[ADD_ACTION] = $add;\n\n        return this._send_request(data, callback);\n    };\n\n    /*\n     * Append a value to a list-valued people analytics property.\n     *\n     * ### Usage:\n     *\n     *     // append a value to a list, creating it if needed\n     *     mixpanel.people.append('pages_visited', 'homepage');\n     *\n     *     // like mixpanel.people.set(), you can append multiple properties at once:\n     *     mixpanel.people.append({\n     *         list1: 'bob',\n     *         list2: 123\n     *     });\n     *\n     * @param {Object|String} prop If a string, this is the name of the property. If an object, this is an associative array of names and numeric values.\n     * @param {*} [value] An item to append to the list\n     * @param {Function} [callback] If provided, the callback will be called after the tracking event\n     */\n    MixpanelPeople.prototype.append = function(list_name, value, callback) {\n        var data = {};\n        var $append = {};\n        if (_.isObject(list_name)) {\n            _.each(list_name, function(v, k) {\n                if (k == '$distinct_id' || k == '$token') {\n                    return;\n                } else {\n                    $append[k] = v;\n                }\n            });\n            callback = value;\n        } else {\n            $append[list_name] = value;\n        }\n        data[APPEND_ACTION] = $append;\n\n        return this._send_request(data, callback);\n    };\n\n    /*\n     * Record that you have charged the current user a certain amount\n     * of money. Charges recorded with track_charge will appear in the\n     * Mixpanel revenue report.\n     *\n     * ### Usage:\n     *\n     *     // charge a user $50\n     *     mixpanel.people.track_charge(50);\n     *\n     *     // charge a user $30.50 on the 2nd of january\n     *     mixpanel.people.track_charge(30.50, { '$time': new Date('jan 1 2012') });\n     *\n     * @param {Number} amount The amount of money charged to the current user\n     * @param {Object} [properties] An associative array of properties associated with the charge\n     * @param {Function} [callback] If provided, the callback will be called when the server responds\n     */\n    MixpanelPeople.prototype.track_charge = function(amount, properties, callback) {\n        if (!_.isNumber(amount)) {\n            amount = parseFloat(amount);\n            if (isNaN(amount)) {\n                console.error(\"Invalid value passed to mixpanel.people.track_charge - must be a number\");\n                return;\n            }\n        }\n\n        return this.append('$transactions', _.extend({\n            '$amount': amount\n        }, properties), callback);\n    };\n\n    /*\n     * Permanently clear all revenue report transactions from the\n     * current user's people analytics profile.\n     *\n     * ### Usage:\n     *\n     *     mixpanel.people.clear_charges();\n     *\n     * @param {Function} [callback] If provided, the callback will be called after the tracking event\n     */\n    MixpanelPeople.prototype.clear_charges = function(callback) {\n        return this.set('$transactions', [], callback);\n    };\n\n    /*\n     * Permanently deletes the current people analytics profile from\n     * Mixpanel (using the current distinct_id).\n     *\n     * ### Usage:\n     *\n     *     // remove the all data you have stored about the current user\n     *     mixpanel.people.delete_user();\n     *\n     */\n    MixpanelPeople.prototype.delete_user = function() {\n        if (!this._identify_called()) {\n            console.error('mixpanel.people.delete_user() requires you to call identify() first');\n            return;\n        }\n        var data = {'$delete': this._mixpanel.get_distinct_id()};\n        return this._send_request(data);\n    };\n\n    MixpanelPeople.prototype.toString = function() {\n        return this._mixpanel.toString() + \".people\";\n    };\n\n    MixpanelPeople.prototype._send_request = function(data, callback) {\n        data['$token'] = this._get_config('token');\n        data['$distinct_id'] = this._mixpanel.get_distinct_id();\n\n        var date_encoded_data = _.encodeDates(data)\n          , truncated_data    = _.truncate(date_encoded_data, 255)\n          , json_data         = _.JSONEncode(date_encoded_data)\n          , encoded_data      = _.base64Encode(json_data);\n\n        if (!this._identify_called()) {\n            this._enqueue(data);\n            if (!_.isUndefined(callback)) {\n                if (this._get_config('verbose')) {\n                    callback({ status: -1, error: null });\n                } else {\n                    callback(-1);\n                }\n            }\n            return truncated_data;\n        }\n\n        console.log(\"MIXPANEL PEOPLE REQUEST:\");\n        console.log(truncated_data);\n\n        this._mixpanel._send_request(\n            this._get_config('api_host') + '/engage/',\n            { 'data': encoded_data },\n            this._mixpanel._prepare_callback(callback, truncated_data)\n        );\n\n        return truncated_data;\n    };\n\n    MixpanelPeople.prototype._get_config = function(conf_var) {\n        return this._mixpanel.get_config(conf_var);\n    };\n\n    MixpanelPeople.prototype._identify_called = function() {\n        return this._mixpanel._flags.identify_called === true;\n    };\n\n    // Queue up engage operations if identify hasn't been called yet.\n    MixpanelPeople.prototype._enqueue = function(data) {\n        if (SET_ACTION in data) {\n            this._mixpanel.cookie._add_to_people_queue(SET_ACTION, data);\n        } else if (SET_ONCE_ACTION in data) {\n            this._mixpanel.cookie._add_to_people_queue(SET_ONCE_ACTION, data);\n        } else if (ADD_ACTION in data) {\n            this._mixpanel.cookie._add_to_people_queue(ADD_ACTION, data);\n        } else if (APPEND_ACTION in data) {\n            this._mixpanel.cookie._add_to_people_queue(APPEND_ACTION, data);\n        } else {\n            console.error(\"Invalid call to _enqueue():\", data);\n        }\n    };\n\n    // Flush queued engage operations - order does not matter,\n    // and there are network level race conditions anyway\n    MixpanelPeople.prototype._flush = function(_set_callback, _add_callback, _append_callback, _set_once_callback) {\n        var _this = this,\n            $set_queue = _.extend({}, this._mixpanel.cookie._get_queue(SET_ACTION)),\n            $set_once_queue = _.extend({}, this._mixpanel.cookie._get_queue(SET_ONCE_ACTION)),\n            $add_queue = _.extend({}, this._mixpanel.cookie._get_queue(ADD_ACTION)),\n            $append_queue = this._mixpanel.cookie._get_queue(APPEND_ACTION);\n\n        if (!_.isUndefined($set_queue) && _.isObject($set_queue) && !_.isEmptyObject($set_queue)) {\n            _this._mixpanel.cookie._pop_from_people_queue(SET_ACTION, $set_queue);\n            this.set($set_queue, function(response, data) {\n                // on bad response, we want to add it back to the queue\n                if (response == 0) {\n                    _this._mixpanel.cookie._add_to_people_queue(SET_ACTION, $set_queue);\n                }\n                if (!_.isUndefined(_set_callback)) {\n                    _set_callback(response, data);\n                }\n            });\n        }\n\n        if (!_.isUndefined($set_once_queue) && _.isObject($set_once_queue) && !_.isEmptyObject($set_once_queue)) {\n            _this._mixpanel.cookie._pop_from_people_queue(SET_ONCE_ACTION, $set_once_queue);\n            this.set_once($set_once_queue, function(response, data) {\n                // on bad response, we want to add it back to the queue\n                if (response == 0) {\n                    _this._mixpanel.cookie._add_to_people_queue(SET_ONCE_ACTION, $set_once_queue);\n                }\n                if (!_.isUndefined(_set_once_callback)) {\n                    _set_once_callback(response, data);\n                }\n            });\n        }\n\n        if (!_.isUndefined($add_queue) && _.isObject($add_queue) && !_.isEmptyObject($add_queue)) {\n            _this._mixpanel.cookie._pop_from_people_queue(ADD_ACTION, $add_queue);\n            this.increment($add_queue, function(response, data) {\n                // on bad response, we want to add it back to the queue\n                if (response == 0) {\n                    _this._mixpanel.cookie._add_to_people_queue(ADD_ACTION, $add_queue);\n                }\n                if (!_.isUndefined(_add_callback)) {\n                    _add_callback(response, data);\n                }\n            });\n        }\n\n        // we have to fire off each $append individually since there is\n        // no concat method server side\n        if (!_.isUndefined($append_queue) && _.isArray($append_queue) && $append_queue.length) {\n            for (var i = $append_queue.length - 1; i >= 0; i--) {\n                var $append_item = $append_queue.pop();\n                _this.append($append_item, function(response, data) {\n                    if (response == 0) {\n                        _this._mixpanel.cookie._add_to_people_queue(APPEND_ACTION, $append_item);\n                    }\n                    if (!_.isUndefined(_append_callback)) { _append_callback(response, data); }\n                });\n            };\n            // Save the shortened append queue\n            _this._mixpanel.cookie.save();\n        }\n    };\n\n    // EXPORTS (for closure compiler)\n\n    // Underscore Exports\n    _['toArray']                                        = _.toArray;\n    _['isObject']                                       = _.isObject;\n    _['JSONEncode']                                     = _.JSONEncode;\n    _['JSONDecode']                                     = _.JSONDecode;\n    _['isBlockedUA']                                    = _.isBlockedUA;\n    _['isEmptyObject']                                  = _.isEmptyObject;\n    _['info']                                           = _.info;\n    _['info']['device']                                 = _.info.device;\n    _['info']['browser']                                = _.info.browser;\n\n    // MixpanelLib Exports\n    MixpanelLib.prototype['init']                       = MixpanelLib.prototype.init;\n    MixpanelLib.prototype['disable']                    = MixpanelLib.prototype.disable;\n    MixpanelLib.prototype['track']                      = MixpanelLib.prototype.track;\n    MixpanelLib.prototype['track_links']                = MixpanelLib.prototype.track_links;\n    MixpanelLib.prototype['track_forms']                = MixpanelLib.prototype.track_forms;\n    MixpanelLib.prototype['track_pageview']             = MixpanelLib.prototype.track_pageview;\n    MixpanelLib.prototype['register']                   = MixpanelLib.prototype.register;\n    MixpanelLib.prototype['register_once']              = MixpanelLib.prototype.register_once;\n    MixpanelLib.prototype['unregister']                 = MixpanelLib.prototype.unregister;\n    MixpanelLib.prototype['identify']                   = MixpanelLib.prototype.identify;\n    MixpanelLib.prototype['alias']                      = MixpanelLib.prototype.alias;\n    MixpanelLib.prototype['name_tag']                   = MixpanelLib.prototype.name_tag;\n    MixpanelLib.prototype['set_config']                 = MixpanelLib.prototype.set_config;\n    MixpanelLib.prototype['get_config']                 = MixpanelLib.prototype.get_config;\n    MixpanelLib.prototype['get_property']               = MixpanelLib.prototype.get_property;\n    MixpanelLib.prototype['get_distinct_id']            = MixpanelLib.prototype.get_distinct_id;\n    MixpanelLib.prototype['toString']                   = MixpanelLib.prototype.toString;\n\n    // MixpanelCookie Exports\n    MixpanelCookie.prototype['properties']              = MixpanelCookie.prototype.properties;\n    MixpanelCookie.prototype['update_search_keyword']   = MixpanelCookie.prototype.update_search_keyword;\n    MixpanelCookie.prototype['update_referrer_info']    = MixpanelCookie.prototype.update_referrer_info;\n    MixpanelCookie.prototype['get_cross_subdomain']     = MixpanelCookie.prototype.get_cross_subdomain;\n    MixpanelCookie.prototype['clear']                   = MixpanelCookie.prototype.clear;\n\n    // MixpanelPeople Exports\n    MixpanelPeople.prototype['set']                     = MixpanelPeople.prototype.set;\n    MixpanelPeople.prototype['set_once']                = MixpanelPeople.prototype.set_once;\n    MixpanelPeople.prototype['increment']               = MixpanelPeople.prototype.increment;\n    MixpanelPeople.prototype['append']                  = MixpanelPeople.prototype.append;\n    MixpanelPeople.prototype['track_charge']            = MixpanelPeople.prototype.track_charge;\n    MixpanelPeople.prototype['clear_charges']           = MixpanelPeople.prototype.clear_charges;\n    MixpanelPeople.prototype['delete_user']             = MixpanelPeople.prototype.delete_user;\n    MixpanelPeople.prototype['toString']                = MixpanelPeople.prototype.toString;\n\n    // Initialization\n    if (_.isUndefined(mixpanel)) {\n        // mixpanel wasn't initialized properly, report error and quit\n        console.critical(\"'mixpanel' object not initialized. Ensure you are using the latest version of the Mixpanel JS Library along with the snippet we provide.\");\n        return;\n    }\n    if (mixpanel['__loaded'] || (mixpanel['config'] && mixpanel['cookie'])) {\n        // lib has already been loaded at least once; we don't want to override the global object this time so bomb early\n        console.error(\"Mixpanel library has already been downloaded at least once.\");\n        return;\n    }\n    if (SNIPPET_VERSION < 1.1) {\n        // mixpanel wasn't initialized properly, report error and quit\n        console.critical(\"Version mismatch; please ensure you're using the latest version of the Mixpanel code snippet.\");\n        return;\n    }\n\n    // Load instances of the Mixpanel Library\n    var instances = {};\n    _.each(mixpanel['_i'], function(item) {\n        var name, instance;\n        if (item && _.isArray(item)) {\n            name = item[item.length-1];\n            instance = create_mplib.apply(this, item);\n\n            instances[name] = instance;\n        }\n    });\n\n    var extend_mp = function() {\n        // add all the sub mixpanel instances\n        _.each(instances, function(instance, name) {\n            if (name !== PRIMARY_INSTANCE_NAME) { mixpanel[name] = instance; }\n        });\n\n        // add private functions as _\n        mixpanel['_'] = _;\n    };\n\n    // we override the snippets init function to handle the case where a\n    // user initializes the mixpanel library after the script loads & runs\n    mixpanel['init'] = function(token, config, name) {\n        if (name) {\n            // initialize a sub library\n            if (!mixpanel[name]) {\n                mixpanel[name] = instances[name] = create_mplib(token, config, name);\n                mixpanel[name]._loaded();\n            }\n        } else {\n            var instance = mixpanel;\n\n            if (instances[PRIMARY_INSTANCE_NAME]) {\n                // main mixpanel lib already initialized\n                instance = instances[PRIMARY_INSTANCE_NAME];\n            } else if (token) {\n                // intialize the main mixpanel lib\n                instance = create_mplib(token, config, PRIMARY_INSTANCE_NAME);\n            }\n\n            window[PRIMARY_INSTANCE_NAME] = mixpanel = instance;\n            extend_mp();\n        }\n    };\n\n    mixpanel['init']();\n\n    // Fire loaded events after updating the window's mixpanel object\n    _.each(instances, function(instance) {\n        instance._loaded();\n    });\n\n    // Cross browser DOM Loaded support\n\n    function dom_loaded_handler() {\n        // function flag since we only want to execute this once\n        if (dom_loaded_handler.done) { return; }\n        dom_loaded_handler.done = true;\n\n        DOM_LOADED = true;\n        ENQUEUE_REQUESTS = false;\n\n        _.each(instances, function(inst) {\n            inst._dom_loaded();\n        });\n    }\n\n    if (document.addEventListener) {\n        if (document.readyState == \"complete\") {\n            // safari 4 can fire the DOMContentLoaded event before loading all\n            // external JS (including this file). you will see some copypasta\n            // on the internet that checks for 'complete' and 'loaded', but\n            // 'loaded' is an IE thing\n            dom_loaded_handler();\n        } else {\n            document.addEventListener(\"DOMContentLoaded\", dom_loaded_handler, false);\n        }\n    } else if (document.attachEvent) {\n        // IE\n        document.attachEvent(\"onreadystatechange\", dom_loaded_handler);\n\n        // check to make sure we arn't in a frame\n        var toplevel = false;\n        try {\n            toplevel = window.frameElement == null;\n        } catch(e) {}\n\n        if (document.documentElement.doScroll && toplevel) {\n            function do_scroll_check() {\n                try {\n                    document.documentElement.doScroll(\"left\");\n                } catch(e) {\n                    setTimeout(do_scroll_check, 1);\n                    return;\n                }\n\n                dom_loaded_handler();\n            };\n\n            do_scroll_check();\n        }\n    }\n\n    // fallback handler, always will work\n    _.register_event(window, 'load', dom_loaded_handler, true);\n\n})(window['mixpanel']);\n//# sourceURL=/lib/mixpanel-2.2.js"),
root.mixpanel=mixpanel}.apply(root,arguments)})}(this),eval('/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4, bitwise: true */\n/*global define: true, graphite: true, console: true, brackets*/\n\ndefine(\'override/config/environment\',[\n    \'jquery\',\n    \'module\',\n    \'text!config-json\'\n], function ($, module, configText) {\n    "use strict";\n    \n    var ExtensionUtils = brackets.getModule("utils/ExtensionUtils"),\n        configJSON = JSON.parse(configText);\n\n    var environment = {\n        IMS_HOST : configJSON.IMS_HOST,\n        LOGOUT_HOST : configJSON.LOGOUT_HOST,\n        IMS_CLIENT_ID : configJSON.IMS_CLIENT_ID,\n        IMS_TARGET_ENV : configJSON.IMS_TARGET_ENV,\n        IMSLIB_URL : configJSON.IMSLIB_URL,\n        ADOBE_ANALYTICS_ACCOUNT : configJSON.ADOBE_ANALYTICS_ACCOUNT,\n        ENVIRONMENT : "stage",\n\n        ASSETS_HOST : configJSON.ASSETS_HOST,\n        IMAGE_SERVICE_HOST : configJSON.IMAGE_SERVICE_HOST,\n        IMAGE_SERVICE_PORT: configJSON.IMAGE_SERVICE_PORT,\n        FILESTORAGE_HOST: configJSON.FILESTORAGE_HOST,\n        COLLAB_SERVICE_HOST: configJSON.COLLAB_SERVICE_HOST,\n        COLLAB_IMAGE_SERVICE_HOST: configJSON.COLLAB_IMAGE_SERVICE_HOST,\n\n        API_KEY: configJSON.API_KEY,\n        proxies: {},\n\n        getImsAuthEndpoint_Login: function () {\n            return "https://" + environment.IMS_HOST + "/ims/authorize/v1";\n        },\n        getImsAuthEndpoint_Logout: function () {\n            return "https://" + environment.LOGOUT_HOST + "/ims/logout/v1";\n        },\n        url: function (pathname, service) {\n            service = service || environment.IMAGE_SERVICE_HOST;\n            \n            // TODO fix this:  for some odd reason the createwebasset call fails if it goes through our proxy.\n            // Proxy for create web asset disabled for now. However there is no good reason to cache \n            // these calls anyways.\n            if (environment.proxies[service] && pathname !== "/createwebasset" &&\n                    !pathname.match(/archive/)) {\n                return environment.proxies[service] + pathname;\n            } else {\n                return service + pathname;\n            }\n\n        },\n        setProxyURL: function (proxy, target) {\n            environment.proxies[target] = proxy;\n        },\n        modulePath: function () {\n            return ExtensionUtils.getModulePath(module) + "..";\n        }\n    };\n\n    return environment;\n});\n\n//# sourceURL=/./config/environment.js'),eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4, bitwise: true */\n/*global define: true, graphite: true, document: true, mixpanel: true, window: true*/\n\ndefine('controllers/AuthController',[\n    'jquery',\n    'underscore',\n    'backbone',\n    'config/environment'\n], function ($, _, Backbone, environment) {\n    'use strict';\n\n    // serverAPI - ccweb should handle authentication\n    var IMS_REDIRECT_URI = window.location.protocol + '//' + window.location.host,\n        AuthController = Backbone.Model.extend({\n            authModel: null,\n\n            getLoginURL: function () {\n                var loginURL = environment.getImsAuthEndpoint_Login() + '?client_id=' + environment.IMS_CLIENT_ID + '&redirect_uri=' + IMS_REDIRECT_URI + '/api/v1/login&scope=openid,AdobeID,creative_cloud&dc=' + !!window.graphite.isFeatureEnabled('aug21');\n                return loginURL;\n            },\n\n            getLogoutURL: function () {\n                return environment.getImsAuthEndpoint_Logout() + '?redirect_uri=' + IMS_REDIRECT_URI + '/api/v1/logout&client_id=' + environment.IMS_CLIENT_ID + '&access_token=null';\n            },\n\n            setAuthModel: function (model) {\n                this.authModel = model;\n            },\n\n            getAuthModel: function () {\n                return this.authModel;\n            },\n\n            setCookie: function (name, value, hours) {\n                var expires = '';\n\n                if (hours) {\n                    var date = new Date();\n                    date.setTime(date.getTime() + (hours * 60 * 60 * 1000));\n                    expires = '; expires=' + date.toGMTString();\n                }\n                document.cookie = name + '=' + value + expires + '; path=/';\n            },\n\n            getCookie: function (name) {\n                var cookies = document.cookie.split(';'),\n                    i,\n                    cookie;\n                for (i in cookies) {\n                    if (cookies.hasOwnProperty(i)) {\n                        cookie = cookies[i].trim().split('=');\n                        cookie[0].trim();\n                        if (cookie[0] === name) {\n                            return cookie[1];\n                        }\n                    }\n                }\n                return;\n            },\n\n            login: function () {\n                if (this.authModel.isValid()) {\n                    return;\n                }\n\n                graphite.events.trigger('load-login-page', this.getLoginURL());\n            },\n\n            logout: function () {\n                if (!this.authModel.isValid()) {\n                    return;\n                }\n\n                document.location = this.getLogoutURL();\n            },\n\n            reauthenticate: function () {\n                this.authModel.invalidate();\n                this.login();\n            },\n\n            isLoggedIn: function () {\n                return this.authModel && this.authModel.isValid();\n            }\n\n        });\n\n    return new AuthController();\n});\n\n//# sourceURL=/lib/graphite-api/public/js/controllers/AuthController.js"),eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013-2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4 */\n/*global define: true, graphite: true, require: true*/\ndefine(\n    'plugin-dependencies',\n    [\n        'underscore',\n        'controllers/AuthController',\n        'ext/strings'\n    ],\n    function (_, AuthController, i18nStrings) {\n        'use strict';\n\n        return {\n            translate: function () {\n                var test_mode     = false;\n                var original_key  = arguments[0] ? arguments[0] : null;\n                var replacements  = Array.prototype.slice.call(arguments, 1);\n\n                // simple lookup of a single key, return the key if no match found\n                var ret = original_key;\n                \n                // replace string w/ localized equivalent\n                if (i18nStrings.hasOwnProperty(original_key)) {\n                    ret = i18nStrings[original_key];\n                }\n                                      \n                ret = ret.replace(/\\\\'/g, '\\'');\n\n                // replace variables, assuming we have found the base string\n                if (ret) {\n                    _.each(replacements, function (item, index) {\n                        ret = ret.replace(('{' + index + '}'), item);\n                    });\n                }\n                if (test_mode) {\n                    return \"!!!-\" + ret + \"-!!!\";\n                }\n\n                return ret;\n            },\n\n            utils: {\n                getCurrentPage: function () {\n                    return AuthController.isLoggedIn();\n                },\n                getCurrentBasePath: function () {\n                    return 'parfait';\n                }\n            },\n\n            config: {\n                sharedcloud_proxy_url: \"\"\n            },\n\n            auth: {\n                token: \"\"\n            },\n\n            parfait: true,\n\n            notifyUser: function (msg) {\n                graphite.events.trigger('load-alert', msg);\n            }\n        };\n    }\n);\n//# sourceURL=/pluginshim/plugin-dependencies.js"),eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4, bitwise: true */\n/*global define: true, graphite: true*/\n\ndefine('models/ConfigModel',[\n    'underscore',\n    'backbone'\n], function (_, Backbone) {\n    'use strict';\n    var ConfigModel = Backbone.Model.extend({\n            defaults: {\n                buildSHA: '***gitSHA***'\n            },\n            getBuildNumber: function () {\n                return this.get('buildSHA');\n            }\n        });\n    return ConfigModel;\n});\n\n//# sourceURL=/lib/graphite-api/public/js/models/ConfigModel.js"),eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4, bitwise: true */\n/*global define: true, graphite: true, jsonPostObject: true, jsonPostData: true*/\n\ndefine('models/AuthModel',[\n    'jquery',\n    'underscore',\n    'backbone'\n], function ($, _, Backbone) {\n    'use strict';\n\n    // serverAPI - ccweb should handle authentication\n    var AuthModel = Backbone.Model.extend({\n\n        defaults: {\n            access_token: null,\n            expires_in: null,\n            user_data: null,\n            adobeID: null\n        },\n\n        initialize: function () {\n            var that = this;\n\n            $.ajax({\n                url: '/api/v1/user/data',\n                type: 'GET',\n                async: false,\n                success: function (data) {\n                    that.user_data = data.user_data;\n                    that.adobeID = data.adobeID;\n                }\n            });\n        },\n\n        invalidate: function () {\n            this.user_data = null;\n        },\n\n        isValid: function () {\n            return this.user_data;\n        },\n\n        isValidWithUserFeature: function (feature) {\n            if (this.isValid()) {\n                if (this.user_data.accountEnabled) {\n                    if (feature) {\n                        return (this.user_data[feature] || false);\n                    }\n                    return true;\n                }\n            }\n            return false;\n        },\n\n        isAnalyticsOptIn: function () {\n            var isAnalyticsOptIn = true; //by default.\n\n            if (this.user_data) {\n                if (!this.user_data.analyticsOptIn) {\n                    isAnalyticsOptIn = false;\n                }\n            }\n            return isAnalyticsOptIn;\n        },\n\n        isAdobeInternalUser: function () {\n            var bAdobeInternal = false;\n            if (this.user_data) {\n                var emailAddress = this.user_data.email;\n                var domainIndex = emailAddress.lastIndexOf('@');\n                if (domainIndex !== -1) {\n                    var domainName = emailAddress.substr(domainIndex + 1);\n                    domainName = domainName.toLowerCase();\n                    if ((domainName === 'adobe.com') ||\n                            (domainName === 'adobetest.com') ||\n                            (domainName === '601t.com')) {\n                        bAdobeInternal = true;\n                    }\n                }\n            }\n            return bAdobeInternal;\n        },\n\n        setAnalyticsOptIn: function (bAnalyticsOptIn) {\n\n            //post data\n            var jsonPostObject = {};\n            jsonPostObject.analyticsOptIn = bAnalyticsOptIn;\n            var jsonPostData = JSON.stringify(jsonPostObject);\n\n            var that = this;\n            $.ajax({\n                type: 'POST',\n                url: '/api/v1/user/analyticsOptIn',\n                data: jsonPostData,\n                contentType: 'application/json; charset=utf-8',\n                dataType: 'json',\n                success: function () {\n                    that.user_data.analyticsOptIn = bAnalyticsOptIn;\n                },\n                error: function (errMsg) {\n                    // we currently do nothing here\n                }\n            });\n        },\n\n        getAdobeId: function () {\n            return this.adobeID;\n        },\n\n        getRegisterDate: function () {\n            return this.user_data.registerDate;\n        },\n\n        getAccessToken: function () {\n            // Does not apply to ccweb or parfait where the window location\n            // will redirect completely to a full page sign-in form.\n            // Used only for E4B to asynchronously get access token for \n            // scenarios where the access token was expired and the user has\n            // to log in again to complete an action that is already in-progress.\n\n            // Synchronously resolve promise\n            var accessToken = this.attributes.access_token;\n            return new $.Deferred().resolve(accessToken).promise();\n        }\n    });\n\n    return AuthModel;\n});\n//# sourceURL=/lib/graphite-api/public/js/models/AuthModel.js"),eval('/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4, maxerr: 50 */\n/*global define, brackets */\n\ndefine(\'ext/NodeAPI\',["module"], function (module) {\n    "use strict";\n\n    var ExtensionUtils = brackets.getModule("utils/ExtensionUtils"),\n        NodeDomain = brackets.getModule("utils/NodeDomain"),\n        domainPath = ExtensionUtils.getModulePath(module, "node/v0.5.0/ParfaitDomain"),\n        nodeDomain = new NodeDomain("parfait-v0.5.0", domainPath); // TODO add build step\n\n    return {\n        nodeDomain: nodeDomain\n    };\n});\n//# sourceURL=/./NodeAPI.js'),eval('define(\'text!ext/models/default-preferences.json\',[],function () { return \'{\\n    "INSTALL_COMPLETE": {\\n        "key": "installComplete",\\n        "type": "boolean",\\n        "initial": false\\n    },\\n\\n    "INSTALL_BUNDLED_BUILD_VERSION": {\\n        "key": "installBundledBuildVersion",\\n        "type": "string",\\n        "initial": false\\n    },\\n    \\n    "EULA_ACCEPTED": {\\n        "key": "eulaAccepted",\\n        "type": "boolean",\\n        "initial": false\\n    },\\n    \\n    "METRICS_ENABLED": {\\n        "key": "metricsEnabled",\\n        "type": "boolean",\\n        "initial": true\\n    },\\n\\n    "HIDE_BEFORE_RENAME_MESSAGE": {\\n        "key": "hideBeforeRenameMessage",\\n        "type": "boolean",\\n        "initial": false\\n    },\\n\\n    "HIDE_AFTER_RENAME_MESSAGE": {\\n        "key": "hideAfterRenameMessage",\\n        "type": "boolean",\\n        "initial": false\\n    },\\n\\n    "HIDE_FIRST_LAUNCH_TOOLBAR_TOOLTIP": {\\n        "key": "hideFirstLaunchToolbarTooltip",\\n        "type": "boolean",\\n        "initial": false\\n    },\\n\\n    "HIDE_FIRST_LAUNCH_PSD": {\\n        "key": "hideFirstLaunchPSD",\\n        "type": "boolean",\\n        "initial": false\\n    }, \\n\\n    "HIDE_CALL_TO_ACTION_CALLOUT": {\\n        "key": "hideCallToActionCallout",\\n        "type": "boolean",\\n        "initial": false\\n    }, \\n    \\n    "HIDE_CSS_SYNTAX_MESSAGE": {\\n        "key": "hideCssSyntaxMessage",\\n        "type": "boolean",\\n        "initial": false        \\n    },\\n    \\n    "CCFILE_CACHE": {\\n        "key": "ccFileCache",\\n        "type": "object",\\n        "initial": {}\\n    },\\n    \\n    "GRAPHITE_VERSION": {\\n        "key": "graphiteVersion",\\n        "type": "string",\\n        "initial": ""\\n    },\\n    \\n    "USE_METRICS_BUFFER": {\\n        "key": "useMetricsBuffer",\\n        "type": "boolean",\\n        "initial": true\\n    },\\n    \\n    "METRICS_ANALYTICS_LIFECYCLE": {\\n        "key": "metricsAnalyticsLifecycle",\\n        "type": "object",\\n        "initial": {\\n            "all": {},\\n            "launch": {\\n                "a.Launches": 0\\n            }\\n        }\\n    },\\n    \\n    "MIXPANEL_PENDING_REQUESTS": {\\n        "key": "metricsPendingRequests",\\n        "type": "array",\\n        "initial": []\\n    },\\n    \\n    "MIXPANEL_BUFFER": {\\n        "key": "metricsBuffer",\\n        "type": "array",\\n        "initial": []\\n    },\\n    \\n    "IMS_COOKIE": {\\n        "key": "imsCookie",\\n        "type": "object",\\n        "initial": {}\\n    },\\n\\n    "METRICS_DEFAULT_PARAMS": {\\n        "key": "metricsDefaultParams",\\n        "type": "object",\\n        "initial": {\\n            "psdViews.userCount": 0,\\n            "psdViews.creativeUrlCount": 0,\\n            "psdViews.gettingStartedCount": 0,\\n            "ims.signIn.attemptCount": 0,\\n            "ims.signIn.successCount": 0,\\n            "ims.signIn.abortCount": 0,\\n            "ims.signUp.attemptCount": 0,\\n            "ims.signUp.successCount": 0,\\n            "ims.signUp.abortCount": 0,\\n            "tutorialMax.totalSteps": 0,\\n            "tutorialMax.navigatedSteps": 0,\\n            "tutorialMax.navigatedRate": 0,\\n            "tutorialMax.completedSteps": 0,\\n            "tutorialMax.completedRate": 0,\\n            "tutorialMax.lastNavigatedStep": ""\\n        }\\n    }\\n}\';});\n\n//# sourceURL=/text!ext/models/default-preferences.json'),eval('/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4 */\n/*global define, brackets*/\n\ndefine(\'ext/models/BracketsPreferencesModel\',[\n    "underscore",\n    "backbone",\n    "text!ext/models/default-preferences.json"\n], function (_, Backbone, DefaultPreferences) {\n    "use strict";\n\n    var DEFAULTS = JSON.parse(DefaultPreferences);\n\n    var PreferencesManager = brackets.getModule("preferences/PreferencesManager");\n\n    var BracketsPreferencesModel = Backbone.Model.extend({\n        \n        defaults: {\n            preferenceSystem: PreferencesManager.stateManager.getPrefixedSystem("psdlens")\n        },\n        \n        initialize: function () {\n            var self = this,\n                prefs = self.get("preferenceSystem");\n\n            Object.keys(DEFAULTS).forEach(function (id) {\n                var data = DEFAULTS[id];\n                prefs.definePreference(data.key, data.type, data.initial);\n                self[id] = data.key;\n\n                if (data.type === "object" && (typeof data.initial === "object")) {\n                    // Populate missing defaults\n                    var existing = prefs.get(data.key);\n                    prefs.set(data.key, _.defaults(existing, data.initial));\n                }\n            });\n        },\n\n        restoreDefaults: function () {\n            var self = this;\n            \n            Object.keys(DEFAULTS).forEach(function (id) {\n                self.reset(id);\n            });\n        },\n        \n        reset: function (id) {\n            var data = DEFAULTS[id];\n            \n            if (!data) {\n                return;\n            }\n            \n            var prefs = this.get("preferenceSystem");\n            prefs.set(data.key, data.initial);\n        },\n        \n        toJSON: function () {\n            var prefs = this.get("preferenceSystem"),\n                json = {};\n\n            _.each(DEFAULTS, function (data) {\n                json[data.key] = prefs.get(data.key);\n            });\n            \n            return json;\n        },\n\n        getViewState: function (id, context) {\n            return PreferencesManager.getViewState(id, context);\n        }\n\n    });\n    \n    return new BracketsPreferencesModel();\n});\n//# sourceURL=/./models/BracketsPreferencesModel.js'),eval('/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4 */\n/*global define, graphite, brackets, decodeURI*/\n\ndefine(\'ext/CacheManager\',[\n    "jquery",\n    "underscore",\n    "ext/NodeAPI",\n    "ext/models/BracketsPreferencesModel",\n    "ext/strings"\n], function ($, _, NodeAPI, BracketsPreferencesModel, Strings) {\n    "use strict";\n    \n    var nodeDomain  = NodeAPI.nodeDomain,\n        prefs       = BracketsPreferencesModel.get("preferenceSystem");\n\n    var CacheManager = {\n\n        currentMD5s: {},\n    \n        purgeCache: function (key) {\n            var cacheMap = this.getCache();\n            \n            if (key) {\n                delete cacheMap[key];\n                nodeDomain.exec("clearProxyCache", decodeURI(key));\n            } else {\n                cacheMap = {};\n                nodeDomain.exec("clearProxyCache", null);\n            }\n            \n            this.setCache(cacheMap);\n        },\n\n        isEmpty: function () {\n            return Object.keys(this.getCache()).length === 0;\n        },\n        \n        getCache: function () {\n            return prefs.get(BracketsPreferencesModel.CCFILE_CACHE);\n        },\n        \n        setCache: function (cacheMap) {\n            prefs.set(BracketsPreferencesModel.CCFILE_CACHE, cacheMap);\n        },\n        \n        getGraphiteVersion: function () {\n            return prefs.get(BracketsPreferencesModel.GRAPHITE_VERSION);\n        },\n        \n        setGraphiteVersion: function (graphiteVersion) {\n            prefs.set(BracketsPreferencesModel.GRAPHITE_VERSION, graphiteVersion);\n        },\n        \n        validateCacheForPath: function (md5, path) {\n            this.validateKey(md5, path);\n        },\n        \n        validateKey: function (value, key) {\n            var cacheMap = this.getCache();\n            \n            if (cacheMap[key] && cacheMap[key] !== value) {\n                // There is a new or updated PSD. Purge cache.\n                this.purgeCache(key);\n            }\n        },\n\n        handleCCDirLoad: function (params) {\n            var self = this,\n                cacheMap = this.getCache(),\n                loadedMD5s = params.pathMD5Map,\n                currentPath = params.path;\n\n            this.currentMD5s = loadedMD5s;\n\n            _.each(this.currentMD5s, function (value, key) {\n                self.validateKey(value, key);\n            });\n\n            // Purge cache for paths that have been deleted from CC\n            _.each(cacheMap, function (value, key) {\n                var thisKeysFolder = key.substr(0, key.lastIndexOf("/"));\n\n                if (thisKeysFolder === currentPath &&\n                        !self.currentMD5s[key]) {\n                    // A PSD has been deleted from this folder, purge cache\n                    self.purgeCache(key);\n                }\n            });\n        },\n\n        handleAssetDataLoaded: function (params) {\n            var cacheMap = this.getCache(),\n                graphiteVersion = params.graphiteVersion,\n                path = params.path,\n                cachedGraphiteVersion = this.getGraphiteVersion();\n\n            // FIXME ccweb/main.js do not cache authless PSDs\n            if (path.indexOf("files/") < 0) {\n                return;\n            }\n\n            if (graphiteVersion && cachedGraphiteVersion && graphiteVersion !== cachedGraphiteVersion) {\n                this.purgeCache();\n            } else {\n                // WHen a PSD is opened we assume that currentMD5s holds\n                // the current MD5 for the PSD in view. \n                // If we ever implement a way to open a PSD without first browsing to the folder\n                // we will have to ensure currentMD5s is updated before this handler runs.\n                cacheMap[path] = this.currentMD5s[path];\n                this.setCache(cacheMap);\n            }\n\n            this.setGraphiteVersion(graphiteVersion);\n        }\n    };\n\n    return CacheManager;\n});\n\n//# sourceURL=/./CacheManager.js'),eval('/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4, bitwise: true */\n/*global define, brackets, PathUtils*/\ndefine(\'ext/ims/IMSProxy\',["ext/NodeAPI"], function (NodeAPI) {\n    "use strict";\n\n    var _proxyDomain,\n        configurePromise,\n        nodeDomain = NodeAPI.nodeDomain;\n\n    return {\n        configure: function () {\n            if (!configurePromise) {\n                configurePromise = nodeDomain.exec("configureIMS").then(function (res) {\n                    _proxyDomain = "http://127.0.0.1:" + res.port;\n                }, function (err) {\n                    console.error(err);\n                });\n            }\n\n            return configurePromise;\n        },\n\n        proxyUrlInfo: function (targetURL) {\n            var targetDomain = PathUtils.parseUrl(targetURL).domain;\n\n            return {\n                domain: targetDomain,\n                url: targetURL.replace(targetDomain, _proxyDomain)\n            };\n        },\n\n        setCookie: function (cookieString) {\n            nodeDomain.exec("setCookie", cookieString);\n        }\n    };\n});\n//# sourceURL=/./ims/IMSProxy.js'),eval('define(\'text!ext/package.json\',[],function () { return \'{\\n  "name": "adobe.brackets.extract",\\n  "title": "Extract for Brackets (Preview)",\\n  "homepage": "http://www.adobe.com/go/e4b_help",\\n  "author": "Adobe",\\n  "version": "0.8.0",\\n  "keywords": [ "PSDLens", "Extract", "Adobe" ],\\n  "engines": {\\n    "brackets": ">=1.1"\\n  },\\n  "description": "Preview of Extract functionality inside Brackets. Extract design information and assets from a design comp via contextual code hints for CSS.",\\n  "i18n": [ "en", "fr", "ja" ],\\n  "package-i18n": {\\n    "fr": {\\n      "title": "Extract for Brackets (Preview)",\\n      "description": "Prsentation prive de la fonctionnalit Extract dans Brackets. Celle-ci permet notamment dextraire les informations de conception et les actifs dune composition grce aux indicateurs de code contextuels pour CSS."\\n    },\\n    "ja": {\\n      "title": "Extract for Brackets (Preview)",\\n      "description": "Brackets  Extract CSS  "\\n    }\\n},\\n  "devDependencies": {\\n    "grunt": "0.4.1",\\n    "grunt-cli": "0.1.9",\\n    "grunt-contrib-jshint": "0.6.0",\\n    "grunt-contrib-clean": "0.4.1",\\n    "grunt-contrib-copy": "0.4.1",\\n    "grunt-contrib-requirejs": "0.4.1",\\n    "load-grunt-tasks": "0.2.0",\\n    "grunt-contrib-compress": "0.8.0",\\n    "jshint": "2.1.4",\\n    "grunt-gitinfo": "0.1.6",\\n    "lodash": "2.4.1"\\n  },\\n  "scripts": {\\n    "install": "bash -c \\\'cd lib/graphite-api; npm install; grunt sass; stylus public/css public/js/ccweb.files.extract/css\\\'"\\n  }\\n}\\n\';});\n\n//# sourceURL=/text!ext/package.json'),eval('define(\'text!ext/html/eula-dialog.html\',[],function () { return \'<div class="e4b-eula-dialog template modal hide">\\n    <div class="modal-header">\\n        <h1 class="dialog-title">{{EULA_DIALOG_TITLE}}</h1>\\n    </div>\\n    <div class="modal-body">\\n        <p class="dialog-message">{{EULA_HEADER}}</p>\\n        <div class="content">{{{EULA_CONTENT}}}</div>\\n        <p class="dialog-notice">{{{EULA_OPT_OUT_NOTICE}}}</p>\\n    </div>\\n    <div class="modal-footer">\\n        <a href="#" class="dialog-button btn" data-button-id="cancel">{{EULA_BTN_DECLINE}}</a>\\n        <a href="#" class="dialog-button btn primary" data-button-id="ok">{{EULA_BTN_ACCEPT}}</a>\\n    </div>\\n</div>\';});\n\n//# sourceURL=/text!ext/html/eula-dialog.html'),
eval('/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4, bitwise: true */\n/*global define, brackets, graphite, Mustache*/\n\ndefine(\'ext/models/ExtensionMetadata\',[\n    "jquery",\n    "backbone",\n    "ext/models/BracketsPreferencesModel",\n    "ext/strings",\n    "text!ext/package.json",\n    "text!ext/html/eula-dialog.html"\n], function ($, Backbone, BracketsPreferencesModel, Strings, PackageJSON, eulaDialogHTML) {\n    "use strict";\n    \n    var Dialogs = brackets.getModule("widgets/Dialogs");\n    \n    var prefs = BracketsPreferencesModel.get("preferenceSystem"),\n        eulaDialogTemplate = Mustache.render(eulaDialogHTML, Strings);\n\n    var ExtensionMetadata = Backbone.Model.extend({\n\n        initialize: function () {\n            var self = this,\n                id = JSON.parse(PackageJSON).name;\n\n            // Use compile-time metdata to get extension ID\n            this.set("id", id);\n        },\n        \n        getAcceptedEULA: function () {\n            var deferred = new $.Deferred(),\n                eulaAccepted = prefs.get(BracketsPreferencesModel.EULA_ACCEPTED);\n            \n            if (eulaAccepted) {\n                deferred.resolve();\n            } else {\n                var dialogPromise = Dialogs.showModalDialogUsingTemplate(eulaDialogTemplate).getPromise();\n                dialogPromise.done(function (btnId) {\n                    var accepted = btnId === Dialogs.DIALOG_BTN_OK;\n                    prefs.set(BracketsPreferencesModel.EULA_ACCEPTED, accepted);\n                    \n                    if (accepted) {\n                        graphite.events.trigger("eulaAccepted");\n                        deferred.resolve();\n                    } else {\n                        deferred.reject();\n                    }\n                });\n            }\n            \n            return deferred.promise();\n        },\n\n        getBundledBuildVersion: function () {\n            return prefs.get(BracketsPreferencesModel.INSTALL_BUNDLED_BUILD_VERSION);\n        },\n\n        isBundledBuild: function () {\n            return !!this.getBundledBuildVersion();\n        }\n    });\n\n    return new ExtensionMetadata();\n});\n\n//# sourceURL=/./models/ExtensionMetadata.js'),eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4, maxerr: 50 */\n/*global define */\n\ndefine('nls/AdobeIMSStrings',['require','exports','module'],function (require, exports, module) {\n    \n    'use strict';\n    \n    // Code that needs to display user strings should call require(\"AdobeIMSStrings\") to load\n    // AdobeIMSStrings.js. This file will dynamically load AdobeIMSStrings.js for the locale specified by brackets.locale.\n    // \n    // Translations for other locales should be placed in nls/<locale<optional country code>>/AdobeIMSStrings.js\n    // Localization is provided via the i18n plugin.\n    // All other bundles for languages need to add a prefix to the exports below so i18n can find them.\n    // TODO: dynamically populate the local prefix list below?\n    module.exports = {\n        root: true,\n        \"fr\": true,\n        \"ja\": true\n    };\n});\n//# sourceURL=/nls/AdobeIMSStrings.js"),eval('/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4, maxerr: 50 */\n/*global define */\n\n/*\n *\n * Do *NOT* translate the string keys on the left of the colon.  These string\n *    keys *MUST* match the string values inherited from the JS source.\n *\n */\n\ndefine(\'nls/root/AdobeIMSStrings\',{\n    // imslib.js strings\n    "allow_pop_up_window": "The browser\'s pop-up blocker has stopped a window from opening. To be able to sign-in, please use the browser\'s UI (in the address bar) to allow the window to be opened. Thank you.",\n    "confirm_expired_credentials_sign_in_again": "Your session has expired. To protect your account, you need to confirm your password periodically. Do you want to sign in again?",\n    "alert_expired_credentials_sign_in_again": "Your session has expired. To protect your account, you need to confirm your password periodically. Please sign in again.",\n    "network_error": "A network error has occurred. Are you connected to the internet?"\n});\n//# sourceURL=/nls/root/AdobeIMSStrings.js'),eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4, maxerr: 50 */\n/*global define, brackets */\n\ndefine('ext/AdobeIMSStrings',['require','exports','module','i18n!nls/AdobeIMSStrings'],function (require, exports, module) {\n    \"use strict\";\n\n    module.exports = require(\"i18n!nls/AdobeIMSStrings\");\n});\n//# sourceURL=/./AdobeIMSStrings.js"),eval('define(\'text!html/ims-loading.html\',[],function () { return \'<html>\\n<head>\\n<title>{{WINDOW_TITLE}}</title>\\n<style type="text/css">\\n    body {\\n        display: flex;\\n        flex-direction: column;\\n        justify-content: center;\\n        align-items: center;\\n        overflow: hidden;\\n    }\\n    .logo {\\n        width: 195px;\\n        height: 40px;\\n        background-size: auto auto;\\n        background-repeat: no-repeat;\\n        background-position: 0 0;\\n        background-image: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAxNy4xLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApICAtLT4NCjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+DQo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4Ig0KCSB3aWR0aD0iMzAwcHgiIGhlaWdodD0iNDAwcHgiIHZpZXdCb3g9IjAgMCAzMDAgNDAwIiBlbmFibGUtYmFja2dyb3VuZD0ibmV3IDAgMCAzMDAgNDAwIiB4bWw6c3BhY2U9InByZXNlcnZlIj4NCjxnPg0KCTxwYXRoIGlkPSJsb2dvIiBmaWxsPSIjMzMzMzMzIiBkPSJNMTc5LjYsMjkuM2MtMi41LDAtNC40LTAuMS01LjMtMC4xYy0wLjEsMC0wLjItMC4xLTAuMi0wLjJWNS4zYzAtMC4xLDAtMC4yLDAuMi0wLjINCgkJYzEuMSwwLDMuNC0wLjEsNi4xLTAuMWM4LjIsMCwxMS45LDUsMTEuOSwxMS44QzE5Mi4zLDI2LjcsMTg1LjIsMjkuMywxNzkuNiwyOS4zeiBNMTgwLjMsNi40Yy0yLjMsMC00LjEsMC00LjUsMC4xdjIxLjINCgkJYzAuNCwwLDIuMiwwLjEsMy44LDAuMWM2LjcsMCwxMS4xLTMuNiwxMS4xLTExQzE5MC42LDkuOSwxODYuNCw2LjQsMTgwLjMsNi40eiBNMTY2LjYsMjkuMmgtMS4zYy0wLjEsMC0wLjIsMC0wLjItMC4yVjUuMw0KCQljMC0wLjEsMC4xLTAuMiwwLjItMC4yaDEuM2MwLjEsMCwwLjIsMC4xLDAuMiwwLjJWMjlDMTY2LjgsMjkuMiwxNjYuNywyOS4yLDE2Ni42LDI5LjJ6IE0xNDkuOCwyMC4zYy0wLjUsMC4xLTIuMywwLjEtMy43LDAuMUgxMzgNCgkJYy0wLjIsNC4zLDIsNy42LDYuNCw3LjZjMS41LDAsMy0wLjIsNC40LTEuMWMwLjEsMCwwLjEsMCwwLjEsMC4xdjEuMWMwLDAuMSwwLDAuMi0wLjEsMC4yYy0xLjEsMC42LTIuNiwxLjEtNC43LDEuMQ0KCQljLTUuOSwwLTcuOS00LjQtNy45LTguN2MwLTUsMi44LTguOSw3LjQtOC45YzQuOSwwLDYuNSwzLjksNi41LDYuNmMwLDAuNywwLDEuMi0wLjEsMS41QzE1MCwyMC4yLDE0OS45LDIwLjMsMTQ5LjgsMjAuM3oNCgkJIE0xNDMuNSwxMy40Yy0zLjQsMC01LjEsMi43LTUuNSw1LjdoNy44YzIuMiwwLDIuNSwwLDIuNi0wLjFjMC0wLjEsMC0wLjUsMC0wLjZDMTQ4LjUsMTYuNiwxNDcuNSwxMy40LDE0My41LDEzLjR6IE0xMjMuNywyOS41DQoJCWMtMiwwLTMuNy0wLjItNS42LTEuMmMtMC4xLTAuMS0wLjItMC4yLTAuMi0wLjNWMy4yYzAtMC4xLDAtMC4xLDAuMi0wLjFoMS4zYzAuMSwwLDAuMiwwLDAuMiwwLjF2MTBjMS4zLTAuNywzLTEuMiw0LjgtMS4yDQoJCWM0LjcsMCw3LjgsMy40LDcuOCw4LjRDMTMyLjIsMjYuMiwxMjguMSwyOS41LDEyMy43LDI5LjV6IE0xMjQuMywxMy40Yy0xLjcsMC0zLjMsMC40LTQuNiwxLjF2MTIuN2MxLjMsMC43LDIuOCwwLjksNC4yLDAuOQ0KCQljMy43LDAsNi43LTIuOSw2LjctNy43QzEzMC41LDE2LjQsMTI4LjIsMTMuNCwxMjQuMywxMy40eiBNMTA0LjksMjkuNWMtNS41LDAtNy45LTQuNi03LjktOC44YzAtNSwzLjMtOC44LDcuOS04LjgNCgkJczcuOCwzLjUsNy44LDguOEMxMTIuNywyNiwxMDkuNSwyOS41LDEwNC45LDI5LjV6IE0xMDQuOCwxMy40Yy0zLjcsMC02LjEsMy02LjEsNy4zYzAsNCwyLjMsNy40LDYuMyw3LjRjMi44LDAsNi0yLjEsNi03LjMNCgkJQzExMSwxNy4xLDEwOS4yLDEzLjQsMTA0LjgsMTMuNHogTTg3LjQsMjkuNWMtNC43LDAtOC40LTMtOC40LTguN2MwLTUuNCwzLjgtOC45LDkuMS04LjljMS42LDAsMi42LDAuMiwzLjUsMC41VjMuMg0KCQljMC0wLjEsMC0wLjIsMC4yLTAuMkg5M2MwLjIsMCwwLjIsMC4xLDAuMiwwLjJ2MjMuNWMwLDAuNCwwLDAuOCwwLjEsMS4xYzAsMC4xLDAsMC4yLTAuMSwwLjJDOTEuNCwyOS4xLDg5LjMsMjkuNSw4Ny40LDI5LjV6DQoJCSBNOTEuNSwxNC4xYy0wLjgtMC41LTItMC43LTMuNi0wLjdjLTQuOSwwLTcuMywzLjUtNy4zLDcuNGMwLDUuMywzLjcsNy4zLDYuOSw3LjNjMS40LDAsMy0wLjIsNC0wLjhWMTQuMXogTTc2LjEsMjkuMmgtMS41DQoJCWMtMC4xLDAtMC4yLDAtMC4yLTAuMWwtMy4yLTguOGgtOS42TDU4LjQsMjljMCwwLjEtMC4xLDAuMi0wLjIsMC4yaC0xLjNjLTAuMSwwLTAuMi0wLjEtMC4xLTAuMkw2NSw2LjJjMC4xLTAuMiwwLjEtMC40LDAuMS0xDQoJCWMwLTAuMSwwLjEtMC4xLDAuMi0wLjFoMi4xYzAuMSwwLDAuMSwwLDAuMiwwLjFMNzYuMiwyOUM3Ni4yLDI5LjEsNzYuMiwyOS4yLDc2LjEsMjkuMnogTTY2LjQsNi40TDY2LjQsNi40DQoJCWMtMC42LDItMi43LDcuOC00LjQsMTIuNGg4LjdDNzAsMTYuNSw2Ny4xLDguNyw2Ni40LDYuNHogTTQ0LjksMHYzNi45TDI4LjQsMEg0NC45eiBNMjYuMSwzNi45bC0zLjItNy40aC03LjdsNy4zLTE1LjhMMzMsMzYuOQ0KCQlIMjYuMXogTTAsMGgxNi43TDAsMzYuOVYweiIvPg0KCTxwYXRoIGlkPSJlbnRlcnByaXNlX2xvZ28iIGZpbGw9IiMzMzMzMzMiIGQ9Ik00NC45LDE1Mi40djM2LjlsLTE2LjUtMzYuOUg0NC45eiBNMjYuMSwxODkuM2wtMy4yLTcuNGgtNy43bDcuMy0xNS44TDMzLDE4OS4zSDI2LjENCgkJeiBNMCwxNTIuNGgxNi43TDAsMTg5LjNWMTUyLjR6Ii8+DQoJPGcgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAgICAiPg0KCQk8cGF0aCBmaWxsPSIjMzMzMzMzIiBkPSJNNzEuMywxODMuOGMwLDAuMS0wLjEsMC4yLTAuMiwwLjJINTcuNWMtMC4yLDAtMC4zLTAuMS0wLjMtMC4zdi0yNC42YzAtMC4yLDAuMS0wLjIsMC4yLTAuMmgxMw0KCQkJYzAuMSwwLDAuMiwwLDAuMiwwLjJsMC4yLDEuMWMwLDAuMSwwLDAuMi0wLjIsMC4ySDU4Ljl2MTAuMWgxMC4zYzAuMSwwLDAuMiwwLDAuMiwwLjJ2MS4xYzAsMC4yLTAuMSwwLjItMC4yLDAuMkg1OC45djEwLjZoMTIuNQ0KCQkJYzAuMiwwLDAuMiwwLDAuMiwwLjJMNzEuMywxODMuOHoiLz4NCgkJPHBhdGggZmlsbD0iIzMzMzMzMyIgZD0iTTc1LjksMTcwLjFjMC0xLjMtMC4xLTMuNS0wLjItNGMwLTAuMiwwLTAuMiwwLjItMC4yaDEuMmMwLjEsMCwwLjIsMCwwLjIsMC4yYzAuMSwwLjMsMC4yLDEuNSwwLjIsMi4yDQoJCQljMS45LTEuOCw0LTIuOCw2LjItMi44czUuOSwxLjEsNS45LDcuMXYxMS4xYzAsMC4yLTAuMSwwLjItMC4yLDAuMmgtMS4yYy0wLjIsMC0wLjItMC4xLTAuMi0wLjJ2LTExLjFjMC0zLjMtMS40LTUuNS00LjYtNS41DQoJCQljLTIuMywwLTQuMywxLjMtNS44LDIuOXYxMy44YzAsMC4yLTAuMSwwLjItMC4yLDAuMmgtMS4zYy0wLjEsMC0wLjItMC4xLTAuMi0wLjJWMTcwLjF6Ii8+DQoJCTxwYXRoIGZpbGw9IiMzMzMzMzMiIGQ9Ik0xMDIuOCwxODMuNWMwLDAuMSwwLDAuMi0wLjIsMC4zYy0wLjgsMC40LTEuOCwwLjYtMi42LDAuNmMtMi40LDAtMy45LTEuMS0zLjktNC42di0xMi40aC0yLjcNCgkJCWMtMC4yLDAtMC4yLTAuMS0wLjItMC4zdi0wLjljMC0wLjIsMC0wLjIsMC4yLTAuMmgyLjdjMC0xLjUsMC4yLTQuNSwwLjMtNS4yYzAtMC4xLDAuMS0wLjIsMC4yLTAuMmwxLjMtMC4zYzAuMSwwLDAuMiwwLDAuMiwwLjENCgkJCWMtMC4yLDEuNC0wLjMsMy44LTAuMyw1LjZoNC40YzAuMiwwLDAuMiwwLjEsMC4yLDAuMnYxYzAsMC4yLTAuMSwwLjItMC4yLDAuMmgtNC40djEyLjVjMCwxLjgsMC43LDMsMi41LDNjMC43LDAsMS40LTAuMSwyLjItMC41DQoJCQljMC4xLDAsMC4yLDAsMC4yLDAuMnYwLjlMMTAyLjgsMTgzLjVMMTAyLjgsMTgzLjV6Ii8+DQoJCTxwYXRoIGZpbGw9IiMzMzMzMzMiIGQ9Ik0xMDYuOSwxNzQuNmMtMC4yLDQuNywyLjMsOC4yLDYuOSw4LjJjMS42LDAsMy4yLTAuMiw0LjgtMS4xYzAuMS0wLjEsMC4yLDAsMC4yLDAuMXYxLjENCgkJCWMwLDAuMiwwLDAuMi0wLjEsMC4zYy0xLjIsMC43LTIuNiwxLjEtNSwxLjFjLTYuMSwwLTguNC00LjctOC40LTkuM2MwLTUuNiwzLTkuNSw3LjgtOS41YzUsMCw2LjksNC4yLDYuOSw3DQoJCQljMCwxLjItMC4xLDEuOC0wLjIsMS45Yy0wLjcsMC4yLTIuMywwLjItNCwwLjJIMTA2Ljl6IE0xMTUuNSwxNzMuMmMyLjMsMCwyLjcsMCwyLjgtMC4yYzAtMC4yLDAtMC41LDAtMC44YzAtMS41LTEuMS01LjMtNS40LTUuMw0KCQkJYy0zLjYsMC01LjUsMi45LTUuOSw2LjNIMTE1LjV6Ii8+DQoJCTxwYXRoIGZpbGw9IiMzMzMzMzMiIGQ9Ik0xMjYsMTY1LjljMC4yLDAsMC4yLDAsMC4yLDAuMmMwLjEsMC41LDAuMiwxLjYsMC4zLDIuNGMxLjYtMiwzLjgtMyw1LjctM2MwLjEsMCwwLjMsMCwwLjQsMA0KCQkJYzAuMSwwLDAuMSwwLjEsMC4xLDAuM3YxLjFjMCwwLjIsMCwwLjItMC4yLDAuMmMtMi42LTAuMS01LDEuNi02LDMuMnYxMy40YzAsMC4yLDAsMC4yLTAuMiwwLjJIMTI1Yy0wLjIsMC0wLjItMC4xLTAuMi0wLjJ2LTEzLjENCgkJCWMwLTEuNi0wLjEtMy43LTAuMi00LjZjMC0wLjIsMC0wLjIsMC4yLTAuMmgxLjJWMTY1Ljl6Ii8+DQoJCTxwYXRoIGZpbGw9IiMzMzMzMzMiIGQ9Ik0xNTEuMywxNzQuMmMwLDYuOC01LjUsMTAuMS0xMC4yLDEwLjFjLTEuMywwLTIuMy0wLjItMy0wLjN2OC42YzAsMC4xLTAuMSwwLjItMC4yLDAuMmwtMS4zLDAuMg0KCQkJYy0wLjIsMC0wLjIsMC0wLjItMC4ydi0yNC43YzAtMC4yLDAtMC42LTAuMS0xLjFjMCwwLDAtMC4xLDAuMS0wLjJjMS0wLjMsMy43LTEuNSw2LjctMS41QzE0OCwxNjUuNSwxNTEuMywxNjguOSwxNTEuMywxNzQuMnoNCgkJCSBNMTM4LjEsMTY3Ljl2MTQuNWMwLjgsMC4zLDEuNywwLjUsMy4xLDAuNWM0LjYsMCw4LjQtMy4zLDguNC04LjZjMC00LjItMi41LTcuMi02LjgtNy4yQzE0MC43LDE2NywxMzkuMywxNjcuNCwxMzguMSwxNjcuOXoiLz4NCgkJPHBhdGggZmlsbD0iIzMzMzMzMyIgZD0iTTE1Ny41LDE2NS45YzAuMiwwLDAuMiwwLDAuMiwwLjJjMC4xLDAuNSwwLjIsMS42LDAuMywyLjRjMS42LTIsMy44LTMsNS43LTNjMC4xLDAsMC4zLDAsMC40LDANCgkJCWMwLjEsMCwwLjEsMC4xLDAuMSwwLjN2MS4xYzAsMC4yLDAsMC4yLTAuMiwwLjJjLTIuNi0wLjEtNSwxLjYtNiwzLjJ2MTMuNGMwLDAuMiwwLDAuMi0wLjIsMC4yaC0xLjRjLTAuMiwwLTAuMi0wLjEtMC4yLTAuMg0KCQkJdi0xMy4xYzAtMS42LTAuMS0zLjctMC4yLTQuNmMwLTAuMiwwLTAuMiwwLjItMC4yaDEuM0wxNTcuNSwxNjUuOUwxNTcuNSwxNjUuOXoiLz4NCgkJPHBhdGggZmlsbD0iIzMzMzMzMyIgZD0iTTE2Ny40LDE2MC41YzAtMC42LDAuNS0xLjIsMS4xLTEuMmMwLjcsMCwxLjEsMC41LDEuMSwxLjJjMCwwLjYtMC41LDEuMS0xLjEsMS4xDQoJCQlDMTY3LjgsMTYxLjYsMTY3LjQsMTYxLjEsMTY3LjQsMTYwLjV6IE0xNjcuNywxNjYuMWMwLTAuMiwwLTAuMiwwLjItMC4yaDEuM2MwLjEsMCwwLjIsMCwwLjIsMC4ydjE3LjdjMCwwLjIsMCwwLjItMC4yLDAuMkgxNjgNCgkJCWMtMC4yLDAtMC4yLDAtMC4yLTAuMnYtMTcuN0gxNjcuN3oiLz4NCgkJPHBhdGggZmlsbD0iIzMzMzMzMyIgZD0iTTE4MC4zLDE2N2MtMy4yLDAtNCwxLjgtNCwzLjFjMCwxLjcsMC44LDIuNiw0LjMsNGMzLjEsMS4yLDUuMSwyLjQsNS4xLDUuMmMwLDMuNi0zLjEsNS01LjksNQ0KCQkJYy0yLjMsMC00LTAuNi01LjItMS40Yy0wLjEtMC4xLTAuMi0wLjItMC4yLTAuM3YtMS40YzAtMC4yLDAuMS0wLjIsMC4yLTAuMmMxLjYsMS4xLDMuNCwxLjgsNS4zLDEuOGMzLjEsMCw0LjItMS43LDQuMi0zLjMNCgkJCWMwLTEuOC0xLjItMi43LTQuNi00LjFjLTMtMS4yLTQuOC0yLjUtNC44LTUuMmMwLTIuOCwyLjMtNC43LDUuOC00LjdjMi4yLDAsMy42LDAuNiw0LjQsMS4xYzAuMSwwLjEsMC4xLDAuMiwwLjEsMC4zdjEuMg0KCQkJYzAsMC4yLTAuMSwwLjItMC4yLDAuMUMxODMuNiwxNjcuNSwxODIuMiwxNjcsMTgwLjMsMTY3eiIvPg0KCQk8cGF0aCBmaWxsPSIjMzMzMzMzIiBkPSJNMTkxLjQsMTc0LjZjLTAuMiw0LjcsMi4zLDguMiw2LjksOC4yYzEuNiwwLDMuMi0wLjIsNC44LTEuMWMwLjEtMC4xLDAuMiwwLDAuMiwwLjF2MS4xDQoJCQljMCwwLjIsMCwwLjItMC4xLDAuM2MtMS4yLDAuNy0yLjYsMS4xLTUsMS4xYy02LjEsMC04LjQtNC43LTguNC05LjNjMC01LjYsMy05LjUsNy44LTkuNWM1LDAsNi45LDQuMiw2LjksNw0KCQkJYzAsMS4yLTAuMSwxLjgtMC4yLDEuOWMtMC43LDAuMi0yLjMsMC4yLTQsMC4ySDE5MS40eiBNMTk5LjksMTczLjJjMi4zLDAsMi43LDAsMi44LTAuMnMwLTAuNSwwLTAuOGMwLTEuNS0xLjEtNS4zLTUuNC01LjMNCgkJCWMtMy42LDAtNS41LDIuOS01LjksNi4zSDE5OS45eiIvPg0KCQk8cGF0aCBmaWxsPSIjMzMzMzMzIiBkPSJNMjE5LjgsMTgzLjdjMCwwLjIsMCwwLjItMC4yLDAuMmgtMS4zYy0wLjIsMC0wLjIsMC0wLjItMC4ydi0yNC42YzAtMC4xLDAtMC4yLDAuMi0wLjJoMS4zDQoJCQljMC4yLDAsMC4yLDAsMC4yLDAuMlYxODMuN3oiLz4NCgkJPHBhdGggZmlsbD0iIzMzMzMzMyIgZD0iTTIyNi41LDE1OS4xYzAtMC4yLDAtMC4yLDAuMi0wLjNjMS4xLDAsMy4zLTAuMSw2LjItMC4xYzguNiwwLDEyLjUsNS4zLDEyLjUsMTIuMw0KCQkJYzAsMTEuMi04LjMsMTIuOS0xMy40LDEyLjljLTIuNiwwLTQuMy0wLjEtNS4zLTAuMWMtMC4yLDAtMC4yLTAuMS0wLjItMC4zVjE1OS4xeiBNMjI4LjIsMTgyLjVjMC41LDAsMiwwLjEsMy44LDAuMQ0KCQkJYzcuMiwwLDExLjctMy41LDExLjctMTEuNWMwLTcuMi00LjItMTAuOS0xMC45LTEwLjljLTIuNSwwLTQuMSwwLTQuNiwwVjE4Mi41eiIvPg0KCTwvZz4NCgk8cGF0aCBpZD0iZHJvcGRvd25fYXJyb3dzIiBmaWxsPSIjQTFBMUEwIiBkPSJNMS44LDkxbDMuNC01LjhMOC41LDkxSDEuOHogTTUuMSw5OS40bC0zLjQtNS45aDYuN0w1LjEsOTkuNHoiLz4NCgk8cGF0aCBmaWxsPSIjQ0JDQkNBIiBkPSJNMjYuNiwzNDQuNGMwLDAsMCwwLjEsMC4xLDAuMmMwLDAuMSwwLjEsMC4xLDAuMSwwLjJsLTAuMy0wLjdDMjYuNSwzNDQuMSwyNi41LDM0NC4yLDI2LjYsMzQ0LjQNCgkJQzI2LjYsMzQ0LjMsMjYuNiwzNDQuNCwyNi42LDM0NC40Yy0wLjUtMS4zLTEuMy0yLjUtMi4zLTMuNGMtMS0xLTIuMi0xLjctMy41LTIuMXMtMi43LTAuNi00LjItMC40Yy0xLjQsMC4yLTIuNywwLjctMy45LDEuNA0KCQljLTAuOSwwLjYtMS43LDEuNC0yLjQsMi4zYy0xLjMtMC4yLTIuNS0wLjEtMy43LDAuM3MtMi4zLDEuMS0zLjIsMnMtMS41LDItMS45LDMuMnMtMC40LDIuNS0wLjIsMy44YzAuMywxLjksMS4yLDMuNSwyLjcsNC43DQoJCWMxLjUsMS4zLDMuMSwxLjksNSwxLjloOC45YzEuNCwwLDIuNy0wLjMsNC0wLjlzMi40LTEuNCwzLjMtMi41czEuNi0yLjQsMi0zLjhzMC41LTIuOSwwLjItNC4zYy0wLjEtMC40LTAuMS0wLjgtMC4yLTEuMWwwLDANCgkJQzI2LjksMzQ1LjIsMjYuOCwzNDQuOCwyNi42LDM0NC40TDI2LjYsMzQ0LjR6IE0xNi41LDM0OWMwLjIsMC4yLDAuMiwwLjUsMC4xLDAuN3MtMC4yLDAuNC0wLjUsMC41Yy0wLjMsMC4xLTAuNSwwLTAuNy0wLjINCgkJbC0yLjgtMy4zYy0wLjktMS0yLTEuNi0zLjMtMS43cy0yLjUsMC4zLTMuNSwxLjFjLTEsMC44LTEuNiwyLTEuOCwzLjNjLTAuMiwxLjQsMC4xLDIuNiwwLjksMy43YzAuNSwwLjYsMSwxLjEsMS43LDEuNQ0KCQlzMS41LDAuNSwyLjIsMC41SDExYzAuNiwwLjYsMS4yLDEuMSwxLjgsMS41SDguOWMtMS4zLDAtMi41LTAuNC0zLjYtMS4ycy0xLjktMS44LTIuMy0zLjFjLTAuNC0xLjItMC41LTIuNS0wLjItMy44DQoJCXMwLjktMi40LDEuOS0zLjNjMS4zLTEuMiwyLjgtMS44LDQuNi0xLjdzMy4zLDAuOCw0LjUsMi4yTDE2LjUsMzQ5eiBNMTIsMzU0LjFsLTMuNC0zLjZjLTAuMi0wLjItMC4yLTAuNS0wLjItMC43DQoJCWMwLjEtMC4yLDAuMi0wLjQsMC41LTAuNXMwLjUsMCwwLjcsMC4ybDMuMywzLjZjMC45LDAuOSwyLDEuNiwzLjIsMS45czIuNSwwLjMsMy43LTAuMXMyLjItMS4xLDMuMS0yLjJjMC44LTEsMS4zLTIuMiwxLjUtMy41DQoJCXMwLTIuNi0wLjYtMy44Yy0wLjUtMS4yLTEuNC0yLjItMi40LTIuOWMtMS4xLTAuOC0yLjQtMS4xLTMuNy0xLjFjLTEuNCwwLTIuNiwwLjQtMy43LDEuMWMtMC40LDAuMy0wLjcsMC42LTEsMC44DQoJCWMtMC40LTAuMy0wLjgtMC41LTEuMy0wLjdjMC45LTEuMSwyLjEtMS44LDMuNC0yLjNzMi43LTAuNiw0LTAuM2MxLjMsMC4yLDIuNCwwLjcsMy41LDEuNWMxLDAuOCwxLjksMS44LDIuNSwzczAuOSwyLjQsMC45LDMuOA0KCQlzLTAuMywyLjYtMC45LDMuOGMtMC42LDEuMi0xLjQsMi4yLTIuNCwzYy0xLjEsMC44LTIuMiwxLjMtMy41LDEuNWMtMS42LDAuMy0zLjEsMC4xLTQuNi0wLjZDMTMuNiwzNTUuNiwxMi43LDM1NC45LDEyLDM1NC4xDQoJCUwxMiwzNTQuMXoiLz4NCgk8ZyBpZD0iYmVoYW5jZSI+DQoJCTxwYXRoIGZpbGw9IiNDQkNCQ0EiIGQ9Ik01MywzMzcuN2MwLjksMC4yLDEuNiwwLjUsMi4xLDAuOGMwLjYsMC41LDEuMSwxLDEuMywxLjVjMC4zLDAuNSwwLjQsMS4zLDAuNCwyLjRzLTAuMiwxLjktMC43LDIuNg0KCQkJYy0wLjQsMC43LTEsMS4yLTIsMS42YzEuMSwwLjMsMiwwLjksMi44LDEuOGMwLjYsMSwwLjksMi4xLDAuOSwzLjNjMCwxLTAuMiwxLjktMC42LDIuN2MtMC40LDAuNy0xLDEuMy0xLjYsMS44DQoJCQljLTAuNywwLjUtMS41LDAuOC0yLjQsMWMtMC44LDAuMi0xLjcsMC4zLTIuNiwwLjNoLTkuN3YtMjAuM2g5LjZDNTEuMywzMzcuNCw1Mi4yLDMzNy41LDUzLDMzNy43TDUzLDMzNy43eiBNNTEuNywzNDUNCgkJCWMwLjUtMC40LDAuOC0xLDAuOC0xLjhjMC0wLjQtMC4xLTAuNy0wLjItMS4xYy0wLjItMC4zLTAuNC0wLjUtMC43LTAuN2MtMC4yLTAuMi0wLjYtMC4zLTEtMC40aC0xLjFoLTQuMnY0LjdoNC41DQoJCQlDNTAuNSwzNDUuNiw1MS4yLDM0NS40LDUxLjcsMzQ1TDUxLjcsMzQ1eiBNNTEuMiwzNTQuMmMwLjUtMC4xLDAuOC0wLjIsMS0wLjRjMC4yLTAuMSwwLjQtMC40LDAuNy0wLjhjMC4yLTAuMywwLjMtMC44LDAuMy0xLjMNCgkJCWMwLTEtMC4zLTEuOC0wLjktMi4zYy0wLjYtMC40LTEuNC0wLjYtMi40LTAuNmgtNC43djUuN0g1MHYtMC4xQzUwLjUsMzU0LjMsNTAuOSwzNTQuMyw1MS4yLDM1NC4yTDUxLjIsMzU0LjJ6IE02Ni41LDM1NS4xDQoJCQljMC44LDAsMS41LTAuMiwyLjItMC42YzAuNS0wLjQsMC45LTAuOCwxLjEtMS4zaDMuNmMtMC43LDEuOS0xLjUsMy4xLTIuNywzLjhjLTEuMywwLjgtMi43LDEuMS00LjMsMS4xYy0xLDAtMi0wLjItMy4yLTAuNQ0KCQkJYy0xLTAuNS0xLjgtMS0yLjMtMS41Yy0wLjYtMC43LTEuMS0xLjYtMS41LTIuNWMtMC4zLTEtMC41LTIuMS0wLjUtMy4yczAuMi0yLjEsMC41LTMuMWMwLjQtMC45LDAuOS0xLjcsMS41LTIuNQ0KCQkJYzAuNy0wLjcsMS41LTEuMywyLjMtMS42YzAuOS0wLjQsMS45LTAuNiwzLjEtMC42YzEuMywwLDIuNCwwLjIsMy4zLDAuN2MxLDAuNiwxLjgsMS4yLDIuMiwxLjljMC42LDAuOCwxLDEuNywxLjMsMi44DQoJCQljMC4zLDEsMC40LDIuMSwwLjMsMy4zSDYyLjhjMCwwLjYsMC4xLDEuMSwwLjMsMS42czAuNCwwLjksMC43LDEuMkM2NC40LDM1NC44LDY1LjMsMzU1LjEsNjYuNSwzNTUuMUw2Ni41LDM1NS4xeiBNNjYuMiwzNDUuNg0KCQkJYy0wLjYsMC0xLjEsMC4xLTEuNiwwLjNjLTAuMiwwLjEtMC42LDAuNC0xLDAuOGMtMC4yLDAuMi0wLjMsMC41LTAuNSwxYy0wLjEsMC41LTAuMiwwLjktMC4yLDAuOWg2LjVjLTAuMS0wLjktMC40LTEuNi0wLjktMi4zDQoJCQlDNjcuOSwzNDUuOSw2Ny4xLDM0NS42LDY2LjIsMzQ1LjZMNjYuMiwzNDUuNnogTTcwLjIsMzM4Ljd2Mkg2MnYtMkg3MC4yeiIvPg0KCTwvZz4NCgk8ZyBpZD0ibWt0X2Nsb3VkIj4NCgkJPHBhdGggZmlsbD0iIzk2OTU5NSIgZD0iTTIyOC44LDM1MS41YzAuNywxLDEuNSwxLjgsMi42LDIuNHMyLjIsMC45LDMuNCwwLjloMC4xaDAuMWMxLjIsMCwyLjQtMC40LDMuNS0xczEuOS0xLjUsMi41LTIuNmwwLjMsMC4yDQoJCQljMC43LTEuMywxLjEtMi43LDEuMS00LjFjLTAuMS0yLjEtMC44LTMuOS0yLjMtNS40cy0zLjMtMi4yLTUuNC0yLjF2MC40Yy0yLDAuMS0zLjcsMC44LTUsMi4zYy0xLjQsMS41LTIsMy4yLTIsNS4yDQoJCQlDMjI3LjcsMzQ5LjEsMjI4LjEsMzUwLjQsMjI4LjgsMzUxLjVMMjI4LjgsMzUxLjV6IE0yMzQuNiwzNDAuOWgwLjJjMS43LDAsMy4yLDAuNiw0LjQsMS45czEuOSwyLjgsMS45LDQuNQ0KCQkJYzAsMS4zLTAuMywyLjQtMC45LDMuNWwwLjMsMC4yYy0wLjYsMS0xLjQsMS45LTIuNCwyLjVzLTIuMSwwLjktMy4zLDAuOXMtMi4zLTAuMy0zLjQtMC45Yy0xLjEtMC42LTEuOS0xLjQtMi41LTIuNQ0KCQkJYy0wLjctMS4xLTEtMi4yLTEtMy41YzAtMS45LDAuNi0zLjYsMS45LTQuOWMxLjMtMS40LDIuOS0yLjEsNC43LTIuMnYwLjVIMjM0LjZ6IE0yMzAuNCwzNTUuOGMtMS40LTAuOC0yLjYtMS45LTMuNS0zLjRsLTAuMywwLjINCgkJCWMtMC45LTEuNS0xLjQtMy4yLTEuNC00LjljLTAuMS0yLjcsMC44LTUuMSwyLjctNy4xYzEuOC0yLDQuMS0zLDYuNy0zYzEuMywwLDIuNSwwLjIsMy43LDAuN3MyLjIsMS4yLDMuMiwyLjENCgkJCWMwLjksMC45LDEuNywxLjksMi4yLDMuMXMwLjgsMi40LDAuOCwzLjhjMCwxLjktMC40LDMuNy0xLjMsNS4zbDAuMywwLjJjMS0xLjcsMS40LTMuNSwxLjQtNS41Yy0wLjEtMi44LTEuMS01LjItMy4xLTcuMg0KCQkJYy0xLTEtMi4xLTEuNy0zLjMtMi4ycy0yLjUtMC43LTMuOS0wLjdjLTEuMywwLTIuNiwwLjMtMy44LDAuOWMtMS4yLDAuNS0yLjMsMS4zLTMuMiwyLjNjLTEuOSwyLTIuOCw0LjUtMi44LDcuMw0KCQkJYzAsMS44LDAuNSwzLjUsMS41LDUuMWwtMC40LDAuMmMxLDEuNiwyLjIsMi44LDMuOCwzLjdjMS42LDAuOSwzLjMsMS40LDUuMSwxLjRoMC4yYzEuOCwwLDMuNS0wLjUsNS0xLjVzMi44LTIuMiwzLjctMy44bC0xLTAuNg0KCQkJYy0wLjgsMS40LTEuOSwyLjUtMy4zLDMuM2MtMS40LDAuOC0yLjksMS4yLTQuNCwxLjNDMjMzLjQsMzU3LDIzMS44LDM1Ni42LDIzMC40LDM1NS44eiBNMjMyLjksMzUxLjFjMC42LDAuMywxLjIsMC41LDEuOSwwLjUNCgkJCWgwLjFjMC43LDAsMS4zLTAuMiwxLjktMC42YzAuNi0wLjQsMS4xLTAuOCwxLjQtMS41YzAuNC0wLjcsMC42LTEuNCwwLjYtMi4yYzAtMS4xLTAuNS0yLjEtMS4yLTIuOWMtMC44LTAuOC0xLjctMS4yLTIuOC0xLjENCgkJCXYtMC40Yy0wLjksMC0xLjYsMC4zLTIuMywwLjdjLTEsMC43LTEuNywxLjYtMS45LDIuOGMtMC4zLDEuMiwwLDIuMywwLjYsMy40bDAuMy0wLjJDMjMxLjksMzUwLjMsMjMyLjMsMzUwLjcsMjMyLjksMzUxLjF6DQoJCQkgTTIzMy4xLDM0NC43YzAuNS0wLjMsMS4xLTAuNSwxLjctMC41di0wLjRjMSwwLDEuOCwwLjMsMi42LDFjMC43LDAuNywxLjEsMS42LDEuMSwyLjZjMCwwLjctMC4yLDEuNC0wLjUsMg0KCQkJYy0wLjMsMC41LTAuNywxLTEuMiwxLjNzLTEuMSwwLjUtMS43LDAuNUgyMzVjLTAuNiwwLTEuMi0wLjEtMS43LTAuNHMtMS0wLjctMS4zLTEuMmwwLjMtMC4yYy0wLjUtMC43LTAuNy0xLjYtMC41LTIuNQ0KCQkJQzIzMS45LDM0NS45LDIzMi4zLDM0NS4yLDIzMy4xLDM0NC43TDIzMy4xLDM0NC43eiIvPg0KCTwvZz4NCgk8cGF0aCBpZD0iY2Fwc2xvayIgZmlsbD0iIzRFNEU0RSIgZD0iTTEwLjgsMjYwLjlIMi45Yy0xLjYsMC0yLjktMS4zLTIuOS0yLjl2LTcuOGMwLTEuNiwxLjMtMi45LDIuOS0yLjloNy44DQoJCWMxLjYsMCwyLjksMS4zLDIuOSwyLjl2Ny44QzEzLjcsMjU5LjYsMTIuNCwyNjAuOSwxMC44LDI2MC45eiBNNS45LDI1OC45aDJ2LTJoLTJWMjU4Ljl6IE02LjksMjQ5LjFsLTMsMy45aDJ2Mi45aDJWMjUzaDINCgkJTDYuOSwyNDkuMXoiLz4NCgk8cGF0aCBpZD0iZXllX2Nsb3NlIiBmaWxsPSIjNEU0RTRFIiBkPSJNMC43LDMyMC4yTDE1LDMwNS45bDEuNiwxLjZMMi4zLDMyMS44TDAuNywzMjAuMnogTTkuMSwzMDkuNmMtMi41LDAtNC41LDEuOS00LjUsNC4zDQoJCWMwLDAuMiwwLDAuMywwLDAuNGwtMi41LDIuNWMtMS41LTEuNC0yLjEtMi45LTIuMS0yLjlzMi4zLTUuNyw5LjEtNS43YzAuNiwwLDEuMSwwLjEsMS42LDAuMWwtMS4zLDEuMw0KCQlDOS4yLDMwOS42LDkuMiwzMDkuNiw5LjEsMzA5LjZ6IE05LjEsMzE4LjFjMi41LDAsNC41LTEuOSw0LjUtNC4zYzAtMC4yLDAtMC4zLDAtMC41bDIuNS0yLjVjMS41LDEuNCwyLjEsMi45LDIuMSwyLjkNCgkJcy0yLjMsNS43LTkuMSw1LjdjLTAuNiwwLTEuMS0wLjEtMS42LTAuMWwxLjMtMS4zQzguOSwzMTguMSw5LDMxOC4xLDkuMSwzMTguMXoiLz4NCgk8cGF0aCBpZD0iZXllX29wZW4iIGZpbGw9IiM0RTRFNEUiIGQ9Ik05LjEsMjg5LjRjLTYuOCwwLTkuMS01LjctOS4xLTUuN3MyLjMtNS43LDkuMS01LjdzOS4xLDUuNyw5LjEsNS43UzE1LjksMjg5LjQsOS4xLDI4OS40eg0KCQkgTTkuMSwyNzkuNWMtMi41LDAtNC42LDEuOS00LjYsNC4zczIsNC4zLDQuNiw0LjNjMi41LDAsNC42LTEuOSw0LjYtNC4zQzEzLjcsMjgxLjQsMTEuNiwyNzkuNSw5LjEsMjc5LjV6IE05LjEsMjg1LjkNCgkJYy0xLjMsMC0yLjMtMS0yLjMtMi4xczEtMi4xLDIuMy0yLjFzMi4zLDEsMi4zLDIuMVMxMC40LDI4NS45LDkuMSwyODUuOXoiLz4NCgk8cGF0aCBpZD0iaW5mb19zaWduIiBmaWxsPSIjNjY2NjY2IiBkPSJNNy40LDY5LjljLTQuMSwwLTcuNC0zLjMtNy40LTcuNHMzLjMtNy40LDcuNC03LjRzNy40LDMuMyw3LjQsNy40UzExLjQsNjkuOSw3LjQsNjkuOXoNCgkJIE03LjQsNTYuMUMzLjgsNTYuMSwxLDU5LDEsNjIuNXMyLjksNi40LDYuNCw2LjRzNi40LTIuOSw2LjQtNi40UzEwLjksNTYuMSw3LjQsNTYuMXogTTYuOSw2MWgxdjVoLTFWNjF6IE02LjksNTkuMWgxdjFoLTFWNTkuMXoiDQoJCS8+DQoJPGc+DQoJCTxwYXRoIGZpbGw9IiM1NzU4NTgiIGQ9Ik0yNzAuNCwzNTQuN2MtMC42LDAuNi0wLjksMS4yLTEuMiwxLjdzLTAuMiwwLjgsMCwwLjlsLTAuNS0wLjNjLTAuMS0wLjEtMC4xLTAuNCwwLTAuOA0KCQkJYzAuMi0wLjQsMC41LTAuOSwxLjEtMS41czEuNC0xLjIsMi40LTEuN2wwLDBDMjcxLjYsMzUzLjUsMjcxLDM1NC4xLDI3MC40LDM1NC43eiBNMjg4LjIsMzUwLjFjLTAuOS0wLjUtMi43LTAuNi01LjItMC4zDQoJCQljLTMuMywwLjQtNi4zLDEuMi05LjEsMi41YzEuNy0wLjcsMy43LTEuMiw2LjEtMS42czQuNC0wLjYsNi4xLTAuNXMyLjYsMC40LDIuNSwxbDAsMEMyODguOCwzNTAuOCwyODguNywzNTAuNCwyODguMiwzNTAuMQ0KCQkJTDI4OC4yLDM1MC4xeiBNMjc4LjMsMzM4LjFjMC0wLjEsMC0wLjMsMC0wLjNjMC0wLjEsMC0wLjItMC4xLTAuMmMtMC4xLTAuMS0wLjEtMC4xLTAuMS0wLjFzLTAuMSwwLTAuMi0wLjFzLTAuMSwwLTAuMSwwDQoJCQlzMCwwLTAuMSwwaC0wLjRjLTAuMiwwLTAuNCwwLjItMC41LDAuNWMtMC4xLDAuNS0wLjIsMS4xLTAuMiwxLjhzMC4xLDEuNSwwLjMsMi4zYzAuMiwwLjksMC40LDEuNywwLjcsMi42DQoJCQljMC4zLDAuOCwwLjcsMS42LDEuMiwyLjRzMS4xLDEuNSwxLjcsMnMxLjIsMC45LDEuOSwxLjNjMC43LDAuNCwxLjQsMC43LDIuMSwwLjljMC43LDAuMiwxLjMsMC40LDEuOSwwLjVzMS4xLDAuMSwxLjUsMC4xDQoJCQljMC40LTAuMSwwLjYtMC4yLDAuNi0wLjRjLTAuNiwwLjMtMS42LDAuMS0zLjItMC41cy0zLTEuNC00LjMtMi40Yy0xLjQtMS4yLTIuNS0zLTMuMi01LjRzLTAuOS00LjItMC41LTUuMw0KCQkJYzAuMS0wLjMsMC4yLTAuNCwwLjMtMC41YzAuNCwwLjIsMC42LDAuNiwwLjcsMS4ybDAsMEMyNzguMywzMzguNCwyNzguMywzMzguMiwyNzguMywzMzguMXogTTI3OCwzNDAuM2MtMC4xLDAuOC0wLjMsMS42LTAuNCwyLjINCgkJCXMtMC40LDEuNi0wLjksMi44Yy0wLjQsMS4yLTEsMi41LTEuNiwzLjdjLTEuNSwyLjktMi43LDUuMS0zLjgsNi40cy0xLjksMS44LTIuNiwxLjZsMC41LDAuM2MwLjQsMC4yLDAuOCwwLjEsMS40LTAuMw0KCQkJczEuMy0xLjIsMi4xLTIuNWMwLjktMS4yLDEuOC0yLjksMi45LTVjMC4yLTAuNSwwLjUtMSwwLjctMS40YzAuMi0wLjUsMC40LTAuOSwwLjYtMS4zczAuMy0wLjgsMC40LTEuMmMwLjEtMC40LDAuMi0wLjgsMC4zLTEuMQ0KCQkJYzAuMS0wLjMsMC4yLTAuNiwwLjItMS4xYzAuMS0wLjQsMC4xLTAuNywwLjEtMC45YzAtMC4yLDAuMS0wLjUsMC4xLTFzMC0wLjgsMC0wLjlzMC0wLjQsMC0wLjlzMC0wLjgsMC0wLjlsMCwwDQoJCQlDMjc4LjIsMzM5LDI3OC4xLDMzOS41LDI3OCwzNDAuM3oiLz4NCgk8L2c+DQoJPHBhdGggZmlsbD0iI0NCQ0JDQSIgZD0iTTIzLjEsMzc5LjJjMCwwLDAsMC4xLDAuMSwwLjFjMCwwLjEsMC4xLDAuMSwwLjEsMC4xbC0wLjItMC42YzAsMCwwLDAuMSwwLjEsMC4xDQoJCUMyMywzNzkuMSwyMywzNzkuMSwyMy4xLDM3OS4yYy0wLjUtMS4xLTEuMS0yLjEtMi0yLjlzLTEuOS0xLjQtMy0xLjhjLTEuMi0wLjQtMi40LTAuNS0zLjYtMC4zcy0yLjQsMC42LTMuNCwxLjINCgkJYy0wLjgsMC41LTEuNSwxLjItMi4xLDEuOWMtMS4xLTAuMi0yLjItMC4xLTMuMiwwLjJjLTEuMSwwLjQtMiwwLjktMi44LDEuOGMtMC44LDAuOC0xLjMsMS43LTEuNiwyLjhjLTAuMywxLjEtMC40LDIuMS0wLjIsMy4yDQoJCWMwLjMsMS42LDEuMSwzLDIuMyw0LjFjMS4zLDEuMSwyLjcsMS42LDQuMywxLjZoNy42YzEuMiwwLDIuMy0wLjMsMy40LTAuOHMyLTEuMiwyLjgtMi4xYzAuOC0xLDEuNC0yLDEuNy0zLjNzMC40LTIuNSwwLjItMy43DQoJCWMtMC4xLTAuNC0wLjEtMC43LTAuMi0wLjlsMCwwQzIzLjMsMzc5LjgsMjMuMiwzNzkuNSwyMy4xLDM3OS4yTDIzLjEsMzc5LjJ6IE0xNC40LDM4My4xYzAuMSwwLjIsMC4yLDAuNCwwLjEsMC42DQoJCXMtMC4yLDAuMy0wLjQsMC40cy0wLjQsMC0wLjYtMC4ybC0yLjQtMi44Yy0wLjgtMC45LTEuNy0xLjQtMi44LTEuNXMtMi4yLDAuMi0zLDFjLTAuOSwwLjctMS40LDEuNy0xLjUsMi45DQoJCWMtMC4xLDEuMiwwLjEsMi4yLDAuOCwzLjJjMC40LDAuNiwwLjksMSwxLjUsMS4zczEuMiwwLjUsMS45LDAuNWgxLjhjMC41LDAuNSwxLDAuOSwxLjUsMS4zSDcuOGMtMS4xLDAtMi4yLTAuMy0zLjEtMQ0KCQlzLTEuNi0xLjYtMi0yLjdzLTAuNC0yLjItMC4yLTMuM2MwLjMtMS4xLDAuOC0yLjEsMS42LTIuOWMxLjEtMSwyLjQtMS41LDQtMS41czIuOCwwLjcsMy44LDEuOUwxNC40LDM4My4xeiBNMTAuNCwzODcuNWwtMi45LTMuMQ0KCQljLTAuMi0wLjItMC4yLTAuNC0wLjEtMC42czAuMi0wLjQsMC40LTAuNHMwLjQsMCwwLjYsMC4ybDIuOSwzLjFjMC44LDAuOCwxLjcsMS40LDIuOCwxLjZjMS4xLDAuMywyLjEsMC4yLDMuMi0wLjENCgkJYzEtMC4zLDEuOS0xLDIuNi0xLjlzMS4yLTEuOSwxLjMtM2MwLjItMS4xLDAtMi4yLTAuNS0zLjNjLTAuNS0xLTEuMi0xLjktMi4xLTIuNWMtMS0wLjctMi0xLTMuMi0xcy0yLjIsMC4zLTMuMiwxDQoJCWMtMC4zLDAuMy0wLjYsMC41LTAuOCwwLjdjLTAuMy0wLjItMC43LTAuNC0xLjEtMC42YzAuOC0wLjksMS44LTEuNiwyLjktMnMyLjMtMC41LDMuNS0wLjNjMS4xLDAuMiwyLjEsMC42LDMsMS4zDQoJCWMwLjksMC43LDEuNiwxLjUsMi4xLDIuNmMwLjUsMSwwLjgsMi4xLDAuOCwzLjNjMCwxLjItMC4zLDIuMi0wLjgsMy4ycy0xLjIsMS45LTIuMSwyLjZzLTEuOSwxLjEtMywxLjNjLTEuNCwwLjItMi43LDAuMS00LTAuNQ0KCQlDMTEuOCwzODguNywxMS4xLDM4OC4yLDEwLjQsMzg3LjVMMTAuNCwzODcuNXoiLz4NCgk8ZyBpZD0iYmVoYW5jZV8xXyI+DQoJCTxwYXRoIGZpbGw9IiNDQkNCQ0EiIGQ9Ik01MC40LDM3NC4zYzAuNywwLjIsMS4zLDAuNCwxLjcsMC43YzAuNSwwLjQsMC45LDAuOCwxLjEsMS4zYzAuMiwwLjUsMC4zLDEuMSwwLjMsMnMtMC4yLDEuNi0wLjYsMi4yDQoJCQljLTAuMywwLjYtMC45LDEtMS43LDEuNGMwLjksMC4yLDEuNywwLjcsMi4zLDEuNmMwLjUsMC44LDAuOCwxLjcsMC44LDIuOGMwLDAuOS0wLjIsMS42LTAuNSwyLjNjLTAuMywwLjYtMC44LDEuMS0xLjQsMS42DQoJCQljLTAuNiwwLjQtMS4yLDAuNy0yLDAuOWMtMC43LDAuMi0xLjQsMC4zLTIuMiwwLjNoLTguMXYtMTdoOC4xQzQ5LDM3NCw0OS43LDM3NC4xLDUwLjQsMzc0LjNMNTAuNCwzNzQuM3ogTTQ5LjMsMzgwLjQNCgkJCWMwLjUtMC40LDAuNy0wLjksMC43LTEuNmMwLTAuMy0wLjEtMC42LTAuMi0xYy0wLjItMC4yLTAuNC0wLjQtMC42LTAuNmMtMC4yLTAuMS0wLjUtMC4zLTAuOC0wLjRoLTAuOUg0NHY0aDMuOA0KCQkJQzQ4LjMsMzgxLDQ4LjgsMzgwLjgsNDkuMywzODAuNEw0OS4zLDM4MC40eiBNNDguOSwzODguMmMwLjQtMC4xLDAuNy0wLjIsMC45LTAuM2MwLjItMC4xLDAuNC0wLjMsMC42LTAuNw0KCQkJYzAuMi0wLjMsMC4zLTAuNiwwLjMtMS4xYzAtMC45LTAuMy0xLjUtMC44LTEuOWMtMC41LTAuMy0xLjItMC41LTItMC41SDQ0djQuOGgzLjl2LTAuMUM0OC4zLDM4OC4zLDQ4LjYsMzg4LjMsNDguOSwzODguMg0KCQkJTDQ4LjksMzg4LjJ6IE02MS43LDM4OWMwLjcsMCwxLjMtMC4yLDEuOC0wLjVzMC44LTAuNywwLjktMS4xaDNjLTAuNiwxLjYtMS4zLDIuNi0yLjIsMy4yYy0xLjEsMC42LTIuMywxLTMuNiwxDQoJCQljLTAuOCwwLTEuNy0wLjEtMi43LTAuNGMtMC44LTAuNC0xLjUtMC44LTItMS4zYy0wLjUtMC42LTAuOS0xLjMtMS4zLTIuMWMtMC4zLTAuOS0wLjQtMS43LTAuNC0yLjdjMC0wLjksMC4xLTEuOCwwLjQtMi42DQoJCQljMC4zLTAuOCwwLjgtMS41LDEuMy0yLjFjMC42LTAuNiwxLjMtMS4xLDItMS40YzAuOC0wLjMsMS42LTAuNSwyLjYtMC41YzEuMSwwLDIsMC4yLDIuOCwwLjZjMC45LDAuNSwxLjUsMSwxLjksMS42DQoJCQljMC41LDAuNywwLjgsMS40LDEuMSwyLjNjMC4zLDAuOSwwLjMsMS44LDAuMywyLjhoLTguOWMwLDAuNSwwLjEsMC45LDAuMiwxLjRjMC4yLDAuNCwwLjQsMC44LDAuNiwxQzYwLDM4OC43LDYwLjcsMzg5LDYxLjcsMzg5DQoJCQlMNjEuNywzODl6IE02MS40LDM4MWMtMC41LDAtMSwwLjEtMS40LDAuM2MtMC4yLDAuMS0wLjUsMC4zLTAuOSwwLjdjLTAuMSwwLjEtMC4zLDAuNC0wLjQsMC45Yy0wLjEsMC41LTAuMiwwLjctMC4yLDAuOEg2NA0KCQkJYy0wLjEtMC43LTAuMy0xLjQtMC44LTEuOUM2Mi45LDM4MS4yLDYyLjIsMzgxLDYxLjQsMzgxTDYxLjQsMzgxeiBNNjQuOCwzNzUuMnYxLjdoLTYuOXYtMS43SDY0Ljh6Ii8+DQoJPC9nPg0KCTxnIGlkPSJta3RfY2xvdWRfMV8iPg0KCQk8cGF0aCBmaWxsPSIjOTY5NTk1IiBkPSJNMTk5LjcsMzg1LjZjMC41LDAuOCwxLjIsMS41LDIuMSwyYzAuOSwwLjUsMS44LDAuNywyLjgsMC43YzAsMCwwLDAsMC4xLDBoMC4xYzEsMCwxLjktMC4zLDIuOC0wLjgNCgkJCWMwLjktMC41LDEuNS0xLjIsMi0yLjFsMC4zLDAuMmMwLjYtMSwwLjktMi4yLDAuOS0zLjRjMC0xLjctMC43LTMuMi0xLjktNC40Yy0xLjItMS4yLTIuNy0xLjgtNC40LTEuN3YwLjNjLTEuNiwwLTMsMC43LTQuMSwxLjgNCgkJCWMtMS4xLDEuMi0xLjYsMi42LTEuNiw0LjJDMTk4LjgsMzgzLjYsMTk5LjEsMzg0LjcsMTk5LjcsMzg1LjZMMTk5LjcsMzg1LjZ6IE0yMDQuNCwzNzdoMC4xYzEuNCwwLDIuNiwwLjUsMy42LDEuNQ0KCQkJczEuNSwyLjIsMS41LDMuN2MwLDEtMC4yLDItMC43LDIuOGwwLjMsMC4yYy0wLjUsMC44LTEuMSwxLjUtMS45LDJjLTAuOCwwLjUtMS43LDAuNy0yLjYsMC44Yy0xLDAtMS45LTAuMi0yLjgtMC43DQoJCQljLTAuOS0wLjUtMS41LTEuMi0yLTJjLTAuNS0wLjktMC44LTEuOC0wLjgtMi44YzAtMS41LDAuNS0yLjksMS41LTRzMi4zLTEuNywzLjgtMS43TDIwNC40LDM3N0wyMDQuNCwzNzd6IE0yMDAuOSwzODkuMQ0KCQkJYy0xLjItMC43LTIuMS0xLjYtMi44LTIuN2wtMC4zLDAuMmMtMC43LTEuMi0xLjEtMi42LTEuMS00Yy0wLjEtMi4yLDAuNy00LjEsMi4xLTUuN2MxLjUtMS42LDMuMy0yLjQsNS41LTIuNWMxLDAsMiwwLjIsMywwLjUNCgkJCWMxLDAuNCwxLjgsMC45LDIuNiwxLjdjMC44LDAuNywxLjMsMS42LDEuOCwyLjVjMC40LDEsMC42LDIsMC42LDNjMCwxLjUtMC4zLDMtMS4xLDQuM2wwLjMsMC4yYzAuOC0xLjQsMS4yLTIuOCwxLjEtNC40DQoJCQljLTAuMS0yLjMtMC45LTQuMi0yLjUtNS44Yy0wLjgtMC44LTEuNy0xLjQtMi43LTEuN2MtMS0wLjQtMi0wLjYtMy4xLTAuNnMtMi4xLDAuMy0zLjEsMC43Yy0xLDAuNC0xLjgsMS4xLTIuNiwxLjkNCgkJCWMtMS41LDEuNy0yLjMsMy42LTIuMiw1LjljMCwxLjUsMC40LDIuOCwxLjIsNC4xbC0wLjMsMC4yYzAuOCwxLjMsMS44LDIuMywzLjEsM3MyLjcsMS4xLDQuMSwxLjFoMC4yYzEuNSwwLDIuOC0wLjQsNC0xLjINCgkJCWMxLjItMC43LDIuMi0xLjgsMy0zbC0wLjgtMC41Yy0wLjcsMS4xLTEuNSwyLTIuNiwyLjdzLTIuMywxLTMuNiwxQzIwMy40LDM5MCwyMDIuMSwzODkuNywyMDAuOSwzODkuMXogTTIwMywzODUuMg0KCQkJYzAuNSwwLjMsMSwwLjQsMS41LDAuNGgwLjFjMC42LDAsMS4xLTAuMiwxLjUtMC40YzAuNS0wLjMsMC45LTAuNywxLjEtMS4yYzAuMy0wLjYsMC41LTEuMSwwLjUtMS44YzAtMC45LTAuNC0xLjctMS0yLjMNCgkJCWMtMC42LTAuNi0xLjQtMC45LTIuMy0wLjl2LTAuM2MtMC43LDAtMS4zLDAuMi0xLjksMC42Yy0wLjgsMC42LTEuMywxLjMtMS41LDIuM3MwLDEuOSwwLjUsMi43bDAuMy0wLjINCgkJCUMyMDIuMSwzODQuNiwyMDIuNSwzODUsMjAzLDM4NS4yeiBNMjAzLjEsMzgwLjFjMC40LTAuMywwLjktMC40LDEuNC0wLjR2LTAuM2MwLjgsMCwxLjUsMC4zLDIuMSwwLjhjMC42LDAuNiwwLjksMS4zLDAuOSwyLjENCgkJCWMwLDAuNi0wLjEsMS4xLTAuNCwxLjZjLTAuMiwwLjQtMC42LDAuOC0xLDFjLTAuNCwwLjMtMC45LDAuNC0xLjQsMC40aC0wLjFjLTAuNSwwLTAuOS0wLjEtMS40LTAuM2MtMC40LTAuMi0wLjgtMC42LTEuMS0xDQoJCQlsMC4zLTAuMmMtMC40LTAuNi0wLjUtMS4zLTAuNC0yQzIwMi4xLDM4MS4xLDIwMi41LDM4MC41LDIwMy4xLDM4MC4xTDIwMy4xLDM4MC4xeiIvPg0KCTwvZz4NCgk8Zz4NCgkJPHBhdGggZmlsbD0iIzU3NTg1OCIgZD0iTTIzNS4zLDM4OC44Yy0wLjUsMC41LTAuOCwxLTAuOSwxLjRjLTAuMiwwLjQtMC4yLDAuNiwwLDAuN2wtMC40LTAuMmMtMC4xLTAuMS0wLjEtMC4zLDAtMC43DQoJCQlzMC40LTAuNywwLjktMS4yczEuMS0xLDEuOS0xLjRsMCwwQzIzNi4yLDM4Ny44LDIzNS43LDM4OC4zLDIzNS4zLDM4OC44eiBNMjQ5LjcsMzg1LjFjLTAuNy0wLjQtMi4yLTAuNS00LjMtMC4zDQoJCQljLTIuNiwwLjMtNS4xLDEtNy40LDJjMS40LTAuNSwzLTEsNC45LTEuM3MzLjYtMC41LDUtMC40czIuMSwwLjMsMiwwLjhsMCwwQzI1MC4yLDM4NS42LDI1MC4xLDM4NS4zLDI0OS43LDM4NS4xTDI0OS43LDM4NS4xeg0KCQkJIE0yNDEuNywzNzUuM2MwLTAuMSwwLTAuMiwwLTAuM2MwLTAuMSwwLTAuMS0wLjEtMC4ybC0wLjEtMC4xaC0wLjFoLTAuMWMwLDAsMCwwLTAuMSwwaC0wLjNjLTAuMiwwLTAuMywwLjEtMC40LDAuNA0KCQkJYy0wLjEsMC40LTAuMSwwLjktMC4xLDEuNXMwLjEsMS4yLDAuMiwxLjljMC4yLDAuNywwLjQsMS40LDAuNiwyLjFjMC4yLDAuNywwLjYsMS4zLDEsMnMwLjksMS4yLDEuNCwxLjZjMC40LDAuNCwxLDAuNywxLjUsMS4xDQoJCQljMC42LDAuMywxLjEsMC42LDEuNywwLjhjMC42LDAuMiwxLjEsMC4zLDEuNiwwLjRzMC45LDAuMSwxLjIsMC4xczAuNS0wLjIsMC41LTAuNGMtMC40LDAuMi0xLjMsMC4xLTIuNi0wLjRzLTIuNS0xLjEtMy41LTEuOQ0KCQkJYy0xLjEtMS0yLTIuNC0yLjYtNC40cy0wLjctMy40LTAuNC00LjNjMC4xLTAuMiwwLjItMC4zLDAuMy0wLjRjMC4zLDAuMSwwLjUsMC41LDAuNSwxbDAsMEMyNDEuNiwzNzUuNSwyNDEuNywzNzUuNCwyNDEuNywzNzUuM3oNCgkJCSBNMjQxLjQsMzc3LjFjLTAuMSwwLjctMC4yLDEuMy0wLjMsMS44cy0wLjQsMS4zLTAuNywyLjNzLTAuOCwyLTEuMywzYy0xLjIsMi40LTIuMiw0LjEtMy4xLDUuMmMtMC45LDEuMS0xLjYsMS41LTIuMSwxLjMNCgkJCWwwLjQsMC4yYzAuMywwLjIsMC43LDAuMSwxLjEtMC4yYzAuNS0wLjMsMS0xLDEuNy0yczEuNS0yLjQsMi40LTQuMWMwLjItMC40LDAuNC0wLjgsMC42LTEuMmMwLjItMC40LDAuMy0wLjcsMC40LTENCgkJCWMwLjEtMC4zLDAuMi0wLjYsMC4zLTFzMC4yLTAuNywwLjItMC45czAuMS0wLjUsMC4yLTAuOWMwLjEtMC40LDAuMS0wLjYsMC4xLTAuN3MwLTAuNCwwLjEtMC44YzAtMC40LDAtMC42LDAtMC43czAtMC4zLDAtMC43DQoJCQljMC0wLjQsMC0wLjYsMC0wLjdsMCwwQzI0MS42LDM3Ni4xLDI0MS41LDM3Ni40LDI0MS40LDM3Ny4xeiIvPg0KCTwvZz4NCgk8Zz4NCgkJPHJlY3QgeD0iMS4xIiB5PSIxMTEuMSIgZmlsbD0iIzg5ODk4OSIgd2lkdGg9IjI5LjkiIGhlaWdodD0iMjkuOSIvPg0KCQk8cGF0aCBmaWxsPSIjRkZGRkZGIiBzdHJva2U9IiM3QzdDN0MiIHN0cm9rZS13aWR0aD0iMC4yNSIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBkPSJNMTYuOSwxMzcuNGgtNC40VjEyNmgtM3YtMy45aDN2LTIuMw0KCQkJYzAtMy4yLDAuOS01LjEsNC44LTUuMWgzLjN2My45aC0yYy0xLjUsMC0xLjYsMC41LTEuNiwxLjZ2MmgzLjdsLTAuNCwzLjloLTMuMkwxNi45LDEzNy40eiIvPg0KCTwvZz4NCgk8Zz4NCgkJPHJlY3QgeD0iMzciIHk9IjExMSIgZmlsbD0iIzg5ODk4OSIgd2lkdGg9IjI5LjYiIGhlaWdodD0iMzAiLz4NCgkJPHBhdGggZmlsbD0iI0ZGRkZGRiIgc3Ryb2tlPSIjN0M3QzdDIiBzdHJva2Utd2lkdGg9IjAuMjUiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgZD0iTTU3LjMsMTEzLjFjMCwwLTYuMiwwLTguMiwwDQoJCQljLTMuNywwLTcuMSwyLjctNy4xLDUuOWMwLDMuMiwyLjUsNS44LDYuMiw1LjhjMC4zLDAsMC41LDAsMC44LDBjLTAuMiwwLjUtMC40LDEtMC40LDEuNWMwLDAuOSwwLjUsMS42LDEuMSwyLjINCgkJCWMtMC41LDAtMC45LDAtMS40LDBjLTQuNiwwLTguMSwyLjgtOC4xLDUuOGMwLDIuOSwzLjgsNC43LDguNCw0LjdjNS4yLDAsOC4xLTIuOSw4LjEtNS44YzAtMi4zLTAuNy0zLjctMi45LTUuMg0KCQkJYy0wLjctMC41LTIuMi0xLjgtMi4yLTIuNWMwLTAuOSwwLjMtMS4zLDEuNi0yLjNjMS40LTEsMi4zLTIuNSwyLjMtNC4yYzAtMi0wLjktNC0yLjYtNC42aDIuNkw1Ny4zLDExMy4xeiBNNTQuNSwxMzIuNw0KCQkJYzAuMSwwLjMsMC4xLDAuNSwwLjEsMC44YzAsMi4zLTEuNSw0LjItNiw0LjJjLTMuMSwwLTUuNC0xLjktNS40LTQuM2MwLTIuMywyLjgtNC4yLDYtNC4yYzAuNywwLDEuNCwwLjEsMiwwLjMNCgkJCUM1Mi45LDEzMC43LDU0LjEsMTMxLjMsNTQuNSwxMzIuN3ogTTQ5LjQsMTI0Yy0yLjEtMC4xLTQuMS0yLjMtNC41LTVzMS4xLTQuOCwzLjItNC43YzIuMSwwLjEsNC4xLDIuMiw0LjUsNC45DQoJCQlDNTMsMTIxLjksNTEuNSwxMjQsNDkuNCwxMjR6Ii8+DQoJCTxnIGVuYWJsZS1iYWNrZ3JvdW5kPSJuZXcgICAgIj4NCgkJCTxwYXRoIGZpbGw9IiNGRkZGRkYiIGQ9Ik02MS42LDEyOC41aC0xLjdWMTI2aC0yLjZ2LTEuN2gyLjZ2LTIuNWgxLjd2Mi41aDIuNnYxLjdoLTIuNlYxMjguNXoiLz4NCgkJPC9nPg0KCTwvZz4NCgk8cmVjdCBpZD0iZWhscGVyIiB5PSIwIiBmaWxsPSJub25lIiB3aWR0aD0iMzAwIiBoZWlnaHQ9IjQwMCIvPg0KCTxnPg0KCQk8cGF0aCBmaWxsPSIjOUE5QTlBIiBkPSJNMTguMywyMDhjMC41LDAsMC45LDAuMSwxLjIsMC4yYzAuNCwwLjIsMC43LDAuNCwxLDAuNmMwLjMsMC4zLDAuNSwwLjYsMC42LDFzMC4yLDAuOCwwLjIsMS4ybC0xLjEsMTEuOA0KCQkJYzAsMC40LTAuMSwwLjgtMC4yLDEuMWMtMC4yLDAuNC0wLjQsMC43LTAuNiwxYy0wLjMsMC4zLTAuNiwwLjUtMSwwLjdzLTAuOCwwLjItMS4yLDAuMmgtMTNjLTAuNCwwLTAuOC0wLjEtMS4yLTAuMg0KCQkJYy0wLjQtMC4yLTAuNy0wLjQtMS0wLjdzLTAuNS0wLjYtMC43LTFzLTAuMi0wLjgtMC4yLTEuMmwtMS0xMS41YzAtMC41LDAuMS0wLjksMC4yLTEuMmMwLjEtMC40LDAuNC0wLjcsMC42LTENCgkJCWMwLjMtMC4zLDAuNi0wLjUsMS0wLjdzMC44LTAuMiwxLjItMC4ySDV2LTQuOGMwLTAuOCwwLjItMS41LDAuNS0yLjJzMC43LTEuMywxLjItMS44czEuMS0wLjksMS44LTEuMnMxLjQtMC40LDIuMi0wLjQNCgkJCXMxLjUsMC4xLDIuMiwwLjRjMC43LDAuMywxLjMsMC43LDEuOCwxLjJzMC45LDEuMSwxLjIsMS44YzAuMywwLjcsMC40LDEuNCwwLjQsMi4ydjQuOGgyVjIwOHogTTE5LjIsMjIyLjdsMS4yLTExLjgNCgkJCWMwLTAuMi0wLjEtMC41LTAuMi0wLjdzLTAuMi0wLjQtMC40LTAuNmMtMC4yLTAuMi0wLjQtMC4zLTAuNi0wLjRjLTAuMi0wLjEtMC41LTAuMi0wLjgtMC4ySDMuMmMtMC4zLDAtMC42LDAuMS0wLjgsMC4yDQoJCQljLTAuMiwwLjEtMC41LDAuMi0wLjYsMC40Yy0wLjIsMC4yLTAuMywwLjQtMC40LDAuN2MtMC4xLDAuMi0wLjIsMC41LTAuMiwwLjdsMS4xLDExLjdjMCwwLjIsMC4xLDAuNSwwLjIsMC43DQoJCQljMC4xLDAuMiwwLjIsMC41LDAuNCwwLjZjMC4yLDAuMiwwLjQsMC4zLDAuNiwwLjRjMC4yLDAuMSwwLjUsMC4yLDAuOCwwLjJoMTIuOWMwLjMsMCwwLjYtMC4xLDAuOC0wLjJjMC4yLTAuMSwwLjUtMC4yLDAuNi0wLjQNCgkJCWMwLjItMC4yLDAuMy0wLjQsMC40LTAuNkMxOS4xLDIyMy4yLDE5LjIsMjIzLDE5LjIsMjIyLjd6IE02LjIsMjAzLjJ2NC44aDl2LTQuOGMwLTAuNi0wLjEtMS4yLTAuMy0xLjhzLTAuNS0xLTEtMS41DQoJCQljLTAuNC0wLjQtMC45LTAuNy0xLjUtMWMtMC42LTAuMi0xLjEtMC4zLTEuOC0wLjNzLTEuMiwwLjEtMS43LDAuM3MtMSwwLjUtMS40LDFjLTAuNCwwLjQtMC43LDAuOS0xLDEuNVM2LjIsMjAyLjYsNi4yLDIwMy4yeg0KCQkJIE0xMC43LDIxNC42YzAuMywwLDAuNiwwLjEsMC45LDAuMmMwLjMsMC4xLDAuNSwwLjMsMC44LDAuNWMwLjIsMC4yLDAuNCwwLjUsMC41LDAuOHMwLjEsMC42LDAuMSwwLjl2MC4xbC0wLjQsNC4yDQoJCQljMCwwLjEsMCwwLjItMC4xLDAuMmMwLDAuMS0wLjEsMC4xLTAuMSwwLjJjMCwwLTAuMSwwLjEtMC4yLDAuMWMtMC4xLDAtMC4xLDAtMC4yLDBIOS40Yy0wLjEsMC0wLjIsMC0wLjIsMA0KCQkJYy0wLjEsMC0wLjEtMC4xLTAuMi0wLjFjLTAuMSwwLTAuMS0wLjEtMC4xLTAuMmMwLTAuMSwwLTAuMSwwLTAuMkw4LjQsMjE3di0wLjFjMC0wLjMsMC4xLTAuNiwwLjItMC45YzAuMS0wLjMsMC4zLTAuNSwwLjUtMC44DQoJCQljMC4yLTAuMiwwLjUtMC40LDAuNy0wLjVDMTAuMSwyMTQuNiwxMC40LDIxNC42LDEwLjcsMjE0LjZ6IE0xMS41LDIyMC42bDAuNi0zLjdjMC0wLjIsMC0wLjMtMC4xLTAuNWMtMC4xLTAuMS0wLjItMC4zLTAuMy0wLjQNCgkJCWMtMC4xLTAuMS0wLjItMC4yLTAuNC0wLjJjLTAuMS0wLjEtMC4zLTAuMS0wLjUtMC4xcy0wLjQsMC0wLjUsMC4xcy0wLjMsMC4xLTAuNCwwLjJjLTAuMSwwLjEtMC4yLDAuMi0wLjMsMC40DQoJCQljLTAuMSwwLjEtMC4xLDAuMy0wLjEsMC41bDAuNCwzLjdIMTEuNXoiLz4NCgk8L2c+DQoJPHBhdGggaWQ9ImxvZ29fMV8iIGZpbGw9IiMzMzMzMzMiIGQ9Ik0xNDAuNyw3MC41Yy0xLjYsMC0yLjktMC4xLTMuNC0wLjFjLTAuMSwwLTAuMS0wLjEtMC4xLTAuMVY1NC45YzAtMC4xLDAtMC4xLDAuMS0wLjENCgkJYzAuNywwLDIuMi0wLjEsNC0wLjFjNS4zLDAsNy43LDMuMyw3LjcsNy43QzE0OC45LDY4LjgsMTQ0LjMsNzAuNSwxNDAuNyw3MC41eiBNMTQxLjEsNTUuNmMtMS41LDAtMi43LDAtMi45LDAuMXYxMy44DQoJCWMwLjMsMCwxLjQsMC4xLDIuNSwwLjFjNC40LDAsNy4yLTIuMyw3LjItNy4yQzE0Ny44LDU3LjksMTQ1LjEsNTUuNiwxNDEuMSw1NS42eiBNMTMyLjIsNzAuNGgtMC44Yy0wLjEsMC0wLjEsMC0wLjEtMC4xVjU0LjkNCgkJYzAtMC4xLDAuMS0wLjEsMC4xLTAuMWgwLjhjMC4xLDAsMC4xLDAuMSwwLjEsMC4xdjE1LjRDMTMyLjMsNzAuNCwxMzIuMyw3MC40LDEzMi4yLDcwLjR6IE0xMjEuMyw2NC43Yy0wLjMsMC4xLTEuNSwwLjEtMi40LDAuMQ0KCQloLTUuM2MtMC4xLDIuOCwxLjMsNC45LDQuMiw0LjljMSwwLDItMC4xLDIuOS0wLjdjMC4xLDAsMC4xLDAsMC4xLDAuMXYwLjdjMCwwLjEsMCwwLjEtMC4xLDAuMWMtMC43LDAuNC0xLjcsMC43LTMuMSwwLjcNCgkJYy0zLjgsMC01LjEtMi45LTUuMS01LjdjMC0zLjMsMS44LTUuOCw0LjgtNS44YzMuMiwwLDQuMiwyLjUsNC4yLDQuM2MwLDAuNSwwLDAuOC0wLjEsMUMxMjEuNCw2NC42LDEyMS4zLDY0LjcsMTIxLjMsNjQuN3oNCgkJIE0xMTcuMiw2MC4yYy0yLjIsMC0zLjMsMS44LTMuNiwzLjdoNS4xYzEuNCwwLDEuNiwwLDEuNy0wLjFjMC0wLjEsMC0wLjMsMC0wLjRDMTIwLjQsNjIuMiwxMTkuOCw2MC4yLDExNy4yLDYwLjJ6IE0xMDQuMyw3MC42DQoJCWMtMS4zLDAtMi40LTAuMS0zLjYtMC44Yy0wLjEtMC4xLTAuMS0wLjEtMC4xLTAuMlY1My41YzAtMC4xLDAtMC4xLDAuMS0wLjFoMC44YzAuMSwwLDAuMSwwLDAuMSwwLjFWNjBjMC44LTAuNSwyLTAuOCwzLjEtMC44DQoJCWMzLjEsMCw1LjEsMi4yLDUuMSw1LjVDMTA5LjgsNjguNSwxMDcuMiw3MC42LDEwNC4zLDcwLjZ6IE0xMDQuNyw2MC4yYy0xLjEsMC0yLjEsMC4zLTMsMC43djguM2MwLjgsMC41LDEuOCwwLjYsMi43LDAuNg0KCQljMi40LDAsNC40LTEuOSw0LjQtNUMxMDguNyw2Mi4xLDEwNy4yLDYwLjIsMTA0LjcsNjAuMnogTTkyLjEsNzAuNmMtMy42LDAtNS4xLTMtNS4xLTUuN2MwLTMuMywyLjEtNS43LDUuMS01LjdzNS4xLDIuMyw1LjEsNS43DQoJCUM5Ny4yLDY4LjQsOTUuMSw3MC42LDkyLjEsNzAuNnogTTkyLDYwLjJjLTIuNCwwLTQsMi00LDQuN2MwLDIuNiwxLjUsNC44LDQuMSw0LjhjMS44LDAsMy45LTEuNCwzLjktNC43DQoJCUM5Niw2Mi42LDk0LjksNjAuMiw5Miw2MC4yeiBNODAuNyw3MC42Yy0zLjEsMC01LjUtMi01LjUtNS43YzAtMy41LDIuNS01LjgsNS45LTUuOGMxLDAsMS43LDAuMSwyLjMsMC4zdi02YzAtMC4xLDAtMC4xLDAuMS0wLjENCgkJaDAuOGMwLjEsMCwwLjEsMC4xLDAuMSwwLjF2MTUuM2MwLDAuMywwLDAuNSwwLjEsMC43YzAsMC4xLDAsMC4xLTAuMSwwLjFDODMuMyw3MC40LDgxLjksNzAuNiw4MC43LDcwLjZ6IE04My40LDYwLjYNCgkJYy0wLjUtMC4zLTEuMy0wLjUtMi4zLTAuNWMtMy4yLDAtNC43LDIuMy00LjcsNC44YzAsMy40LDIuNCw0LjcsNC41LDQuN2MwLjksMCwyLTAuMSwyLjYtMC41TDgzLjQsNjAuNkw4My40LDYwLjZ6IE03My4zLDcwLjRoLTENCgkJYy0wLjEsMC0wLjEsMC0wLjEtMC4xbC0yLjEtNS43aC02LjJsLTIuMSw1LjdjMCwwLjEtMC4xLDAuMS0wLjEsMC4xaC0wLjhjLTAuMSwwLTAuMS0wLjEtMC4xLTAuMWw1LjMtMTQuOA0KCQljMC4xLTAuMSwwLjEtMC4zLDAuMS0wLjdjMC0wLjEsMC4xLTAuMSwwLjEtMC4xaDEuNGMwLjEsMCwwLjEsMCwwLjEsMC4xbDUuNiwxNS41QzczLjQsNzAuNCw3My40LDcwLjQsNzMuMyw3MC40eiBNNjcsNTUuNg0KCQlMNjcsNTUuNmMtMC40LDEuMy0xLjgsNS4xLTIuOSw4LjFoNS43QzY5LjQsNjIuMiw2Ny41LDU3LjEsNjcsNTUuNnogTTUzLjEsNTEuNHYyNGwtMTAuNy0yNEg1My4xeiBNNDAuOCw3NS40bC0yLjEtNC44aC01DQoJCWw0LjctMTAuM2w2LjgsMTUuMUg0MC44eiBNMjMuOSw1MS40aDEwLjlsLTEwLjksMjRWNTEuNHoiLz4NCgk8cGF0aCBpZD0iZW50ZXJwcmlzZV9sb2dvXzFfIiBmaWxsPSIjMzMzMzMzIiBkPSJNNTIuNCw4MXYyMy45TDQxLjcsODFINTIuNHogTTQwLjMsMTA0LjlsLTIuMS00LjhoLTVsNC43LTEwLjJsNi44LDE1SDQwLjN6DQoJCSBNMjMuNCw4MWgxMC44bC0xMC44LDIzLjlDMjMuNCwxMDQuOSwyMy40LDgxLDIzLjQsODF6Ii8+DQoJPGcgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAgICAiPg0KCQk8cGF0aCBmaWxsPSIjMzMzMzMzIiBkPSJNNjkuNSwxMDEuNEM2OS41LDEwMS41LDY5LjQsMTAxLjUsNjkuNSwxMDEuNGwtOC45LDAuMWMtMC4xLDAtMC4yLTAuMS0wLjItMC4yVjg1LjQNCgkJCWMwLTAuMSwwLjEtMC4xLDAuMS0wLjFoOC40YzAuMSwwLDAuMSwwLDAuMSwwLjFsMC4xLDAuN2MwLDAuMSwwLDAuMS0wLjEsMC4xaC03LjZ2Ni41aDYuN2MwLjEsMCwwLjEsMCwwLjEsMC4xdjAuNw0KCQkJYzAsMC4xLTAuMSwwLjEtMC4xLDAuMWgtNi43djYuOWg4LjFjMC4xLDAsMC4xLDAsMC4xLDAuMUw2OS41LDEwMS40eiIvPg0KCQk8cGF0aCBmaWxsPSIjMzMzMzMzIiBkPSJNNzIuNSw5Mi41YzAtMC44LTAuMS0yLjMtMC4xLTIuNmMwLTAuMSwwLTAuMSwwLjEtMC4xaDAuOGMwLjEsMCwwLjEsMCwwLjEsMC4xYzAuMSwwLjIsMC4xLDEsMC4xLDEuNA0KCQkJYzEuMi0xLjIsMi42LTEuOCw0LTEuOHMzLjgsMC43LDMuOCw0LjZ2Ny4yYzAsMC4xLTAuMSwwLjEtMC4xLDAuMWgtMC44Yy0wLjEsMC0wLjEtMC4xLTAuMS0wLjF2LTcuMmMwLTIuMS0wLjktMy42LTMtMy42DQoJCQljLTEuNSwwLTIuOCwwLjgtMy44LDEuOXY4LjljMCwwLjEtMC4xLDAuMS0wLjEsMC4xaC0wLjhjLTAuMSwwLTAuMS0wLjEtMC4xLTAuMVY5Mi41eiIvPg0KCQk8cGF0aCBmaWxsPSIjMzMzMzMzIiBkPSJNODkuOSwxMDEuMmMwLDAuMSwwLDAuMS0wLjEsMC4yYy0wLjUsMC4zLTEuMiwwLjQtMS43LDAuNGMtMS42LDAtMi41LTAuNy0yLjUtM3YtOGgtMS43DQoJCQljLTAuMSwwLTAuMS0wLjEtMC4xLTAuMlY5MGMwLTAuMSwwLTAuMSwwLjEtMC4xaDEuN2MwLTEsMC4xLTIuOSwwLjItMy40YzAtMC4xLDAuMS0wLjEsMC4xLTAuMWwwLjgtMC4yYzAuMSwwLDAuMSwwLDAuMSwwLjENCgkJCWMtMC4xLDAuOS0wLjIsMi41LTAuMiwzLjZoMi44YzAuMSwwLDAuMSwwLjEsMC4xLDAuMXYwLjZjMCwwLjEtMC4xLDAuMS0wLjEsMC4xaC0yLjh2OC4xYzAsMS4yLDAuNSwxLjksMS42LDEuOQ0KCQkJYzAuNSwwLDAuOS0wLjEsMS40LTAuM2MwLjEsMCwwLjEsMCwwLjEsMC4xTDg5LjksMTAxLjJMODkuOSwxMDEuMkw4OS45LDEwMS4yeiIvPg0KCQk8cGF0aCBmaWxsPSIjMzMzMzMzIiBkPSJNOTIuNiw5NS40Yy0wLjEsMywxLjUsNS4zLDQuNSw1LjNjMSwwLDIuMS0wLjEsMy4xLTAuN2MwLjEtMC4xLDAuMSwwLDAuMSwwLjF2MC43YzAsMC4xLDAsMC4xLTAuMSwwLjINCgkJCWMtMC44LDAuNS0xLjcsMC43LTMuMiwwLjdjLTMuOSwwLTUuNC0zLTUuNC02YzAtMy42LDEuOS02LjIsNS4xLTYuMnM0LjUsMi43LDQuNSw0LjVjMCwwLjgtMC4xLDEuMi0wLjEsMS4yDQoJCQljLTAuNSwwLjEtMS41LDAuMS0yLjYsMC4xaC01LjlWOTUuNHogTTk4LjEsOTQuNWMxLjUsMCwxLjcsMCwxLjgtMC4xYzAtMC4xLDAtMC4zLDAtMC41YzAtMS0wLjctMy40LTMuNS0zLjQNCgkJCWMtMi4zLDAtMy42LDEuOS0zLjgsNC4xTDk4LjEsOTQuNUw5OC4xLDk0LjV6Ii8+DQoJCTxwYXRoIGZpbGw9IiMzMzMzMzMiIGQ9Ik0xMDQuOSw4OS44QzEwNSw4OS44LDEwNSw4OS44LDEwNC45LDg5LjhjMC4yLDAuNCwwLjIsMS4xLDAuMywxLjdjMS0xLjMsMi41LTEuOSwzLjctMS45DQoJCQljMC4xLDAsMC4yLDAsMC4zLDBjMC4xLDAsMC4xLDAuMSwwLjEsMC4ydjAuN2MwLDAuMSwwLDAuMS0wLjEsMC4xYy0xLjctMC4xLTMuMiwxLTMuOSwyLjF2OC43YzAsMC4xLDAsMC4xLTAuMSwwLjFoLTAuOA0KCQkJYy0wLjEsMC0wLjEtMC4xLTAuMS0wLjF2LTguNWMwLTEtMC4xLTIuNC0wLjEtM2MwLTAuMSwwLTAuMSwwLjEtMC4xTDEwNC45LDg5LjhMMTA0LjksODkuOHoiLz4NCgkJPHBhdGggZmlsbD0iIzMzMzMzMyIgZD0iTTEyMS4zLDk1LjFjMCw0LjQtMy42LDYuNS02LjYsNi41Yy0wLjgsMC0xLjUtMC4xLTEuOS0wLjJ2NS42YzAsMC4xLTAuMSwwLjEtMC4xLDAuMWwtMC44LDAuMQ0KCQkJYy0wLjEsMC0wLjEsMC0wLjEtMC4xdi0xNmMwLTAuMSwwLTAuNC0wLjEtMC43YzAsMCwwLTAuMSwwLjEtMC4xYzAuNi0wLjIsMi40LTEsNC4zLTFDMTE5LjIsODkuNSwxMjEuMyw5MS43LDEyMS4zLDk1LjF6DQoJCQkgTTExMi44LDkxLjF2OS40YzAuNSwwLjIsMS4xLDAuMywyLDAuM2MzLDAsNS40LTIuMSw1LjQtNS42YzAtMi43LTEuNi00LjctNC40LTQuN0MxMTQuNSw5MC41LDExMy41LDkwLjcsMTEyLjgsOTEuMXoiLz4NCgkJPHBhdGggZmlsbD0iIzMzMzMzMyIgZD0iTTEyNS4zLDg5LjhDMTI1LjQsODkuOCwxMjUuNCw4OS44LDEyNS4zLDg5LjhjMC4yLDAuNCwwLjIsMS4xLDAuMywxLjdjMS0xLjMsMi41LTEuOSwzLjctMS45DQoJCQljMC4xLDAsMC4yLDAsMC4zLDBzMC4xLDAuMSwwLjEsMC4ydjAuN2MwLDAuMSwwLDAuMS0wLjEsMC4xYy0xLjctMC4xLTMuMiwxLTMuOSwyLjF2OC43YzAsMC4xLDAsMC4xLTAuMSwwLjFoLTAuOQ0KCQkJYy0wLjEsMC0wLjEtMC4xLTAuMS0wLjF2LTguNWMwLTEtMC4xLTIuNC0wLjEtM2MwLTAuMSwwLTAuMSwwLjEtMC4xTDEyNS4zLDg5LjhMMTI1LjMsODkuOEwxMjUuMyw4OS44eiIvPg0KCQk8cGF0aCBmaWxsPSIjMzMzMzMzIiBkPSJNMTMxLjcsODYuM2MwLTAuNCwwLjMtMC44LDAuNy0wLjhjMC41LDAsMC43LDAuMywwLjcsMC44YzAsMC40LTAuMywwLjctMC43LDAuN1MxMzEuNyw4Ni43LDEzMS43LDg2LjN6DQoJCQkgTTEzMS45LDg5LjljMC0wLjEsMC0wLjEsMC4xLTAuMWgwLjhjMC4xLDAsMC4xLDAsMC4xLDAuMXYxMS41YzAsMC4xLDAsMC4xLTAuMSwwLjFIMTMyYy0wLjEsMC0wLjEsMC0wLjEtMC4xVjg5LjlMMTMxLjksODkuOXoiDQoJCQkvPg0KCQk8cGF0aCBmaWxsPSIjMzMzMzMzIiBkPSJNMTQwLjEsOTAuNWMtMi4xLDAtMi42LDEuMi0yLjYsMmMwLDEuMSwwLjUsMS43LDIuOCwyLjZjMiwwLjgsMy4zLDEuNiwzLjMsMy40YzAsMi4zLTIsMy4yLTMuOCwzLjINCgkJCWMtMS41LDAtMi42LTAuNC0zLjQtMC45Yy0wLjEtMC4xLTAuMS0wLjEtMC4xLTAuMnYtMC45YzAtMC4xLDAuMS0wLjEsMC4xLTAuMWMxLDAuNywyLjIsMS4yLDMuNCwxLjJjMiwwLDIuNy0xLjEsMi43LTIuMQ0KCQkJYzAtMS4yLTAuOC0xLjctMy0yLjdjLTEuOS0wLjgtMy4xLTEuNi0zLjEtMy40czEuNS0zLDMuOC0zYzEuNCwwLDIuMywwLjQsMi44LDAuN2MwLjEsMC4xLDAuMSwwLjEsMC4xLDAuMnYwLjgNCgkJCWMwLDAuMS0wLjEsMC4xLTAuMSwwLjFDMTQyLjIsOTAuOCwxNDEuMyw5MC41LDE0MC4xLDkwLjV6Ii8+DQoJCTxwYXRoIGZpbGw9IiMzMzMzMzMiIGQ9Ik0xNDcuMyw5NS40Yy0wLjEsMywxLjUsNS4zLDQuNSw1LjNjMSwwLDIuMS0wLjEsMy4xLTAuN2MwLjEtMC4xLDAuMSwwLDAuMSwwLjF2MC43YzAsMC4xLDAsMC4xLTAuMSwwLjINCgkJCWMtMC44LDAuNS0xLjcsMC43LTMuMiwwLjdjLTMuOSwwLTUuNC0zLTUuNC02YzAtMy42LDEuOS02LjIsNS4xLTYuMmMzLjIsMCw0LjUsMi43LDQuNSw0LjVjMCwwLjgtMC4xLDEuMi0wLjEsMS4yDQoJCQljLTAuNSwwLjEtMS41LDAuMS0yLjYsMC4xaC01LjlWOTUuNHogTTE1Mi44LDk0LjVjMS41LDAsMS43LDAsMS44LTAuMXMwLTAuMywwLTAuNWMwLTEtMC43LTMuNC0zLjUtMy40Yy0yLjMsMC0zLjYsMS45LTMuOCw0LjENCgkJCUwxNTIuOCw5NC41TDE1Mi44LDk0LjV6Ii8+DQoJCTxwYXRoIGZpbGw9IiMzMzMzMzMiIGQ9Ik0xNjUuNywxMDEuM2MwLDAuMSwwLDAuMS0wLjEsMC4xaC0wLjhjLTAuMSwwLTAuMSwwLTAuMS0wLjFWODUuNGMwLTAuMSwwLTAuMSwwLjEtMC4xaDAuOA0KCQkJYzAuMSwwLDAuMSwwLDAuMSwwLjFWMTAxLjN6Ii8+DQoJCTxwYXRoIGZpbGw9IiMzMzMzMzMiIGQ9Ik0xNzAsODUuNGMwLTAuMSwwLTAuMSwwLjEtMC4yYzAuNywwLDIuMS0wLjEsNC0wLjFjNS42LDAsOC4xLDMuNCw4LjEsOGMwLDcuMy01LjQsOC40LTguNyw4LjQNCgkJCWMtMS43LDAtMi44LTAuMS0zLjQtMC4xYy0wLjEsMC0wLjEtMC4xLTAuMS0wLjJMMTcwLDg1LjRMMTcwLDg1LjR6IE0xNzEuMSwxMDAuNWMwLjMsMCwxLjMsMC4xLDIuNSwwLjFjNC43LDAsNy42LTIuMyw3LjYtNy40DQoJCQljMC00LjctMi43LTcuMS03LjEtNy4xYy0xLjYsMC0yLjcsMC0zLDBWMTAwLjV6Ii8+DQoJPC9nPg0KPC9nPg0KPC9zdmc+DQo=)\\n    }\\n    .label {\\n        padding-top: 9px;\\n        max-width: 75%;\\n        font-family: sans-serif; /* TODO Adobe Clean? */\\n        text-align: center;\\n        text-overflow: ellipsis;\\n    }\\n</style>\\n</head>\\n<body>\\n    <div class="logo"></div>\\n    <div class="label">{{LABEL}}</div>\\n</body>\\n</html>\';});\n\n//# sourceURL=/text!html/ims-loading.html'),
eval('/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4, regexp: true, sub: true, evil: true */\n/*global define, brackets, window, Mustache*/\ndefine(\'adobeid\',[\n    "jquery",\n    "config/environment",\n    "ext/ims/IMSProxy",\n    "ext/models/ExtensionMetadata",\n    "ext/strings",\n    "ext/AdobeIMSStrings",\n    "text!html/ims-loading.html"\n], function ($, environment, IMSProxy, ExtensionMetadata, Strings,\n    AdobeIMSStrings, IMSLoadingHTML) {\n    "use strict";\n    \n    var NativeApp = brackets.getModule("utils/NativeApp");\n\n    var _imsWindow;\n\n    function _installPopupWindowHandlers(w) {\n        var windowHref = w.location.href;\n        windowHref = windowHref.slice(0, windowHref.lastIndexOf("/") + 1);\n        // Change "newwindow" or target=_blank links to open in the OS default browser\n        // Copied from click-prevention handling brackets.js \n        w.document.body.addEventListener("click", function (e) {\n            // Check parents too, in case link has inline formatting tags\n            var node = e.target, url, target, isNewWindow;\n            while (node) {\n                if (node.tagName === "A") {\n                    url = node.getAttribute("href");\n                    target = node.getAttribute("target");\n                    isNewWindow = (url.indexOf("newwindow") === 0) || (target === "_blank");\n                    if (isNewWindow && !url.match(/^#/)) {\n                        NativeApp.openURLInDefaultBrowser(windowHref + url);\n                        e.preventDefault();\n                    }\n                    break;\n                }\n                node = node.parentElement;\n            }\n        }, true);\n    }\n    \n    // Create a module instead of setting a global window.adobeid\n    var adobeid = {},\n        $adobeid = $(adobeid),\n        platform = brackets.platform;\n\n    // Adobe Analytics accepts win, osx and linux names for `pl` property\n    if (platform === "mac") {\n        platform = "osx";\n    }\n    \n    adobeid.client_id = environment.IMS_CLIENT_ID;\n    adobeid.uses_modal_mode = true;\n    adobeid.locale = brackets.getLocale();\n    adobeid.target_env = environment.IMS_TARGET_ENV;\n    adobeid.redirect_uri = "brackets-auth://redirectims.html";\n    adobeid.override_modal_redirect = true;\n    adobeid.scope = "AdobeID,openid,creative_cloud,creative_sdk";\n    adobeid.strings = { user: AdobeIMSStrings };\n\n    adobeid.api_parameters = {\n        authorize: {\n            // SUSI Context https://selfservice.adobelogin.com\n            // ctx_id: "signin",\n            \n            // Adobe Analytics SUSI Integration\n            state: {\n                "ac": "ExtractForBrackets_app",\n                "av": ExtensionMetadata.get("version"),\n                "pl": platform\n            }\n        }\n    };\n\n    adobeid.proxyGet = function (url, fnToCall, type) {\n        // Swap IMS host with proxy host:port\n        var proxyUrlInfo = IMSProxy.proxyUrlInfo(url);\n\n        return $.ajax({\n            url: proxyUrlInfo.url,\n            success: fnToCall,\n            dataType: type,\n            data: {\n                // FIXME Why doesn\'t $.ajax work with header assignment?\n                // Pass target in querystring\n                "e4b-target-domain": proxyUrlInfo.domain\n            }\n        });\n    };\n    adobeid.onReady = function () {\n        $adobeid.triggerHandler("ready");\n    };\n    adobeid.onProfile = function (profile) {\n        $adobeid.triggerHandler("profile", [profile]);\n    };\n    adobeid.onAccessToken = function (token, tokenInfo) {\n        $adobeid.triggerHandler("accessToken", [token, tokenInfo]);\n    };\n    adobeid.onAccessTokenHasExpired = function (token, tokenInfo) {\n        $adobeid.triggerHandler("accessTokenHasExpired", [token, tokenInfo]);\n    };\n    adobeid.onError = function (error) {\n        console.error(error.userMessage || error.message);\n        $adobeid.triggerHandler("error", [error]);\n    };\n    adobeid.getClientWindow = function (url, params, fnOnRedirect) {\n        var deferred = new $.Deferred(),\n            interval,\n            exitOnRedirectInterval,\n            prevURL,\n            curURL,\n            documentElementHTML;\n\n        if (_imsWindow) {\n            _imsWindow.close();\n        }\n\n        try {\n            // Account for brackets-shell versions <= 0.44 that precisely test\n            // for "about:blank". Pass width/height URL params for\n            // brackets-shell to workaround bug\n            // https://github.com/adobe/brackets/issues/8768\n            _imsWindow = window.open("about:blank?width=" + params.width + "&height=" + params.height);\n        } catch (err) {\n            _imsWindow = window.open("about:blank");\n        }\n\n        // Use endpoint to choose label\n        var urlExec = /\\/ims\\/([^\\/]+)(\\/v[0-9]+)?(\\/([^\\/]+))?/i.exec(url),\n            endpoint = urlExec[4] ? urlExec[1] + "_" + urlExec[4] : urlExec[1],\n            labelKey = "SUSI_LOADING_" + endpoint.toUpperCase(),\n            label = Strings[labelKey] || Strings["SUSI_LOADING_BASE"],\n            templateStrings = {};\n\n        templateStrings.LABEL = label;\n        templateStrings.WINDOW_TITLE = Strings["SUSI_LOADING_WINDOW_TITLE"];\n\n        // Render loading screen\n        _imsWindow.document.write(Mustache.render(IMSLoadingHTML, templateStrings));\n\n        // Load IMS endpoint\n        _imsWindow.location.href = url;\n\n        // Use a Promise to allow listeners to respond when the popup window closes\n        $adobeid.triggerHandler("getClientWindow", [deferred.promise()]);\n\n        // Remove interval when window closes\n        deferred.always(function () {\n            window.clearInterval(exitOnRedirectInterval);\n        });\n\n        function _stopPolling(isClosed) {\n            window.clearInterval(interval);\n\n            if (isClosed) {\n                // Resolve getClientWindow promise when we hit the redirect_uri\n                // Clears the exitOnRedirectInterval timer\n                deferred.resolve();\n            }\n        }\n\n        function _exitIfRedirect() {\n            if (_imsWindow) {\n                curURL = _imsWindow.location && _imsWindow.location.href;\n                if (curURL) {\n                    if (curURL.indexOf(adobeid.redirect_uri) === 0) {\n                    // Complete sign-in if we detect the redirect_uri\n                        fnOnRedirect(curURL);\n\n                        // Close pop-up window\n                        _imsWindow.close();\n                        _imsWindow = null;\n\n                        _stopPolling(true);\n\n                        return true;\n                    }\n                }\n            }\n            return false;\n        }\n\n        function _updateCookie() {\n            // Notify listeners of new/updated cookie\n            // Use eval() to suppress SecurityError that CEF reports, even when\n            // brackets-shell explicitly disables web security\n            $adobeid.triggerHandler("cookie", [_imsWindow["eval"]("document.cookie")]);\n        }\n\n        // FIXME Why is curURL "data:text/html,chromewebdata" instead\n        // of the redirect uri "brackets-auth://...", but only when\n        // we eval the "cookie" event at the start of the _onunload handler?\n        // Splitting up the work in _updateCookie fixes the bug somehow.\n        _imsWindow.addEventListener("unload", _updateCookie);\n\n        // FIXME https://git.corp.adobe.com/jhagenst/brackets-parfait-extension/issues/782\n        // Somehow unload/load doesn\'t always catch the redirect URI on signUp only.\n        // Add persistent polling here as a HACK\n        exitOnRedirectInterval = window.setInterval(_exitIfRedirect, 500);\n\n        _imsWindow.addEventListener("unload", function _onunload() {\n            // poll for URL change\n            interval = window.setInterval(function () {\n                if (_imsWindow) {\n                    if (_imsWindow.closed) {\n                        _stopPolling(true);\n                        return;\n                    }\n\n                    // Get HTML content of popup window\n                    if (_imsWindow.document && _imsWindow.document.documentElement) {\n                        documentElementHTML = _imsWindow.document.documentElement.innerHTML;\n                    } else {\n                        documentElementHTML = "";\n                    }\n\n                    if (_exitIfRedirect()) {\n                        return;\n                    } else if (documentElementHTML.indexOf("brackets.app.showDeveloperTools") >= 0) {\n                        // Fire networkError error event back to IMSLibWrapper\n                        $adobeid.triggerHandler("error", [{ name: "networkError" }]);\n\n                        // CEF OnLoadError page\n                        _imsWindow.close();\n\n                        _stopPolling(true);\n                    } else if (prevURL !== curURL) {\n                        _stopPolling(false);\n\n                        // Location changed (likely due to sign-up workflow)\n                        // Reset unload and cookie handling\n                        _imsWindow.addEventListener("unload", _updateCookie);\n                        _imsWindow.addEventListener("unload", _onunload);\n\n                        // Install click handler when page finishes loading\n                        _imsWindow.addEventListener("load", function () {\n                            _installPopupWindowHandlers(_imsWindow);\n                        });\n\n                        prevURL = curURL;\n                    }\n                }\n            }, 1);\n        });\n\n        return _imsWindow;\n    };\n    \n    return adobeid;\n});\n\n//# sourceURL=/ims/adobeid.js'),eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4, bitwise: true */\n/*global define*/\ndefine('ext/ims/IMSLibLoader',['require','exports','module','jquery','adobeid','config/environment','ext/ims/IMSProxy'],function (require, exports, module) {\n    \"use strict\";\n\n    var $ = require(\"jquery\"),\n        adobeid = require(\"adobeid\"),\n        Environment = require(\"config/environment\"),\n        IMSProxy = require(\"ext/ims/IMSProxy\");\n\n    var _imslib,\n        _deferred;\n\n    function requireIMSLib() {\n        // Only one request at a time\n        if (!_deferred) {\n            _deferred = new $.Deferred();\n\n            // Try to fetch IMS lib from server\n            require([Environment.IMSLIB_URL], function (imslib) {\n                _imslib = imslib;\n                _deferred.resolve(imslib);\n                _deferred = null;\n            }, function (err) {\n                console.error(err);\n                _deferred.reject();\n                _deferred = null;\n            });\n        }\n\n        return _deferred.promise();\n    }\n    \n    // Always configure IMS proxy on init\n    IMSProxy.configure().done(requireIMSLib);\n\n    exports.getPromise = function () {\n        if (_imslib) {\n            return new $.Deferred().resolve(_imslib).promise();\n        }\n\n        return IMSProxy.configure().then(requireIMSLib);\n    };\n});\n//# sourceURL=/./ims/IMSLibLoader.js"),eval('/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4, regexp: true */\n/*global define, brackets*/\ndefine(\'ext/command/Commands\',[], function () {\n    "use strict";\n    \n    var CommandManager = brackets.getModule("command/CommandManager");\n    \n    var exports = {\n        TOGGLE_PANEL     : "e4b.TOGGLE_PANEL",\n        SHOW_ASSETS_ROOT : "e4b.SHOW_ASSETS_ROOT",\n        TOGGLE_AUTH      : "e4b.TOGGLE_AUTH",\n        PREF_DIALOG      : "e4b.PREF_DIALOG",\n        RESET_ALL        : "e4b.RESET_ALL",\n        HELP_ONLINE      : "e4b.HELP_ONLINE",\n        HELP_TUTORIAL    : "e4b.HELP_TUTORIAL",\n        GUIDED_TUTORIAL  : "e4b.GUIDED_TUTORIAL",\n        \n        register: function (label, id, handler) {\n            return CommandManager.register(label, id, handler);\n        },\n        \n        get: function (id) {\n            return CommandManager.get(id);\n        },\n        \n        execute: function (id) {\n            return CommandManager.execute(id);\n        }\n    };\n    \n    return exports;\n});\n\n//# sourceURL=/./command/Commands.js'),eval('/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4, bitwise: true */\n/*global define, brackets, graphite, Mustache*/\n\ndefine(\'ext/models/ExtensionMetaData\',[\n    "jquery",\n    "backbone",\n    "ext/models/BracketsPreferencesModel",\n    "ext/strings",\n    "text!ext/package.json",\n    "text!ext/html/eula-dialog.html"\n], function ($, Backbone, BracketsPreferencesModel, Strings, PackageJSON, eulaDialogHTML) {\n    "use strict";\n    \n    var Dialogs = brackets.getModule("widgets/Dialogs");\n    \n    var prefs = BracketsPreferencesModel.get("preferenceSystem"),\n        eulaDialogTemplate = Mustache.render(eulaDialogHTML, Strings);\n\n    var ExtensionMetadata = Backbone.Model.extend({\n\n        initialize: function () {\n            var self = this,\n                id = JSON.parse(PackageJSON).name;\n\n            // Use compile-time metdata to get extension ID\n            this.set("id", id);\n        },\n        \n        getAcceptedEULA: function () {\n            var deferred = new $.Deferred(),\n                eulaAccepted = prefs.get(BracketsPreferencesModel.EULA_ACCEPTED);\n            \n            if (eulaAccepted) {\n                deferred.resolve();\n            } else {\n                var dialogPromise = Dialogs.showModalDialogUsingTemplate(eulaDialogTemplate).getPromise();\n                dialogPromise.done(function (btnId) {\n                    var accepted = btnId === Dialogs.DIALOG_BTN_OK;\n                    prefs.set(BracketsPreferencesModel.EULA_ACCEPTED, accepted);\n                    \n                    if (accepted) {\n                        graphite.events.trigger("eulaAccepted");\n                        deferred.resolve();\n                    } else {\n                        deferred.reject();\n                    }\n                });\n            }\n            \n            return deferred.promise();\n        },\n\n        getBundledBuildVersion: function () {\n            return prefs.get(BracketsPreferencesModel.INSTALL_BUNDLED_BUILD_VERSION);\n        },\n\n        isBundledBuild: function () {\n            return !!this.getBundledBuildVersion();\n        }\n    });\n\n    return new ExtensionMetadata();\n});\n\n//# sourceURL=/./models/ExtensionMetaData.js'),eval('/*\n * Copyright (c) 2015 Adobe Systems Incorporated. All rights reserved.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the "Software"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n *\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4, maxerr: 50 */\n/*global $, define, brackets, Mustache, graphite */\n\ndefine(\'ext/ims/IMSLib\',[\'require\',\'exports\',\'module\',\'ext/command/Commands\',\'ext/strings\',\'controllers/AuthController\',\'ext/models/ExtensionMetaData\',\'ext/models/BracketsPreferencesModel\'],function (require, exports, module) {\n    "use strict";\n\n    var Commands                    = require("ext/command/Commands"),\n        Strings                     = require("ext/strings"),\n        AuthController              = require("controllers/AuthController"),\n        ExtensionMetaData           = require("ext/models/ExtensionMetaData"),\n        BracketsPreferencesModel    = require("ext/models/BracketsPreferencesModel");\n    \n    var AppInit                     = brackets.getModule("utils/AppInit"),\n        StringUtils                 = brackets.getModule("utils/StringUtils"),\n        HealthLogger;\n\n    // cached authorization status from the shell\n    var authStatusCache = null,\n        authStatusDeferred = null,\n        authStatusTimer = null,\n        authCallTimer = null;\n    \n    var prefs = BracketsPreferencesModel.get("preferenceSystem");\n        // error codes from the shell\n    var IMS_NO_ERROR = 0,\n        IMS_ERR_CALL_PENDING = 17,\n        IMS_ERR_EXPIRED_ACCESS_TOKEN = 18;\n    \n        // max retries when the error shell error is CALL_PENDING\n    var MAX_RETRIES                 = 10,\n        MS_WAIT_UNTIL_RETRY         = 100,\n        WAIT_TIMEOUT                = 10000,\n        HEALTH_DATA_LOGGING_VERSION = "1.4.0";\n\n    var thorLoggedOut = false;\n        /**\n     * Clear cached auth status information\n     */\n    function invalidateCache() {\n        authStatusCache = null;\n        authStatusTimer = null;\n    }\n    \n        \n    /**\n     * Make an authorized user object from the status object returned from the\n     * shell. For now just strips the access token-related information from the\n     * status object.\n     * \n     * @param {Object} status - IMSLib status object\n     * @return {Object} - authorized user object\n     */\n    function getAuthorizedUserFromStatus(status) {\n        // make shallow copy. This works only with key value pairs where\n        // the value is not a function\n        var modifiedUserProfileJson = JSON.parse(JSON.stringify(status));\n\n        delete modifiedUserProfileJson.access_token;\n        delete modifiedUserProfileJson.expires_in;\n        delete modifiedUserProfileJson.refresh_token;\n        delete modifiedUserProfileJson.token_type;\n\n        return modifiedUserProfileJson;\n    }\n    \n    /**\n     * Asynchronously get an authStatus object, either from the cache or from the shell.\n     *\n     * @param {boolean} forceRefresh - if set, ignore the cached status and force a refresh\n     * @returns {$.Promise<{accessToken: string, authorizedUser: Object}>} - an auth status object\n     */\n    function _getAuthStatus(forceRefresh) {\n        var deferred;\n        \n        function getAuthStatusHelper(retryCount) {\n            \n            if (retryCount > MAX_RETRIES) {\n                deferred.reject();\n            }\n            \n            if (!brackets.app.getAuthorizedUser) {\n                deferred.reject();\n            } else {\n                brackets.app.getAuthorizedUser(function (err, status) {\n                    \n                    if (err === IMS_NO_ERROR && status && authStatusDeferred) {\n                    \n                        try {\n                            var statusObj = JSON.parse(status),\n                                accessToken = statusObj.access_token,\n                                authorizedUser = getAuthorizedUserFromStatus(statusObj),\n                                expiresIn = statusObj.expires_in;\n                                \n                                // Decode the access token payload\n                            if (accessToken) {\n                                var encodedPayload = accessToken.slice(\n                                    accessToken.indexOf(".") + 1,\n                                    accessToken.lastIndexOf(".")\n                                );\n                                \n                                var decodedPayload = window.atob(encodedPayload);\n                                var tokenPayload = JSON.parse(decodedPayload);\n                            // Validate the access token against the expiry field in the payload\n                                var utcExpiresAt = parseInt(tokenPayload.created_at, 10) +\n                                    parseInt(tokenPayload.expires_in, 10);\n                                if ((Date.now() < utcExpiresAt)) {\n                                    // Valid access token\n\n                                    // cache the auth status\n                                    authStatusCache = {\n                                        accessToken: accessToken,\n                                        authorizedUser: authorizedUser\n                                    };\n\n                                    // invalidate and refresh the cached status once the token expires\n                                    authStatusTimer = window.setTimeout(function () {\n                                        $(exports).triggerHandler("signOut");\n                                        invalidateCache();\n                                    }, expiresIn);\n                                    AuthController.getAuthModel().attributes.access_token = accessToken;\n                                    $(exports).triggerHandler("signInAuto", authStatusCache);\n                                    var cmdToggleAuth = Commands.get(Commands.TOGGLE_AUTH);\n                                    cmdToggleAuth.setName(StringUtils.format(Strings.MENU_CC_SIGN_OUT, authStatusCache.authorizedUser.email));\n                                    deferred.resolve(authStatusCache);\n                                } else {\n                                    $(exports).triggerHandler("signOut");\n                                    invalidateCache();\n                                    deferred.reject(IMS_ERR_EXPIRED_ACCESS_TOKEN);\n                                }\n                            } else {\n                                deferred.reject();\n                            }\n\n                        } catch (parseError) {\n                            console.error("Unable to parse auth status: ", parseError);\n                            deferred.reject(parseError);\n                        }\n                    } else if (err === IMS_ERR_CALL_PENDING) {\n                        window.setTimeout(function () {\n                            ++retryCount;\n                            getAuthStatusHelper(retryCount);\n                        }, MS_WAIT_UNTIL_RETRY);\n                    } else {\n                        deferred.reject();\n                    }\n                });\n            }\n        }\n        \n        if (authStatusDeferred) {\n            deferred = authStatusDeferred;\n        } else {\n            deferred = new $.Deferred();\n            authStatusDeferred = deferred;\n        }\n        \n        if (!authCallTimer) {\n            authCallTimer = window.setTimeout(function () {\n                deferred.reject();\n            }, WAIT_TIMEOUT);\n        }\n        \n        deferred.always(function () {\n            window.clearInterval(authCallTimer);\n            authStatusDeferred = null;\n            authCallTimer = null;\n        });\n        \n        if (!authStatusCache || forceRefresh) {\n            getAuthStatusHelper();\n        } else {\n            deferred.resolve(authStatusCache);\n        }\n\n        return deferred.promise();\n    }\n\n    function isThorLoggedOut() {\n        return thorLoggedOut;\n    }\n\n    function isUserSignedIn() {\n        return !!authStatusCache;\n    }\n\n    function signOut() {\n        invalidateCache();\n        thorLoggedOut = true;\n        var cmdToggleAuth = Commands.get(Commands.TOGGLE_AUTH);\n        cmdToggleAuth.setName(Strings.MENU_CC_SIGN_IN);\n        $(exports).triggerHandler("signOut");\n    }\n\n    function getAccessToken() {\n        var deferred = new $.Deferred();\n        if (thorLoggedOut) {\n            deferred.reject();\n        } else {\n            _getAuthStatus().done(function (status) {\n                deferred.resolve(status);\n            }).fail(function (err) {\n                deferred.reject();\n            });\n        }\n        return deferred.promise();\n    }\n    \n    function logUserInfo() {\n        function _logHelper() {\n            var data = {};\n            ExtensionMetaData.getAcceptedEULA().done(function () {\n                if (brackets.app.getAuthorizedUser) {\n                    brackets.app.getAuthorizedUser(function (err, status) {\n                        if (err === IMS_NO_ERROR && status) {\n                            data.userAutoSignedIn = true;\n                            var statusObj = JSON.parse(status),\n                                authorizedUser = getAuthorizedUserFromStatus(statusObj),\n                                accounts = authorizedUser.serviceAccounts;\n\n                            if (accounts && Array.isArray(accounts)) {\n                                data.isCCSubscribedUser = accounts.some(function (account) {\n                                    return account.serviceCode === "creative_cloud" && account.serviceLevel === "CS_LVL_2";\n                                });\n                            }\n                        } else {\n                            data.userAutoSignedIn = false;\n                        }\n                        HealthLogger.setHealthDataLog("e4b", data);\n                        graphite.events.trigger("ccSubscriptionInfo", data);\n\n                    });\n                }\n            });\n        }\n        \n        var eulaAccepted = prefs.get(BracketsPreferencesModel.EULA_ACCEPTED);\n        \n        if (eulaAccepted) {\n            _logHelper();\n        } else {\n            graphite.events.on("eulaAccepted", _logHelper);\n        }\n    }\n\n    function healthDataLoggingExistsInVersion() {\n        var currentBracketsVersion = brackets.metadata.version;\n        \n        var currentBracketsVersionValues    = currentBracketsVersion.split(/\\.|-/),\n            healthDataBracketsVersionValues = HEALTH_DATA_LOGGING_VERSION.split(/\\.|-/),\n            length                          = Math.max(currentBracketsVersionValues.length, healthDataBracketsVersionValues.length),\n            i;\n        \n        for (i = 0; i < length; i++) {\n            if (parseInt(currentBracketsVersionValues[i], 10) > parseInt(healthDataBracketsVersionValues[i], 10)) {\n                return true;\n            } else if (parseInt(currentBracketsVersionValues[i], 10) < parseInt(healthDataBracketsVersionValues[i], 10)) {\n                return false;\n            }\n        }\n        return true;\n    }\n    \n    if (healthDataLoggingExistsInVersion()) {\n        HealthLogger = brackets.getModule("utils/HealthLogger");\n        AppInit.appReady(logUserInfo);\n    }\n    \n    exports.getAccessToken = getAccessToken;\n    exports.signOut        = signOut;\n    exports.isUserSignedIn = isUserSignedIn;\n    exports.isThorLoggedOut = isThorLoggedOut;\n});\n\n//# sourceURL=/./ims/IMSLib.js'),eval('/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4, bitwise: true, sub: true, regexp: true */\n/*global define, brackets, graphite, window, PathUtils, Mustache*/\ndefine(\'ext/ims/IMSLibWrapper\',[\n    "module",\n    "jquery",\n    "underscore",\n    "backbone",\n    "config/environment",\n    "ext/ims/IMSLibLoader",\n    "ext/ims/IMSProxy",\n    "ext/ims/IMSLib",\n    "adobeid",\n    "ext/command/Commands",\n    "ext/models/BracketsPreferencesModel",\n    "ext/models/ExtensionMetaData",\n    "ext/CacheManager",\n    "ext/strings"\n], function (module, $, _, Backbone, environment, IMSLibLoader, IMSProxy, IMSLibrary,\n    adobeid, Commands, BracketsPreferencesModel, ExtensionMetaData, CacheManager,\n    Strings) {\n    "use strict";\n    \n    var DefaultDialogs  = brackets.getModule("widgets/DefaultDialogs"),\n        Dialogs         = brackets.getModule("widgets/Dialogs"),\n        Menus           = brackets.getModule("command/Menus"),\n        StringUtils     = brackets.getModule("utils/StringUtils");\n\n    var RE_COOKIE_PAIR = /(\\S+)=(.*)/;\n\n    var imslib,\n        imsReady = false,\n        $adobeid = $(adobeid),\n        prefs = BracketsPreferencesModel.get("preferenceSystem"),\n        cmdToggleAuth,\n        thorLoggedIn = false;\n\n    function loadIMS() {\n        if (imslib) {\n            return new $.Deferred().resolve(imslib).promise();\n        }\n\n        // getPromise is reentrant, prevents imslib from loading more than once\n        return IMSLibLoader.getPromise().done(function (hostedIMS) {\n            imslib = hostedIMS;\n        });\n    }\n    \n    var IMSLibWrapper = Backbone.Model.extend({\n        \n        initialize: function () {\n            var self = this,\n                wasSignedIn = false,\n                initStart = Date.now();\n\n            // Restore cookies and update proxy server\n            self._initializeCookie();\n            \n            $adobeid.on("ready", function _onStateChange(event) {\n                if (event.type === "ready") {\n                    imsReady = true;\n\n                    // Enable menu item when imslib is ready\n                    cmdToggleAuth.setEnabled(true);\n\n                    graphite.events.trigger("ims-ready", {\n                        duration: Date.now() - initStart\n                    });\n                }\n\n                // fire "signIn" and "signOut" events when imslib updates\n                // Note that the accessToken event is not included since profile must \n                // always fire after accessToken\n                $adobeid.on("profile accessTokenHasExpired", _onStateChange);\n\n                var isSignedIn = self.isSignedInUser(),\n                    triggerEventName = (isSignedIn) ? "signIn" : "signOut";\n                \n                // Only fire event when signed in state changes\n                if (isSignedIn !== wasSignedIn) {\n                    var data = null;\n\n                    if (isSignedIn) {\n                        data = _.extend({}, imslib.getAccessTokenInfo(), imslib.getUserProfile());\n                        \n                        // Update command label\n                        \n                        cmdToggleAuth.setName(StringUtils.format(Strings.MENU_CC_SIGN_OUT, data.email));\n                    } else {\n                        // Clear cookies on signOut\n                        self._setCookie({});\n                        \n                        // Update command label\n                        cmdToggleAuth.setName(Strings.MENU_CC_SIGN_IN);\n                    }\n                    \n                    $(self).triggerHandler(triggerEventName, [data]);\n                    wasSignedIn = isSignedIn;\n                }\n\n                // These events imply user is online\n                self._handleNetworkChange(true);\n            });\n\n            // Log when access token expires\n            $adobeid.on("accessTokenHasExpired", function (event) {\n                graphite.events.trigger("expired-access-token");\n            });\n\n            // event handlers when popup window closes\n            $adobeid.on("getClientWindow", function (event, promise) {\n                // disable the login menu while we try to sign in\n                cmdToggleAuth.setEnabled(false);\n\n                promise.always(function () {\n                    // renable login menu when dialog closes\n                    cmdToggleAuth.setEnabled(true);\n\n                    // internal _dialogClosed event\n                    $(self).triggerHandler("_dialogClosed");\n                });\n            });\n\n            // Online/Offline handlers\n            $adobeid.on("error", function (event, error) {\n                var isOnline = (error.name !== "networkError");\n                self._handleNetworkChange(isOnline);\n            });\n\n            window.addEventListener("online", function (e) {\n                self._handleNetworkChange(true);\n            }, false);\n\n            window.addEventListener("offline", function (e) {\n                self._handleNetworkChange(false);\n            }, false);\n\n            // FIXME navigator.onLine always returns true as of Brackets 44\n            self._handleNetworkChange(navigator.onLine);\n        },\n\n        _updateMetrics: function (isSignUp, imsCountProperty) {\n            var defaultParams = prefs.get(BracketsPreferencesModel.METRICS_DEFAULT_PARAMS),\n                metricName = isSignUp ? "signUp" : "signIn",\n                prefName = "ims." + metricName + "." + imsCountProperty,\n                count = defaultParams[prefName] + 1;\n\n            defaultParams[prefName] = count;\n\n            // Save prefs\n            prefs.set(BracketsPreferencesModel.METRICS_DEFAULT_PARAMS, defaultParams);\n        },\n\n        _handleNetworkChange: function (isOnline) {\n            if (!isOnline) {\n                $(this).triggerHandler("networkError");\n            }\n        },\n\n        _parseCookie: function (cookie) {\n            var result = {},\n                pairs = cookie.split(/; */),\n                match;\n\n            pairs.forEach(function (pair) {\n                match = pair.trim().match(RE_COOKIE_PAIR);\n\n                if (match) {\n                    result[match[1]] = decodeURIComponent(match[2]);\n                }\n            });\n\n            return result;\n        },\n\n        _setCookie: function (updatedCookie) {\n            var cookie = updatedCookie || prefs.get(BracketsPreferencesModel.IMS_COOKIE);\n\n            // Save updated cookie to preferences\n            if (updatedCookie) {\n                prefs.set(BracketsPreferencesModel.IMS_COOKIE, cookie);\n            }\n\n            // Serialize as a single string\n            var cookieString = "";\n\n            _.each(cookie, function (val, key) {\n                cookieString += key + "=" + encodeURIComponent(val) + "; ";\n            });\n\n            // Update proxy\n            IMSProxy.setCookie(cookieString);\n        },\n\n        _initializeCookie: function () {\n            var self = this;\n            \n            // Save cookies when modified\n            $adobeid.on("cookie", function (event, cookie) {\n                // Merge new cookie with current\n                var currentCookie = prefs.get(BracketsPreferencesModel.IMS_COOKIE),\n                    newCookie = self._parseCookie(cookie),\n                    mergedCookie = _.extend({}, currentCookie, newCookie);\n\n                // Update proxy server with new cookie\n                self._setCookie(mergedCookie);\n            });\n\n            // Restore cookies on init\n            self._setCookie(prefs.get(BracketsPreferencesModel.IMS_COOKIE));\n        },\n        \n        isSignedInUser: function (isReAuthentication, client_id, scope) {\n            if (imsReady) {\n                // Convert to boolean\n                return !!imslib.isSignedInUser(isReAuthentication, client_id, scope);\n            }\n\n            // A non-empty cache implies the user was previously signed in\n            return !CacheManager.isEmpty();\n        },\n        \n        _doOptionalSignIn: function () {\n            if (!this.isSignedInUser()) {\n                return this.signIn();\n            }\n            \n            return new $.Deferred().resolve().promise();\n        },\n        \n        getUserProfile: function () {\n            return this._doOptionalSignIn().then(function () {\n                return imslib && imslib.getUserProfile();\n            });\n        },\n        \n        getAccessToken: function () {\n            // Only log missing/valid access token when requested\n            var deferred = new $.Deferred(),\n                self = this;\n \n            if (this.isSignedInUser()) {\n                deferred.resolve((imslib && imslib.getAccessToken()) || "");\n            } else {\n\n                IMSLibrary.getAccessToken().done(function (accessToken) {\n                    deferred.resolve(accessToken.accessToken);\n                }).fail(function (err) {\n                    if (imslib && imslib.getAccessToken()) {\n                        graphite.events.trigger("valid-access-token");\n                    } else {\n                        graphite.events.trigger("missing-access-token");\n                    }\n                    return self._doOptionalSignIn().then(function () {\n                        deferred.resolve((imslib && imslib.getAccessToken()) || "");\n                        return (imslib && imslib.getAccessToken()) || "";\n                    });\n                        \n                });\n            }\n            return deferred.promise();\n        },\n\n        _showOfflineDialog: function (strAction) {\n            // Show dialog if we can\'t load IMS or we\'re offline\n            Dialogs.showModalDialog(\n                DefaultDialogs.DIALOG_ID_ERROR,\n                Strings.EXTENSION_NAME,\n                StringUtils.format(Strings.ERROR_OFFLINE_MESSAGE, strAction)\n            );\n        },\n\n        _doOptionalLoadIMS: function (actionDeferred, strAction) {\n            var self = this,\n                deferred = new $.Deferred();\n\n            var handleNetworkError = function () {\n                self._showOfflineDialog(strAction);\n            };\n\n            $(this).one("networkError", handleNetworkError);\n\n            actionDeferred.always(function () {\n                $(self).off("networkError", handleNetworkError);\n            });\n\n            if (imsReady) {\n                // May not be currently online, but at least imslib is ready\n                deferred.resolve();\n            } else {\n                loadIMS().then(deferred.resolve, function () {\n                    self._showOfflineDialog(strAction);\n                    deferred.reject();\n                });\n            }\n\n            return deferred.promise();\n        },\n\n        // User can switch between signIn->signUp and back inside SUSI UI. But\n        // not from signUp->signIn. When _dialogClosed is fired, we don\'t know\n        // whether the user signed in or signed up.\n        _signInOrSignUp: function (isSignUp, api_parameters, contextToBePassedOnRedirect) {\n            var self = this,\n                deferred = new $.Deferred(),\n                errString = isSignUp ? Strings.ERROR_OFFLINE_MESSAGE_SIGN_UP : Strings.ERROR_OFFLINE_MESSAGE_SIGN_IN,\n                loadIMSPromise = this._doOptionalLoadIMS(deferred, errString),\n                promise = deferred.promise();\n\n            this._updateMetrics(isSignUp, "attemptCount");\n\n            loadIMSPromise.then(function () {\n                var dialogStarted = Date.now();\n\n                // event handlers when popup window closes\n                $(self).one("_dialogClosed", function (event) {\n                    var eventParams = {\n                        state: "login dialog",\n                        isSignUp: isSignUp,\n                        duration: Date.now() - dialogStarted\n                    };\n\n                    // TODO The following login events can only be captured by IMS:\n                    // login-attempt, login-failure\n                    if (self.isSignedInUser()) {\n                        this._updateMetrics(isSignUp, "successCount");\n                        graphite.events.trigger("login-success", eventParams);\n                    } else {\n                        this._updateMetrics(isSignUp, "abortCount");\n                        graphite.events.trigger("login-cancel", eventParams);\n                        deferred.reject();\n                    }\n                });\n\n                $(self).one("signIn", function (event, data) {\n                    deferred.resolve(data);\n                });\n                \n                if (isSignUp) {\n                    imslib.signUp(api_parameters, contextToBePassedOnRedirect);\n                } else {\n                    imslib.signIn(api_parameters, contextToBePassedOnRedirect);\n                }\n                \n                $(self).triggerHandler(isSignUp ? "signUpDialog" : "signInDialog");\n                graphite.events.trigger("login-start", {\n                    state: "login dialog",\n                    isSignUp: isSignUp\n                });\n            }, deferred.reject);\n            \n            return promise;\n        },\n        \n        signIn: function (api_parameters, contextToBePassedOnRedirect) {\n            return this._signInOrSignUp(false, api_parameters, contextToBePassedOnRedirect);\n        },\n\n        signUp: function (api_parameters, contextToBePassedOnRedirect) {\n            return this._signInOrSignUp(true, api_parameters, contextToBePassedOnRedirect);\n        },\n        \n        signOut: function (api_parameters) {\n            var self = this,\n                deferred = new $.Deferred(),\n                loadIMSPromise = this._doOptionalLoadIMS(deferred, Strings.ERROR_OFFLINE_MESSAGE_SIGN_OUT),\n                promise = deferred.promise();\n            \n            loadIMSPromise.then(function () {\n                var dialogStarted = Date.now();\n\n                // event handlers when popup window closes\n                $(self).one("_dialogClosed", function (event) {\n                    var eventParams = { duration: Date.now() - dialogStarted };\n\n                    if (!self.isSignedInUser()) {\n                        graphite.events.trigger("logout-success", eventParams);\n                    } else {\n                        graphite.events.trigger("logout-failure", eventParams);\n                    }\n                });\n\n                $(self).one("signOut", deferred.resolve);\n                \n                imslib.signOut(api_parameters);\n                graphite.events.trigger("logout-attempted");\n            }, deferred.reject);\n            \n            return promise;\n        },\n\n        handleToggleAuth: function () {\n            var self = this;\n            if (IMSLibrary.isUserSignedIn()) {\n                IMSLibrary.signOut();\n            } else if (this.isSignedInUser()) {\n                this.signOut();\n            } else if (IMSLibrary.isThorLoggedOut()) {\n                this.signIn();\n            } else {\n                IMSLibrary.getAccessToken().fail(function () {\n                    self.signIn();\n                });\n            }\n        }\n    });\n    \n    var wrapper = new IMSLibWrapper();\n    loadIMS();\n    \n    // Help > Sign In/Out of Creative Cloud\n    // If User is Logged in through Thor, it will be automatically signed in. Otherwise, SUSI Dialog will be shown.\n    cmdToggleAuth = Commands.register(Strings.MENU_CC_SIGN_IN, Commands.TOGGLE_AUTH, function () {\n        ExtensionMetaData.getAcceptedEULA().done(function () {\n            wrapper.handleToggleAuth();\n        });\n    });\n    \n    // Disable until we receive `ready` event\n    cmdToggleAuth.setEnabled(false);\n    \n    return wrapper;\n});\n//# sourceURL=/./ims/IMSLibWrapper.js'),
eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4, bitwise: true */\n/*global define, brackets*/\n\ndefine('override/models/BracketsAuthModel',[\n    'jquery',\n    'config/environment',\n    'models/AuthModel',\n    'ext/CacheManager',\n    'ext/ims/IMSLibWrapper',\n    'ext/models/BracketsPreferencesModel',\n    'ext/ims/IMSLib'\n], function ($, environment, AuthModel, CacheManager, IMSLibWrapper, BracketsPreferencesModel, ImsLib) {\n    \"use strict\";\n    \n    var prefs               = BracketsPreferencesModel.get(\"preferenceSystem\");\n    \n    var BracketsAuthModel = AuthModel.extend({\n\n        initialize: function () {\n            var self = this;\n\n            // Override AuthModel throttlecheck\n            this.throttled = false;\n            \n            function updateData(userData) {\n                self.user_data = {};\n                self.user_data.accountEnabled = true;\n                self.user_data.analyticsOptIn = false;\n                self.user_data.email = userData.email;\n                self.user_data.serviceAccounts = userData.serviceAccounts;\n                self.adobeID = userData.email;\n            }\n            \n            $(IMSLibWrapper).on(\"signIn\", function (event, userData) {\n                updateData(userData);\n            }).on(\"signOut\", function (event) {\n                self.invalidate();\n            });\n            \n            $(ImsLib).on(\"signInAuto\", function (event, userData) {\n                updateData(userData.authorizedUser);\n            }).on(\"signOut\", function (event) {\n                self.invalidate();\n            });\n        },\n        configure: function () {\n            return IMSLibWrapper.getAccessToken();\n        },\n        \n        isPaidAccount: function () {\n            // FIXME save in preference so we can track this offline\n            var accounts = this.user_data && this.user_data.serviceAccounts;\n            \n            if (!accounts || !Array.isArray(accounts)) {\n                return false;\n            }\n            \n            return accounts.some(function (account) {\n                return account.serviceCode === \"creative_cloud\" && account.serviceLevel === \"CS_LVL_2\";\n            });\n        },\n\n        isValid: function () {\n            // HACK https://git.corp.adobe.com/jhagenst/brackets-parfait-extension/issues/548\n            // If the user starts Brackets offline, imslib.js can't load and\n            // won't populate AuthModel.user_data used here in AuthModel.isValid().\n            // If the user starts Brackets online and logged in (expired or not),\n            // we can at least show what we have in the cache. In the long run\n            // this isn't the ideal fix and we should at least change usage of\n            // AuthController.isLoggedIn() in AssetView and AssetListView\n            if (!CacheManager.isEmpty()) {\n                return true;\n            }\n\n            return AuthModel.prototype.isValid.call(this);\n        },\n        \n        // Need to override the default method in prototype to avoid\n        // dependency on invite code. Expecting upstream changes.\n        // Eventually we may need to revisit, looks\n        // like Parfait is not fully using this feature yet.\n        isValidWithUserFeature: function () {\n            return true;\n        },\n\n        isAnalyticsOptIn: function () {\n            return prefs.get(BracketsPreferencesModel.METRICS_ENABLED);\n        },\n\n        setAnalyticsOptIn: function (bAnalyticsOptIn) {\n            // do nothing\n        },\n\n        // Override super method that responds synchronously with\n        // attributes.access_token and instead use IMSLib\n        getAccessToken: function () {\n            var deferred = new $.Deferred();\n            IMSLibWrapper.getAccessToken().done(function (accessToken) {\n                deferred.resolve(accessToken);\n            });\n            return deferred.promise();\n        }\n    });\n\n    return BracketsAuthModel;\n});\n//# sourceURL=/./models/BracketsAuthModel.js"),eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013-2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4, bitwise: true */\n/*global define: true, graphite: true, window: true*/\n\ndefine('ccweb.files.extract/models/MetricsProxyModel',[\n    'jquery',\n    'underscore',\n    'backbone'\n], function ($, _, Backbone) {\n    'use strict';\n    var MetricsProxyModel = Backbone.Model.extend({\n\n        defaults: {\n            authModel: null,\n            configModel: null\n        },\n\n        // The Auth model and Config model are necessarily different betwixt Parfait and Extract, so we pass them in during initialization. Weak Typing is your friend\n        setAuthModel: function (model) {\n            this.authModel = model;\n        },\n\n        setConfigModel: function (model) {\n            this.configModel = model;\n            this.setDefaultParam('parfaitBuild', this.configModel.getBuildNumber());\n        },\n\n        initialize: function () {\n            window.graphite = window.graphite || {};\n            window.graphite.events = window.graphite.events || _.extend({}, Backbone.Events);\n\n            window.graphite.events.on('landing-page', this.onLandingPage, this);\n            window.graphite.events.on('login-dialog-shown', this.handleLogInDialogShown, this);\n            window.graphite.events.on('logged-in', this.handleLoggedIn, this);\n            window.graphite.events.on('upload-init', this.uploadInit, this);\n            window.graphite.events.on('uploaded', this.uploaded, this);\n            window.graphite.events.on('upload-failed', this.uploadFailed, this);\n            window.graphite.events.on('processed', this.processed, this);\n            window.graphite.events.on('processing-failed', this.processingFailed, this);\n            window.graphite.events.on('drawPreviewFinish', this.drawPreviewFinish, this);//Confusing, because unlike other event listeners, this fires a 'rendered' event\n            window.graphite.events.on('selectedTab', this.selectedTab, this);\n            window.graphite.events.on('help-dialog', this.helpDialog, this);\n            window.graphite.events.on('help-dialog-shortcut', this.helpDialogShortCut, this);\n            window.graphite.events.on('first-user-overlay-shortcut', this.FUXShortCut, this);\n            window.graphite.events.on('show-color-popup', this.showColorPopup, this);\n            window.graphite.events.on('show-measurement-offsets', this.showMeasurementOffsets, this);\n            window.graphite.events.on('copy-css', this.copyCSS, this);\n            window.graphite.events.on('copy-text', this.copyText, this);\n            window.graphite.events.on('copy-value', this.copyValue, this);\n            window.graphite.events.on('color-format', this.colorFormat, this);\n            window.graphite.events.on('report-fidelity-error', this.reportFidelityError, this);\n            window.graphite.events.on('typekitSearch', this.typekitSearch, this);\n            window.graphite.events.on('extract-asset-download-init', this.extraAssetDownload, this);\n            window.graphite.events.on('asset-extracted-scaled', this.scaledAssetExtracted, this);\n            window.graphite.events.on('canvasClick', this.canvasClicked, this);\n            window.graphite.events.on('canvasClickDrag', this.canvasClickDrag, this);\n            window.graphite.events.on('cssDoublClick', this.cssDoubleClick, this);\n            window.graphite.events.on('register-defaults', this.registerDefaults, this);\n            window.graphite.events.on('load-alert', this.loadAlert, this);\n            window.graphite.events.on('load-calltoaction', this.loadCallToAction, this);\n            window.graphite.events.on('bad-file-type-dragdrop', this.badFileTypeDragDrop, this);\n            window.graphite.events.on('show-extract-asset-popup', this.showExtractAssetPopup, this);\n            window.graphite.events.on('downloading-extracted-asset', this.downloadingExtractedAsset, this);\n            window.graphite.events.on('downloading-psd', this.downloadingPSD, this);\n            window.graphite.events.on('featureFlagSet', this.featureFlagSet, this);\n            window.graphite.events.on('layerCompShown', this.layerCompShown, this);\n            window.graphite.events.on('layerCompChanged', this.layerCompChanged, this);\n            window.graphite.events.on('commitDropperColor', this.handleDropperExtraction, this);\n            window.graphite.events.on('preprocessorChanged', this.handlePreprocessorChanged, this);\n            window.graphite.events.on('catchIntercept', this.handleIntercept, this);\n            window.graphite.events.on('baseFontSizeChanged', this.handleBaseFontSizeChanged, this);\n            window.graphite.events.on('preferredFontUnitsChanged', this.handlePreferredFontUnitsChanged, this);\n            window.graphite.events.on('show-job-list-overlay', this.handleShowJobListOverlay, this);\n            window.graphite.events.on('upload-psd-public-one-up', this.handleUploadOneUp, this);\n\n            this.defaultParams = {\n            };\n        },\n\n        registerDefaults: function () {\n            graphite.serverAPI.registerPersistentParameters(this.defaultParams);\n            window.graphite.events.off('register-defaults');\n        },\n\n        mergeParams: function (params) {\n            var thisParam,\n                returnParams = {},\n                currentDate = new Date();\n            for (thisParam in this.defaultParams) {\n                if (this.defaultParams.hasOwnProperty(thisParam)) {\n                    returnParams[thisParam] = this.defaultParams[thisParam];\n                }\n            }\n            for (thisParam in params) {\n                if (params.hasOwnProperty(thisParam)) {\n                    returnParams[thisParam] = params[thisParam];\n                }\n            }\n            returnParams.timestamp = currentDate.getTime();\n            return returnParams;\n        },\n\n        setDefaultParam: function (key, value) {\n            this.defaultParams[key] = value;\n        },\n\n        onLandingPage: function () {\n            this.trackEvent('landing-page');\n        },\n\n        handleLogInDialogShown: function () {\n            this.trackEvent('login-dialog-shown');\n        },\n\n        handleLoggedIn: function () {\n            //initialize the adobeID\n            this.trackEvent('logged-in');\n        },\n\n        uploadInit: function (params) {\n            var nFiles = params.files.length,\n                i;\n            for (i = 0; i < nFiles; i++) {\n                var aFileName = params.files[i].name,\n                    eventParams = { filename : aFileName };\n                this.trackEvent('upload-init', eventParams);\n            }\n        },\n\n        uploaded: function (params) {\n            this.trackEvent('uploaded', params);\n        },\n\n        uploadFailed: function (params) {\n            this.trackEvent('upload-failed', params);\n        },\n\n        processed: function (params) {\n            this.trackEvent('processed', params);\n        },\n\n        processingFailed: function (params) {\n            this.trackEvent('processing-failed', params);\n        },\n\n        drawPreviewFinish: function (psdModel) {\n            var currTime = Date.now();\n            var renditionDuration = currTime - psdModel.get('previewStarted');\n            var eventParams = { renditionDuration : renditionDuration };\n\n            this.setDefaultParam('assetID', psdModel.get('id'));\n            this.trackEvent('rendered', eventParams);\n        },\n\n        selectedTab: function (params) {\n            this.trackEvent('selected-tab', {tabName: params.selectedTab});\n        },\n\n        helpDialog: function () {\n            this.trackEvent('help-dialog');\n        },\n\n        helpDialogShortCut: function () {\n            this.trackEvent('help-dialog-shortcut');\n        },\n\n        FUXShortCut: function () {\n            this.trackEvent('first-user-overlay-shortcut');\n        },\n\n        showColorPopup: function () {\n            this.trackEvent('show-color-popup');\n        },\n\n        showMeasurementOffsets: function () {\n            this.trackEvent('show-measurement-offsets');\n        },\n\n        copyCSS: function (params) {\n            this.trackEvent('copy-css', params);\n        },\n\n        copyText: function () {\n            this.trackEvent('copy-text');\n        },\n\n        copyValue: function (params) {\n            this.trackEvent('copy-value', params);\n        },\n\n        colorFormat: function (params) {\n            this.trackEvent('color-format', params);\n        },\n\n        reportFidelityError: function () {\n            this.trackEvent('report-fidelity-error');\n        },\n\n        typekitSearch: function () {\n            this.trackEvent('typekit-search');\n        },\n\n        extraAssetDownload: function (params) {\n            this.trackEvent('extract-asset-download-init', params);\n        },\n\n        scaledAssetExtracted: function (params) {\n            this.trackEvent('asset-extracted-scaled', params);\n        },\n\n        canvasClicked: function (params) {\n            this.trackEvent('psd-preview-canvas-clicked', params);\n        },\n\n        canvasClickDrag: function (params) {\n            this.trackEvent('psd-preview-canvas-clickdrag', params);\n        },\n\n        cssDoubleClick: function (params) {\n            this.trackEvent('css-properties-doubleclick', params);\n        },\n\n        loadAlert: function (message) {\n            this.trackEvent('load-alert', {alertMessage: message});\n        },\n\n        loadCallToAction: function (params) {\n            this.trackEvent('load-calltoaction');\n        },\n\n        badFileTypeDragDrop: function (params) {\n            this.trackEvent('bad-file-type-dragdrop', params);\n        },\n\n        showExtractAssetPopup: function (params) {\n            //track the origin of show-extract-asset-popup to be 'layerPanel' or 'measurementPopup'\n            //stripping off 'sourceElement' and 'layerModel' params and only sending the origin.\n            this.trackEvent('show-extract-asset-popup', {origin : params.origin});\n        },\n\n        downloadingExtractedAsset: function (params) {\n            //track downloading of asset from the asset panel\n            this.trackEvent('downloading-extracted-asset', params);\n        },\n\n        downloadingPSD: function (params) {\n            //track downloading of asset from the asset list (psd)\n            this.trackEvent('downloading-psd', params);\n        },\n\n        featureFlagSet: function (params) {\n            this.trackEvent('feature-flag-set', params);\n        },\n\n        layerCompShown: function () {\n            this.trackEvent('layer-comp-shown');\n        },\n\n        layerCompChanged: function () {\n            this.trackEvent('layer-comp-changed');\n        },\n\n        handleDropperExtraction: function () {\n            this.trackEvent('dropper-color-extracted');\n        },\n\n        handlePreprocessorChanged: function (params) {\n            this.trackEvent('preprocessor-changed', params);\n        },\n\n        handleIntercept: function (params) {\n            this.trackEvent('catch-intercept', params);\n        },\n\n        handleBaseFontSizeChanged: function (params) {\n            this.trackEvent('base-font-size-changed', params);\n        },\n\n        handlePreferredFontUnitsChanged: function (params) {\n            this.trackEvent('preferred-font-units-changed', params);\n        },\n\n        handleShowJobListOverlay: function (params) {\n            this.trackEvent('show-job-list-overlay', params);\n        },\n\n        handleUploadOneUp: function (params) {\n            this.trackEvent('upload-psd-public-one-up', params);\n        },\n\n        trackEvent: function (eventName, eventParams) {\n            var baseEvent =  'EDGE_EXTRACT_LANDING',\n                eventMap,\n                eventInfo,\n                params = eventParams || {};\n\n            if (this.authModel) {\n                if (!this.authModel.isAnalyticsOptIn()) {\n                    return;\n                }\n\n                if (this.authModel.isValid()) {\n                    // This should all be moved to something that registers them as defaults in the Metrics Controller once the user's Authm Model is returned and valid.\n                    //attach the adobeID\n                    params.adobeID = this.authModel.getAdobeId();\n                    //track whether the e-mail originates from adobe.com, adobetest.com & 601t.com\n                    params.internalUser = this.authModel.isAdobeInternalUser();\n                    // Get the user's register date\n                    params.registerDate = this.authModel.getRegisterDate();\n                    graphite.serverAPI.registerPersistentParameters({ internalUser: params.internalUser, registerDate: this.authModel.getRegisterDate() });\n                    baseEvent = 'EDGE_EXTRACT_ACTIVITY';\n                }\n            }\n            \n            params.isPublic1UpView = graphite.inPublicOneUp();\n\n            eventMap = {\n                'selected-tab'                  : {event : baseEvent, subevent : 'SELECTED_TAB'},\n                'show-color-popup'              : {event : baseEvent, subevent : 'SHOW_COLOR_POPUP'},\n                'show-measurement-offsets'      : {event : baseEvent, subevent : 'SHOW_MEASUREMENT_OFFSETS'},\n                'copy-css'                      : {event : baseEvent, subevent : 'COPY_CSS'},\n                'copy-text'                     : {event : baseEvent, subevent : 'COPY_TEXT'},\n                'copy-value'                    : {event : baseEvent, subevent : 'COPY_VALUE'},\n                'color-format'                  : {event : baseEvent, subevent : 'COLOR_FORMAT'},\n                'dropper-color-extracted'       : {event : baseEvent, subevent : 'DROPPER_COLOR_EXTRACTED'},\n                'report-fidelity-error'         : {event : baseEvent, subevent : 'FIDELITY_ERROR'},\n                'typekit-search'                : {event : baseEvent, subevent : 'TYPEKIT_SEARCH'},\n                'extract-asset-download-init'   : {event : baseEvent, subevent : 'ASSET_DOWNLOAD_INIT'},\n                'asset-extracted-scaled'        : {event : baseEvent, subevent : 'ASSET_EXTRACTED_SCALED'},\n                'show-extract-asset-popup'      : {event : baseEvent, subevent : 'SHOW_EXTRACT_ASSET_POPUP'},\n                'downloading-extracted-asset'   : {event : baseEvent, subevent : 'DOWNLOADING_EXTRACTED_ASSET'},\n                'downloading-psd'               : {event : baseEvent, subevent : 'DOWNLOADING_PSD'},\n                'psd-preview-canvas-clicked'    : {event : baseEvent, subevent : 'PSD_CANVAS_CLICKED'},\n                'psd-preview-canvas-clickdrag'  : {event : baseEvent, subevent : 'PSD_CANVAS_CLICKDRAG'},\n                'css-properties-doubleclick'    : {event : baseEvent, subevent : 'CSS_PROPERTIES_DOUBLECLICKED'},\n                'rendered'                      : {event : baseEvent, subevent : 'RENDERED'},\n                'layer-comp-shown'              : {event : baseEvent, subevent : 'LAYER_COMP_SHOWN'},\n                'layer-comp-changed'            : {event : baseEvent, subevent : 'LAYER_COMP_CHANGED'},\n                'show-vendor-prefixes'          : {event : baseEvent, subevent : 'SHOW_VENDOR_PREFIXES'},\n                'preprocessor-changed'          : {event : baseEvent, subevent : 'CSS_PREPROCESSOR_CHANGED'},\n                'catch-intercept'               : {event : baseEvent, subevent : 'CATCH_INTERCEPT'},\n                'base-font-size-changed'        : {event : baseEvent, subevent : 'BASE_FONT_SIZE_CHANGED'},\n                'preferred-font-units-changed'  : {event : baseEvent, subevent : 'PREFERRED_FONT_UNITS_CHANGED'},\n                'upload-psd-public-one-up'      : {event : baseEvent, subevent : 'UPLOAD_PSD_PUBLIC_ONE_UP'},\n                'load-calltoaction'             : {event : 'EDGE_EXTRACT_LANDING', subevent : 'CALLTOACTION_DIALOG'},\n                'landing-page'                  : {event : 'EDGE_EXTRACT_LANDING', subevent : 'LANDING_PAGE'},\n                'login-dialog-shown'            : {event : 'EDGE_EXTRACT_LANDING', subevent : 'LOGIN_DIALOG'},\n                'feature-flag-set'              : {event : 'EDGE_EXTRACT_NAVIGATION', subevent : 'FEATURE_FLAG_SET'},\n                'load-alert'                    : {event : 'EDGE_EXTRACT_NAVIGATION', subevent : 'ALERT_DIALOG'},\n                'logged-in'                     : {event : 'EDGE_EXTRACT_NAVIGATION', subevent : 'SIGNON_SSO'},\n                'upload-init'                   : {event : 'EDGE_EXTRACT_UPLOAD', subevent : 'INIT'},\n                'uploaded'                      : {event : 'EDGE_EXTRACT_UPLOAD', subevent : 'COMPLETE'},\n                'upload-failed'                 : {event : 'EDGE_EXTRACT_UPLOAD', subevent : 'FAILED'},\n                'processed'                     : {event : 'EDGE_EXTRACT_UPLOAD', subevent : 'PROCESSED'},\n                'processing-failed'             : {event : 'EDGE_EXTRACT_UPLOAD', subevent : 'PROCESSING_FAILED'},\n                'bad-file-type-dragdrop'        : {event : 'EDGE_EXTRACT_UPLOAD', subevent : 'BAD_FILE_TYPE_DRAGDROP'},\n                'help-dialog'                   : {event : 'EDGE_EXTRACT_HELP', subevent : 'HELP_DIALOG'},\n                'help-dialog-shortcut'          : {event : 'EDGE_EXTRACT_HELP', subevent : 'HELP_DIALOG_SHORTCUT'},\n                'first-user-overlay-shortcut'   : {event : 'EDGE_EXTRACT_HELP', subevent : 'FIRST_USER_OVERLAY_SHORTCUT'},\n                'show-job-list-overlay'         : {event : 'EDGE_EXTRACT_HELP', subevent : 'JOB_LIST_OVERLAY_SHORTCUT'}\n            };\n\n            eventInfo = eventMap[eventName];\n\n            function successCallback(resp) {\n                //console.log('trackEventOnServer: ' + JSON.stringify(resp || 'success'));\n            }\n\n            function errorCallback(resp) {\n                //console.log('trackEventOnServer: ' + JSON.stringify(resp || 'fail'));\n            }\n\n            if (eventInfo) {\n\n                var mergedParams = this.mergeParams(params);\n\n                // timestamp\n                if (!mergedParams.timestamp) {\n                    var currentDate = new Date();\n                    mergedParams.timestamp = currentDate.getTime();\n                }\n\n                // define firstUse parameter. In this case, it's if the timestamp - registerDate < 60 minutes (3600000 milliseconds)\n                mergedParams.firstUse = mergedParams.registerDate && (mergedParams.timestamp - mergedParams.registerDate < 3600000);\n\n                // subevent\n                mergedParams.subevent = eventInfo.subevent;\n\n                // eventname (subevent has already been embedded)\n                mergedParams.eventname = eventInfo.event;\n\n                // Now post our event\n                graphite.serverAPI.trackEvent(mergedParams, successCallback, errorCallback, this);\n            }\n\n        }\n    });\n\n    return MetricsProxyModel;\n});\n\n//# sourceURL=/lib/graphite-api/public/js/ccweb.files.extract/models/MetricsProxyModel.js"),eval('/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4, regexp: true */\n/*global define, brackets*/\ndefine(\'ext/Constants\',["module"], function (module) {\n    "use strict";\n    var ExtensionUtils = brackets.getModule("utils/ExtensionUtils");\n    \n    var Constants = {\n        CACHE_LOCATION: brackets.app.getApplicationSupportDirectory() + "/psd-lens/",\n        STATIC_CONTENT_LOCATION: ExtensionUtils.getModulePath(module) + "static-content/",\n\n        Routes: {\n            ASSET: "handleAsset",\n            AUTHLESS_ASSET: "handleAuthlessAsset",\n            FIRST_LAUNCH: "firstLaunch",\n            HIDE: "hidePanel",\n            FOLDER: "handleFolder"\n        },\n\n        States: {\n            STATIC_COMP: "static comp",\n            FILE_BROWSER: "file browser",\n            USER_COMP: "user comp",\n            CREATIVE_URL: "creative url"\n        },\n\n        Hint: {\n            COLOR: "color",\n            IMAGE: "image",\n            GRADIENT: "gradient",\n            OTHER: "other",\n            TEXT: "text",\n            SIZE: "size",\n            POSITION: "position"\n        },\n\n        RegExp: {\n            FILE_EXT: /\\.([a-z]+)$/i,\n            STRIP_VENDOR_PREFIX: /^(-[a-z]+-)?(.+)$/\n        },\n\n        GroupLayerExcludedProps: {"top" : 1, "left" : 1, "right" : 1,\n                                  "bottom" : 1, "width" : 1, "height" : 1,\n                                  "max-height" : 1, "max-width" : 1, "min-width" : 1,\n                                  "min-height" : 1},\n        \n        ThumbnailWidth: 230\n    };\n\n    return Constants;\n\n});\n\n//# sourceURL=/./Constants.js'),eval('/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013-2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4, bitwise: true, sub: true */\n/*global define: true, graphite: true, window: true, brackets: true*/\n\ndefine(\'override/models/BracketsMetricsProxyModel\',[\n    \'jquery\',\n    \'underscore\',\n    \'backbone\',\n    \'ccweb.files.extract/models/MetricsProxyModel\',\n    \'ext/Constants\',\n    \'ext/models/ExtensionMetadata\',\n    "ext/models/BracketsPreferencesModel"\n], function ($, _, Backbone, MetricsProxyModel, Constants, ExtensionMetadata, BracketsPreferencesModel) {\n    "use strict";\n\n    var WEBPA_PSDLENS_NOTAUTHORIZED = "WEBPA_PSDLENS_NOTAUTHORIZED",\n        WEBPA_PSDLENS_AUTHORIZED = "WEBPA_PSDLENS_AUTHORIZED",\n        WEBPA_PSDLENS_NAVIGATION = "WEBPA_PSDLENS_NAVIGATION",\n        WEBPA_PSDLENS_UPLOAD = "WEBPA_PSDLENS_UPLOAD",\n        WEBPA_PSDLENS_EXTRACT = "WEBPA_PSDLENS_EXTRACT",\n        WEBPA_PSDLENS_HELP = "WEBPA_PSDLENS_HELP";\n\n    var METRICS_FLUSH_INTERVAL_MINUTES = 5;\n\n    var BracketsMetricsProxyModel = MetricsProxyModel.extend({\n\n        defaults: {\n            metricsEnableComplete: false,\n            flushInterval: 0,\n            prefs: BracketsPreferencesModel.get("preferenceSystem"),\n            \n            // See MetricsProxyModel.initialize() for graphite event names\n            eventMap: {\n                // extract-for-brackets events\n                "install-complete"              : {},\n                "launch"                        : {},\n                "uninstall-complete"            : {},\n                "app-close"                     : {flush: true, flushAsync: false},\n                "project-open"                  : {},\n                "project-close"                 : {},\n                "hide-panel"                    : {},\n                "update-complete"               : {},\n                "ims-ready"                     : {handler: "imsReady"},\n                "expired-access-token"          : {},\n                "valid-access-token"            : {},\n                "missing-access-token"          : {},\n                "login-success"                 : {},\n                "login-cancel"                  : {},\n                "login-start"                   : {},\n                "logout-success"                : {},\n                "logout-failure"                : {},\n                "logout-attempted"              : {},\n                "browse"                        : {flush: true, flushAsync: true},\n                "browse-show-upload-files"      : {flush: true, flushAsync: true},\n                "layer-select"                  : {},\n                "css-hint-insert"               : {event: WEBPA_PSDLENS_EXTRACT},\n                "css-hint-show"                 : {},\n                "html-hint-insert"              : {event: WEBPA_PSDLENS_EXTRACT},\n                "html-hint-show"                : {},\n                "zoomChanged"                   : {subevent: "ZOOM_CHANGED"},\n                "layers-panel-toggle"           : {},\n                "layers-visibility-toggle"      : {},\n                "extract-asset-downloading"     : {event: WEBPA_PSDLENS_EXTRACT},\n                "extract-asset-downloaded"      : {event: WEBPA_PSDLENS_EXTRACT},\n                "extract-asset-canvas-fallback" : {event: WEBPA_PSDLENS_EXTRACT},\n                "extract-asset-canvas"          : {event: WEBPA_PSDLENS_EXTRACT},\n                "extract-asset-error"           : {event: WEBPA_PSDLENS_EXTRACT},\n                "how-to-dialog-opened"          : {},\n                "how-to-dialog-closed"          : {},\n                "first-launch-call-to-action"   : {},\n                "preferences-dialog-opened"     : {},\n                "preferences-dialog-closed"     : {},\n                "preference-changed"            : {},\n                "preview-rendition-finish"      : {},\n                "route-change"                  : {handler: "routeChange"},\n                "main-toolbar-expanded"         : {},\n                "main-toolbar-collapsed"        : {},\n                "tutorial-hide"                 : {},\n                "tutorial-select-layer"         : {},\n                "tutorial-code-hint"            : {},\n                "tutorial-measurement"          : {},\n                "tutorial-call-to-action"       : {},\n                // projectparfait events\n                "landing-page"                  : {event : WEBPA_PSDLENS_NOTAUTHORIZED},\n                "login-dialog-shown"            : {event : WEBPA_PSDLENS_NOTAUTHORIZED, subevent : "LOGIN_DIALOG"},\n                "upload-init"                   : {event : WEBPA_PSDLENS_UPLOAD, subevent : "INIT", handler : "uploadInit"},\n                "uploaded"                      : {event : WEBPA_PSDLENS_UPLOAD, subevent : "COMPLETE"},\n                "upload-failed"                 : {event : WEBPA_PSDLENS_UPLOAD, subevent : "FAILED"},\n                "processed"                     : {event : WEBPA_PSDLENS_UPLOAD},\n                "processing-failed"             : {event : WEBPA_PSDLENS_UPLOAD},\n                "drawPreviewStart"              : {subevent: "RENDER_START"},\n                "drawPreviewFinish"             : {handler : "drawPreviewFinish"},\n                "rendered"                      : {handler : false},\n                "selectedTab"                   : {subevent : "SELECTED_TAB"},\n                "help-dialog"                   : {},\n                "help-dialog-shortcut"          : {},\n                "first-user-overlay-shortcut"   : {},\n                "show-color-popup"              : {},\n                "show-measurement-offsets"      : {},\n                "copy-css"                      : {},\n                "copy-text"                     : {},\n                "copy-value"                    : {},\n                "color-format"                  : {},\n                "report-fidelity-error"         : {subevent : "FIDELITY_ERROR"},\n                "typekitSearch"                 : {subevent : "TYPEKIT_SEARCH"},\n                "extract-asset-download-init"   : {subevent : "ASSET_DOWNLOAD_INIT"},\n                "asset-extracted-scaled"        : {},\n                "canvasClick"                   : {subevent : "PSD_CANVAS_CLICKED"},\n                "canvasClickDrag"               : {subevent : "PSD_CANVAS_CLICKDRAG"},\n                // undefined "cssDoublClick" /*confirmed typo*/,                : {subevent : "CSS_PROPERTIES_DOUBLECLICKED"},\n                "register-defaults"             : {handler: "registerDefaults"},\n                "load-alert"                    : {event : WEBPA_PSDLENS_NAVIGATION, subevent : "ALERT_DIALOG", handler : "loadAlert"},\n                "load-calltoaction"             : {event : WEBPA_PSDLENS_NOTAUTHORIZED, subevent : "CALLTOACTION_DIALOG"},\n                "bad-file-type-dragdrop"        : {event : WEBPA_PSDLENS_UPLOAD},\n                "show-extract-asset-popup"      : {handler : "showExtractAssetPopup"},\n                "downloading-extracted-asset"   : {},\n                "featureFlagSet"                : {event : WEBPA_PSDLENS_NAVIGATION, subevent : "FEATURE_FLAG_SET"},\n                "layerCompShown"                : {subevent : "LAYER_COMP_SHOWN"},\n                "layerCompChanged"              : {handler: "layerCompChanged"},\n                "layer-comp-changed"            : {}, // See MetricsProxyModel.layerCompChanged()\n                "commitDropperColor"            : {subevent : "DROPPER_COLOR_EXTRACTED"},\n                "preprocessorChanged"           : {subevent : "CSS_PREPROCESSOR_CHANGED"},\n                "catchIntercept"                : {subevent : "CATCH_INTERCEPT"},\n                "baseFontSizeChanged"           : {subevent : "BASE_FONT_SIZE_CHANGED"},\n                "preferredFontUnitsChanged"     : {subevent : "PREFERRED_FONT_UNITS_CHANGED"},\n                "ccSubscriptionInfo"            : {}\n            }\n        },\n\n        initialize: function () {\n            var self = this;\n            \n            window.graphite = window.graphite || {};\n            window.graphite.events = window.graphite.events || _.extend({}, Backbone.Events);\n            \n            // Handle changes to metrics opt-out\n            var prefs = this.get("prefs");\n            prefs.getPreference(BracketsPreferencesModel.METRICS_ENABLED).on("change", function () {\n                self._updateMetricsEnabled();\n            });\n            \n            self._updateMetricsEnabled();\n\n            // Update default params when changed\n            prefs.getPreference(BracketsPreferencesModel.METRICS_DEFAULT_PARAMS).on("change", function () {\n                self._updateDefaultParams();\n            });\n\n            // Restore default params\n            this._updateDefaultParams();\n\n            ExtensionMetadata.on("change:version", function () {\n                self.setDefaultParam("extractExtensionVersion", ExtensionMetadata.get("version"));\n            });\n        },\n\n        _updateDefaultParams: function () {\n            var prefs = this.get("prefs");\n            this.defaultParams = prefs.get(BracketsPreferencesModel.METRICS_DEFAULT_PARAMS);\n        },\n\n        setDefaultParam: function (key, value) {\n            MetricsProxyModel.prototype.setDefaultParam.call(this, key, value);\n\n            // Save default params\n            var prefs = this.get("prefs");\n            prefs.set(BracketsPreferencesModel.METRICS_DEFAULT_PARAMS, this.defaultParams);\n        },\n        \n        _updateMetricsEnabled: function () {\n            var self = this,\n                eventMap = this.get("eventMap"),\n                prefs = this.get("prefs"),\n                metricsEnableComplete = this.get("metricsEnableComplete"),\n                isEnabled = prefs.get(BracketsPreferencesModel.METRICS_ENABLED);\n\n            if (isEnabled && !metricsEnableComplete) {\n                // Flush metrics at an interval\n                var flushInterval = window.setInterval(graphite.serverAPI.flushMetrics, METRICS_FLUSH_INTERVAL_MINUTES * 60 * 1000);\n                this.set("flushInterval", flushInterval);\n\n                Object.keys(eventMap).forEach(function (eventKey) {\n                    var info = eventMap[eventKey];\n\n                    // init default subevent names\n                    if (!info.subevent) {\n                        info.subevent = eventKey.toUpperCase().replace(/-/g, "_");\n                    }\n\n                    // look for custom event handler\n                    var handler = info.handler && self[info.handler];\n\n                    // handler=false implies a graphite event that does not exist\n                    if (handler !== false && (typeof handler !== "function")) {\n                        // use default handler\n                        handler = self._createEventHandler(eventKey);\n                    }\n\n                    if (handler) {\n                        info._handlerFn = handler;\n                        window.graphite.events.on(eventKey, handler, self);\n                    }\n                });\n            } else if (!isEnabled && metricsEnableComplete) {\n                // Flush metrics now\n                // Since metrics opt-out is a special case, the last metric\n                // that should be logged is preferences-dialog-opened\n                graphite.serverAPI.flushMetrics(true);\n                \n                // Remove timer\n                window.clearInterval(this.get("flushInterval"));\n                \n                Object.keys(eventMap).forEach(function (eventKey) {\n                    var info = eventMap[eventKey];\n                    window.graphite.events.off(eventKey, info._handlerFn);\n                });\n                \n                // clear cache\n                BracketsPreferencesModel.reset(BracketsPreferencesModel.MIXPANEL_PENDING_REQUESTS);\n                BracketsPreferencesModel.reset(BracketsPreferencesModel.MIXPANEL_BUFFER);\n            }\n            \n            this.set("metricsEnableComplete", isEnabled);\n        },\n\n        _createEventHandler: function (eventKey) {\n            return function (params) {\n                this.trackEvent(eventKey, params);\n            };\n        },\n\n        // Patch to remove PII assetID\n        drawPreviewFinish: function (psdModel) {\n            var currTime = Date.now();\n            var renditionDuration = currTime - psdModel.get("previewStarted");\n            var eventParams = {\n                renditionDuration: renditionDuration,\n                fileSize: psdModel.get("size")\n            };\n\n            //this.setDefaultParam(\'assetID\', psdModel.get("id"));\n            this.trackEvent("rendered", eventParams);\n        },\n        \n        imsReady: function (params) {\n            this.setDefaultParam("isOffline", false);\n            this.trackEvent("ims-ready", params);\n        },\n\n        // Override MetricsProxyModel\n        uploadInit: function (params) {\n            var self = this;\n            // Exclude filename\n            params.files.forEach(function () {\n                self.trackEvent(\'upload-init\');\n            });\n        },\n\n        // Override MetricsProxyModel\n        uploaded: function (params) {\n            // Remove PII\n            params.path = undefined;\n            params.fileName = undefined;\n\n            this.trackEvent(\'uploaded\', params);\n        },\n        \n        routeChange: function (route) {\n            var state;\n            \n            if (route === Constants.Routes.FIRST_LAUNCH) {\n                state = Constants.States.STATIC_COMP;\n            } else if (route === Constants.Routes.FOLDER) {\n                state = Constants.States.FILE_BROWSER;\n            } else if (route === Constants.Routes.ASSET) {\n                state = Constants.States.USER_COMP;\n            } else if (route === Constants.Routes.AUTHLESS_ASSET) {\n                state = Constants.States.CREATIVE_URL;\n            }\n            \n            // "tutorial" state is event-specific for\n            // how-to-dialog-opened and how-to-dialog-closed\n            \n            // "login dialog" state is event-specific for\n            // login-start, login-success, login-cancel\n            \n            if (state) {\n                this.setDefaultParam("state", state);\n            }\n        },\n\n        setConfigModel: function (model) {\n            MetricsProxyModel.prototype.setConfigModel.call(this, model);\n\n            this.setDefaultParam("bracketsVersion", brackets.metadata.version);\n            this.setDefaultParam("userAgent", window.navigator.userAgent);\n            this.setDefaultParam("state", "not launched");\n\n            // Remove PII $city\n            this.setDefaultParam("$city", "");\n            this.setDefaultParam("isOffline", "unknown");\n        },\n\n        trackEvent: function (eventName, eventParams) {\n            // Note, it should not be possible to enter this method when\n            // metrics are disabled. _updateMetricsEnabled() is setup to\n            // synchronously listen for changes to the METRICS_ENABLED pref.\n            // As a fail safe, we check the preference again here in case\n            // trackEvent() is called externally.\n            var prefs = this.get("prefs");\n            if (!prefs.get(BracketsPreferencesModel.METRICS_ENABLED)) {\n                return;\n            }\n\n            var baseEvent =  WEBPA_PSDLENS_NOTAUTHORIZED,\n                eventInfo,\n                params = eventParams || {},\n                internalUser = false,\n                isAuthValid = !!this.authModel.isValid(),\n                isPaidAccount = false,\n                state = this.defaultParams["state"];\n\n            // Verify the parameters can be serialized to JSON\n            try {\n                JSON.stringify(params);\n            } catch (err) {\n                console.error(err);\n                return;\n            }\n\n            // https://git.corp.adobe.com/jhagenst/brackets-parfait-extension/issues/804\n            // WEBPA_PSDLENS_AUTHORIZED now implies user comp or creative URL.\n            // Use isLoggedIn to determine if the user was authorized or not.\n            // WEBPA_PSDLENS_NOT_AUTHORIZED is only used during first launch.\n            if (state === Constants.States.USER_COMP ||\n                    state === Constants.States.CREATIVE_URL) {\n                baseEvent = WEBPA_PSDLENS_AUTHORIZED;\n            }\n\n            if (isAuthValid) {\n                // This should all be moved to something that registers them as defaults in the Metrics Controller once the user\'s Authm Model is returned and valid.\n                //attach the adobeID\n                // PII - disable for PSD Lens\n                //params.adobeID = this.authModel.getAdobeId();\n                //track whether the e-mail originates from adobe.com, adobetest.com & 601t.com\n                internalUser = this.authModel.isAdobeInternalUser();\n                // Get the user\'s register date\n                // PII - disable for PSD Lens\n                //registerDate = this.authModel.getRegisterDate();\n                // PII - disable for PSD Lens\n                //graphite.serverAPI.registerPersistentParameters({ internalUser: params.internalUser, registerDate: this.authModel.getRegisterDate() });\n                \n                isPaidAccount = this.authModel.isPaidAccount();\n            }\n\n            // FIXME don\'t compute internalUser and isAuthValid on every event\n            // Move into login-success?\n            // Set super properties\n            params.internalUser = internalUser;\n            params.isLoggedIn = isAuthValid;\n            params.isPaidAccount = isPaidAccount;\n\n            // Lookup event based on eventName subevent\n            eventInfo = this.get("eventMap")[eventName];\n\n            function successCallback(resp) {\n                //console.log("trackEventOnServer: " + JSON.stringify(resp || \'success\'));\n            }\n\n            function errorCallback(resp) {\n                //console.log("trackEventOnServer: " + JSON.stringify(resp || \'fail\'));\n            }\n\n            if (eventInfo) {\n                var mergedParams = this.mergeParams(params);\n\n                // timestamp\n                if (!mergedParams.timestamp) {\n                    var currentDate = new Date();\n                    mergedParams.timestamp = currentDate.getTime();\n                }\n\n                // TODO (jasonsj): firstUse as defined here doesn\'t seem approriate for PSD Lens\n                // define firstUse parameter. In this case, it\'s if the timestamp - registerDate < 60 minutes (3600000 milliseconds)\n                // mergedParams.firstUse = registerDate && (mergedParams.timestamp - mergedParams.registerDate < 3600000);\n\n                // subevent\n                mergedParams.subevent = eventInfo.subevent;\n\n                // eventname (subevent has already been embedded)\n                mergedParams.eventname = eventInfo.event || baseEvent;\n\n                // Now post our event\n                graphite.serverAPI.trackEvent(mergedParams, successCallback, errorCallback, this);\n\n                // Flush metrics\n                if (eventInfo.flush) {\n                    graphite.serverAPI.flushMetrics(eventInfo.flushAsync);\n                }\n            } else {\n                console.error("eventName \'" + eventName + "\' is undefined in eventMap");\n            }\n\n        }\n    });\n\n    return BracketsMetricsProxyModel;\n});\n\n//# sourceURL=/./models/BracketsMetricsProxyModel.js'),
eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4 */\n/*global define: true, graphite: true*/\n\ndefine('ccweb.files.extract/Constants',[], function () {\n    'use strict';\n    var Constants = {\n\n        DefaultPPI: 72,\n\n        BaseFontDefaultSize: 16,\n\n        FontUnitType: {\n            EMS: 'em',\n            REMS: 'rem',\n            PX: 'px'\n        },\n\n        ColorFormat: {\n            RGB: 'RGB',\n            HEX: 'Hex',\n            HSL: 'HSL'\n        },\n\n        MenuPosition: {\n            BELOW: '0',\n            TOP: '1'\n        },\n\n        MeasurementUnitType: {\n            PX: 'px',\n            PCT: '%'\n        },\n\n        Type: {\n            LAYER_GROUP: 'layerSection',\n            LAYER: 'layer',\n            LAYER_TEXT: 'textLayer',\n            LAYER_CONTENT: 'contentLayer',\n            LAYER_ADJUSTMENT: 'adjustmentLayer',\n            LAYER_BACKGROUND: 'backgroundLayer'\n        },\n\n        Shape: {\n            ELLIPSE: 'ellipse',\n            RECTANGLE: 'rectangle',\n            PATH: 'path'\n        },\n\n        ContentType: {\n            SOLID_COLOR: 'solidColorLayer'\n        },\n\n        NotificationTooltip: {\n            MIN_DURATION: 3000\n        },\n\n        Tool: {\n            SELECT_DIRECT: 0,\n            DROPPER: 1\n        },\n\n        Tab: {\n            TAB_INSPECT: 0,\n            TAB_LAYERS: 1\n        },\n\n        Shortcut: {\n            LEFT_ARROW: 37,\n            UP_ARROW: 38,\n            RIGHT_ARROW: 39,\n            DOWN_ARROW: 40,\n            HELP: 191,           // /? key\n            CLEAR: 27,           // ESC key\n            FUX: 73,             // i key\n            COLOR_PICKER: 69,    // E key\n            ALT: 18,              // ALT Key\n            SHIFT: 16,            // Shift\n            CTRL: 17,             // Control\n            CMD: 91,              // Command\n            SECONDARY_CMD: 93,    // Secondary (Right) Command\n            CMD_FF: 224,          // Firefox compatible Command\n            TOGGLE_MEASUREMENT: 88 // Measurement Key (x key)\n        },\n\n        Platform: {\n            MAC: 0,\n            WINDOWS: 1\n        },\n\n        topOffsetWithMessageBar: 70, //offset of psd header when message bar is present\n        toolTipTimeout : 2000,//2 seconds\n        flashTimeout : 2300, // 2.3 seconds\n\n        CCWEB_FILES_URL: 'https://creative.adobe.com/files',\n        CCWEB_FILES_URL_STAGE: 'https://stage.adobecc.com/files',\n        RE_SHORT_URL: /^http:\\/\\/adobe\\.ly\\/\\w+$/,\n\n        WorkerErrorCodes: {\n            UNSUPPORTED_INPUTFMT: 'unsupported_input_format_exception',\n            NOINPUTFILE: 'no_input_file_exception',\n            GRAPHITE_PROCESSING: 'graphite_processing_exception',\n            GRAPHITE_REJECTED: 'graphite_file_rejected'\n        },\n\n        WorkerErrorMsgs: {\n            UNSUPPORTED_INPUTFMT: 'Unsupported Image Format',\n            NOINPUTFILE: 'No files specified',\n            GR_JSONGENERATION: 'Graphite JSON generation failed.',\n            GR_THUMBNAIL: 'Graphite Thumbnail generation failed.',\n            GR_SPRITESHEET: 'Graphite Spritesheet generation failed.',\n            GR_UNKNOWNENCODING: 'Unspecified Encoding Format',\n            GR_MISSINGLAYERSPEC: 'Missing Layer Specification',\n            GR_CREATINGASSET: 'Error generating asset'\n        }\n    };\n\n    return Constants;\n});\n\n//# sourceURL=/lib/graphite-api/public/js/ccweb.files.extract/Constants.js"),eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4 */\n/*global define: true, localStorage: true*/\n\ndefine('ccweb.files.extract/models/UserSettingsModel',[\n    'jquery',\n    'underscore',\n    'ccweb.files.extract/Constants',\n    'backbone'\n], function ($, _, Constants, Backbone) {\n    'use strict';\n\n    var UserSettingsModel = Backbone.Model.extend({\n\n        defaults: {\n            preferredFontUnits: Constants.FontUnitType.PX,\n            preferredMeasurementUnits: Constants.MeasurementUnitType.PX,\n            preprocessor: 'css',\n            scaleExtractedAssets: false,\n            assetScaleFactor: 2,\n            shownIntercepts: {}\n        },\n\n        initialize: function () {\n            this.off('change', this.save, this);\n            var setting,\n                savedSettings,\n                serializedSettings = localStorage.getItem('extractUserSettings');\n            if (serializedSettings) {\n                savedSettings = JSON.parse(serializedSettings);\n                for (setting in savedSettings) {\n                    if (savedSettings.hasOwnProperty(setting)) {\n                        this.set(setting, savedSettings[setting]);\n                    }\n                }\n            } else {\n                this.reset();\n            }\n            this.on('change', this.save, this);\n\n        },\n\n        reset: function () {\n            this.off('change', this.save, this);\n            this.clear().set(this.defaults);\n            this.save();\n            this.on('change', this.save, this);\n        },\n\n        save: function () {\n            localStorage.setItem('extractUserSettings', JSON.stringify(this.attributes));\n        }\n\n    });\n\n    return new UserSettingsModel();\n});\n\n//# sourceURL=/lib/graphite-api/public/js/ccweb.files.extract/models/UserSettingsModel.js"),eval('/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4, bitwise: true */\n/*global define: true, graphite: true, Image: true, window: true*/\n\ndefine(\'controllers/DetailsController\',[\n    "jquery",\n    "underscore",\n    "backbone",\n    "ccweb.files.extract/Constants"\n], function ($, _, Backbone, Constants) {\n    "use strict";\n\n    // TODO Delete this monkey patch from vanilla_extract if possible?\n    var DetailsController = Backbone.Model.extend({\n\n        spriteSheets: {},\n        spritesLoaded: {},\n        psdModel: null,\n\n        defaults: {\n            selectedTab: Constants.Tab.TAB_INSPECT,\n            activeTool: Constants.Tool.SELECT_DIRECT,\n            selectedInspectItem: null, // color or font selected in inspect tab\n            inspectedAsset: null, // asset selected in inspect tab\n            toggleMeasurementOnHover: false\n        },\n\n\n        getPSDModel: function () {\n            return this.psdModel;\n        },\n\n\n        setPSDModel: function (model) {\n            this.psdModel = model;\n            // create new sprite sheet map when a new model is set\n            this.spriteSheets = {};\n            this.spritesLoaded = {};\n            this.spriteSheetLoadedEvent = null;\n\n        },\n\n\n        changeActiveTool: function (toolID) {\n            this.set("activeTool", toolID);\n        },\n\n\n        setSelectedTab: function (tab) {\n            this.set("selectedTab", tab);\n        },\n\n\n        setSelectedInspectItem: function (model) {\n            this.set("selectedInspectItem", model);\n        },\n\n\n        setInspectedAsset: function (assetModel) {\n            this.set("inspectedAsset", assetModel);\n        },\n\n        setToggleMeasurementOnHover: function () {\n            this.set("toggleMeasurementOnHover", !this.toggleMeasurementOnHover);\n            this.toggleMeasurementOnHover = !this.toggleMeasurementOnHover;\n        },\n\n        disableMeasurementOnHover: function () {\n            if (this.get("toggleMeasurementOnHover")) {\n                this.setToggleMeasurementOnHover();\n                graphite.events.trigger("toggle-hover-measurement");\n            }\n        },\n        \n        handleImageLoad: function (image, self, sheetID) {\n            self.spritesLoaded[sheetID] = true;\n            image.drawWhenFinished.forEach(function (data) {\n                data(image);\n            });\n            if (self.spriteSheetsLoaded()) {\n                self.triggerSpriteSheetLoadedEvent();\n            }\n        },\n\n        drawSpriteSheet: function (sheetID, drawFunc, context) {\n            var image = this.spriteSheets[sheetID],\n                that = this,\n                localContent = this.psdModel.get(\'localContent\');\n            \n            if (image !== undefined && image !== null) {\n                if (this.spritesLoaded[sheetID]) {\n                    // Draw sprite sheet\n                    drawFunc(image);\n                } else {\n                    // put this on the list of things to draw\n                    image.drawWhenFinished.push(drawFunc);\n                }\n            } else {\n                image = new Image();\n                graphite.serverAPI.applyCrossDomainPolicy(image);\n                this.spriteSheets[sheetID] = image;\n                image.drawWhenFinished = [drawFunc];\n                \n                if (localContent) {\n                    var imgurl = "file://" + localContent.directory + \'/spritesheet/\' + sheetID + \'.png\';\n                    image.src = imgurl;\n                } else {\n                    // Depending on wether the spritesheet API call to ImagService \n                    // uses the directive "disposition: location" we have to load\n                    // the spreitesheets differently. \n                    if (this.psdModel.get("pngLocations")) {\n                        // This is used when "disposition: location" is used: \n                        // spriteshets are loaded separately  and in parallel from StorageService\n                        var spriteUrl = this.getSpriteSheetURL(this.psdModel.get("pngLocations")[sheetID - 1]);\n\n                        graphite.serverAPI.getAssetFromUrl(spriteUrl,\n                            function (imgurl) {\n                                image.src = imgurl;\n                            },\n                            this.psdModel\n                            );\n                    } else {\n                        // This is used when "disposition: location" is NOT used: \n                        // spriteshets are sent with the spritesheet response and \n                        // are attached to the PSD model when parsing the response\n                        image.src = that.psdModel.get("sheet" + sheetID);\n                    }\n                }\n\n                image.addEventListener("load", function () {\n                    that.handleImageLoad(image, that, sheetID);\n                });\n                this.spritesLoaded[sheetID] = false;\n            }\n        },\n\n        getSpriteSheetURL: function (location) {\n            return graphite.serverAPI.getSpriteSheetURL(location);\n        },\n\n        triggerWhenSpriteSheetsLoaded: function (eventName) {\n            this.spriteSheetLoadedEvent = eventName;\n            if (this.spriteSheetsLoaded()) {\n                this.triggerSpriteSheetLoadedEvent();\n            }\n        },\n\n        triggerSpriteSheetLoadedEvent: function () {\n            $(\'.preview-loading-spinner\').remove();\n            graphite.events.trigger("hideWorkerProgress", -1);\n            var eventName = this.spriteSheetLoadedEvent;\n            this.spriteSheetLoadedEvent = null;\n            if (eventName) {\n                graphite.events.trigger(eventName, this.psdModel);\n            }\n        },\n\n        spriteSheetsLoaded: function () {\n            // ccweb plugin uses img.complete because they assign img.src as a\n            // URL to load. With Image Service, we load images via a dataURI.\n            return _.every(this.spritesLoaded, function (isLoaded) {\n                return isLoaded;\n            });\n        }\n\n    });\n\n    return new DetailsController();\n\n});\n//# sourceURL=/lib/graphite-api/public/js/controllers/DetailsController.js'),eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4 */\n/*global define: true*/\n\ndefine('ccweb.files.extract/models/PSDSettingsModel',[\n    'jquery',\n    'underscore',\n    'ccweb.files.extract/Constants',\n    'backbone'\n], function ($, _, Constants, Backbone) {\n    'use strict';\n\n    var PSDSettingsModel = Backbone.Model.extend({\n\n        defaults: {\n            baseFontSize: Constants.BaseFontDefaultSize,\n            baseFontSizeUnits: Constants.FontUnitType.PX\n        },\n\n        initialize: function () {\n            this.reset();\n        },\n\n        reset: function () {\n            this.clear().set(this.defaults);\n        }\n\n    });\n\n    return new PSDSettingsModel();\n});\n\n//# sourceURL=/lib/graphite-api/public/js/ccweb.files.extract/models/PSDSettingsModel.js"),eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4, bitwise: true */\n/*global define: true, graphite: true, regexp: true*/\n\ndefine('ccweb.files.extract/utils/CSSUtil',['jquery',\n        'underscore',\n        'plugin-dependencies',\n        'ccweb.files.extract/models/PSDSettingsModel',\n        'ccweb.files.extract/models/UserSettingsModel',\n        'ccweb.files.extract/Constants'\n       ], function ($, _, deps, PSDSettingsModel, UserSettingsModel, Constants) {\n    'use strict';\n    var CSSUtil = {\n        cssPreprocessors: {\n            css: {\n                displayName: 'CSS',\n                formatString: function (property, value) {\n                    return property + ': ' + CSSUtil.formatCSSValue(property, value) + ';';\n                },\n                listItem: function (cssObj) {\n                    if (cssObj.spacer) {\n                        return CSSUtil.getSpacer(cssObj);\n                    }\n\n                    switch (cssObj.property) {\n                    case 'background-color':\n                    case 'color':\n                    case 'border-color':\n                        return '<span class=\"property\">' + cssObj.property + ': </span><span class=\"color-chip\" style=\"background-color: ' + cssObj.value + ';\"></span> <span class=\"value\">' + cssObj.value + ';</span>';\n                    default:\n                        return '<span class=\"property\">' + cssObj.property + ': </span> <span class=\"value\">' + cssObj.value + ';</span>';\n                    }\n                }\n            },\n\n            scssBourbon: {\n                displayName: 'SCSS+Bourbon',\n                formatString: function (property, value) {\n                    switch (property) {\n                    case 'background':\n                        return '@include ' + property + '(' + value + ');';\n                    default:\n                        return CSSUtil.cssPreprocessors.css.formatString(property, value);\n                    }\n                },\n                listItem: function (cssObj) {\n                    switch (cssObj.property) {\n                    case 'background':\n                        return '<span class=\"value\">@include</span> <span class=\"property\">' + cssObj.property + '</span> <span class=\"value\">(' + cssObj.value + ');</span>';\n                    default:\n                        return CSSUtil.cssPreprocessors.css.listItem(cssObj);\n                    }\n                }\n            },\n\n            sassCompass: {\n                enabled: !deps.parfait,\n                displayName: 'SCSS+Compass',\n                formatString: function (property, value) {\n                    switch (property) {\n                    case 'background':\n                        return '@include ' + property + '(' + value + ')';\n                    default:\n                        return property + ': ' + CSSUtil.formatCSSValue(property, value);\n                    }\n                },\n                listItem: function (cssObj) {\n                    if (cssObj.spacer) {\n                        return CSSUtil.getSpacer(cssObj);\n                    }\n\n                    switch (cssObj.property) {\n                    case 'background':\n                        return '<span class=\"value\">@include</span> <span class=\"property\">' + cssObj.property + '</span> <span class=\"value\">(' + cssObj.value + ')</span>';\n                    case 'background-color':\n                    case 'color':\n                    case 'border-color':\n                        return '<span class=\"property\">' + cssObj.property + ': </span><span class=\"color-chip\" style=\"background-color: ' + cssObj.value + '\"></span> <span class=\"value\">' + cssObj.value + '</span>';\n                    default:\n                        return '<span class=\"property\">' + cssObj.property + ': </span> <span class=\"value\">' + cssObj.value + '</span>';\n                    }\n                }\n            },\n\n            stylusNib: {\n                enabled: !deps.parfait,\n                displayName: 'Stylus+Nib',\n                formatString: function (property, value) {\n                    return property + ' ' + CSSUtil.formatCSSValue(property, value);\n                },\n                listItem: function (cssObj) {\n                    if (cssObj.spacer) {\n                        return CSSUtil.getSpacer(cssObj);\n                    }\n\n                    switch (cssObj.property) {\n                    case 'background':\n                        return '<span class=\"property\">' + cssObj.property + '</span> <span class=\"value\">' + cssObj.value + '</span>';\n                    case 'background-color':\n                    case 'color':\n                    case 'border-color':\n                        return '<span class=\"property\">' + cssObj.property + ' </span><span class=\"color-chip\" style=\"background-color: ' + cssObj.value + '\"></span> <span class=\"value\">' + cssObj.value + '</span>';\n                    default:\n                        return '<span class=\"property\">' + cssObj.property + ' </span> <span class=\"value\">' + cssObj.value + '</span>';\n                    }\n                }\n            },\n\n            lessHat: {\n                enabled: true,\n                displayName: 'LESS+Hat',\n                formatString: function (property, value) {\n                    switch (property) {\n                    case 'background':\n                        return '.background-image(' + value + ');';\n                    default:\n                        return CSSUtil.cssPreprocessors.css.formatString(property, value);\n                    }\n                },\n                listItem: function (cssObj) {\n                    switch (cssObj.property) {\n                    case 'background':\n                        return '<span class=\"property\">.background-image</span><span class=\"value\">(' + cssObj.value + ');</span>';\n                    default:\n                        return CSSUtil.cssPreprocessors.css.listItem(cssObj);\n                    }\n                }\n            }\n        },\n\n        getSpacer: function (cssObj) {\n            var spacer = '<br/>';\n            if (cssObj.label.length) {\n                spacer += '<span class=\"property\">' + cssObj.label + '</span>';\n            }\n            return spacer;\n        },\n\n        applyCSS: function (element, model, prefixed) {\n            var css = model.getCSS(prefixed);\n\n            if (css) {\n                _.each(css, function (style) {\n                    $(element).css(style.property, style.value);\n                });\n            }\n        },\n\n        formatCSSString: function (property, value, preProcessor) {\n            preProcessor = preProcessor || 'css';\n            return this.cssPreprocessors[preProcessor].formatString(property, value);\n        },\n\n        formatCSSValue: function (property, value) {\n            var retStr = value ? value.toString().trim() : '';\n            if (property === 'font-family' && retStr.indexOf(' ') !== -1 && retStr.indexOf('\\'') !== 0 && retStr.lastIndexOf('\\'') !== retStr.length - 1) {\n                retStr = '\\'' + value + '\\'';\n            }\n            return retStr;\n        },\n\n        getDefaultColorString: function (r, g, b, a) {\n            var colorStr;\n\n            if (a !== null && a !== undefined && a !== 1) {\n                colorStr = 'rgba(' + Math.round(r) + ', ' + Math.round(g) + ', ' + Math.round(b) + ', ' + a + ')';\n            } else {\n                colorStr = this.rgbToHEX(r, g, b);\n            }\n\n            return colorStr;\n\n        },\n\n        rgbToHEX: function (r, g, b) {\n            return '#' + ((1 << 24) + (Math.round(r) << 16) + (Math.round(g) << 8) + Math.round(b)).toString(16).slice(1);\n        },\n\n        rgbaToHSL: function (r, g, b, a) {\n            if (a === null || a === undefined) {\n                a = 1;\n            }\n\n            var hsl = '';\n            var normR, normG, normB;\n            normR = r / 255;\n            normG = g / 255;\n            normB = b / 255;\n            var max = Math.max(normR, normG, normB), min = Math.min(normR, normG, normB);\n            var h, s, l = (max + min) / 2;\n\n            if (max === min) {\n                h = s = 0; // achromatic\n            } else {\n                var d = max - min;\n                s = l > 0.5 ? d / (2 - max - min) : d / (max + min);\n                switch (max) {\n                case normR:\n                    h = 60 * (normG - normB) / d;\n                    break;\n                case normG:\n                    h = 60 * (normB - normR) / d + 120;\n                    break;\n                case normB:\n                    h = 60 * (normR - normG) / d + 240;\n                    break;\n                }\n            }\n\n            h = Math.round(h + 360) % 360;\n            s = Math.round(s * 100);\n            l = Math.round(l * 100);\n\n            if (a === 1) {\n                hsl = 'hsl(' + h + ', ' + s + '%, ' + l + '%)';\n            } else {\n                hsl = 'hsla(' + h + ', ' + s + '%, ' + l + '%, ' + parseFloat(a) + ')';\n            }\n            return hsl;\n        },\n\n        // font-weight conversion based on http://help.typekit.com/customer/portal/articles/6855-using-multiple-weights-and-styles\n        // and http://www.webtype.com/info/articles/fonts-weights/\n        fontStyleNameToCSS: function (fontStyleName) {\n            var cssArray = [];\n            var styleName = fontStyleName.toLowerCase();\n            if (styleName.indexOf('regular') !== -1 || styleName.indexOf('normal') !== -1) {\n                cssArray.push({property: 'font-weight', value: '400'});\n            } else if (styleName.indexOf('thin') !== -1) {\n                cssArray.push({property: 'font-weight', value: '100'});\n            } else if (styleName.indexOf('light') !== -1) {\n                if (styleName.indexOf('extra light') !== -1 || styleName.indexOf('extralight') !== -1 ||\n                        styleName.indexOf('ultra light') !== -1 || styleName.indexOf('ultralight') !== -1) {\n                    cssArray.push({property: 'font-weight', value: '200'});\n                } else {\n                    cssArray.push({property: 'font-weight', value: '300'});\n                }\n            } else if (styleName.indexOf('book') !== -1 || styleName.indexOf('demi') !== -1) {\n                if (styleName.indexOf('demibold') !== -1) {\n                    cssArray.push({property: 'font-weight', value: '600'});\n                } else {\n                    cssArray.push({property: 'font-weight', value: '300'});\n                }\n            } else if (styleName.indexOf('medium') !== -1) {\n                cssArray.push({property: 'font-weight', value: '500'});\n            } else if (styleName.indexOf('semibold') !== -1) {\n                cssArray.push({property: 'font-weight', value: '600'});\n            } else if (styleName.indexOf('bold') !== -1) {\n                cssArray.push({property: 'font-weight', value: '700'});\n            } else if (styleName.indexOf('heavy') !== -1) {\n                cssArray.push({property: 'font-weight', value: '800'});\n            } else if (styleName.indexOf('black') !== -1) {\n                cssArray.push({property: 'font-weight', value: '900'});\n            }\n\n            if (fontStyleName.indexOf('Italic') !== -1) {\n                cssArray.push({property: 'font-style', value: 'italic'});\n            }\n\n            return cssArray;\n        },\n\n        hasWhiteSpace: function (str) {\n            return str.indexOf(' ') >= 0;\n        },\n\n        _camelCapsToSpaces: function (value) {\n            return value.replace(/([A-Z]+)/g, ' $1').replace(/([A-Z][a-z])/g, ' $1').replace(/\\s+/g, ' ').trim();\n        },\n\n        getFontInfo: function (textStyle) {\n            var fontInfo = {},\n                postscriptName,\n                dashIndex,\n                fontFamily = textStyle.fontName,\n                friendlyName = fontFamily,\n                fontFace = 'Regular';\n\n            fontInfo.coolTypeResolved = textStyle.cooltypeFontResolved;\n\n            if (textStyle.hasOwnProperty('fontStyleName')) {\n                fontFace = textStyle.fontStyleName;\n            }\n\n            // Resolve friendly name.\n            if (!fontInfo.coolTypeResolved) {\n                postscriptName = textStyle.postscriptFontName;\n                dashIndex = postscriptName.indexOf('-');\n                if (dashIndex !== -1) {\n                    fontFamily = postscriptName.substring(0, dashIndex);\n                    fontFace = postscriptName.substring(dashIndex + 1, postscriptName.length);\n                } else {\n                    fontFamily = postscriptName;\n                }\n                friendlyName = this._camelCapsToSpaces(fontFamily);\n            } else if (fontFamily) {\n                friendlyName = this._camelCapsToSpaces(fontFamily);\n            }\n\n            fontInfo.fontName = fontFamily;\n            fontInfo.fontFace = fontFace;\n            fontInfo.friendlyName = friendlyName;\n\n            var fontSize = this.parseCSSMeasure(textStyle.size);\n            fontSize.val = +(parseFloat(fontSize.val).toFixed(2));\n            fontInfo.size = fontSize.val + (fontSize.units || '');\n\n            return fontInfo;\n        },\n\n        parseCSSMeasure: function (s) {\n            var retVal = {val: s},\n                defaultUnits = PSDSettingsModel.get('baseFontSizeUnits');\n\n            if (defaultUnits) {\n                retVal.units = defaultUnits;\n            }\n\n            if (typeof s === 'string') {\n                var matches = s.match(/([+\\-]?[\\d\\.]*)\\s?([a-zA-Z%]+)/);\n                if (matches) {\n                    retVal.val = matches[1];\n                }\n            }\n\n            return retVal;\n        },\n\n        strokeToCSS: function (shapeObj, opacity) {\n            var cssArray = [];\n            var stroke = shapeObj.stroke;\n            if (opacity === null || opacity === undefined) {\n                opacity = 1;\n            }\n\n            if (shapeObj.type !== Constants.Shape.ELLIPSE && shapeObj.type !== Constants.Shape.RECTANGLE) {\n                if (shapeObj.bottomLeftRadius || shapeObj.bottomRightRadius ||\n                        shapeObj.topLeftRadius || shapeObj.topRightRadius) {\n                    cssArray = this.getBorderRadiusCSS(shapeObj.bottomLeftRadius, shapeObj.bottomRightRadius,\n                        shapeObj.topLeftRadius, shapeObj.topRightRadius);\n                }\n            }\n\n            if (stroke) {\n                if (stroke.strokeStyleLineWidth) {\n                    var metrics = this.parseCSSMeasure(stroke.strokeStyleLineWidth, 'px'); // WAG, same behavior as before we had units\n                    if (metrics.units === 'pt' && stroke.strokeStyleResolution) {\n                        // Winsha wanted always pixels\n                        metrics.units = 'px';\n                        metrics.val = metrics.val * stroke.strokeStyleResolution / Constants.DefaultPPI;\n                    }\n                    cssArray.push({property: 'border-width', value: metrics.val + metrics.units});\n                }\n\n                if (stroke.strokeStyleContent) {\n                    var strokeContent = stroke.strokeStyleContent;\n                    var color = strokeContent.color;\n                    var alpha = +(opacity * stroke.strokeStyleOpacity / 100).toFixed(2);\n\n                    if (strokeContent['class'] === Constants.ContentType.SOLID_COLOR && color) {\n                        cssArray.push({\n                            property: 'border-color',\n                            value: this.getDefaultColorString(color.red, color.green, color.blue, alpha)\n                        });\n                    }\n                }\n\n                if (stroke.strokeStyleLineDashSet) {\n                    var dashSet = stroke.strokeStyleLineDashSet;\n\n                    if (dashSet.length === 0) {\n                        cssArray.push({property: 'border-style', value: 'solid'});\n                    } else if (dashSet.length === 2) {\n                        if (this.parseCSSMeasure(dashSet[0]).val === 0) {\n                            cssArray.push({property: 'border-style', value: 'dotted'});\n                        } else {\n                            cssArray.push({property: 'border-style', value: 'dashed'});\n                        }\n                    }\n                }\n            }\n\n            return cssArray;\n        },\n\n        getShadowCSS: function (layerType, shadow) {\n            var cssObj = {}, hShadow, vShadow, color, blur, matte, spread;\n\n            if (layerType === Constants.Type.LAYER_TEXT) {\n                cssObj.property = 'text-shadow';\n            } else {\n                // currently defaulting to box-shadow\n                //we may also want to support filter: drop-shadow() for shapes and images\n                cssObj.property = 'box-shadow';\n            }\n\n            blur = (shadow.blur === undefined || shadow.blur === null) ? 5 : shadow.blur;\n            matte = shadow.chokeMatte || 0;\n            spread = (blur * matte / 100).toFixed(2);\n\n            hShadow = Math.round(-shadow.distance * Math.cos(this.degreesToRadians(shadow.localLightingAngle)));\n            vShadow = Math.round(shadow.distance * Math.sin(this.degreesToRadians(shadow.localLightingAngle)));\n            color = shadow.color;\n\n            cssObj.value = hShadow + 'px ' + vShadow + 'px';\n            cssObj.value += ' ' + (+(blur - spread).toFixed(2)) + 'px';\n\n            if (layerType !== Constants.Type.LAYER_TEXT) {\n                cssObj.value += ' ' + spread + 'px';\n            }\n\n            if (color) {\n                cssObj.value += ' ' + this.getDefaultColorString(color.red, color.green, color.blue, shadow.opacity / 100);\n            }\n            return cssObj;\n        },\n\n        degreesToRadians: function (degrees) {\n            return (Math.PI / 180) * degrees;\n        },\n\n        getBorderRadiusCSS: function (bottomLeft, bottomRight, topLeft, topRight) {\n            var cssArray = [];\n            if (bottomLeft && bottomLeft === bottomRight && topLeft === topRight && bottomLeft === topLeft) {\n                cssArray.push({property: 'border-radius', value: bottomLeft + 'px'});\n            } else {\n                if (bottomLeft) {\n                    cssArray.push({property: 'border-bottom-left-radius', value: bottomLeft + 'px'});\n                }\n                if (bottomRight) {\n                    cssArray.push({property: 'border-bottom-right-radius', value: bottomRight + 'px'});\n                }\n                if (topLeft) {\n                    cssArray.push({property: 'border-top-left-radius', value: topLeft + 'px'});\n                }\n                if (topRight) {\n                    cssArray.push({property: 'border-top-right-radius', value: topRight + 'px'});\n                }\n            }\n            return cssArray;\n        },\n\n        addCSS: function (cssArray, cssObj) {\n            cssArray.push(cssObj);\n        },\n\n        applyPrefixedStyle: function ($elem, styleName, value) {\n            var styleObj = {};\n            styleObj[styleName] = value;\n            styleObj['-moz-' + styleName] = value;\n            styleObj['-webkit-' + styleName] = value;\n            styleObj['-o-' + styleName] = value;\n            styleObj['-ms-' + styleName] = value;\n            $elem.css(styleObj);\n        },\n        \n        getCSSTransform: function (psdTransform) {\n            // Check for simple scale first\n            if (psdTransform.xy === 0 && psdTransform.yx === 0){\n                if (psdTransform.xx === 1) {\n                    if (psdTransform.yy === 1) {\n                        return '';\n                    } else {\n                        return 'scaleY(' + (+psdTransform.yy.toFixed(3)) + ')';\n                    }\n                } else if (psdTransform.yy === 1) {\n                    return 'scaleX(' + (+psdTransform.xx.toFixed(3)) + ')';\n                } else {\n                    return 'scale(' + (+psdTransform.xx.toFixed(3)) + ',' + (+psdTransform.yy.toFixed(3)) + ')';\n                }\n            }\n            return 'matrix(' + [+psdTransform.xx.toFixed(3), +psdTransform.xy.toFixed(3), +psdTransform.yx.toFixed(3), +psdTransform.yy.toFixed(3), 0, 0] + ')';\n        },\n\n        findModelResolution: function (model) {\n            if (model.get('imgdata')) {\n                return model.get('imgdata').pixelsPerInch || Constants.DefaultPPI;\n            }\n\n            if (model.get('parentModel')) {\n                return this.findModelResolution(model.get('parentModel'));\n            }\n\n            return Constants.DefaultPPI;\n        },\n\n        /* This function accepts a value to convert to the preferred unit type the user has chosen and\n           which is stored in the user settings model.\n\n           If present, the units in the incoming value are ignored because they are assumed to be in points\n           because that is what comes from the graphite JSON. We treat those points as either pixels or points\n           based on what the user has chosen for the Base Font Size for this PSD and we perform the conversion\n           from either points or pixels to the preferred unit type.\n         */\n        convertPSDUnitsToPreferredUnits: function (value, includeUnitInOutput) {\n            var parsedValue,\n                parsedNum,\n                baseFontSizeValue = PSDSettingsModel.get('baseFontSizeValue'),\n                baseFontSizeUnits = PSDSettingsModel.get('baseFontSizeUnits'),\n                preferredUnits = UserSettingsModel.get('preferredFontUnits');\n\n            if (typeof value === 'string') {\n                parsedValue = this.parseCSSMeasure(value, baseFontSizeUnits);\n            } else if (typeof value === 'number') {\n                parsedValue = {\n                    val: value,\n                    units: Constants.FontUnitType.PX\n                };\n            } else if (value.hasOwnProperty('val')) {\n                parsedValue = {\n                    val: value.val,\n                    units: value.units || baseFontSizeUnits\n                };\n            } else {\n                return '';\n            }\n\n            switch (baseFontSizeUnits) {\n                case Constants.FontUnitType.PX:\n                    if ((preferredUnits === Constants.FontUnitType.EMS) || (preferredUnits === Constants.FontUnitType.REMS)) {\n                        //Convert PX to EMS/REMS\n                        parsedValue.val = parsedValue.val / baseFontSizeValue;\n                    }\n                    parsedValue.units = preferredUnits;\n                    break;\n            }\n\n            parsedNum = +parseFloat(parsedValue.val).toFixed(2);\n            return includeUnitInOutput ? parsedNum + parsedValue.units : parsedNum;\n        }\n\n    };\n\n    return CSSUtil;\n\n});\n\n//# sourceURL=/lib/graphite-api/public/js/ccweb.files.extract/utils/CSSUtil.js"),
eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4 */\n/*global define: true, graphite: true*/\n\ndefine('ccweb.files.extract/controllers/ZoomController',[\n    'jquery',\n    'underscore',\n    'backbone',\n    'ccweb.files.extract/utils/CSSUtil'\n], function ($, _, Backbone, CSSUtil) {\n    'use strict';\n\n    var ZoomController = {\n\n        level: 1.0,\n\n        setZoomLevel: function (level) {\n            level = level > 32 ? 32 : level;\n            this.level = level;\n            graphite.events.trigger('zoomChanged');\n        },\n\n        getZoomLevel: function () {\n            return this.level;\n        },\n\n        getZoomPercent: function () {\n            return parseFloat((100.0 * this.level).toFixed(2)) + '%';\n        },\n\n        zoomPoint: function (point, invert) {\n            var factor = invert ? 1 / this.level : this.level;\n            return {\n                x: point.x * factor,\n                y: point.y * factor\n            };\n        },\n\n        zoomSize: function (size, invert) {\n            var factor = invert ? 1 / this.level : this.level;\n            return {\n                width: size.width * factor,\n                height: size.height * factor\n            };\n        },\n\n        zoomRect: function (bounds, invert) {\n            var factor = invert ? 1 / this.level : this.level;\n            return {\n                top: bounds.top * factor,\n                left: bounds.left * factor,\n                bottom: bounds.bottom * factor,\n                right: bounds.right * factor\n            };\n        },\n\n        zoomIn: function () {\n            var zoom = this.level,\n                nextStop;\n            if (zoom < 0.25) {\n                nextStop = 0.25;\n            } else if (zoom < 0.33) {\n                nextStop = 0.33;\n            } else if (zoom < 0.5) {\n                nextStop = 0.5;\n            } else if (zoom < 0.66) {\n                nextStop = 0.66;\n            } else if (zoom < 1) {\n                nextStop = 1;\n            } else {\n                nextStop = parseInt(zoom + 1, 10);\n            }\n            this.setZoomLevel(nextStop);\n        },\n\n        zoomOut: function () {\n            var zoom = this.level,\n                nextStop;\n            if (zoom <= 0.25) {\n                nextStop = 0.10;\n            } else if (zoom <= 0.33) {\n                nextStop = 0.25;\n            } else if (zoom <= 0.5) {\n                nextStop = 0.33;\n            } else if (zoom <= 0.66) {\n                nextStop = 0.5;\n            } else if (zoom <= 1) {\n                nextStop = 0.66;\n            } else {\n                nextStop = parseInt(zoom - 1, 10);\n            }\n\n            this.setZoomLevel(nextStop);\n        },\n\n        zoomElementScale: function ($elem) {\n            CSSUtil.applyPrefixedStyle($elem, 'transform', 'scale(' + this.level + ')');\n            CSSUtil.applyPrefixedStyle($elem, 'transform-origin', '0 0');\n        },\n\n        zoomElementSize: function ($elem, size) {\n            var scaledSize = this.zoomSize(size);\n            $elem.css({\n                width: scaledSize.width + 'px',\n                height: scaledSize.height + 'px'\n            });\n        },\n\n        reset: function () {\n            this.level = 1.0;\n        }\n    };\n\n    return ZoomController;\n});\n\n//# sourceURL=/lib/graphite-api/public/js/ccweb.files.extract/controllers/ZoomController.js"),eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4, bitwise: true */\n/*global define: true, graphite: true*/\n\ndefine('ccweb.files.extract/collections/SubLayerCollection',['backbone'], function (Backbone) {\n    'use strict';\n    var SubLayerCollection = Backbone.Collection.extend({\n        model: null,\n\n        /* pass in the layerModel here, as this eliminates a circular dependency in Require.js; with this\n            module losing out on the LayerModel module (it's passed in as undefined). */\n        initialize: function (layerModel) {\n            this.model = layerModel;\n        }\n\n    });\n\n    return SubLayerCollection;\n});\n\n\n//# sourceURL=/lib/graphite-api/public/js/ccweb.files.extract/collections/SubLayerCollection.js"),eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4, bitwise: true */\n/*global define: true, graphite: true*/\n\ndefine('ccweb.files.extract/models/ColorModel',[\n    'underscore',\n    'backbone',\n    'ccweb.files.extract/utils/CSSUtil'\n], function (_, Backbone, CSSUtil) {\n    'use strict';\n    var ColorModel = Backbone.Model.extend({\n\n        defaults: {\n            red: '',\n            green: '',\n            blue: '',\n            alpha: 1.0\n        },\n\n        parse: function (response) {\n            var result = {};\n            result.red = Math.round(response.red);\n            result.green = Math.round(response.green);\n            result.blue = Math.round(response.blue);\n\n            return result;\n        },\n\n        isEqual: function (color, compareAlpha) {\n            var equal = color && color instanceof ColorModel &&\n                this.get('red') === color.get('red') &&\n                this.get('green') === color.get('green') &&\n                this.get('blue') === color.get('blue');\n\n            // by default don't compare alpha\n            if (compareAlpha) {\n                equal = equal && this.get('alpha') === color.get('alpha');\n            }\n\n            return equal;\n        },\n\n        toRGBString: function (alpha) {\n            var rgb = '(' + this.get('red') + ', ' + this.get('green') + ', ' + this.get('blue');\n            var colorString = '';\n            if (alpha === 1 || alpha === null || alpha === undefined) {\n                colorString = 'rgb' + rgb + ')';\n            } else {\n                colorString = 'rgba' + rgb + ', ' + parseFloat(alpha) + ')';\n            }\n            return colorString;\n        },\n\n        toHEXString: function (alpha) {\n            if (alpha === null || alpha === undefined) {\n                alpha = 1;\n            }\n\n            var hex = CSSUtil.rgbToHEX(this.get('red'), this.get('green'), this.get('blue'));\n            var opacity = '';\n\n            if (!(alpha === 1 || alpha === null || alpha === undefined)) {\n                opacity = '; opacity: ' + alpha + ';';\n            }\n\n            return hex + opacity;\n        },\n\n\n        toHSLString: function (alpha) {\n            var hsl = CSSUtil.rgbaToHSL(this.get('red'), this.get('green'), this.get('blue'), alpha);\n            return hsl;\n        }\n\n    });\n\n    return ColorModel;\n});\n\n//# sourceURL=/lib/graphite-api/public/js/ccweb.files.extract/models/ColorModel.js"),eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4, bitwise: true */\n/*global define: true, graphite: true*/\n\ndefine('ccweb.files.extract/models/TextStyleModel',[\n    'underscore',\n    'backbone',\n    'ccweb.files.extract/utils/CSSUtil'\n], function (_, Backbone, CSSUtil) {\n    'use strict';\n    var TextStyleModel = Backbone.Model.extend({\n\n        defaults: {\n            fontName: '',\n            fontFace: '',\n            size: '',\n            sizeUnits: ''\n        },\n\n        parse: function (response) {\n            return CSSUtil.getFontInfo(response);\n        },\n\n\n        isEqual: function (style) {\n            return style && style instanceof TextStyleModel &&\n                this.get('fontName') === style.get('fontName') &&\n                this.get('fontFace') === style.get('fontFace') &&\n                this.get('size') === style.get('size');\n        },\n\n\n        getCSS: function (showVendorPrefixes, ppi) {\n            var cssArray = [\n                    {property: 'font-family', value: this.get('fontName')},\n                    {property: 'font-size', value: (CSSUtil.convertPSDUnitsToPreferredUnits(this.get('size'), true)) }\n                ],\n                fontStyleArray = CSSUtil.fontStyleNameToCSS(this.get('fontFace'));\n\n            if (fontStyleArray.length > 0) {\n                cssArray = cssArray.concat(fontStyleArray);\n            }\n            return cssArray;\n        }\n    });\n\n    return TextStyleModel;\n});\n\n//# sourceURL=/lib/graphite-api/public/js/ccweb.files.extract/models/TextStyleModel.js"),eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4, bitwise: true */\n/*global define: true, graphite: true*/\n\ndefine('ccweb.files.extract/models/GradientModel',[\n    'jquery',\n    'underscore',\n    'backbone',\n    'ccweb.files.extract/utils/CSSUtil'\n], function ($, _, Backbone, CSSUtil) {\n    'use strict';\n    var GradientModel = Backbone.Model.extend({\n\n        compiledColorStops: [],\n\n        defaults: {\n            enabled: true,\n            reverse: false,\n            align: true,\n            opacity: 100,\n            angle: 0,\n            scale: 84,\n            mode: 'normal',\n            type: 'linear',\n            gradient: null\n        },\n\n        initialize: function () {\n            this.set('layers', []);\n            var angle = this.get('angle'),\n                type = this.get('type'),\n                bounds = this.get('layerModel').get('bounds'),\n                height = bounds.bottom - bounds.top,\n                width = bounds.right - bounds.left,\n                gradientLineLengthPhotoshop = this.getGradientLineLengthPhotoshop(bounds),\n                gradientLineLengthCSS = Math.abs(width * Math.sin(angle)) + Math.abs(height * Math.cos(angle)),\n                percentageOfOriginalDimension = angle % 45 === 0 || type !== 'linear' ? 1 : Math.min(gradientLineLengthPhotoshop / gradientLineLengthCSS, 1);\n\n            this.set('percentageOfOriginalDimension', percentageOfOriginalDimension);\n\n            this.generateColorStops();\n\n        },\n\n        isEqual: function (gradient) {\n            // 'align', 'mode'???\n            return gradient &&\n                this.get('reverse') === gradient.get('reverse') &&\n                this.get('angle') === gradient.get('angle') &&\n                this.get('type') === gradient.get('type') &&\n                this.get('percentageOfOriginalDimension') === gradient.get('percentageOfOriginalDimension') &&\n                JSON.stringify(this.get('gradient')) === JSON.stringify(gradient.get('gradient'));  // :Ming: may need more complete compare in the future\n        },\n\n\n        /**\n         * Linearly interpolate between two values\n         * @param {float} t Value between 0 and 1, indicating how far to go in the range a to b\n         * @param {number} a First value\n         * @param {number} b Second value\n         * @returns {number} Calculated value 't'th of the way from a to b\n         */\n        linearInterp: function (t, a, b) {\n            return Math.round(t * (b - a) + a);  // Same as (1-t)*a + t*b\n        },\n\n        /**\n         * Take colors array, find the color value at the given location.\n         * If found, return the matching color object.\n         * If not found, interpolate between available values in the array.\n         * @param {Array} colors\n         * @param {Integer} location\n         * @returns {Object} color object\n         */\n        getColorForLocation: function (colorStops, location) {\n            if (colorStops) {\n                var len = colorStops.length,\n                    last = len - 1,\n                    i,\n                    colorStop,\n                    prevColorStop,\n                    t,\n                    newVal;\n\n                if (location <= colorStops[0].location) {\n                    // If color location is before or at the first color location,\n                    // use the first colorStop\n                    return _.clone(colorStops[0].color);\n                }\n                if (location >= colorStops[last].location) {\n                    // If color location is at or past the last color location,\n                    // use the last colorStop.\n                    return _.clone(colorStops[last].color);\n                }\n                // otherwise look through the colorStop array\n                for (i = 1; i < len; i++) {\n                    colorStop = colorStops[i];\n                    if (colorStop.location === location) {\n                        return _.clone(colorStop.color);\n                    }\n                    if (colorStop.location > location) {\n                        // This color location is too far, so interpolate between previous one and this one.\n                        prevColorStop = colorStops[i - 1];\n                        t = (location - prevColorStop.location) / (colorStop.location - prevColorStop.location);\n                        newVal = {\n                            red: this.linearInterp(t, prevColorStop.color.red, colorStop.color.red),\n                            green: this.linearInterp(t, prevColorStop.color.green, colorStop.color.green),\n                            blue: this.linearInterp(t, prevColorStop.color.blue, colorStop.color.blue),\n                            alpha: this.linearInterp(t, prevColorStop.color.alpha, colorStop.color.alpha)\n                        };\n                        return newVal;\n                    }\n                }\n            }\n            // If we fall through everything above, we fail...\n            return {};\n        },\n\n        /**\n         * Take transparency array, find the transparency value at the given location.\n         * If found, return the matching opacity object.\n         * If not found, interpolate between available values in the array.\n         * @param {Array} transparency\n         * @param {Integer} location\n         * @returns {Object} opacity\n         */\n        getOpacityForLocation: function (transparency, location) {\n            if (transparency) {\n                var len = transparency.length,\n                    last = len - 1,\n                    i,\n                    transp,\n                    prevTransp,\n                    t,\n                    newVal;\n\n                if (location <= transparency[0].location) {\n                    // If color location is before or at the first transparency location,\n                    // use the first transparency opacity.\n                    return transparency[0].opacity;\n                }\n                if (location >= transparency[last].location) {\n                    // If color location is at or past the last transparency location,\n                    // use the last transparency opacity.\n                    return transparency[last].opacity;\n                }\n                // otherwise look through the transparency array\n                for (i = 1; i < len; i++) {\n                    transp = transparency[i];\n                    if (transp.location === location) {\n                        return transp.opacity;\n                    }\n                    if (transp.location > location) {\n                        // This transp location is too far, so interpolate between previous one and this one.\n                        // Make sure they both use the same units though.\n                        prevTransp = transparency[i - 1];\n                        t = (location - prevTransp.location) / (transp.location - prevTransp.location);\n                        newVal = this.linearInterp(t, prevTransp.opacity, transp.opacity);\n                        return newVal;\n                    }\n                }\n            }\n            // If we fall through everything above, return 100%\n            return 100;\n        },\n\n        generateColorStopString: function (colorStop, percentage, alpha) {\n            if (alpha === null || alpha === undefined) {\n                alpha = 1;\n            }\n            var colorStopString = CSSUtil.getDefaultColorString(colorStop.color.red, colorStop.color.green, colorStop.color.blue, colorStop.color.alpha * alpha) + ' ',\n                locationAsPercentage = (Math.floor(colorStop.location / 4096 * 100)),\n                scaledLocationAsPercentage = Math.round((locationAsPercentage * percentage) + (((1 - percentage) * 100) / 2));\n\n            colorStopString += scaledLocationAsPercentage + '%';\n            return colorStopString;\n        },\n\n        generateColorStops: function () {\n            var transparency = this.get('gradient').transparency,\n                transLen = transparency.length,\n                skipTransparency,\n                colors = this.get('gradient').colors,\n                processedLocations = {},\n                previousColorStop,\n                midpoint,\n                i;\n\n            if (!colors) {\n                return [];\n            }\n\n            // create intermediate color stops based on midpoint or transparency\n            this.compiledColorStops = [];\n\n            // get all color stops first\n            for (i = 0; i < colors.length; i++) {\n                var colorStop = _.clone(colors[i]);\n                // if midpoint not 50%, create previous interpolated color stop based on midpoint location\n                if (colorStop.midpoint !== 50 && i > 0) {\n                    midpoint = colorStop.midpoint / 100.0; // midpoint is a percentage, convert it to decimal\n                    previousColorStop = colors[i - 1];\n                    // create new stop and interpolate the colors\n                    var midpointColorStop = {};\n                    midpointColorStop.location = this.linearInterp(midpoint, previousColorStop.location, colorStop.location);\n                    midpointColorStop.color = {\n                        red: this.linearInterp(midpointColorStop.location / 4096, previousColorStop.color.red, colorStop.color.red),\n                        green: this.linearInterp(midpointColorStop.location / 4096, previousColorStop.color.green, colorStop.color.green),\n                        blue: this.linearInterp(midpointColorStop.location / 4096, previousColorStop.color.blue, colorStop.color.blue),\n                        alpha: this.getOpacityForLocation(transparency, midpointColorStop.location) / 100.0\n                    };\n                    this.compiledColorStops.push(midpointColorStop);\n                    processedLocations[midpointColorStop.location] = true;\n                }\n                colorStop.color.alpha = this.getOpacityForLocation(transparency, colorStop.location) / 100.0;\n                this.compiledColorStops.push(colorStop);\n                processedLocations[colorStop.location] = true;\n            }\n\n            // then figure out if we need to create more stops from opacity stops\n            for (i = 0; i < transLen; i++) {\n                // If the current location does not have a CSS color stop yet\n                if (!processedLocations[transparency[i].location]) {\n                    skipTransparency = false;\n                    // Check to see if the opacity is actually different on either side, otherwise, no need to process this stop\n                    if (transLen > 1) {\n                        if (i === 0) {\n                            if (transparency[0].opacity === transparency[1].opacity) {\n                                skipTransparency = true;\n                            }\n                        } else if (i === transLen - 1) {\n                            if (transparency[transLen - 2].opacity === transparency[transLen - 1].opacity) {\n                                skipTransparency = true;\n                            }\n                        } else if (transLen > 2) {\n                            if (transparency[i].opacity === transparency[i - 1].opacity && transparency[i].opacity === transparency[i + 1].opacity) {\n                                skipTransparency = true;\n                            }\n                        }\n                    }\n\n                    if (!skipTransparency) {\n                        var transparencyStop = {};\n                        transparencyStop.location = transparency[i].location;\n                        transparencyStop.color = this.getColorForLocation(this.compiledColorStops, transparencyStop.location);\n                        // override the alpha with the alpha provided\n                        transparencyStop.color.alpha = transparency[i].opacity / 100;\n\n                        this.compiledColorStops.push(transparencyStop);\n                    }\n                }\n            }\n\n            // sort color stops by location\n            this.compiledColorStops.sort(function (a, b) {\n                if (a.location < b.location) {\n                    return -1;\n                }\n                if (a.location > b.location) {\n                    return 1;\n                }\n                return 0;\n            });\n\n            if (this.get('reverse')) {\n                var len = this.compiledColorStops.length,\n                    lastIndex = len - 1,\n                    tempLocation,\n                    stopA,\n                    stopB;\n\n                this.compiledColorStops.reverse();\n\n                // flip all the locations\n                for (i = 0; i < Math.floor(len / 2); i++) {\n                    stopA = this.compiledColorStops[i];\n                    stopB = this.compiledColorStops[lastIndex - i];\n                    tempLocation = stopA.location;\n                    stopA.location = stopB.location;\n                    stopB.location = tempLocation;\n                }\n            }\n        },\n\n        getCSS: function (showVendorPrefixes, alpha) {\n            var style = '',\n                prefixedStyle,\n                i;\n\n            for (i = 0; i < this.compiledColorStops.length; i++) {\n                style += this.generateColorStopString(this.compiledColorStops[i], this.get('percentageOfOriginalDimension'), alpha) + ', ';\n            }\n\n            style = style.substring(0, style.length - 2) + ')';\n\n            switch (this.get('type')) {\n            case 'linear':\n                prefixedStyle = 'linear-gradient(' + this.get('angle') + 'deg, ' + style;\n                style = 'linear-gradient(' + (90 - this.get('angle')) + 'deg, ' + style;\n                break;\n            case 'radial':\n                style = 'radial-gradient(center, ellipse closest-side, ' + style;\n                prefixedStyle = style;\n                break;\n            default:\n                console.warn('Unknown gradient type: ', this.get('type'));\n                return [];\n            }\n\n            return showVendorPrefixes ? [\n                {property: 'background', value: '-webkit-' + prefixedStyle},\n                {property: 'background', value: '-moz-' + prefixedStyle},\n                {property: 'background', value: '-o-' + prefixedStyle},\n                {property: 'background', value: '-ms-' + prefixedStyle},\n                {property: 'background', value: style}\n            ] : [{property: 'background', value: style}];\n        },\n\n        getGradientLineLengthPhotoshop: function (bounds) {\n            // find the center\n            var centerX = (bounds.left + bounds.right) * 0.5;\n            var centerY = (bounds.top + bounds.bottom) * 0.5;\n            var realAngle = this.get('angle');\n            var isNeg = realAngle < 0;\n            if (isNeg) {\n                realAngle = -realAngle;\n            }\n            // Copied comment from Photoshop... UGradientTool.cpp\n            ////////////////////////////////////////////////////////////////////\n            // Create a square which represents a tight bounding\n            // square of the bounds.\n            // Locate the pt on the squares boudary that is the\n            // intersection of a line at the given angle\n            // that originates at the center of the square.\n            // This is easily done via linear interpolation\n            // from the corners.\n\n            // Then if the pt lies outside the bounds, clip it\n            // to find a pt that is on it's boundary\n\n            // While it is a long routine it is very simple math\n            // with no trig functions or sqrts required.  The code path\n            // for a given angle is short.\n            // jgh 4/21/00\n            var startPt = {}, endPt = {};\n            var startX, startY, anglescale, deltaX, deltaY;\n            var halfWidth = (bounds.right - bounds.left) * 0.5;\n            var halfHeight = (bounds.bottom - bounds.top) * 0.5;\n\n            if (realAngle === 90) {\n                startX = centerX;\n                if (!isNeg) {\n                    startY = bounds.top;\n                } else {\n                    startY = bounds.bottom;\n                }\n            } else {\n                var radius = halfWidth >= halfHeight ? halfWidth : halfHeight;\n                if (radius === 0) {\n                    startY = centerY;\n                    startX = centerX;\n                } else {\n                    var squareBounds = {\n                        top: centerY - radius,\n                        left: centerX - radius,\n                        bottom: centerY + radius,\n                        right: centerX + radius\n                    };\n\n                    if (realAngle <= 45.0) {\n                        anglescale = realAngle / 45.0;\n                        deltaY = radius * anglescale;\n                        if (halfHeight <= halfWidth) {\n                            startY = centerY + deltaY;\n                            if (startY > bounds.bottom) {\n                                // we need to scale x and pin y\n                                startX = centerX + ((radius / deltaY) * halfHeight);\n                                startY = bounds.bottom;\n                            } else {\n                                startX = squareBounds.right;\n                            }\n                        } else {\n                            // we need to scale y and pin x\n                            startY = centerY + ((deltaY / radius) * halfWidth);\n                            startX = bounds.right;\n                        }\n                    } else if (realAngle <= 90.0) {\n                        realAngle -= 45.0;\n                        anglescale = 1.0 - (realAngle / 45.0);\n                        deltaX = radius * anglescale;\n                        if (halfWidth <= halfHeight) {\n                            startX = centerX + deltaX;\n                            if (startX > bounds.right) {\n                                // we need to scale y and pin x\n                                if (deltaX !== 0.0) {\n                                    startY = centerY + ((radius / deltaX) * halfWidth);\n                                } else {\n                                    startY = centerY;\n                                }\n                                startX = bounds.right;\n                            } else {\n                                startY = squareBounds.bottom;\n                            }\n                        } else {\n                            // we need to scale x and pin y\n                            startX = centerX + ((deltaX / radius) * halfHeight);\n                            startY = bounds.bottom;\n                        }\n                    } else if (realAngle <= 135.0) {\n                        realAngle -= 90.0;\n                        anglescale = (realAngle / 45.0);\n                        deltaX = radius * anglescale;\n                        if (halfWidth <= halfHeight) {\n                            startX = centerX - deltaX;\n                            if (startX < bounds.left) {\n                                // we need to scale y and pin x\n                                if (deltaX !== 0.0) {\n                                    startY = centerY + ((radius / deltaX) * halfWidth);\n                                } else {\n                                    startY = centerY;\n                                }\n                                startX = bounds.left;\n                            } else {\n                                startY = squareBounds.bottom;\n                            }\n                        } else {\n                            // we need to scale x and pin y\n                            startX = centerX - ((deltaX / radius) * halfHeight);\n                            startY = bounds.bottom;\n                        }\n                    } else {\n                        realAngle -= 135.0;\n                        anglescale = 1.0 - (realAngle / 45.0);\n                        deltaY = radius * anglescale;\n\n                        if (halfHeight <= halfWidth) {\n                            startY = centerY + deltaY;\n                            if (startY > bounds.bottom) {\n                                // we need to scale x and pin y\n                                if (deltaY !== 0.0) {\n                                    startX = centerX - ((radius / deltaY) * halfHeight);\n                                } else {\n                                    startX = centerX;\n                                }\n                                startY = bounds.bottom;\n                            } else {\n                                startX = squareBounds.left;\n                            }\n                        } else {\n                            // we need to scale y and pin x\n                            startY = centerY + ((deltaY / radius) * halfWidth);\n                            startX = bounds.left;\n                        }\n                    }\n                    // reflect across the center if positive\n                    if (!isNeg) {\n                        startY = centerY - (startY - centerY);\n                    }\n                }\n            }\n\n            var offsetX = 0;\n            var offsetY = 0;\n\n            if (this.get('type') === 'linear') {\n                endPt.h = Math.round((startX + offsetX));\n                endPt.v = Math.round((startY + offsetY));\n\n                // now reflect for the endpts\n\n                startPt.h = Math.round((centerX + (centerX - startX) + offsetX));\n                startPt.v = Math.round((centerY + (centerY - startY) + offsetY));\n            } else {\n                startPt.h = Math.round((centerX + offsetX));\n                startPt.v = Math.round((centerY + offsetY));\n\n                endPt.h = Math.round((startX + offsetX));\n                endPt.v = Math.round((startY + offsetY));\n            }\n\n            // return the length\n            var xLength = Math.abs(startPt.h - endPt.h);\n            var yLength = Math.abs(startPt.v - endPt.v);\n            return Math.sqrt(xLength * xLength + yLength * yLength);\n        }\n    });\n\n    return GradientModel;\n});\n\n//# sourceURL=/lib/graphite-api/public/js/ccweb.files.extract/models/GradientModel.js"),
eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4, bitwise: true */\n/*global define: true, graphite: true*/\n\ndefine('ccweb.files.extract/models/LayerPropertiesModel',[\n    'jquery',\n    'underscore',\n    'backbone',\n    'ccweb.files.extract/Constants',\n    './ColorModel',\n    './TextStyleModel',\n    './GradientModel'\n], function ($, _, Backbone, Constants, ColorModel, TextStyleModel, GradientModel) {\n    'use strict';\n    var LayerPropertiesModel = Backbone.Model.extend({\n\n        defaults: {\n            layerType: '',\n            colors: null,\n            gradients: null,\n            textStyles: null\n        },\n\n        enabledGradientTypes: {\n            linear: true,\n            radial: true,\n            angle: false,\n            reflected: false, // This should be doable in CSS, we just need to mirror the stops, but disable for now\n            diamond: false,\n            shapeburst: false\n        },\n\n        enabledGradientForms: {\n            customStops: true,\n            colorNoise: false\n        },\n\n        initialize: function (attributes) {\n            this.layerType = attributes.layerType;\n        },\n\n        layerEffectsAreTransparent: function () {\n            var effects = this.get('layerEffects');\n\n            if (effects && effects.solidFill && effects.solidFill.enabled) {\n                if (effects.solidFill.opacity === 100) {\n                    return false;\n                }\n            }\n            if (this.isGradientOpaque(this.getGradientEffect())) {\n                return false;\n            }\n\n            return true;\n        },\n\n        getColorsFromEffects: function (colors) {\n            var effects = this.get('layerEffects'),\n                colorModel;\n\n            if (effects && effects.solidFill && effects.solidFill.enabled) {\n                colorModel = new ColorModel();\n                this.setAlpha(effects.solidFill.opacity, colorModel);\n                colors.push(colorModel.set(\n                    colorModel.parse(effects.solidFill.color, {parse: true})\n                ));\n            }\n\n            // only include base color if our layer effects are transparent\n            return this.layerEffectsAreTransparent();\n        },\n\n        getColors: function () {\n            var colors = this.get('colors');\n            var blendOptions = this.get('blendOptions');\n            var i;\n\n            if (colors === null) {\n                colors = [];\n                var color,\n                    shape,\n                    colorModel;\n\n                switch (this.layerType) {\n                case Constants.Type.LAYER_CONTENT:\n                    color = this.get('color');\n                    shape = this.get('shape');\n                    if (color) {\n                        if (this.getColorsFromEffects(colors)) {\n                            var skipFill = shape && !shape.fillEnabled;\n                            if (!skipFill) {\n                                colorModel = new ColorModel();\n                                colors.push(colorModel.set(\n                                    colorModel.parse(color, {parse: true})\n                                ));\n\n                                this.checkOpacity(blendOptions, colorModel);\n                            }\n                        }\n\n                        if (shape && shape.stroke) {\n                            var stroke = shape.stroke;\n                            if (stroke.strokeStyleContent) {\n                                var strokeContent = stroke.strokeStyleContent;\n                                color = strokeContent.color;\n                                if (color) {\n                                    colorModel = new ColorModel();\n                                    if (stroke.strokeStyleOpacity !== 100) {\n                                        this.setAlpha(stroke.strokeStyleOpacity, colorModel);\n                                    }\n                                    this.checkOpacity(blendOptions, colorModel);\n                                    colors.push(colorModel.set(\n                                        colorModel.parse(color, {parse: true})\n                                    ));\n                                }\n                            }\n                        }\n                    }\n\n                    break;\n                case Constants.Type.LAYER_TEXT:\n                    var ranges = this.get('textStyleRange');\n                    if (ranges) {\n                        if (this.getColorsFromEffects(colors)) {\n                            for (i = 0; i < ranges.length; i++) {\n                                color = ranges[i].textStyle.color;\n                                if (color) {\n                                    colorModel = new ColorModel();\n                                    colors.push(colorModel.set(\n                                        colorModel.parse(color, {parse: true})\n                                    ));\n                                    this.checkOpacity(blendOptions, colorModel);\n                                }\n                            }\n                        }\n                    }\n                    break;\n                }\n            }\n            return colors;\n        },\n\n        checkOpacity: function (blendOptions, colorModel) {\n            if (blendOptions && blendOptions.opacity) {\n                this.setAlpha(blendOptions.opacity, colorModel);\n            }\n        },\n\n        setAlpha: function (opacity, colorModel) {\n            colorModel.set('alpha', +(opacity / 100).toFixed(2));\n        },\n\n        getGradients: function () {\n            var gradients = this.get('gradients'),\n                shape = this.get('shape');\n            if (gradients === null) {\n                gradients = [];\n                if (this.layerType === Constants.Type.LAYER_CONTENT && !(shape && !shape.fillEnabled)) {\n                    var gradientEffect = this.getGradientEffect();\n                    if (gradientEffect) {\n                        gradients.push(gradientEffect);\n                    }\n                    if (this.layerEffectsAreTransparent()) {\n                        if (this.get('class') === 'gradientLayer' &&\n                                this.enabledGradientTypes[this.get('type')] &&\n                                this.enabledGradientForms[this.get('gradient').gradientForm]) {\n                            var gradientModel = new GradientModel(this.toJSON(), {parse: true});\n                            gradients.push(gradientModel);\n                        }\n                    }\n                }\n            }\n\n            return gradients;\n        },\n\n\n        getTextStyles: function () {\n            var textStyles = this.get('textStyles');\n            var i;\n            if (textStyles === null) {\n                textStyles = [];\n                if (this.layerType === Constants.Type.LAYER_TEXT && this.get('rawText') !== '') {\n                    var ranges = this.get('textStyleRange');\n                    var textStyle, textStyleModel;\n                    if (ranges) {\n                        for (i = 0; i < ranges.length; i++) {\n                            textStyle = ranges[i].textStyle;\n                            textStyleModel = new TextStyleModel();\n                            textStyles.push(textStyleModel.set(\n                                textStyleModel.parse(textStyle, {parse: true})\n                            ));\n                        }\n                    }\n                }\n            }\n            return textStyles;\n        },\n\n\n        // Private\n        getGradientEffect: function () {\n            var gradientJSON, gradient, effects;\n            if (this.layerType === Constants.Type.LAYER_CONTENT) {\n                effects = this.get('layerEffects');\n                if (effects) {\n                    if (effects.gradientFill && effects.gradientFill.enabled) {\n                        gradientJSON = effects.gradientFill;\n                    } else if (effects.innerGlow && effects.innerGlow.gradient && effects.innerGlow.enabled) {\n                        gradientJSON = effects.innerGlow;\n                    } else if (effects.outerGlow && effects.outerGlow.gradient && effects.outerGlow.enabled) {\n                        gradientJSON = effects.outerGlow;\n                    }\n                }\n            }\n\n            if (gradientJSON && this.enabledGradientTypes[gradientJSON.type]) {\n                gradientJSON.layerModel = this.get('layerModel');\n                gradient = new GradientModel(gradientJSON, {parse: true});\n            }\n\n            return gradient;\n        },\n\n        isGradientOpaque: function (gradient) {\n            var isOpaque = gradient && gradient.get('enabled') && gradient.get('opacity') === 100;\n            if (isOpaque) {\n                $.each(gradient.get('gradient').transparency, function (index, transparency) {\n                    if (transparency.opacity !== 100) {\n                        isOpaque = false;\n                        return;\n                    }\n                });\n            }\n\n            return isOpaque;\n        }\n    });\n\n    return LayerPropertiesModel;\n});\n\n//# sourceURL=/lib/graphite-api/public/js/ccweb.files.extract/models/LayerPropertiesModel.js"),eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4, bitwise: true */\n/*global define: true, graphite: true*/\n\ndefine('ccweb.files.extract/models/BaseStyleUsageModel',[\n    'underscore',\n    'backbone'\n], function (_, Backbone) {\n    'use strict';\n    var BaseStyleUsageModel = Backbone.Model.extend({\n\n        defaults: {\n            style: null,\n            layers: null\n        },\n\n        initialize: function () {\n            this.set('layers', []);\n        },\n\n        addUsage: function (layerModel) {\n            this.get('layers').push(layerModel);\n        }\n\n    });\n\n    return BaseStyleUsageModel;\n\n});\n\n//# sourceURL=/lib/graphite-api/public/js/ccweb.files.extract/models/BaseStyleUsageModel.js"),eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4, bitwise: true */\n/*global define: true, graphite: true*/\n\ndefine('ccweb.files.extract/models/ColorUsageModel',[\n    'underscore',\n    'backbone',\n    './BaseStyleUsageModel'\n], function (_, Backbone, BaseStyleUsageModel) {\n    'use strict';\n    var ColorUsageModel = BaseStyleUsageModel.extend({\n\n        defaults: {\n            alphas: null\n        },\n\n        alphaMap: null, // private\n\n\n        initialize: function (attributes) {\n            BaseStyleUsageModel.prototype.initialize.apply(this, arguments);\n\n            this.set('alphas', []);\n            this.alphaMap = {};\n        },\n\n        addUsage: function (layerModel, color) {\n            BaseStyleUsageModel.prototype.addUsage.apply(this, arguments);\n            var found = false,\n                layerAlpha,\n                originalAlpha,\n                alpha,\n                style,\n                alphas,\n                i,\n                ii;\n\n            if (color instanceof ColorUsageModel) {\n                style = color.get('style');\n                originalAlpha = style.get('alpha');\n                alphas = color.get('alphas');\n                for (i = 0, ii = alphas.length; i < ii; i++) {\n                    alpha = alphas[i] === undefined ? 1 : alphas[i];\n                    style.set('alpha', alpha);\n                    this.addUsage(layerModel, style);\n                }\n                style.set('alpha', originalAlpha);\n                return;\n            }\n\n            layerAlpha = color.get('alpha');\n            for (alpha in this.alphaMap) {\n                if (this.alphaMap.hasOwnProperty(alpha) && alpha === String(layerAlpha)) {\n                    found = true;\n                    this.alphaMap[alpha].push(layerModel);\n                }\n            }\n\n            if (!found) {\n                this.alphaMap[layerAlpha] = [layerModel];\n                this.get('alphas').push(layerAlpha);\n            }\n        }\n    });\n\n    return ColorUsageModel;\n});\n\n//# sourceURL=/lib/graphite-api/public/js/ccweb.files.extract/models/ColorUsageModel.js"),eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4, bitwise: true */\n/*global define: true, graphite: true*/\n\ndefine('ccweb.files.extract/models/GradientUsageModel',[\n    'underscore',\n    'backbone',\n    './BaseStyleUsageModel'\n], function (_, Backbone, BaseStyleUsageModel) {\n    'use strict';\n    var GradientUsageModel = BaseStyleUsageModel.extend({\n    });\n\n    return GradientUsageModel;\n\n});\n\n//# sourceURL=/lib/graphite-api/public/js/ccweb.files.extract/models/GradientUsageModel.js"),eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4, bitwise: true */\n/*global define: true, graphite: true*/\n\ndefine('ccweb.files.extract/models/TextStyleUsageModel',[\n    'underscore',\n    'backbone',\n    './BaseStyleUsageModel'\n], function (_, Backbone, BaseStyleUsageModel) {\n    'use strict';\n    var TextStyleUsageModel = BaseStyleUsageModel.extend({\n    });\n\n    return TextStyleUsageModel;\n});\n\n//# sourceURL=/lib/graphite-api/public/js/ccweb.files.extract/models/TextStyleUsageModel.js"),eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4 */\n/*global define: true*/\n\ndefine('ccweb.files.extract/models/LayerModelMap',[\n    'jquery',\n    'underscore',\n    'backbone'\n], function ($, _, Backbone) {\n    'use strict';\n\n    var LayerModelMap = Backbone.Model.extend({\n\n        defaults: {\n            psdLayersMap: {}\n        },\n\n        initialize: function () {\n            this.reset();\n        },\n\n        addLayerToMap: function (id, layerElem, flattenedElem, layerModel) {\n            this.get('psdLayersMap')[id] = {item: layerElem, flattenedItem: flattenedElem, model: layerModel};\n        },\n\n        addModel: function (id, model) {\n            this.idToModelMap[id] = model;\n        },\n\n        getLayerInfoForId: function (id) {\n            return this.get('psdLayersMap')[id];\n        },\n\n        getLayerModelFromId: function (id) {\n            var layer = this.get('psdLayersMap')[id];\n            return layer ? layer.model : null;\n        },\n\n        getModel: function (id) {\n            return this.idToModelMap[id];\n        },\n\n        reset: function () {\n            this.idToModelMap = {};\n            this.flattenedLayers = [];\n        },\n\n        addFlattenedLayer: function (model) {\n            this.flattenedLayers.push(model);\n        },\n\n        getFlattenedLayers: function () {\n            return this.flattenedLayers;\n        }\n\n    });\n\n    return new LayerModelMap();\n});\n\n//# sourceURL=/lib/graphite-api/public/js/ccweb.files.extract/models/LayerModelMap.js"),eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4 */\n/*global define: true, graphite: true, navigator: true*/\n\ndefine('ccweb.files.extract/utils/MeasurementUtil',[\n    'underscore',\n    'ccweb.files.extract/controllers/DetailsController',\n    'ccweb.files.extract/models/UserSettingsModel',\n    'ccweb.files.extract/Constants'\n\n], function (_, DetailsController, UserSettingsModel, Constants) {\n    'use strict';\n    var MeasurementUtil = {\n\n        calcLayerGroupBounds: function (layerList, PSDModel) {\n            var bounds,\n                groupBounds,\n                i;\n            if (!layerList || layerList.length < 1) {\n                return;\n            }\n\n            bounds = this.getVisibleBounds(layerList[0], PSDModel);\n            groupBounds = {top: bounds.top, left: bounds.left, bottom: bounds.bottom, right: bounds.right};\n            for (i = 1; i < layerList.length; i++) {\n                bounds = this.getVisibleBounds(layerList[i], PSDModel);\n                groupBounds.top = Math.min(groupBounds.top, bounds.top);\n                groupBounds.left = Math.min(groupBounds.left, bounds.left);\n                groupBounds.bottom = Math.max(groupBounds.bottom, bounds.bottom);\n                groupBounds.right = Math.max(groupBounds.right, bounds.right);\n            }\n            return groupBounds;\n        },\n\n        boundsIntersect: function (bounds1, bounds2) {\n            return bounds1.left < bounds2.right && bounds1.right > bounds2.left &&\n                   bounds1.top < bounds2.bottom && bounds1.bottom > bounds2.top;\n        },\n\n        getVisibleBounds: function (layerModel, PSDModel, boundsOnly) {\n            var layerBounds,\n                imageBounds = PSDModel.get('imgdata').bounds,\n                result;\n\n            // Prefer rawBounds unless specified otherwise, to ignore any drop\n            // shadow or other layer effects.\n            layerBounds = layerModel.zeroRawBounds() || boundsOnly ?\n                    layerModel.get('bounds') : layerModel.get('rawBounds');\n\n            result = {top: Math.max(0, layerBounds.top),\n                      left: Math.max(0, layerBounds.left),\n                      bottom: Math.min(imageBounds.bottom, layerBounds.bottom),\n                      right: Math.min(imageBounds.right, layerBounds.right)};\n            result.width = result.right - result.left;\n            result.height = result.bottom - result.top;\n            return result;\n        },\n\n        layer1ContainsLayer2: function (layer1, layer2) {\n            var PSDModel = DetailsController.getPSDModel(),\n                rect1 = this.getVisibleBounds(layer1, PSDModel),\n                rect2 = this.getVisibleBounds(layer2, PSDModel);\n\n            return this.rect1ContainsRect2(rect1, rect2);\n        },\n\n        getMeasurementsOfLayerAgainstPSDBounds: function (layerModel) {\n            var layerBounds = this.getVisibleBounds(layerModel, DetailsController.getPSDModel());\n\n            return this.getMeasurementsOfRectAgainstPSDBounds(layerBounds);\n        },\n\n        getMeasurementsOfRectAgainstPSDBounds: function (rect) {\n            var psdBounds = DetailsController.getPSDModel().get('imgdata').bounds;\n\n            return this.getMeasurementsOfRectInsideRect(rect, psdBounds);\n        },\n\n        getMeasurementsOfRectInsideRect: function (innerRect, outerRect) {\n            var result = _.clone(innerRect),\n                preferredUnits = UserSettingsModel.get('preferredMeasurementUnits');\n\n            result.width = result.right - result.left;\n            result.height = result.bottom - result.top;\n\n            outerRect.width = outerRect.right - outerRect.left;\n            outerRect.height = outerRect.bottom - outerRect.top;\n\n            result.percentWidth = +(result.width / outerRect.width * 100).toFixed(1);\n            result.displayWidth = (preferredUnits === Constants.MeasurementUnitType.PX ? result.width : result.percentWidth) +  preferredUnits;\n\n            result.percentHeight = +(result.height / outerRect.height * 100).toFixed(1);\n            result.displayHeight = (preferredUnits === Constants.MeasurementUnitType.PX ? result.height : result.percentHeight) +  preferredUnits;\n\n            return result;\n        },\n\n        setLayerBounds: function (childElem, isFlattened, currentModel, parentModel, SelectionController) {\n            var bounds = currentModel.get('bounds'),\n                psdModelBounds = DetailsController.getPSDModel().get('imgdata').bounds,\n                parentBounds = parentModel ? parentModel.get('bounds') : null,\n                flattenedSprite;\n\n            if (!parentBounds) {\n                parentBounds = {top: 0, left: 0};\n            }\n\n            var top = bounds.top,\n                left = bounds.left,\n                right = bounds.right,\n                bottom = bounds.bottom,\n                parentLeft = parentBounds.left,\n                parentTop = parentBounds.top;\n\n            if (isFlattened) {\n                flattenedSprite = currentModel.get('flattenedSprite');\n                left = flattenedSprite.psdOrigin.left;\n                top = flattenedSprite.psdOrigin.top;\n                right = left + (flattenedSprite.bounds.right - flattenedSprite.bounds.left);\n                bottom = top + (flattenedSprite.bounds.bottom - flattenedSprite.bounds.top);\n            }\n\n            if (SelectionController.clipLayersToImage) {\n                top = Math.max(0, top);\n                left = Math.max(0, left);\n                right = Math.min(psdModelBounds.right, right);\n                bottom = Math.min(psdModelBounds.bottom, bottom);\n                parentLeft = Math.max(0, parentLeft);\n                parentTop = Math.max(0, parentTop);\n            }\n\n            childElem.css('top', top - parentTop);\n            childElem.css('left', left - parentLeft);\n\n            if (currentModel.get('type') === Constants.Type.LAYER_GROUP && !isFlattened) {\n                var childCanvas = childElem.children().first();\n                childElem.css('width', right - left + 'px');\n                childElem.css('height', bottom - top + 'px');\n                if (this.hasSpriteSheets === false) {\n                    childCanvas[0].width = right - left;\n                    childCanvas[0].height = bottom - top;\n                }\n            } else {\n                if (right - left < 0 || bottom - top < 0) {\n                    childElem[0].width = 0;\n                    childElem[0].height = 0;\n                } else {\n                    childElem[0].width = right - left;\n                    childElem[0].height = bottom - top;\n                }\n            }\n\n            return {top: top, left: left, bottom: bottom, right: right};\n        },\n\n        rect1ContainsRect2: function (rect1, rect2) {\n            return ((rect1.left <= rect2.left) && (rect1.top <= rect2.top) && (rect1.right >= rect2.right) && (rect1.bottom >= rect2.bottom));\n        }\n\n    };\n\n    return MeasurementUtil;\n});\n\n//# sourceURL=/lib/graphite-api/public/js/ccweb.files.extract/utils/MeasurementUtil.js"),eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4, bitwise: true */\n/*global define: true, graphite: true*/\n\ndefine('ccweb.files.extract/utils/UTF8',[ ], function () {\n    'use strict';\n\n    var UTF8 = {\n        decodeCharacters: function (utftext) {\n            utftext = utftext || '';\n            var iterator = {\n                    text: utftext,\n                    index: 0,\n                    nextChar: function () {\n                        var c = null;\n                        if (this.index < this.text.length) {\n                            c = this.text.charCodeAt(this.index);\n                            if (c === 65535) {\n                                c = parseInt(this.text.substr(this.index + 3, 2), 16);\n                                this.index = this.index + 4;\n                            }\n                            this.index = this.index + 1;\n                        }\n                        return c;\n                    },\n                    atEnd: function () {\n                        return this.index >= this.text.length;\n                    }\n                },\n                string = '',\n                c,\n                c1,\n                c2;\n\n            while (!iterator.atEnd()) {\n                c = iterator.nextChar();\n                if (c < 128) {\n                    string += String.fromCharCode(c);\n                } else if ((c > 191) && (c < 224)) {\n                    c1 = iterator.nextChar();\n                    string += String.fromCharCode(((c & 31) << 6) | (c1 & 63));\n                } else {\n                    c1 = iterator.nextChar();\n                    c2 = iterator.nextChar();\n                    string += String.fromCharCode(((c & 15) << 12) | ((c1 & 63) << 6) | (c2 & 63));\n                }\n            }\n            return string;\n        }\n    };\n\n    return UTF8;\n});\n\n//# sourceURL=/lib/graphite-api/public/js/ccweb.files.extract/utils/UTF8.js"),eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4, bitwise: true */\n/*global define: true, graphite: true*/\n\ndefine('ccweb.files.extract/models/LayerModel',[\n    'jquery',\n    'underscore',\n    'backbone',\n    'plugin-dependencies',\n    'ccweb.files.extract/collections/SubLayerCollection',\n    './LayerPropertiesModel',\n    './ColorUsageModel',\n    './GradientUsageModel',\n    './TextStyleUsageModel',\n    './LayerModelMap',\n    './UserSettingsModel',\n    'ccweb.files.extract/controllers/DetailsController',\n    'ccweb.files.extract/utils/MeasurementUtil',\n    'ccweb.files.extract/Constants',\n    'ccweb.files.extract/utils/CSSUtil',\n    'ccweb.files.extract/utils/UTF8'\n], function ($, _, Backbone, deps, SubLayerCollection, LayerPropertiesModel, ColorUsageModel,\n             GradientUsageModel, TextStyleUsageModel, LayerModelMap, UserSettingsModel, DetailsController,\n             MeasurementUtil, Constants, CSSUtil, UTF8) {\n    'use strict';\n    var LayerModel = Backbone.Model.extend({\n        defaults: {\n            type: '',\n            layerName: '',\n            layerId: '',\n            bounds: '',\n            properties: '',\n            selected: false,\n            rendered: false,\n            parentModel: null,\n            flattenedParent: null,\n            flattenedSprite: null,\n            zIndex: 0,\n            toplevel: false,\n            psdGuid: '',\n            layerCollection: null,\n            colors: null,\n            usageModels: null,\n            visible: false,\n            psdVisible: false, //The original visibility setting for the layer in the PSD. Do not modify this value\n            renderedVisible: false //Denotes visibility of this layer as captured by any flattened sprites.\n        },\n\n        cssComments: {\n            FONT_SUB: deps.translate('Approximation due to font substitution')\n        },\n\n        initialize: function () {\n            this.set('colors', []); // Make sure the colors array is not null in case $.each\n        },\n\n        toString: function () {\n            return '[object LayerModel name: ' + this.get('layerName') + ', layerId: ' + this.get('layerId') + ', zIndex: ' + this.get('zIndex') + ']';\n        },\n\n        parse: function (response) {\n            var result = {},\n                props,\n                childrenArray = response.children,\n                layerCollection = new SubLayerCollection(LayerModel);\n\n            result.type = response.type;\n            result.layerName = response.layerName;\n            result.layerId = response.layerId;\n            result.visible = response.visible;\n            if (result.visible === undefined) {\n                result.visible = true;\n            }\n\n            result.bounds = response.bounds;\n            result.rawBounds = response.rawBounds;\n\n            result.flattenedParent = response.flattenedParent;\n            result.flattenedSprite = response.flattenedSprite;\n            result.isFlattened = result.flattenedSprite !== undefined  || result.flattenedParent !== undefined;\n            result.psdVisible = result.renderedVisible = result.visible;\n\n            if (response.clipped && response.hasOwnProperty('clipLayerBaseId')) {\n                var clipbaseModel = LayerModelMap.getModel(response.clipLayerBaseId),\n                    clippedArray = clipbaseModel.get('clippedLayers') || [];\n\n                clippedArray.push(this);\n                clipbaseModel.set('clippedLayers', clippedArray);\n\n                result.clipbase = clipbaseModel;\n\n            }\n\n            if (response.hasOwnProperty('spriteSheet')) {\n                result.spriteSheet = response.spriteSheet;\n            }\n\n            LayerModelMap.addModel(result.layerId, this);\n\n            if (response.flattenedSprite) {\n                LayerModelMap.addFlattenedLayer(this);\n            }\n\n            // result.thumb = response.thumb;\n            if (childrenArray) {\n                layerCollection.reset();\n                layerCollection.add(childrenArray, {parse: true});\n                result.layerCollection = layerCollection;\n            }\n            \n            if (response.hasOwnProperty('smartObjectData')) {\n                result.smartObjectLayers = new SubLayerCollection(LayerModel);\n                result.smartObjectLayers.reset();\n                result.smartObjectLayers.add(response.smartObjectData.children, {parse: true});\n            }\n\n            props = new LayerPropertiesModel({layerType: result.type, layerModel: this});\n            props.set(props.parse(response.properties, {parse: true}));\n            result.properties = props;\n\n            return result;\n        },\n\n\n        //returns an array of css property objects (property:, value:)\n        getCSSArray: function (showVendorPrefixes) {\n            var cssArray = [],\n                properties = this.get('properties'),\n                //Fixes issue #529\n                bounds = MeasurementUtil.getMeasurementsOfLayerAgainstPSDBounds(this),\n                usageModels = this.get('usageModels'),\n                color,\n                layerEffects = properties.get('layerEffects'),\n                i,\n                textStyle,\n                shape,\n                width,\n                height,\n                textRanges,\n                decodedText,\n                isDup,\n                isDupFunc,\n                textFragment,\n                emittedStyles = [],\n                inlineEmitted,\n                fontInfo,\n                fontSize,\n                leading,\n                blendOptions,\n                ppi = CSSUtil.findModelResolution(this);\n\n            if (properties.layerType === Constants.Type.LAYER_TEXT) {\n                textRanges = properties.get('textStyleRange');\n                decodedText = UTF8.decodeCharacters(properties.get('rawText'));\n                if (textRanges && textRanges.length > 0) {\n\n                    isDupFunc = function (style) {\n                        return _.isEqual(textStyle, style);\n                    };\n\n                    for (i = 0; i < textRanges.length; i++) {\n                        textStyle = textRanges[i].textStyle;\n                        textFragment = decodedText.substring(textRanges[i].from, textRanges[i].to);\n\n                        // Only emit if we haven't already done so. We are only\n                        // interesting in highlighting unique style combinations.\n                        isDup = _.some(emittedStyles, isDupFunc);\n\n                        if (!this.isWhitespace(textFragment) && !isDup) {\n                            if (i >= 1) {\n                                cssArray.push({\n                                    spacer: true,\n                                    label: '/* ' + deps.translate('Inline Style') + ' */',\n                                    property: null,\n                                    value: null\n                                });\n                                inlineEmitted = true;\n                            }\n\n                            fontInfo = CSSUtil.getFontInfo(textStyle);\n                            cssArray.push({\n                                property: 'font-family',\n                                value: CSSUtil.formatCSSValue('font-family', fontInfo.fontName)\n                            });\n                            blendOptions = properties.get('blendOptions');\n                            var clr;\n                            if (usageModels.colors.length === 1) {\n                                color = usageModels.colors[0].get('style');\n                                color = {\n                                    red: color.get('red'),\n                                    green: color.get('green'),\n                                    blue: color.get('blue'),\n                                    alpha: color.get('alpha')\n                                };\n                            } else {\n                                color = textStyle.color;\n                            }\n                            if (blendOptions && blendOptions.hasOwnProperty('fillOpacity')) {\n                                color.alpha *= blendOptions.fillOpacity / 100;\n                            }\n                            cssArray.push({\n                                property: 'color',\n                                value: CSSUtil.getDefaultColorString(color.red, color.green, color.blue, color.alpha)\n                            });\n                            fontSize = CSSUtil.parseCSSMeasure(fontInfo.size);\n                            cssArray.push({\n                                property: 'font-size',\n                                value: CSSUtil.convertPSDUnitsToPreferredUnits(fontSize, true),\n                                comment: fontInfo.coolTypeResolved ? undefined : this.cssComments.FONT_SUB\n                            });\n                            if (fontInfo.fontFace) {\n                                cssArray = cssArray.concat(CSSUtil.fontStyleNameToCSS(fontInfo.fontFace));\n                            }\n                            if (textStyle.leading) {\n                                leading = CSSUtil.parseCSSMeasure(textStyle.leading);\n                                var units = UserSettingsModel.get('preferredFontUnits'),\n                                    value;\n                                if (units === Constants.FontUnitType.PX) {\n                                    value = +(+leading.val).toFixed(3) + units;\n                                } else {\n                                    value = +(leading.val / fontSize.val).toFixed(3);\n                                }\n                                cssArray.push({\n                                    property: 'line-height',\n                                    value: value,\n                                    comment: fontInfo.coolTypeResolved ? undefined : this.cssComments.FONT_SUB\n                                });\n                            }\n                            if (textStyle.textAlign) {\n                                cssArray.push({\n                                    property: 'text-align',\n                                    value: textStyle.textAlign\n                                });\n                            }\n                            if (properties.get('dropShadow')) {\n                                cssArray.push({\n                                    property: 'text-shadow',\n                                    value: properties.get('dropShadow')\n                                });\n                            }\n                            emittedStyles.push(textStyle);\n                        }\n                    }\n                    // Insert separator before additional CSS.\n                    if (inlineEmitted) {\n                        cssArray.push({\n                            spacer: true,\n                            label: ''\n                        });\n                    }\n                }\n            } else if (properties.layerType === Constants.Type.LAYER_CONTENT) {\n                // TODO: create test file for the case with multiple gradients (would that ever happen?)\n                shape = properties.get('shape');\n                blendOptions = properties.get('blendOptions');\n                var isOpacity = blendOptions && blendOptions.hasOwnProperty('opacity'),\n                    isFillOpacity = blendOptions && blendOptions.hasOwnProperty('fillOpacity'),\n                    globalOpacity = isOpacity ? blendOptions.opacity / 100 : 1,\n                    fillOpacity = isFillOpacity ? blendOptions.fillOpacity / 100 : 1,\n                    gradientUsage = usageModels.gradients[0],\n                    colorUsage = usageModels.colors[0],\n                    skipBackground = shape && !shape.fillEnabled,\n                    notCSSShape = shape && shape.type === Constants.Shape.PATH,\n                    isFill = (colorUsage || gradientUsage) && !skipBackground,\n                    isStroke = shape && shape.stroke,\n                    gradientModel,\n                    cssObj,\n                    alpha;\n\n                if (shape) {\n                    if (shape.type === Constants.Shape.ELLIPSE) {\n                        cssArray.push({property: 'border-radius', value: '50%'});\n                    }\n                    if (shape.type === Constants.Shape.RECTANGLE) {\n                        cssObj = CSSUtil.getBorderRadiusCSS(shape.bottomLeftRadius, shape.bottomRightRadius, shape.topLeftRadius, shape.topRightRadius);\n                        if (cssObj) {\n                            cssArray = cssArray.concat(cssObj);\n                        }\n                    }\n                }\n                if (!notCSSShape) {\n                    if (isStroke) {\n                        cssArray = cssArray.concat(CSSUtil.strokeToCSS(shape, isFill ? null : +(globalOpacity * fillOpacity).toFixed(2)));\n                    }\n                    if (!skipBackground) {\n                        alpha = (isStroke ? 1 : globalOpacity) * fillOpacity;\n                        alpha = +alpha.toFixed(2);\n                        if (colorUsage) {\n                            color = properties.get('color');\n                            cssArray.push({\n                                property: 'background-color',\n                                value: CSSUtil.getDefaultColorString(color.red, color.green, color.blue, alpha)\n                            });\n                        }\n                        if (gradientUsage) {\n                            gradientModel = gradientUsage.get('style');\n                            cssObj = gradientModel.getCSS(showVendorPrefixes, alpha);\n                            if (cssObj) {\n                                cssArray = cssArray.concat(cssObj);\n                            }\n                        }\n                    }\n                    if (isOpacity && isStroke && isFill) {\n                        cssArray.push({\n                            property: 'opacity',\n                            value: +globalOpacity.toFixed(2)\n                        });\n                    }\n                }\n            }\n\n            if (layerEffects) {\n                if (layerEffects.dropShadow && layerEffects.dropShadow.enabled) {\n                    CSSUtil.addCSS(cssArray, CSSUtil.getShadowCSS(properties.layerType, layerEffects.dropShadow));\n                }\n            }\n\n            //TODO: remove when we update to the new marketing page\n            if (properties.get('dropShadow') && properties.layerType !== Constants.Type.LAYER_TEXT) {\n                cssArray.push({\n                    property: 'box-shadow',\n                    value: properties.get('dropShadow')\n                });\n            }\n            if (properties.get('borderRadius')) {\n                cssArray.push({\n                    property: 'border-radius',\n                    value: properties.get('borderRadius')\n                });\n            }\n            \n            if (properties.get('transform')) {\n                var cssTransform = CSSUtil.getCSSTransform(properties.get('transform'));\n                if (cssTransform && cssTransform !== '') {\n                    cssArray.push({\n                        property: 'transform',\n                        value: cssTransform\n                    });\n                }\n            }\n\n            //CSS Width doesn't calculate correctly if using inside or path borders.  Bug 1035. Subtract border, if appropriate\n            if (shape && (shape.type === Constants.Shape.RECTANGLE || shape.type === Constants.Shape.ELLIPSE)) {\n                if (shape.stroke && shape.stroke.strokeStyleLineAlignment) {\n                    if (shape.stroke.strokeStyleLineAlignment) {\n                        // Subtract twice the border thickness\n                        bounds.right -= (parseInt(shape.stroke.strokeStyleLineWidth, 10) * 2);\n                        bounds.bottom -= (parseInt(shape.stroke.strokeStyleLineWidth, 10) * 2);\n                        //Call getMeasurements to recalc the display values\n                        bounds = MeasurementUtil.getMeasurementsOfRectInsideRect(bounds, DetailsController.getPSDModel().get('imgdata').bounds);\n                    }\n                }\n            }\n\n            cssArray.push({\n                property: 'width',\n                value: bounds.displayWidth\n            }, {\n                property: 'height',\n                value: bounds.displayHeight\n            });\n\n            return cssArray;\n        },\n\n        isFontSubstitution: function () {\n            if (this.fontSubstitution !== undefined) {\n                return this.fontSubstitution;\n            }\n\n            var properties = this.get('properties'),\n                i,\n                textStyle,\n                textRanges,\n                decodedText,\n                textFragment;\n\n            if (properties.layerType === Constants.Type.LAYER_TEXT) {\n                textRanges = properties.get('textStyleRange');\n                decodedText = UTF8.decodeCharacters(properties.get('rawText'));\n                if (textRanges && textRanges.length > 0) {\n                    for (i = 0; i < textRanges.length; i++) {\n                        textStyle = textRanges[i].textStyle;\n                        textFragment = decodedText.substring(textRanges[i].from, textRanges[i].to);\n                        if (!this.isWhitespace(textFragment)) {\n                            if (!CSSUtil.getFontInfo(textStyle).coolTypeResolved) {\n                                this.fontSubstitution = true;\n                                break;\n                            }\n                        }\n                    }\n                }\n            }\n            this.fontSubstitution = this.fontSubstitution || false;\n            return this.fontSubstitution;\n        },\n\n        isWhitespace: function (s) {\n            s = s.replace(/\\s/gm, '');\n            return (!s || s.length === 0);\n        },\n\n        getCSSAsString: function (showVendorPrefixes, preprocessor) {\n            var retCSSStr = '',\n                cssProps = this.getCSSArray(preprocessor === 'css'),\n                cssPropsLength = cssProps.length,\n                i,\n                aCSSProp;\n            for (i = 0; i < cssPropsLength; i++) {\n                aCSSProp = cssProps[i];\n                if (aCSSProp.property || aCSSProp.value) {\n                    retCSSStr += CSSUtil.formatCSSString(aCSSProp.property, aCSSProp.value, preprocessor);\n                    if (i !== (cssPropsLength - 1)) {\n                        retCSSStr += '\\r\\n';\n                    }\n                }\n            }\n            return retCSSStr;\n        },\n\n        combineUsageModels: function (destinationUsageModels, sourceUsageModels) {\n            function combineModels(destinationModels, sourceModels) {\n                var exists,\n                    thisUsageModel,\n                    otherUsageModel,\n                    thisLayer,\n                    otherLayer,\n                    i,\n                    j,\n                    k,\n                    l,\n                    style;\n\n                for (i = 0; i < sourceModels.length; i++) {\n                    thisUsageModel = sourceModels[i];\n                    exists = false;\n                    style = thisUsageModel.get('style');\n\n                    for (j = 0; j < destinationModels.length; j++) {\n                        otherUsageModel = destinationModels[j];\n                        if (style.isEqual(otherUsageModel.get('style'))) {\n                            // combine the layers\n                            for (k = 0; k < thisUsageModel.get('layers').length; k++) {\n                                thisLayer = thisUsageModel.get('layers')[k];\n                                exists = false;\n                                for (l = 0; l < otherUsageModel.get('layers').length; l++) {\n                                    otherLayer = otherUsageModel.get('layers')[l];\n                                    if (thisLayer.isEqual(otherLayer)) {\n                                        exists = true;\n                                        break;\n                                    }\n                                }\n\n                                if (!exists) {\n                                    otherUsageModel.addUsage(thisLayer, thisUsageModel);\n                                }\n                            }\n\n                            exists = true;\n                            break;\n                        }\n                    }\n\n                    if (!exists) {\n                        destinationModels.push(thisUsageModel);\n                    }\n                }\n            }\n\n            combineModels(destinationUsageModels.colors, sourceUsageModels.colors);\n            combineModels(destinationUsageModels.gradients, sourceUsageModels.gradients);\n            combineModels(destinationUsageModels.textStyles, sourceUsageModels.textStyles);\n        },\n\n        getUsageModels: function () {\n            var usageModels = this.get('usageModels'), // if I enable the cache, its a global cache for some reason...\n                properties,\n                sublayers,\n                sublayer,\n                subStyleUsageModels,\n                i,\n                self = this,\n                resetLayers = function(usage) {\n                    usage.get('layers').length = 0;\n                    usage.get('layers').push(self);\n                };\n\n\n            if (!usageModels) {\n                usageModels = { colors: [], gradients: [], textStyles: [] };\n                properties = this.get('properties');\n                sublayers = this.get('layerCollection');\n\n                if (properties) {\n                    this.addColorStyle(usageModels.colors, properties.getColors()); // add all styles for this specific layer\n                    this.addGStyle(usageModels.gradients, properties.getGradients()); // add all styles for this specific layer\n                    this.addStyle(usageModels.textStyles, properties.getTextStyles()); // add all styles for this specific layer\n                }\n\n                if (sublayers) {\n                    for (i = 0; i < sublayers.length; i++) {\n                        sublayer = sublayers.at(i);\n                        subStyleUsageModels = sublayer.getUsageModels();\n                        this.combineUsageModels(usageModels, subStyleUsageModels);\n                    }\n                }\n                \n                sublayers = this.get('smartObjectLayers');\n                if (sublayers) {\n                    for (i = 0; i < sublayers.length; i++) {\n                        sublayer = sublayers.at(i);\n                        subStyleUsageModels = sublayer.getUsageModels();\n                        _.each(subStyleUsageModels.colors, resetLayers);\n                        _.each(subStyleUsageModels.gradients, resetLayers);\n                        _.each(subStyleUsageModels.textStyles, resetLayers);\n                        this.combineUsageModels(usageModels, subStyleUsageModels);\n                    }\n                }\n\n                this.set('usageModels', usageModels);\n            }\n            return {\n                colors: usageModels.colors,\n                gradients: usageModels.gradients,\n                textStyles: usageModels.textStyles\n            };\n        },\n\n        addStyle: function (sourceArray, toAddArray) {\n            var usage,\n                found,\n                j,\n                k;\n            if (toAddArray.length) {\n                for (j = 0; j < toAddArray.length; j++) {\n                    found = false;\n                    for (k = 0; k < sourceArray.length; k++) {\n                        if (sourceArray[k].get('style').isEqual(toAddArray[j])) {\n                            found = true;\n                            sourceArray[k].addUsage(this);\n                            break;\n                        }\n                    }\n                    if (!found) {\n                        usage = new TextStyleUsageModel({style: toAddArray[j]});\n                        usage.addUsage(this);\n                        sourceArray.push(usage);\n                    }\n                }\n            }\n        },\n\n\n        addColorStyle: function (sourceArray, toAddArray) {\n            var usage,\n                found,\n                j,\n                k;\n            // store colors for this layer\n            this.set('colors', toAddArray);\n\n            if (toAddArray.length) {\n                for (j = 0; j < toAddArray.length; j++) {\n                    found = false;\n                    for (k = 0; k < sourceArray.length; k++) {\n                        if (sourceArray[k].get('style').isEqual(toAddArray[j])) {\n                            found = true;\n                            sourceArray[k].addUsage(this, toAddArray[j]);\n                            break;\n                        }\n                    }\n                    if (!found) {\n                        usage = new ColorUsageModel({style: toAddArray[j]});\n                        usage.addUsage(this, toAddArray[j]);\n                        sourceArray.push(usage);\n                    }\n                }\n            }\n        },\n\n        addGStyle: function (sourceArray, toAddArray) {\n            var found,\n                usage,\n                j,\n                k;\n            if (toAddArray.length) {\n                for (j = 0; j < toAddArray.length; j++) {\n                    found = false;\n                    for (k = 0; k < sourceArray.length; k++) {\n                        if (sourceArray[k].get('style').isEqual(toAddArray[j])) {\n                            found = true;\n                            sourceArray[k].addUsage(this);\n                            break;\n                        }\n                    }\n                    if (!found) {\n                        usage = new GradientUsageModel({style: toAddArray[j]});\n                        usage.addUsage(this);\n                        sourceArray.push(usage);\n                    }\n                }\n            }\n        },\n\n        isEqual: function (layerModel) {\n            return this.get('layerId') === layerModel.get('layerId');\n        },\n\n        zeroBounds: function () {\n            var bounds = this.get('bounds');\n            return bounds.top === 0 && bounds.bottom === 0 && bounds.left === 0 && bounds.right === 0;\n        },\n\n        zeroRawBounds: function () {\n            var rawBounds = this.get('rawBounds');\n            return !rawBounds || (rawBounds.top === 0 && rawBounds.bottom === 0 && rawBounds.left === 0 && rawBounds.right === 0);\n        },\n\n        isDescendantOf: function (model) {\n            var parentModel = this.get('parentModel'),\n                result = false;\n            while (parentModel && parentModel instanceof LayerModel) {\n                if (parentModel.isEqual(model)) {\n                    result = true;\n                    break;\n                }\n                parentModel = parentModel.get('parentModel');\n            }\n            return result;\n        },\n\n        /**\n         * Returns true if this layer and all ancestor layers visible\n         * property matches their renderedVisible property, meaning, the\n         * layer matches the visibility it had at the time it was rendered\n         * by any associated flattened sprites.\n         */\n        isEffectiveRenderedVisibility: function () {\n            return this.get('renderedVisible') === this.getEffectiveVisibility();\n        },\n\n        /**\n         * Returns true if the layer and all ancestor layer sets are visible.\n         */\n        getEffectiveVisibility: function () {\n            var isVisible = this.isVisibleOnStage(),\n                parentModel = this.get('parentModel'),\n                children = this.get('layerCollection'),\n                child,\n                i;\n            if (isVisible && parentModel && parentModel instanceof LayerModel) {\n                isVisible = parentModel.getEffectiveVisibility();\n            }\n\n            // Layer groups are considered effectively invisible if none of its\n            // children are visible.\n            if (isVisible && children) {\n                isVisible = false;\n                for (i = 0; i < children.length; i++) {\n                    child = children.at(i);\n                    if (child.get('visible')) {\n                        isVisible = true;\n                        break;\n                    }\n                }\n            }\n\n            return isVisible;\n        },\n        \n        /*\n         * Returns the opacity of the object combined with the opacity of any parents.  If any element\n         * is invisible the effective opacity is 0\n         */\n        getEffectiveOpacity: function () {\n            var opacity = this.isVisibleOnStage() ? this.getCombinedOpacity() : 0,\n                parentModel = this.get('parentModel'),\n                children = this.get('layerCollection'),\n                child,\n                i;\n            if (opacity !== 0 && parentModel && parentModel instanceof LayerModel) {\n                opacity = opacity * parentModel.getEffectiveOpacity();\n            }\n            \n            // Layer groups are considered effectively invisible if none of its\n            // children are visible.\n            if (opacity > 0 && children) {\n                var isVisible = false;\n                for (i = 0; i < children.length; i++) {\n                    child = children.at(i);\n                    if (child.get('visible')) {\n                        isVisible = true;\n                        break;\n                    }\n                }\n                if (!isVisible) {\n                    opacity = 0;\n                }\n            }\n\n            return opacity;\n        },\n\n        findDescendantFlattenedSprites: function () {\n            var flattenedLayers = LayerModelMap.getFlattenedLayers(),\n                results = [],\n                self = this;\n            _.each(flattenedLayers, function (layer) {\n                if (layer.isDescendantOf(self)) {\n                    results.push(layer);\n                }\n            });\n            return results;\n        },\n\n        isVisibleOnStage: function () {\n            var visible = this.get('visible'),\n                clipbase = this.get('clipbase'),\n                baseVisible = clipbase ? clipbase.get('visible') : true;\n\n            return visible && baseVisible;\n        },\n        \n        getCombinedOpacity: function () {\n            var blendOptions = this.get('properties') && this.get('properties').get('blendOptions');\n            if (blendOptions) {\n                var opacity = (blendOptions.opacity || 100) / 100,\n                    fillOpacity = (blendOptions.fillOpacity || 100) / 100;\n                return opacity * fillOpacity;\n            } else {\n                return 1;\n            }\n        },\n        \n        canBeExtracted: function () {\n            // a layer can be extracted if it is not an adjustment layer and it is visible\n            // a layerSet can be extracted if it is visible and contains a layer that can be extracted\n            if (this.getEffectiveVisibility()) {\n                if (this.get('type') === 'layerSection') {\n                    var models = this.get('layerCollection') ? this.get('layerCollection').models : [];\n                    return _.some(models, function (value, index) { return value.canBeExtracted(); });\n                } else {\n                    return (this.get('type') !== 'adjustmentLayer');\n                }\n            }\n            return false;\n        }\n    });\n\n    return LayerModel;\n});\n\n//# sourceURL=/lib/graphite-api/public/js/ccweb.files.extract/models/LayerModel.js"),
eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4 */\n/*global define: true, graphite: true*/\n\ndefine('ccweb.files.extract/utils/StyleUtil',[\n    'ccweb.files.extract/models/BaseStyleUsageModel',\n    'ccweb.files.extract/models/ColorModel',\n    'ccweb.files.extract/models/GradientModel',\n    'ccweb.files.extract/models/TextStyleModel'\n], function (BaseStyleUsageModel, ColorModel, GradientModel, TextStyleModel) {\n    'use strict';\n    var StyleUtil = {\n\n        areUsageStylesEqual: function (styleUsage1, styleUsage2) {\n            var isEqual = false;\n            if (styleUsage1 && styleUsage2 &&\n                    (styleUsage1 instanceof BaseStyleUsageModel) &&\n                    (styleUsage2 instanceof BaseStyleUsageModel)) {\n                var style1 = styleUsage1.get('style');\n                var style2 = styleUsage2.get('style');\n\n                if ((style1 instanceof ColorModel && style2 instanceof ColorModel) ||\n                        (style1 instanceof GradientModel && style2 instanceof GradientModel) ||\n                        (style1 instanceof TextStyleModel && style2 instanceof TextStyleModel)) {\n                    isEqual = style1.isEqual(style2);\n                }\n            }\n\n            return isEqual;\n        }\n\n    };\n\n    return StyleUtil;\n\n});\n\n//# sourceURL=/lib/graphite-api/public/js/ccweb.files.extract/utils/StyleUtil.js"),eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4, bitwise: true */\n/*global define: true, graphite: true, window: true, document: true*/\n\ndefine('ccweb.files.extract/controllers/SelectionController',[\n    'jquery',\n    'underscore',\n    'backbone',\n    'ccweb.files.extract/Constants',\n    'ccweb.files.extract/controllers/DetailsController',\n    'ccweb.files.extract/controllers/ZoomController',\n    'ccweb.files.extract/models/LayerModel',\n    'ccweb.files.extract/models/LayerModelMap',\n    'ccweb.files.extract/models/ColorUsageModel',\n    'ccweb.files.extract/models/TextStyleUsageModel',\n    'ccweb.files.extract/models/GradientUsageModel',\n    'ccweb.files.extract/utils/StyleUtil',\n    'ccweb.files.extract/utils/MeasurementUtil'\n], function ($, _, Backbone, Constants, DetailsController, ZoomController, LayerModel,\n        LayerModelMap, ColorUsageModel, TextStyleUsageModel, GradientUsageModel,\n        StyleUtil, MeasurementUtil) {\n    'use strict';\n    var SelectionController = Backbone.Model.extend({\n        selectionMap: {},\n        focusMap: {}, // map of models that are currently in focus (lightboxed)\n\n        defaults: {\n            psdModel: null,\n            psdView: null,\n            extractedStylesInSelection: null //colors/fonts/gradients in the selection\n\n        },\n\n        getPSDModel: function () {\n            return this.psdModel;\n        },\n\n        setPSDModel: function (model) {\n            if (this.psdModel) {\n                this.psdModel.off(null, null, this);\n            }\n\n            this.psdModel = model;\n            this.psdModel.on('change:info', this.handleModelInfoChanged, this);\n            this.resetFocusMap();\n            this.resetSelection();\n\n            this.offscreenCanvas = null;\n            this.offscreenContext = null;\n            this.clipLayersToImage = false;\n            this.handleModelInfoChanged();\n        },\n\n        handleModelInfoChanged: function () {\n            var info = this.psdModel.get('info');\n            if (info && info.hasOwnProperty('clipSpriteSheetLayers')) {\n                this.clipLayersToImage = info.clipSpriteSheetLayers;\n            }\n        },\n\n\n//***** Hover Methods *****/\n        isLayerVisible: function (layerModel, recurse) {\n            var isVisible = layerModel.get('visible');\n            if (recurse && layerModel.get('parentModel') && isVisible) {\n                if (layerModel.get('parentModel') instanceof LayerModel) {\n                    isVisible = this.isLayerVisible(layerModel.get('parentModel'), recurse);\n                }\n            }\n            return isVisible;\n        },\n\n//***** Selection Methods *****/\n\n        isSelected: function (layerID) {\n            return (this.selectionMap[layerID] !== null);\n        },\n\n        getSelectedLayers: function () {\n            return _.values(this.selectionMap);\n        },\n\n        selectParent: function () {\n            // only select the parent if one item is selected\n            if (Object.keys(this.selectionMap).length === 1) {\n                var id,\n                    layerModel,\n                    parentModel;\n\n                for (id in this.selectionMap) {\n                    if (this.selectionMap.hasOwnProperty(id)) {\n                        layerModel = LayerModelMap.getLayerModelFromId(id);\n                        parentModel = layerModel.get('parentModel');\n                        if (parentModel instanceof LayerModel) {\n                            this.changeSelection([parentModel], false);\n                        }\n                    }\n                }\n            }\n        },\n\n        selectTopChild: function () {\n            // the top child in z-order is the last item in the layerCollection\n            // only select the parent if one item is selected\n            if (Object.keys(this.selectionMap).length === 1) {\n                var id,\n                    layerModel,\n                    childLayers;\n\n                for (id in this.selectionMap) {\n                    if (this.selectionMap.hasOwnProperty(id)) {\n                        layerModel = LayerModelMap.getLayerModelFromId(id);\n                        childLayers = layerModel.get('layerCollection');\n                        if (childLayers && childLayers.length > 0) {\n                            this.changeSelection([childLayers.at(childLayers.length - 1)], false);\n                        }\n                    }\n\n                }\n            }\n        },\n\n        selectNextSibling: function () {\n            if (Object.keys(this.selectionMap).length === 1) {\n                var id,\n                    layerModel,\n                    parentModel,\n                    childLayers,\n                    currentIndex;\n\n                for (id in this.selectionMap) {\n                    if (this.selectionMap.hasOwnProperty(id)) {\n                        layerModel = LayerModelMap.getLayerModelFromId(id);\n                        parentModel = layerModel.get('parentModel');\n                        childLayers = parentModel.get('layerCollection');\n                        currentIndex = childLayers.indexOf(layerModel);\n                        if (currentIndex > -1) {\n                            if (currentIndex > 0) {\n                                this.changeSelection([childLayers.at(currentIndex - 1)], false);\n                            } else {\n                                //Wrap around\n                                this.changeSelection([childLayers.at(childLayers.length - 1)], false);\n                            }\n                        }\n                    }\n                }\n            }\n        },\n\n        selectPrevSibling: function () {\n            if (Object.keys(this.selectionMap).length === 1) {\n                var id,\n                    layerModel,\n                    parentModel,\n                    childLayers,\n                    currentIndex;\n\n                for (id in this.selectionMap) {\n                    if (this.selectionMap.hasOwnProperty(id)) {\n                        layerModel = LayerModelMap.getLayerModelFromId(id);\n                        parentModel = layerModel.get('parentModel');\n                        childLayers = parentModel.get('layerCollection');\n                        currentIndex = childLayers.indexOf(layerModel);\n                        if (currentIndex > -1) {\n                            if (currentIndex < childLayers.length - 1) {\n                                this.changeSelection([childLayers.at(currentIndex + 1)], false);\n                            } else {\n                                //Wrap around\n                                this.changeSelection([childLayers.at(0)], false);\n                            }\n                        }\n                    }\n\n                }\n            }\n        },\n\n        changeSelection: function (layerModelArray, addToSelection) {\n            var id, i, layerModel;\n\n            if (!addToSelection || !layerModelArray) {\n                // deselect all selected items\n\n                for (id in this.selectionMap) {\n                    if (this.selectionMap.hasOwnProperty(id)) {\n                        this.selectionMap[id].set('selected', false);\n                    }\n                }\n                this.selectionMap = {};\n            }\n\n            if (layerModelArray) {\n                for (i = 0; i < layerModelArray.length; i++) {\n                    layerModel = layerModelArray[i];\n                    if (layerModel && !layerModel.get('selected')) {\n                        layerModel.set('selected', true);\n                        this.selectionMap[layerModel.get('layerId')] = layerModel;\n                    } else {\n                        if (layerModel && addToSelection) {\n                            //toggle selection off if already selected and modifier is pressed\n                            layerModel.set('selected', false);\n                            delete this.selectionMap[layerModel.get('layerId')];\n                        }\n                    }\n                }\n            }\n\n            graphite.events.trigger('selection-changed');\n            this.updateStylesForSelection();\n        },\n\n        resetSelection: function () {\n            this.selectionMap = {};\n        },\n\n        selectItemAtPoint: function (clientX, clientY, addToSelection) {\n            var hitItem = (clientX !== -1 && clientY !== -1) ? this.itemAtPoint(clientX, clientY) : null;\n            this.changeSelection([hitItem], addToSelection);\n            var hoverArray = hitItem !== null ? [hitItem] : [];\n            graphite.events.trigger('item-hovered-over', hoverArray, true);\n        },\n\n        // Private helper used for replacing a layer group with\n        // an explicit set of its descendants.\n        _expandGroup: function (layer, expanded) {\n            var collection = layer.get('layerCollection'),\n                foundHiddenLayer = false,\n                i;\n            for (i = 0; i < collection.length; i++) {\n                var child = collection.at(i),\n                    childCollection = child.get('layerCollection');\n                expanded.push(child);\n                if (child.get('visible') === false) {\n                    foundHiddenLayer = true;\n                }\n                if (childCollection) {\n                    foundHiddenLayer = foundHiddenLayer || this._expandGroup(child, expanded);\n                }\n            }\n            return foundHiddenLayer;\n        },\n\n        /**\n         * Expands a selection in preparation for asset extraction or sprite\n         * regeneration.  Removes any redundant groups from selection, expands\n         * groups to only include explicitly visible layers, and filters out\n         * non-visible layers.\n         */\n        expandSelection: function (selection) {\n            var filteredGroups = [],\n                expandedLayers = [],\n                expandedGroups = [],\n                filteredSelection = selection,\n                self = this;\n\n            // Remove any redundant groups from original list. Basically\n            // any layer group that has additional descendant layers explicitly\n            // selected, can be filtered out.\n            _.each(selection, function (layer) {\n                var parent = layer.get('parentModel');\n                while (parent) {\n                    if (parent.get('selected')) {\n                        filteredGroups.push(parent.get('layerId'));\n                    }\n                    parent = parent.get('parentModel');\n                }\n            });\n\n            if (filteredGroups.length) {\n                filteredSelection = _.filter(selection, function (layer) {\n                    return filteredGroups.indexOf(layer.get('layerId')) === -1;\n                });\n            }\n\n            // Now expand any remaining groups that have hidden descendants.\n            // Returns true if there was a hidden layer otherwise if false,\n            // there is no reason to expand.\n            _.each(filteredSelection, function (layer) {\n                if (layer.get('layerCollection')) {\n                    var descendants = [],\n                        hasHiddenLayers = self._expandGroup(layer, descendants);\n                    if (hasHiddenLayers) {\n                        expandedGroups.push(layer.get('layerId'));\n                        expandedLayers = expandedLayers.concat(descendants);\n                    }\n                }\n            });\n\n            // Combine any expandedLayers with our original selection.\n            filteredSelection = filteredSelection.concat(expandedLayers);\n\n            // Now filtered out any expanded groups and any hidden layers.\n            filteredSelection = _.filter(filteredSelection, function (layer) {\n                return self.isLayerVisible(layer, true) &&\n                    expandedGroups.indexOf(layer.get('layerId')) === -1;\n            });\n\n            return filteredSelection;\n        },\n\n        updateStylesForSelection: function () {\n            var selectedLayers = this.getSelectedLayers(),\n                extractedStyles = this.psdModel.get('extractedStyles') ||\n                    {colors: [], textStyles: [], gradients: [], models: []},\n                newUsageModels;\n\n            if (selectedLayers.length) {\n                var usageModels = {\n                    colors: [],\n                    textStyles: [],\n                    gradients: []\n                };\n\n                $.each(selectedLayers, function (index, value) {\n                    newUsageModels = value.getUsageModels();\n                    value.combineUsageModels(usageModels, newUsageModels);\n                });\n\n                extractedStyles = {\n                    colors: usageModels.colors,\n                    textStyles: usageModels.textStyles,\n                    gradients: usageModels.gradients,\n                    models: selectedLayers\n                };\n            }\n\n            var arrayToCheck;\n            if (DetailsController.get('selectedInspectItem') instanceof ColorUsageModel) {\n                arrayToCheck = extractedStyles.colors;\n            } else if (DetailsController.get('selectedInspectItem') instanceof TextStyleUsageModel) {\n                arrayToCheck = extractedStyles.textStyles;\n            } else if (DetailsController.get('selectedInspectItem') instanceof GradientUsageModel) {\n                arrayToCheck = extractedStyles.gradients;\n            }\n\n            if (arrayToCheck) {\n                var found = false;\n                $.each(arrayToCheck, function (index, value) {\n                    if (StyleUtil.areUsageStylesEqual(value, DetailsController.get('selectedInspectItem'))) {\n                        DetailsController.set('selectedInspectItem', value);\n                        found = true;\n                        return false;\n                    }\n                    return true;\n                });\n\n                if (!found) {\n                    DetailsController.setSelectedInspectItem(null);\n                }\n            }\n\n            this.set('extractedStylesInSelection', extractedStyles);\n\n        },\n\n\n//***** HitTest Methods *****/\n        itemAtPoint: function (clientX, clientY) {\n            var hitItem = null;\n            var id,\n                root,\n                layerCollection,\n                i,\n                layerItem,\n                psdPt;\n\n            for (id in this.focusMap) {\n                if (this.focusMap.hasOwnProperty(id)) {\n                    root = this.focusMap[id];\n\n                    if (root !== null) {\n                        layerCollection = root.get('layerCollection');\n                        if (layerCollection) {\n                            for (i = layerCollection.length - 1; i >= 0; i--) {\n                                layerItem = layerCollection.at(i);\n                                psdPt = this.convertClientPtToPSDPt(clientX, clientY);\n                                hitItem = this.hitTestItem(layerItem, psdPt.x, psdPt.y, true);\n                                if (hitItem) {\n                                    break;\n                                }\n                            }\n                        }\n                        if (hitItem) {\n                            break;\n                        }\n\n                    }\n                }\n            }\n\n            return hitItem;\n        },\n\n        findHitItem: function (root, x, y, recurse) {\n            var newSelectedItem = null,\n                layerCollection = root.get('layerCollection'),\n                i,\n                layerItem;\n\n            for (i = layerCollection.length - 1; i >= 0; i--) {\n                layerItem = layerCollection.at(i);\n                newSelectedItem = this.hitTestItem(layerItem, x, y, recurse);\n\n                if (newSelectedItem !== null) {\n                    break;\n                }\n            }\n            return newSelectedItem;\n        },\n\n        hitTestItem: function (layerItem, x, y, recurse) {\n            var hitItem = null,\n                bounds = layerItem.get('bounds'),\n                visible = layerItem.get('visible'),\n                adjustmentLayer = layerItem.get('type') === Constants.Type.LAYER_ADJUSTMENT,\n                useBoundsOnly = layerItem.get('type') === Constants.Type.LAYER_TEXT;\n\n            if (visible === undefined) {\n                visible = true;\n            }\n            if (visible && !adjustmentLayer && this.pointInRect(x, y, bounds)) {\n                var canvasItem = LayerModelMap.getLayerInfoForId(layerItem.get('layerId')).item;\n                if (canvasItem[0].tagName === 'CANVAS') {\n                    if (useBoundsOnly || this.pixelHit(canvasItem[0], x, y, bounds)) {\n                        hitItem = layerItem;\n                    }\n                } else {\n                    var children = layerItem.get('layerCollection');\n                    if (children !== null && recurse) {\n                        if (children.at(0).get('rendered') === true || this.psdView.hasSpriteSheets) {\n                            hitItem = this.findHitItem(layerItem, x, y, recurse);\n                        } else {\n                            //use the child canvas that renders the group layer preview to hittest\n                            var groupCanvas = canvasItem.children().first();\n                            if (this.pixelHit(groupCanvas[0], x, y, bounds)) {\n                                hitItem = layerItem;\n                            }\n                        }\n                    }\n                }\n            }\n            return hitItem;\n        },\n\n        pointInRect: function (x, y, rect) {\n            return (x <= rect.right && x >= rect.left && y <= rect.bottom && y >= rect.top);\n        },\n\n        pixelHit: function (canvas, x, y, bounds) {\n            var hit = false,\n                left = bounds.left,\n                top = bounds.top,\n                imgData,\n                i;\n\n            if (!this.offscreenContext) {\n                this.offscreenCanvas = $('<canvas/>')[0];\n                // Note 257x256 here instead of 1x1. For now we are working around\n                // a chrome issue https://code.google.com/p/chromium/issues/detail?id=382588\n                this.offscreenCanvas.width = 257;\n                this.offscreenCanvas.height = 256;\n                this.offscreenContext = this.offscreenCanvas.getContext('2d');\n                this.offscreenContext.webkitImageSmoothingEnabled = false;\n            }\n\n            if (this.clipLayersToImage) {\n                left = Math.max(left, 0);\n                top = Math.max(top, 0);\n            }\n\n            this.offscreenContext.clearRect(0, 0, 1, 1);\n            this.offscreenContext.drawImage(canvas, x - left, y - top, 1, 1, 0, 0, 1, 1);\n\n            imgData = this.offscreenContext.getImageData(0, 0, 1, 1);\n\n            for (i = 0; i < imgData.data.length; i += 4) {\n                if (imgData.data[i + 3] > 0) {\n                    hit = true;\n                    break;\n                }\n            }\n            return hit;\n        },\n\n        resetFocusMap: function () {\n            this.focusMap = {'root': this.psdModel};\n        },\n\n        groupExpanded: function (model) {\n            this.psdView.groupExpanded(model);\n        },\n\n        convertClientPtToPSDPt: function (clientX, clientY) {\n            var psdPt = {},\n                $results = $('.psd-preview-view');\n            var documentOffset = $results.find('.preview-container').offset();\n            var paddingTop = $results.find('.preview-container').css('padding-top');\n            var paddingLeft = $results.find('.preview-container').css('padding-left');\n\n            psdPt.x = clientX - documentOffset.left - parseInt(paddingLeft, 10);\n            psdPt.y = clientY - documentOffset.top - parseInt(paddingTop, 10);\n\n            psdPt = ZoomController.zoomPoint(psdPt, true);\n\n            return psdPt;\n        },\n\n        clearDOMSelection: function () {\n            if (window.getSelection) {\n                if (window.getSelection().empty) {  // Chrome\n                    window.getSelection().empty();\n                } else if (window.getSelection().removeAllRanges) {  // Firefox\n                    window.getSelection().removeAllRanges();\n                }\n            } else if (document.selection) {  // IE?\n                document.selection.empty();\n            }\n        },\n\n        enableDropperTool: function () {\n            if (DetailsController.get('activeTool') === Constants.Tool.DROPPER) {\n                this.disableDropperTool();\n                return;\n            }\n\n            DetailsController.changeActiveTool(Constants.Tool.DROPPER);\n            this.selectItemAtPoint(-1, -1, false);\n            DetailsController.setSelectedInspectItem(null);\n            $('.extract-plugin').addClass('dropper-tool');\n            graphite.events.trigger('dropperStart');\n        },\n\n        disableDropperTool: function () {\n            DetailsController.changeActiveTool(Constants.Tool.SELECT_DIRECT);\n            $('.extract-plugin').removeClass('dropper-tool');\n            graphite.events.trigger('dropperStop');\n        },\n\n        rectIntersectsWith: function (a, b) {\n            if (a.left < b.right && b.left < a.right && a.top < b.bottom) {\n                return b.top < a.bottom;\n            }\n            return false;\n        },\n\n        rectIntersect: function (a, b) {\n            var x = Math.max(a.left, b.left),\n                y = Math.max(a.top, b.top),\n                overlapX = Math.min(a.right, b.right),\n                overlapY = Math.min(a.bottom, b.bottom);\n            if (overlapX >= x && overlapY >= y) {\n                return {\n                    left: x - b.left,\n                    top: y - b.top,\n                    width: overlapX - x,\n                    height: overlapY - y,\n                    destLeft: x - a.left,\n                    destTop: y - a.top\n                };\n            }\n            return null;\n        },\n\n        findIntersectsBackToFront: function (rect, collection, intersects) {\n            var layerCollection = collection || this.psdModel.get('layerCollection'),\n                results = intersects || [],\n                layerItem,\n                origItem,\n                layerBounds,\n                flattenedSprite,\n                flattenedParent,\n                childCollection,\n                intersect,\n                i;\n\n            if (layerCollection) {\n                for (i = layerCollection.length - 1; i >= 0; i--) {\n\n                    layerItem = origItem = layerCollection.at(i);\n                    layerBounds = MeasurementUtil.getVisibleBounds(layerItem, this.psdModel, true);\n                    flattenedSprite = layerItem.get('flattenedSprite');\n                    flattenedParent = layerItem.get('flattenedParent');\n\n                    // Bubble up to flattened sprite if necessary\n                    if (layerItem.get('visible') && flattenedParent) {\n                        layerItem = LayerModelMap.getModel(flattenedParent);\n                        flattenedSprite = layerItem.get('flattenedSprite');\n                    }\n\n                    if (flattenedSprite) {\n                        var psdOrigin = flattenedSprite.altPsdOrigin || flattenedSprite.psdOrigin;\n                        layerBounds.left = psdOrigin.left;\n                        layerBounds.top = psdOrigin.top;\n                        layerBounds.bottom = layerBounds.top + (flattenedSprite.bounds.bottom - flattenedSprite.bounds.top);\n                        layerBounds.right = layerBounds.left + (flattenedSprite.bounds.right - flattenedSprite.bounds.left);\n                    }\n\n                    if (origItem.getEffectiveVisibility()) {\n                        childCollection = layerItem.get('layerCollection');\n                        if (childCollection && !flattenedSprite) {\n                            if (this.rectIntersectsWith(rect, layerBounds)) {\n                                this.findIntersectsBackToFront(rect, childCollection, results);\n                            }\n                        } else {\n                            intersect = this.rectIntersect(rect, layerBounds);\n                            if (intersect) {\n                                results.push({item: layerItem, intersect: intersect});\n                            }\n                        }\n\n                        if (flattenedSprite) {\n                            break;\n                        }\n                    }\n\n                }\n            }\n\n            return results;\n        },\n        \n//***** Asset Extraction Methods *****/\n        canExtractAsset: function () {\n            var selectedLayers = this.expandSelection(this.getSelectedLayers());\n            \n            return _.some(selectedLayers, function (value, index) {\n                return value.canBeExtracted();\n            });\n            \n        }\n\n    });\n\n    return new SelectionController();\n});\n\n//# sourceURL=/lib/graphite-api/public/js/ccweb.files.extract/controllers/SelectionController.js"),eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4 */\n/*global define: true, graphite: true, navigator: true, document: true*/\n\ndefine('ccweb.files.extract/utils/KeyboardUtils',['jquery', 'underscore', 'ccweb.files.extract/Constants'], function ($, _, Constants) {\n    'use strict';\n    var KeyboardUtils = {\n\n        isMultiSelectKey: function (event) {\n            var multiSelect = event.shiftKey;\n            var os = this.getPlatform();\n            if (event.metaKey && os === Constants.Platform.MAC) {   /// this is Mac check for cmd key\n                multiSelect = true;\n            } else if (event.ctrlKey && os === Constants.Platform.WINDOWS) {\n                multiSelect = true;\n            }\n            return multiSelect;\n        },\n\n        getPlatform: function () {\n            var osStr = navigator.appVersion.toLowerCase();\n            if (osStr.indexOf('macintosh') > -1) {\n                osStr = Constants.Platform.MAC;\n            } else if (osStr.indexOf('windows') > -1) {\n                osStr = Constants.Platform.WINDOWS;\n            }\n            return osStr;\n        },\n\n        getActiveFocusedElement: function () {\n            var $activeElement = $(document.activeElement);\n            return $activeElement;\n        },\n\n        getMetaKeyName: function (name) {\n            var keyName = String(name).toLowerCase(),\n                platform = this.getPlatform();\n            if (keyName === 'ctrl' || keyName === 'cmd') {\n                return platform === Constants.Platform.MAC ? '' : 'Ctrl';\n            } else if (keyName === 'shift') {\n                return platform === Constants.Platform.MAC ? '' : 'Shift';\n            } else if (keyName === 'alt' || keyName === 'option') {\n                return platform === Constants.Platform.MAC ? '' : 'Alt';\n            }\n            return name;\n        },\n\n        _doesFocusedElementHaveTag: function (tags) {\n            var $el = this.getActiveFocusedElement();\n            if ($el && $el.length) {\n                var isCheck = function (tag) {\n                    return $el.is(tag);\n                };\n                if (_.some(tags, isCheck)) {\n                    if (!$el.is('input') && !$el.is('textarea')) {\n                        if (!$el[0].isContentEditable) {\n                            return null;\n                        }\n                    }\n                    return $el;\n                }\n            }\n            return null;\n        },\n\n        isInputInFocus: function () {\n            return this._doesFocusedElementHaveTag(['input', 'p', 'div', 'textarea']);\n        }\n\n    };\n\n    return KeyboardUtils;\n});\n\n//# sourceURL=/lib/graphite-api/public/js/ccweb.files.extract/utils/KeyboardUtils.js"),eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4 */\n/*global define: true, graphite: true, document: true*/\n\ndefine('ccweb.files.extract/controllers/KeyboardController',[\n    'jquery',\n    'underscore',\n    './SelectionController',\n    './DetailsController',\n    'ccweb.files.extract/Constants',\n    'ccweb.files.extract/utils/KeyboardUtils'\n], function ($, _, SelectionController, DetailsController, Constants, KeyboardUtils) {\n    'use strict';\n\n    var KeyboardController = {\n        attachedElement: null,\n        multiSelectPending: false,\n\n        // attach key handlers to the passed in $element, replacing any previously passed in $element.\n        // if no element is passed in, then use document.\n        attachKeyHandlers: function ($element) {\n            if (this.attachedElement) {\n                this.removeKeyHandlers();\n            }\n            _.bindAll(this, 'handleKeyUp', 'handleKeyDown');\n            this.attachedElement = $element || $(document);\n            this.attachedElement.keyup(this.handleKeyUp);\n            this.attachedElement.keydown(this.handleKeyDown);\n        },\n\n        removeKeyHandlers: function () {\n            if (this.attachedElement) {\n                this.attachedElement.unbind('keyup', this.handleKeyUp);\n                this.attachedElement.unbind('keydown', this.handleKeyDown);\n                this.attachedElement = null;\n            }\n        },\n\n        isMultiSelectModifier: function (e) {\n            var result = KeyboardUtils.isMultiSelectKey(e);\n\n            // Also make sure that the modifier is the only key pressed.\n            if (result) {\n                result = _.contains([\n                    Constants.Shortcut.SHIFT,\n                    Constants.Shortcut.CTRL,\n                    Constants.Shortcut.CMD,\n                    Constants.Shortcut.SECONDARY_CMD,\n                    Constants.Shortcut.CMD_FF\n                ], e.keyCode);\n            }\n\n            return result;\n        },\n\n        setMultiSelectPending: function (value) {\n            if (this.multiSelectPending !== value) {\n                graphite.events.trigger('multiSelectPending', value);\n                this.multiSelectPending = value;\n            }\n        },\n\n        handleKeyDown: function (e) {\n            this.setMultiSelectPending(this.isMultiSelectModifier(e));\n\n            switch (e.keyCode) {\n            case Constants.Shortcut.LEFT_ARROW:\n            case Constants.Shortcut.RIGHT_ARROW:\n            case Constants.Shortcut.UP_ARROW:\n            case Constants.Shortcut.DOWN_ARROW:\n                if (this.handleArrowKeys) {\n                    if (SelectionController.getSelectedLayers().length !== 0) {\n                        e.stopPropagation();\n                        e.preventDefault();\n                    }\n                }\n                break;\n            }\n        },\n\n        _hasFocus: function () {\n            return document.activeElement === this.attachedElement[0] ||\n                !KeyboardUtils.isInputInFocus();\n        },\n\n        handleKeyUp: function (e) {\n            if (!this._hasFocus() || $('#habla_window_state_div').hasClass('olrk-state-expanded')) {\n                return;\n            }\n\n            this.setMultiSelectPending(false);\n\n            switch (e.keyCode) {\n            case Constants.Shortcut.CLEAR:\n                graphite.events.trigger('hide-help-dialog');\n                graphite.events.trigger('hide-first-user-overlay');\n                SelectionController.disableDropperTool();\n                SelectionController.selectItemAtPoint(-1, -1, false);\n                DetailsController.setSelectedInspectItem(null);\n                break;\n            case Constants.Shortcut.LEFT_ARROW:\n                SelectionController.selectParent();\n                break;\n            case Constants.Shortcut.RIGHT_ARROW:\n                SelectionController.selectTopChild();\n                break;\n            case Constants.Shortcut.UP_ARROW:\n                SelectionController.selectPrevSibling();\n                break;\n            case Constants.Shortcut.DOWN_ARROW:\n                SelectionController.selectNextSibling();\n                break;\n            case Constants.Shortcut.TOGGLE_MEASUREMENT:\n                if (DetailsController.get('activeTool') === Constants.Tool.DROPPER) {\n                    SelectionController.disableDropperTool();\n                }\n                DetailsController.setToggleMeasurementOnHover();\n                graphite.events.trigger('toggle-hover-measurement');\n                break;\n            case Constants.Shortcut.HELP:\n                var helpDialogIsVisible = $('div.keystroke-window-overlay').is(':visible');\n                if (!helpDialogIsVisible) {\n                    graphite.events.trigger('help-dialog-shortcut');\n                }\n                graphite.events.trigger('toggle-help-dialog');\n                break;\n            case Constants.Shortcut.COLOR_PICKER:\n                DetailsController.disableMeasurementOnHover();\n                if (!e.ctrlKey && !e.shiftKey && !e.metaKey && !e.altKey) {\n                    SelectionController.enableDropperTool();\n                }\n                break;\n            case Constants.Shortcut.FUX:\n                var fuxOverlayIsVisible = $('div.first-user-exp-overlay').is(':visible');\n                if (!fuxOverlayIsVisible) {\n                    graphite.events.trigger('first-user-overlay-shortcut');\n                }\n                graphite.events.trigger('toggle-first-user-overlay');\n                break;\n            }\n        }\n    };\n\n    return KeyboardController;\n});\n\n//# sourceURL=/lib/graphite-api/public/js/ccweb.files.extract/controllers/KeyboardController.js"),
eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4 */\n/*global define: true, graphite: true*/\n\ndefine('ccweb.files.extract/utils/ImageUtil',['jquery'], function ($) {\n    'use strict';\n\n    var ImageUtil = {\n\n        ImageScaleType: {\n            FIT: 'fit',\n            FILL: 'fill'\n        },\n\n        // TO DO:  consolidate these 2 functions\n        calcImageSizeToFit: function (image, targetWidth, targetHeight) {\n            var ratio = image.naturalWidth / image.naturalHeight;\n            var w, h;\n            if (ratio * targetHeight > targetWidth) {\n                w = targetWidth;\n                h = targetWidth / ratio;\n            } else {\n                h = targetHeight;\n                w = targetHeight * ratio;\n            }\n\n            var x = (targetWidth - w) / 2;\n            var y = (targetHeight - h) / 2;\n\n            return {width: w, height: h, x: x, y: y};\n        },\n\n\n        calcImageSizeToFill: function (image, targetWidth, targetHeight) {\n            var ratio = image.naturalWidth / image.naturalHeight;\n\n            var w, h;\n            if (ratio * targetHeight < targetWidth) {\n                w = targetWidth;\n                h = targetWidth / ratio;\n            } else {\n                h = targetHeight;\n                w = targetHeight * ratio;\n            }\n\n            return {width: w, height: h};\n        },\n\n        // Please pass in an image element, not a jquery object\n        sizeAndCenterImage: function (image, targetWidth, targetHeight, scaleType, scaleUp) {\n            var info, nw, nh;\n            if (scaleType === this.ImageScaleType.FIT) {\n                info = this.calcImageSizeToFit(image, targetWidth, targetHeight);\n            } else {\n                info = this.calcImageSizeToFill(image, targetWidth, targetHeight);\n            }\n\n            nw = info.width;\n            nh = info.height;\n\n            if (!scaleUp) {\n                var imageWidth = image.naturalWidth;\n                var imageHeight = image.naturalHeight;\n\n                nw = imageWidth !== 0 ? Math.min(info.width, imageWidth) : info.width;\n                nh = imageHeight !== 0 ? Math.min(info.height, imageHeight) : info.height;\n            }\n\n            $(image).width(nw + 'px');\n            $(image).height(nh + 'px');\n\n            $(image).css('margin-left', (targetWidth - nw) / 2 + 'px');\n            $(image).css('margin-top', (targetHeight - nh) / 2 + 'px');\n        }\n\n    };\n\n    return ImageUtil;\n});\n\n//# sourceURL=/lib/graphite-api/public/js/ccweb.files.extract/utils/ImageUtil.js"),eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4 */\n/*global define: true, graphite: true*/\n\ndefine('ccweb.files.extract/utils/SpriteSheetUtils',[\n    'jquery',\n    './ImageUtil',\n    'ccweb.files.extract/controllers/DetailsController'\n], function ($, ImageUtil, DetailsController) {\n    'use strict';\n    var SpriteSheetUtils = {\n\n        drawSprite: function (view, selector, data, htmltag, constrainContainer) {\n            var theBounds = data.bounds;\n            return function (image) {\n                var wrapperWidth,\n                    wrapperHeight,\n                    width,\n                    height,\n                    bnds,\n                    info,\n                    nw,\n                    nh,\n                    theCanvas = htmltag[0],\n                    context = theCanvas.getContext('2d');\n\n                width = theBounds.right - theBounds.left;\n                height = theBounds.bottom - theBounds.top;\n\n                if (constrainContainer) {\n                    wrapperWidth = parseInt($(view.el).find(selector).css('max-width'), 10);\n                    wrapperHeight = parseInt($(view.el).find(selector).css('max-height'), 10);\n\n                    // Maintain aspect\n                    if (wrapperHeight) {\n                        wrapperHeight = Math.min(wrapperHeight, height);\n                    }\n                } else {\n                    wrapperWidth = parseInt($(view.el).find(selector).css('width'), 10);\n                    wrapperHeight = parseInt($(view.el).find(selector).css('height'), 10);\n                    if (wrapperWidth === 0) {\n                        wrapperWidth = 40;\n                        wrapperHeight = 30;\n                    }\n                }\n\n                bnds = { naturalWidth: width,\n                    naturalHeight: height};\n                info = ImageUtil.calcImageSizeToFit(bnds, wrapperWidth,\n                            wrapperHeight || height);\n                nw = info.width;\n                nh = info.height;\n                theCanvas = htmltag[0];\n\n                if (constrainContainer) {\n                    wrapperHeight = nh;\n                }\n\n                theCanvas.width = wrapperWidth;\n                theCanvas.height = wrapperHeight;\n                context.drawImage(image, theBounds.left, theBounds.top, width, height, (wrapperWidth - nw) / 2, (wrapperHeight - nh) / 2, nw, nh);\n            };\n        },\n\n        drawSpriteRect: function (view, theBounds, data, selector, htmltag, constrainContainer) {\n            var wrapperWidth,\n                wrapperHeight,\n                width,\n                height,\n                bnds,\n                info,\n                nw,\n                nh,\n                theCanvas = htmltag[0],\n                context = theCanvas.getContext('2d');\n\n            width = theBounds.right - theBounds.left;\n            height = theBounds.bottom - theBounds.top;\n\n            if (constrainContainer) {\n                wrapperWidth = parseInt($(view.el).find(selector).css('max-width'), 10);\n                wrapperHeight = parseInt($(view.el).find(selector).css('max-height'), 10);\n                // Maintain aspect\n                if (wrapperHeight) {\n                    wrapperHeight = Math.min(wrapperHeight, height);\n                }\n            } else {\n                wrapperWidth = parseInt($(view.el).find(selector).css('width'), 10);\n                wrapperHeight = parseInt($(view.el).find(selector).css('height'), 10);\n                if (wrapperWidth === 0 || wrapperHeight === 0) {\n                    wrapperWidth = 40;\n                    wrapperHeight = 30;\n                }\n            }\n\n            bnds = { naturalWidth: width,\n                naturalHeight: height};\n            info = ImageUtil.calcImageSizeToFit(bnds, wrapperWidth,\n                    wrapperHeight || height);\n            nw = info.width;\n            nh = info.height;\n            theCanvas = htmltag[0];\n\n            if (constrainContainer) {\n                wrapperHeight = nh;\n            }\n\n            theCanvas.width = wrapperWidth;\n            theCanvas.height = wrapperHeight;\n\n            context.globalAlpha = data.opacity / 255;\n            context.beginPath();\n            context.rect((wrapperWidth - nw) / 2, (wrapperHeight - nh) / 2, nw, nh);\n            context.fillStyle = 'rgb(' + data.color.red + ',' + data.color.green + ',' + data.color.blue + ')';\n            context.fill();\n        },\n\n        renderSpriteModel: function (view, model, containerSelector, canvasSelector, constrainContainer) {\n            var spriteSheet = model.get('spriteSheet');\n            if (spriteSheet) {\n                if (spriteSheet.sheetID) {\n                    DetailsController.drawSpriteSheet(spriteSheet.sheetID, this.drawSprite(view, containerSelector, spriteSheet, view.$el.find(canvasSelector), constrainContainer), this);\n                } else if (spriteSheet.color) {\n                    this.drawSpriteRect(view, model.get('bounds'), spriteSheet, containerSelector, view.$el.find(canvasSelector), constrainContainer);\n                }\n            } else {\n                var data = {opacity: 0, color: {red: 0, green: 0, blue: 0}},\n                    $canvas = view.$el.find(canvasSelector);\n                if ($canvas.length) {\n                    this.drawSpriteRect(view, model.get('bounds'), data, containerSelector, view.$el.find(canvasSelector));\n                }\n            }\n        }\n\n    };\n\n    return SpriteSheetUtils;\n});\n\n//# sourceURL=/lib/graphite-api/public/js/ccweb.files.extract/utils/SpriteSheetUtils.js"),eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4 */\n/*global define: true, graphite: true*/\n\ndefine('ccweb.files.extract/utils/TemplateUtil',[\n    'jquery',\n    'underscore',\n    'plugin-dependencies'\n], function ($, _, deps) {\n    'use strict';\n    var TemplateUtil = {\n\n        createTemplate: function (srcHTML, data) {\n            var normalizedHTML = graphite.isFeatureEnabled('ccweb') ?\n                    srcHTML.replace(/\\/images\\//g, '/resource/extract/parfait/public/images/') :\n                    srcHTML,\n                context = _.extend({translate: deps.translate}, data),\n                template = _.template(normalizedHTML);\n\n            return $(template(context).trim()).filter('*');\n        }\n\n    };\n\n    return TemplateUtil;\n});\n\n//# sourceURL=/lib/graphite-api/public/js/ccweb.files.extract/utils/TemplateUtil.js"),eval('define(\'text!override/views/templates/layerListItemTemplate.html\',[],function () { return \'<div class="layer-item">\\n    <div class="layer-bg"></div>\\n    <div class="visible-button"></div>\\n    <div class="image-wrapper">\\n        <% if (type == "textLayer") { %>\\n            <div class="text-layer-icon">T</div>\\n        <% } %>\\n        <canvas id="sprite_preview" class="preview" width="40" height="30"></canvas>\\n        <div class="preview-warning"></div>\\n    </div>\\n    <h5 class="layer-label" title="<%- layerName %>"> <%- layerName %> </h5>\\n    <div class="export-buttons">\\n        <span class="asset-button"></span>\\n    </div>\\n</div>\';});\n\n//# sourceURL=/text!override/views/templates/layerListItemTemplate.html'),eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013-2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4 */\n/*global define: true, graphite: true, clearTimeout: true, setTimeout: true, clearTimeout: true*/\n\ndefine('ccweb.files.extract/views/layers/LayerItemView',[\n    'jquery',\n    'underscore',\n    'backbone',\n    'ccweb.files.extract/controllers/SelectionController',\n    'ccweb.files.extract/utils/SpriteSheetUtils',\n    'ccweb.files.extract/utils/KeyboardUtils',\n    'ccweb.files.extract/utils/TemplateUtil',\n    'text!ccweb.files.extract/views/templates/layerListItemTemplate.html'\n], function ($, _, Backbone, SelectionController,\n    SpriteSheetUtils, KeyboardUtils, TemplateUtil, LayerListItemTemplate) {\n    'use strict';\n    var LayerItemView = Backbone.View.extend({\n\n        className: 'layer-item-row',\n\n        events: {\n            'click': 'handleLayerSelect',\n            'mouseenter': 'handleMouseEnter',\n            'mouseleave': 'handleMouseLeave',\n            'click .asset-button': 'handleExtractAssetClick'\n        },\n\n        initialize: function (options) {\n            _.bindAll(this,\n                'handleVisibilityToggleClick',\n                'handleThumbMouseEnter',\n                'handleThumbMouseLeave');\n\n            this.model.set('psdGuid', options.psdGuid);\n            this.model.set('toplevel', options.toplevel);\n            this.parentView = options.parentView;\n            this.render();\n\n            this.$el.find('.image-wrapper').first().on('mouseenter', this.handleThumbMouseEnter);\n            this.$el.find('.image-wrapper').first().on('mouseleave', this.handleThumbMouseLeave);\n            this.$el.find('.visible-button').first().on('click', this.handleVisibilityToggleClick);\n            this.addHandlers();\n        },\n\n        render: function () {\n            var json = this.model.toJSON();\n            this.$el.html(TemplateUtil.createTemplate(LayerListItemTemplate, json));\n\n            this.$previewWarning = this.$el.find('div.preview-warning');\n            var icon = this.$el.find('div.layer-icon');\n\n            if (json.properties.attributes.shape) {\n                icon.addClass('vector');\n            } else if (json.type === 'textLayer') {\n                icon.addClass('text');\n            } else {\n                icon.addClass('none');\n            }\n\n            // Initial state\n            this.handleFlattenedChange();\n            this.handleVisibilityChange();\n            this.drawSpriteSheet();\n\n            this.processLayerWarning();\n\n            return this;\n        },\n\n        addHandlers: function () {\n            this.model.on('change:visible', this.handleVisibilityChange, this);\n            this.model.on('change:selected', this.handleSelectionChange, this);\n            this.model.on('change:isFlattened', this.handleFlattenedChange, this);\n            graphite.events.on('selectedTab', this.handleSelectedTab, this);\n            graphite.events.on('reset-layers-visibility', this.handleVisibilityReset, this);\n        },\n\n        removeEventListeners: function () {\n            this.model.off(null, null, this);\n            graphite.events.off(null, null, this);\n        },\n\n        drawSpriteSheet: function () {\n            SpriteSheetUtils.renderSpriteModel(this, this.model, '.image-wrapper', '#sprite_preview', false);\n        },\n\n        handleExtractAssetClick: function (event) {\n            if (!this.model.get('selected')) {\n                SelectionController.changeSelection([this.model], false);\n            }\n            graphite.events.trigger('show-extract-asset-popup',\n                {sourceElement: $(event.target), layerModel: this.model, origin : 'layerPanel'});\n            event.stopPropagation();\n        },\n\n        handleMouseEnter: function () {\n            this.$el.find('.layer-item').toggleClass('show-export', this.model.canBeExtracted());\n            graphite.events.trigger('item-hovered-over', [this.model], true);\n        },\n\n        handleMouseLeave: function () {\n            if (!this.model.get('selected')) {\n                this.$el.find('.layer-item').removeClass('show-export');\n            }\n        },\n\n        handleThumbMouseEnter: function () {\n            var self = this;\n            if (this.hoverTimer) {\n                clearTimeout(this.hoverTimer);\n            }\n            graphite.events.trigger('load-layer-thumb-popup',\n                {model: self.model});\n\n            this.hoverTimer = setTimeout(function () {\n                graphite.events.trigger('show-layer-thumb-popup',\n                    {sourceElement: $(self.el).find('#sprite_preview').first(), model: self.model});\n            }, 500);\n        },\n\n        handleThumbMouseLeave: function () {\n            var self = this;\n            if (this.hoverTimer) {\n                clearTimeout(this.hoverTimer);\n                this.hoverTimer = null;\n            }\n\n            graphite.events.trigger('hide-layer-thumb-popup',\n                {sourceElement: $(self.el).find('#sprite_preview').first(), model: self.model});\n        },\n\n        handleLayerSelect: function (event) {\n            SelectionController.changeSelection([this.model], KeyboardUtils.isMultiSelectKey(event));\n        },\n\n        handleSelectionChange: function () {\n            if (this.$el.hasClass('selected')) {\n                this.$el.removeClass('selected');\n                if (this.parentView) {\n                    this.parentView.childSelected(false);\n                }\n            }\n            if (this.model.get('selected') === true) {\n                this.$el.addClass('selected');\n                if (this.model.canBeExtracted()) {\n                    this.$el.find('.layer-item').addClass('show-export');\n                }\n                if (this.parentView) {\n                    this.parentView.childSelected(true);\n                    this.parentView.expand();\n                    this.parentView.scrollIntoView();\n                }\n            } else {\n                this.$el.find('.layer-item').removeClass('show-export');\n            }\n        },\n\n        handleFlattenedChange: function () {\n            var props = this.model.get('properties'),\n                isFlattened = this.model.get('isFlattened'),\n                isVisible = this.model.get('visible'),\n                blendOptions = props ? props.get('blendOptions') : null,\n                showWarning = false;\n\n            if (blendOptions && !isFlattened && isVisible) {\n                if (blendOptions.mode && (blendOptions.mode !== 'passThrough')) {\n                    showWarning = true;\n                }\n            }\n\n            this.processLayerWarning(showWarning);\n        },\n\n        processLayerWarning: function (show) {\n            if (show || this.model.isFontSubstitution()) {\n                this.$previewWarning.show();\n            } else {\n                this.$previewWarning.hide();\n            }\n        },\n\n        handleSelectedTab: function (params) {\n            if (params.selectedTab === 'Layers') {\n                if (this.model.get('selected') === true) {\n                    if (this.parentView) {\n                        this.parentView.expand();\n                        this.parentView.scrollIntoView();\n                    }\n                }\n            }\n        },\n\n        handleVisibilityChange: function () {\n            var $visibleButton = this.$el.find('.visible-button').first();\n            $visibleButton.toggleClass('off-state', !this.model.get('visible'));\n            this.$el.find('.layer-item').toggleClass('show-export', this.model.get('selected') === true && this.model.canBeExtracted());\n            this.handleFlattenedChange();\n        },\n\n        handleVisibilityToggleClick: function (event) {\n            var visible = this.model.get('visible');\n            this.model.set('visible', !visible);\n            graphite.events.trigger('layerVisiblityChanged', { layer: this.model });\n            event.stopPropagation();\n        },\n\n        handleVisibilityReset: function () {\n            this.model.set('visible', this.model.get('psdVisible'));\n        },\n\n        remove: function () {\n            this.removeEventListeners();\n            Backbone.View.prototype.remove.call(this);\n        }\n    });\n\n    return LayerItemView;\n\n});\n\n\n//# sourceURL=/lib/graphite-api/public/js/ccweb.files.extract/views/layers/LayerItemView.js"),eval('/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013-2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4 */\n/*global define: true, graphite: true, clearTimeout: true, setTimeout: true, clearTimeout: true*/\n\ndefine(\'override/views/layers/BracketsLayerItemView\',[\n    \'ccweb.files.extract/controllers/SelectionController\',\n    \'ccweb.files.extract/views/layers/LayerItemView\',\n    \'ccweb.files.extract/utils/SpriteSheetUtils\',\n    \'ccweb.files.extract/Constants\'\n], function (SelectionController, LayerItemView, SpriteSheetUtils, Constants) {\n    "use strict";\n\n    var BracketsLayerItemView = LayerItemView.extend({\n\n        drawSpriteSheet: function () {\n            if (this.model.get("type") === Constants.Type.LAYER_TEXT) {\n                this.$el.find("#sprite_preview").addClass("text-layer");\n            }\n\n            SpriteSheetUtils.renderSpriteModel(this, this.model, ".image-wrapper", \'#sprite_preview\', false);\n        },\n\n        handleVisibilityToggleClick: function (event) {\n            LayerItemView.prototype.handleVisibilityToggleClick.call(this, event);\n\n            graphite.events.trigger("layer-visibility-toggle", {\n                visible: this.model.get("visible")\n            });\n        },\n\n        handleLayerSelect: function (event) {\n            LayerItemView.prototype.handleLayerSelect.call(this, event);\n\n            graphite.events.trigger("layer-select", {\n                source: "layers-panel",\n                numLayers: SelectionController.getSelectedLayers().length,\n                type: this.model.get("type")\n            });\n        }\n\n    });\n\n    return BracketsLayerItemView;\n\n});\n\n\n//# sourceURL=/./views/layers/BracketsLayerItemView.js'),eval("/*\r\n * ADOBE CONFIDENTIAL\r\n *\r\n * Copyright (c) 2013-2014 Adobe Systems Incorporated. All rights reserved.\r\n *\r\n * NOTICE:  All information contained herein is, and remains\r\n * the property of Adobe Systems Incorporated and its suppliers,\r\n * if any.  The intellectual and technical concepts contained\r\n * herein are proprietary to Adobe Systems Incorporated and its\r\n * suppliers and are protected by trade secret or copyright law.\r\n * Dissemination of this information or reproduction of this material\r\n * is strictly forbidden unless prior written permission is obtained\r\n * from Adobe Systems Incorporated.\r\n */\r\n\r\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4 */\r\n/*global define: true, graphite: true*/\r\n\r\n/* superclass for layers list items that handles selection and visibility */\r\ndefine('ccweb.files.extract/views/layers/LayersListItemView',[\r\n    'jquery',\r\n    'underscore',\r\n    'backbone',\r\n    'ccweb.files.extract/controllers/SelectionController',\r\n    'ccweb.files.extract/utils/KeyboardUtils'\r\n], function ($, _, Backbone, SelectionController, KeyboardUtils) {\r\n    'use strict';\n    var LayersListItemView = Backbone.View.extend({\r\n\r\n        className: 'layer-item-row',\n\r\n        initialize: function (options) {\r\n            this.parentView = options.parentView;\r\n        },\r\n\r\n        addHandlers: function () {\r\n            this.model.on('change:visible', this.handleVisibilityChange, this);\n            this.model.on('change:selected', this.handleSelectionChange, this);\n            graphite.events.on('reset-layers-visibility', this.handleVisibilityReset, this);\n        },\r\n\r\n        render: function () {\r\n            return this;\r\n        },\r\n\r\n        removeEventListeners: function () {\r\n            this.model.off(null, null, this);\r\n        },\r\n\r\n        handleLayerSelect: function (event) {\r\n            SelectionController.changeSelection([this.model], KeyboardUtils.isMultiSelectKey(event));\r\n        },\r\n\r\n        handleSelectionChange: function () {\r\n            if (this.$el.hasClass('selected')) {\n                this.$el.removeClass('selected');\n                if (this.parentView) {\r\n                    this.parentView.childSelected(false);\r\n                }\r\n            }\r\n\r\n            if (this.model.get('selected') === true) {\r\n                this.$el.addClass('selected');\n                if (this.model.canBeExtracted()) {\r\n                    this.$el.find('.layer-group-header').first().addClass('show-export');\n                }\r\n                if (this.parentView) {\r\n                    this.parentView.childSelected(true);\r\n                    this.parentView.expand();\r\n                }\r\n                this.scrollIntoView();\r\n            } else {\r\n                this.$el.find('.layer-group-header').first().removeClass('show-export');\n            }\r\n        },\r\n\r\n        handleVisibilityChange: function () {\r\n            var $visibleButton = this.$el.find('.visible-button').first();\r\n            $visibleButton.toggleClass('off-state', !this.model.get('visible'));\r\n            this.$el.find('.layer-group-header').toggleClass('show-export', this.model.get('selected') === true && this.model.canBeExtracted());\n        },\r\n\r\n        handleVisibilityToggleClick: function (event) {\r\n            this.model.set('visible', !this.model.get('visible'));\n            graphite.events.trigger('layerVisiblityChanged', { layer: this.model });\r\n            event.stopPropagation();\r\n        },\r\n\r\n        handleVisibilityReset: function () {\r\n            this.model.set('visible', this.model.get('psdVisible'));\n        },\r\n\r\n        remove: function () {\r\n            this.removeEventListeners();\r\n            Backbone.View.prototype.remove.call(this);\r\n        }\r\n\r\n    });\r\n\r\n    return LayersListItemView;\r\n});\r\n\n//# sourceURL=/lib/graphite-api/public/js/ccweb.files.extract/views/layers/LayersListItemView.js"),eval('/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013-2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4 */\n/*global define: true, graphite: true*/\n\ndefine(\'override/views/layers/BracketsLayersListItemView\',[\n    \'ccweb.files.extract/controllers/SelectionController\',\n    \'ccweb.files.extract/views/layers/LayersListItemView\'\n], function (SelectionController, LayersListItemView) {\n    "use strict";\n    var BracketsLayersListItemView = LayersListItemView.extend({\n\n        handleLayerSelect: function (event) {\n            LayersListItemView.prototype.handleLayerSelect.call(this, event);\n\n            // Patch to log metrics for layer selection\n            graphite.events.trigger("layer-select", {\n                source: "layers-panel",\n                numLayers: SelectionController.getSelectedLayers().length,\n                type: this.model.get("type")\n            });\n        }\n\n    });\n\n    return BracketsLayersListItemView;\n});\n\n//# sourceURL=/./views/layers/BracketsLayersListItemView.js'),eval('define(\'text!ccweb.files.extract/views/templates/layerGroupListItemTemplate.html\',[],function () { return \'<div class="layer-group-item closed">\\n    <div class="layer-group-header">\\n        <div class="layer-bg"></div>\\n        <div class="visible-button layer-group"></div>\\n        <div class="folder"></div>\\n        <div class="image-wrapper">\\n            <img src="<%- graphite.serverAPI.getLayerURL(psdGuid, layerId) %>" class="preview">\\n        </div>\\n        <h5 class="layer-group-label" title="<%- layerName %>"> <%- layerName %></h5>\\n        <div class="export-buttons">\\n            <span class="asset-button"></span>\\n        </div>\\n    </div>\\n    <div class="children-list">\\n        <div class="children-list-list">\\n        </div>\\n    </div>\\n</div>\\n\';});\n\n//# sourceURL=/text!ccweb.files.extract/views/templates/layerGroupListItemTemplate.html'),eval('define(\'text!ccweb.files.extract/views/templates/layerGroupListItemSpritesheetTemplate.html\',[],function () { return \'<div class="layer-group-item closed">\\n    <div class="layer-group-header">\\n        <div class="layer-bg"></div>\\n        <div class="visible-button layer-group"></div>\\n        <div class="folder"></div>\\n        <div class="image-wrapper">\\n            <canvas id="sprite_preview" class="preview" width="40" height="30"></canvas>\\n            <div class="preview-warning"></div>\\n            <div class="layer-icon"></div>\\n        </div>\\n        <h5 class="layer-group-label" title="<%- layerName %>"> <%- layerName %></h5>\\n        <div class="export-buttons">\\n            <span class="asset-button"></span>\\n        </div>\\n    </div>\\n    <div class="children-list">\\n        <div class="children-list-list">\\n        </div>\\n    </div>\\n</div>\\n\';});\n\n//# sourceURL=/text!ccweb.files.extract/views/templates/layerGroupListItemSpritesheetTemplate.html'),eval('define(\'text!ccweb.files.extract/views/templates/layerGroupListItemNoChildrenTemplate.html\',[],function () { return \'<div class="layer-group-item closed">\\n    <div class="layer-group-header">\\n        <div class="layer-bg"></div>\\n        <div class="visible-button layer-group"></div>\\n        <div class="folder"></div>\\n        <div class="image-wrapper">\\n        </div>\\n        <h5 class="layer-group-label" title="<%- layerName %>"> <%- layerName %></h5>\\n        <div class="export-buttons">\\n            <span class="asset-button"></span>\\n        </div>\\n    </div>\\n    <div class="children-list">\\n        <div class="children-list-list">\\n        </div>\\n    </div>\\n</div>\';});\n\n//# sourceURL=/text!ccweb.files.extract/views/templates/layerGroupListItemNoChildrenTemplate.html'),eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013-2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4 */\n/*global define: true, graphite: true, LayersListItemView: true, setTimeout: true, clearTimeout: true*/\n\ndefine('ccweb.files.extract/views/layers/LayerGroupItemView',[\n    'jquery',\n    'underscore',\n    'ccweb.files.extract/controllers/SelectionController',\n    'ccweb.files.extract/controllers/DetailsController',\n    'ccweb.files.extract/views/layers/LayerItemView',\n    'ccweb.files.extract/views/layers/LayersListItemView',\n    'ccweb.files.extract/utils/ImageUtil',\n    'ccweb.files.extract/utils/SpriteSheetUtils',\n    'ccweb.files.extract/utils/TemplateUtil',\n    'text!ccweb.files.extract/views/templates/layerGroupListItemTemplate.html',\n    'text!ccweb.files.extract/views/templates/layerGroupListItemSpritesheetTemplate.html',\n    'text!ccweb.files.extract/views/templates/layerGroupListItemNoChildrenTemplate.html',\n    'ccweb.files.extract/Constants'\n], function ($, _, SelectionController, DetailsController, LayerItemView,\n             LayersListItemView, ImageUtil, SpriteSheetUtils, TemplateUtil,\n             LayerGroupListItemTemplate, LayerGroupListItemSpritesheetTemplate,\n             LayerGroupListItemNoChildrenTemplate, Constants) {\n    'use strict';\n    var LayerGroupItemView = LayersListItemView.extend({\n\n        hoverTimer: null,\n        events: {\n            'change': 'handleImageLoad'\n        },\n\n        initialize: function (options) {\n            _.bindAll(this,\n                'handleImageLoad',\n                'handleLayerSelect',\n                'handleToggleOpen',\n                'handleVisibilityToggleClick',\n                'handleExtractAssetClick',\n                'handleExtractCodeClick',\n                'handleMouseEnter',\n                'handleMouseLeave',\n                'handleThumbMouseEnter',\n                'handleThumbMouseLeave'\n                );\n            this.model.set('psdGuid', options.psdGuid);\n            this.model.set('toplevel', options.toplevel);\n            this.childrenRendered = false;\n            this.parentView = options.parentView;\n            this.subItems = [];\n            this.render();\n\n            // Initial state\n            this.handleVisibilityChange();\n        },\n\n        render: function () {\n            var tmplId,\n                bounds;\n\n            if (this.model.get('layerCollection') !== undefined &&\n                    this.model.get('layerCollection').length === 0) {\n                tmplId = LayerGroupListItemNoChildrenTemplate;\n            } else if (this.model.get('spriteSheet') !== undefined) {\n                tmplId = LayerGroupListItemSpritesheetTemplate;\n            } else {\n                bounds = this.model.get('bounds');\n                if (bounds.right - bounds.left === 0 || bounds.bottom - bounds.top === 0) {\n                    tmplId = LayerGroupListItemNoChildrenTemplate;\n                } else {\n                    tmplId = LayerGroupListItemTemplate;\n                }\n            }\n\n            this.$previewWarning = this.$el.find('div.preview-warning');\n            this.$el.html(TemplateUtil.createTemplate(tmplId, this.model.toJSON()));\n\n            this.handleFlattenedChange();\n\n            this.drawSpriteSheet();\n            this.renderChildren();\n\n            this.processLayerWarning();\n\n            this.addHandlers();\n\n            return this;\n        },\n\n        addHandlers: function () {\n            LayersListItemView.prototype.addHandlers.apply(this, arguments);\n\n            this.model.on('change:selected', this.handleSelectionChange, this);\n            this.model.on('change:isFlattened', this.handleFlattenedChange, this);\n\n            this.$el.find('.image-wrapper img').load(this.handleImageLoad);\n            this.$el.find('.image-wrapper').first().click(this.handleLayerSelect);\n            this.$el.find('.layer-group-label').first().click(this.handleLayerSelect);\n            this.$el.find('.folder').first().click(this.handleToggleOpen);\n\n            // hook up buttons\n            this.$el.find('.visible-button.layer-group').first().click(this.handleVisibilityToggleClick);\n            this.$el.find('.asset-button').first().click(this.handleExtractAssetClick);\n            this.$el.find('.code-button').first().click(this.handleExtractCodeClick);\n\n            // Mouse events\n            this.$el.find('.layer-group-header').first().mouseenter(this.handleMouseEnter);\n            this.$el.find('.layer-group-header').first().mouseleave(this.handleMouseLeave);\n            this.$el.find('.image-wrapper').first().mouseenter(this.handleThumbMouseEnter);\n            this.$el.find('.image-wrapper').first().mouseleave(this.handleThumbMouseLeave);\n            \n            this.addHandlersToChildren(this.model);\n        },\n        \n        addHandlersToChildren: function (model) {\n            var layerCollection = model.get('layerCollection') || [],\n                i,\n                layerModel;\n            \n            for (i = 0; i < layerCollection.length; i++) {\n                layerModel = layerCollection.at(i);\n                if (layerModel.get('type') !== 'adjustmentLayer') {\n                    layerModel.on('change:visible', this.handleVisibilityChange, this);\n                    if (layerModel.get('type') === 'layerSection') {\n                        this.addHandlersToChildren(layerModel);\n                    }\n                }\n            }\n        },\n\n        removeEventListeners: function () {\n            this.model.off(null, null, this);\n            graphite.events.off(null, null, this);\n        },\n\n        drawSpriteSheet: function () {\n            SpriteSheetUtils.renderSpriteModel(this, this.model, '.image-wrapper', '#sprite_preview', false);\n        },\n\n        renderChildren: function () {\n            if (this.childrenRendered === true) {\n                return;\n            }\n\n            // TODO: Actually render list item sub items usefully\n            if (this.model.attributes.layerCollection !== undefined) {\n                var layerCollection = this.model.attributes.layerCollection,\n                    layerModel,\n                    subLayerListItemView,\n                    i;\n                for (i = layerCollection.length - 1; i > -1; i--) {\n                    layerModel = layerCollection.at(i);\n\n                    if (layerModel.get('type') !== Constants.Type.LAYER_GROUP) {\n                        subLayerListItemView = new LayerItemView({model: layerModel, parentView: this, psdGuid: SelectionController.getPSDModel().get('id')});\n                    } else {\n                        subLayerListItemView = new LayerGroupItemView({model: layerModel, parentView: this, psdGuid: SelectionController.getPSDModel().get('id')});\n                    }\n                    this.subItems.push(subLayerListItemView);\n\n                    this.$el.find('.children-list-list').first().append(subLayerListItemView.el);\n                }\n            }\n            this.childrenRendered = true;\n        },\n\n        //------------------------------------------------\n        // Handlers\n        //------------------------------------------------\n\n        handleFlattenedChange: function () {\n            var props = this.model.get('properties'),\n                isFlattened = this.model.get('isFlattened'),\n                isVisible = this.model.get('visible'),\n                blendOptions = props ? props.get('blendOptions') : null;\n            if (blendOptions && !isFlattened && isVisible) {\n                if (blendOptions.mode && (blendOptions.mode !== 'passThrough')) {\n                    this.blendOptionsWarning = true;\n                    return;\n                }\n                this.blendOptionsWarning = false;\n            } else {\n                this.blendOptionsWarning = false;\n            }\n\n            this.processLayerWarning();\n        },\n\n        processLayerWarning: function () {\n            if (this.blendOptionsWarning || this.model.isFontSubstitution()) {\n                this.$previewWarning.show();\n            } else {\n                this.$previewWarning.hide();\n            }\n        },\n\n        handleImageLoad: function () {\n            var imageWidth = parseInt(this.$el.find('.image-wrapper').width(), 10);\n            if (imageWidth) {\n                ImageUtil.sizeAndCenterImage(this.$el.find('.image-wrapper img')[0],\n                    imageWidth,\n                    parseInt(this.$el.find('.image-wrapper').height(), 10),\n                    ImageUtil.ImageScaleType.FIT,\n                    false);\n            }\n\n        },\n\n        centerChildThumbs: function () {\n            var childList = this.$el.find('.children-list-list'),\n                children = childList ? childList.first()[0].children : null;\n            $.each(children, function (index, childElem) {\n                var image = $(childElem).find('.image-wrapper img')[0];\n                if (image) {\n                    ImageUtil.sizeAndCenterImage($(childElem).find('.image-wrapper img')[0],\n                        parseInt($(childElem).find('.image-wrapper').width(), 10),\n                        parseInt($(childElem).find('.image-wrapper').height(), 10),\n                        ImageUtil.ImageScaleType.FIT,\n                        false);\n                }\n            });\n\n            $.each(this.subItems, function (index, childView) {\n                childView.drawSpriteSheet();\n            });\n        },\n\n        handleThumbMouseEnter: function () {\n            var self = this;\n            if (this.hoverTimer) {\n                clearTimeout(this.hoverTimer);\n            }\n\n            graphite.events.trigger('load-layer-thumb-popup',\n                {model: self.model});\n\n            this.hoverTimer = setTimeout(function () {\n                graphite.events.trigger('show-layer-thumb-popup',\n                    {sourceElement: $(self.el).find('#sprite_preview').first(), model: self.model});\n            }, 500);\n        },\n\n        handleThumbMouseLeave: function () {\n            if (this.hoverTimer) {\n                clearTimeout(this.hoverTimer);\n                this.hoverTimer = null;\n            }\n\n            graphite.events.trigger('hide-layer-thumb-popup',\n                {sourceElement: this.$el.find('#sprite_preview').first(), model: this.model});\n        },\n\n        handleMouseEnter: function () {\n            this.$el.find('.layer-group-header').toggleClass('show-export', this.model.canBeExtracted());\n            graphite.events.trigger('item-hovered-over', [this.model], true);\n        },\n\n        handleMouseLeave: function () {\n            if (!this.model.get('selected')) {\n                this.$el.find('.layer-group-header').first().removeClass('show-export');\n            }\n            graphite.events.trigger('item-hovered-over', [], true);\n        },\n\n        handleExtractAssetClick: function (event) {\n            if (!this.model.get('selected')) {\n                SelectionController.changeSelection([this.model], false);\n            }\n            graphite.events.trigger('show-extract-asset-popup',\n                {sourceElement: $(event.target), layerModel: this.model, origin : 'layerPanel'});\n            event.stopPropagation();\n        },\n\n        handleExtractCodeClick: function (event) {\n            if (!this.model.get('selected')) {\n                SelectionController.changeSelection([this.model], false);\n            }\n            graphite.events.trigger('show-extract-code-popup',\n                {sourceElement: $(event.target), model: this.model});\n        },\n\n        handleToggleOpen: function () {\n            this.renderChildren();\n\n            var bHasChildren = (this.model.get('layerCollection').length > 0),\n                childrenList = this.$el.find('.children-list').first();\n            if (this.$el.find('.layer-group-item').first().hasClass('closed')) {\n\n                if (bHasChildren) {\n                    childrenList.slideDown(50);\n                }\n                SelectionController.groupExpanded(this.model);\n                this.centerChildThumbs();\n                this.$el.find('.layer-group-item').first().removeClass('closed');\n            } else {\n                childrenList.slideUp(50);\n                this.$el.find('.layer-group-item').first().addClass('closed');\n            }\n        },\n\n        childSelected: function (childSelected) {\n            if (childSelected) {\n                this.$el.addClass('parent-of-selected');\n            } else {\n                this.$el.removeClass('parent-of-selected');\n            }\n        },\n\n        expand: function () {\n            var childrenList = this.$el.find('.children-list').first();\n            if (childrenList.is(':hidden')) {\n                childrenList.slideDown(50);\n                SelectionController.groupExpanded(this.model);\n                this.centerChildThumbs();\n            }\n            if (this.parentView instanceof LayerGroupItemView) {\n                this.parentView.expand();\n            }\n\n            this.$el.find('.layer-group-item').first().removeClass('closed');\n        },\n\n        scrollIntoView: function () {\n            if (SelectionController.get('shouldScrollLayers') && DetailsController.get('selectedTab') === 'psdLayersTab') {\n                var layersPanel = $('#psdInspectSection');\n                layersPanel.first().animate({scrollTop: layersPanel[0].scrollTop + this.$el.offset().top - layersPanel.offset().top - 5});\n                SelectionController.set('shouldScrollLayers', false);\n            }\n        },\n\n        remove: function () {\n            this.removeEventListeners();\n            _.each(this.subItems, function (subItem) {\n                subItem.remove();\n            });\n            this.subItems.length = 0;\n\n            LayersListItemView.prototype.remove.call(this);\n        }\n    });\n\n    return LayerGroupItemView;\n});\n\n//# sourceURL=/lib/graphite-api/public/js/ccweb.files.extract/views/layers/LayerGroupItemView.js"),
eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013-2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4 */\n/*global define: true, graphite: true*/\n\ndefine('ccweb.files.extract/views/layers/LayersListView',[\n    'jquery',\n    'underscore',\n    'backbone',\n    'ccweb.files.extract/views/layers/LayerItemView',\n    'ccweb.files.extract/views/layers/LayerGroupItemView',\n    'ccweb.files.extract/Constants',\n    'plugin-dependencies'\n], function ($, _, Backbone, LayerItemView, LayerGroupItemView, Constants, deps) {\n    'use strict';\n    var LayersListView = Backbone.View.extend({\n        template: '<div class=\"section-wrapper\"><button class=\"topcoat-button\" id=\"resetLayers\">' + deps.translate('Reset Layers') + '</button></div><div class=\"layers-list\">' +\n            '</div>',\n        $layersList: null,\n        layerItems: [],\n\n        events: {\n            'click #resetLayers': 'handleResetLayers'\n        },\n\n        initialize: function () {\n            this.render();\n            this.model.on('change:layerCollection', this.handleModelLayerCollectionChanged, this);\n            this.handleModelLayerCollectionChanged();\n        },\n\n        render: function () {\n            var tmpl = _.template(this.template);\n            this.$el.html(tmpl);\n            this.$layersList = $(this.el).find('.layers-list');\n\n            return this;\n        },\n\n        handleModelLayerCollectionChanged: function () {\n            var self,\n                layerCollection,\n                i,\n                layerModel,\n                type,\n                listItem;\n\n            this.layerItems.length = 0;\n            this.$layersList.empty();\n            if (this.model.get('layerCollection') !== null) {\n                self = this;\n                layerCollection =  this.model.get('layerCollection');\n                for (i = layerCollection.length - 1; i > -1; i--) {\n                    layerModel = layerCollection.at(i);\n                    type = layerModel.get('type');\n                    if (type === Constants.Type.LAYER_GROUP) {\n                        listItem = new LayerGroupItemView({model: layerModel,\n                                                           psdGuid: self.model.get('id'),\n                                                           toplevel: true});\n                        this.layerItems.push(listItem);\n                    } else {\n                        listItem = new LayerItemView({model: layerModel,\n                                                      psdGuid: self.model.get('id'),\n                                                      toplevel: true});\n                        this.layerItems.push(listItem);\n                    }\n                    this.$layersList.append(listItem.el);\n                }\n\n            }\n        },\n\n        removeEventListeners: function () {\n            this.model.off(null, null, this);\n        },\n\n        remove: function () {\n            if (this.$layersList) {\n                this.$layersList.remove();\n                this.$layersList = null;\n            }\n            _.each(this.layerItems, function (layerItem) {\n                layerItem.remove();\n            });\n            this.layerItems.length = 0;\n\n            this.removeEventListeners();\n            Backbone.View.prototype.remove.call(this);\n        },\n\n        handleResetLayers: function () {\n            graphite.events.trigger('reset-layers-visibility', {});\n        }\n    });\n\n    return LayersListView;\n});\n\n//# sourceURL=/lib/graphite-api/public/js/ccweb.files.extract/views/layers/LayersListView.js"),eval('/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013-2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4 */\n/*global brackets: true, define: true, graphite: true*/\n\ndefine(\'override/views/layers/BracketsLayersListView\',[\n    \'jquery\',\n    \'underscore\',\n    \'backbone\',\n    \'ccweb.files.extract/views/layers/LayersListView\',\n    \'ccweb.files.extract/controllers/KeyboardController\'\n], function ($, _, Backbone, LayersListView, KeyboardController) {\n    "use strict";\n\n    var CodeHintManager = brackets.getModule("editor/CodeHintManager");\n\n    var BracketsLayersListView = LayersListView.extend({\n        $input: null,\n\n        events: {\n            "click #resetLayers": "handleResetLayers",\n            "click": "handleClick"\n        },\n        \n        render: function () {\n            LayersListView.prototype.render.call(this);\n            \n            this.$input = $("#psd-details-input");\n            this.addHandlers();\n            \n            return this;\n        },\n\n        addHandlers: function () {\n            KeyboardController.attachKeyHandlers(this.$input);\n        },\n\n        removeEventListeners: function () {\n            KeyboardController.removeKeyHandlers();\n        },\n        \n        handleClick: function (event) {\n            if (!CodeHintManager.isOpen()) {\n                this.$input.focus();\n            } else {\n                event.stopPropagation();\n            }\n        },\n\n        remove: function () {\n            this.removeEventListeners();\n            LayersListView.prototype.remove.call(this);\n        }\n    });\n\n    return BracketsLayersListView;\n});\n\n//# sourceURL=/./views/layers/BracketsLayersListView.js'),eval("/*jslint nomen: true, devel: true*/\n/*global define: true, graphite: true, CSSListItemView: true*/\ndefine('ccweb.files.extract/views/inspect/CSSListItemView',[\n    'jquery',\n    'underscore',\n    'backbone',\n    'ccweb.files.extract/utils/TemplateUtil',\n    'ccweb.files.extract/utils/CSSUtil'\n], function ($, _, Backbone, TemplateUtil, CSSUtil) {\n    'use strict';\n    var colorProperties = {\n        'background-color': 1,\n        'border-color': 1,\n        'color': 1\n    },\n        CSSListItemView = Backbone.View.extend({\n\n            defaults: {\n                cssObj : null,\n                clip : null\n            },\n\n            initialize: function (options) {\n                this.cssObj = options.cssObj;\n                this.preProcessor = options.preProcessor;\n                this.render();\n            },\n\n            render: function () {\n                var listItem = CSSUtil.cssPreprocessors[this.preProcessor].listItem(this.cssObj);\n                this.setElement('<li>' + listItem + '</li>');\n\n                if (this.cssObj && this.cssObj.comment) {\n                    this.$el.append(' <span class=\"comment\">/* ' + this.cssObj.comment + ' */</span>');\n                }\n\n                return this;\n            },\n\n            isColorProperty: function () {\n                return this.cssObj && (colorProperties.hasOwnProperty(this.cssObj.property));\n            },\n\n            isSpacer: function () {\n                return this.cssObj && this.cssObj.spacer;\n            }\n        });\n\n    return CSSListItemView;\n});\n\n//# sourceURL=/lib/graphite-api/public/js/ccweb.files.extract/views/inspect/CSSListItemView.js"),eval('define(\'text!ccweb.files.extract/views/templates/cssColorItemTemplate.html\',[],function () { return \'<li>\\n    <span class="property">color:</span><span class="color-chip" style="background-color: <%= value %>;"></span> <span class="value"><%= value %>;</span>\\n</li>\';});\n\n//# sourceURL=/text!ccweb.files.extract/views/templates/cssColorItemTemplate.html'),eval("define('text!ccweb.files.extract/views/templates/messageSelectSingleItemTemplate.html',[],function () { return '<li class=\"css-properties-message\">\\n    <%-translate(\"Select a single layer in the PSD to see its CSS properties\")%>\\n</li>';});\n\n//# sourceURL=/text!ccweb.files.extract/views/templates/messageSelectSingleItemTemplate.html"),eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013-2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4 */\n/*global define: true, graphite: true, InspectCSSView: true*/\n\ndefine('ccweb.files.extract/views/inspect/InspectCSSView',[\n    'jquery',\n    'underscore',\n    'backbone',\n    'ccweb.files.extract/models/ColorModel',\n    'ccweb.files.extract/models/UserSettingsModel',\n    'ccweb.files.extract/controllers/SelectionController',\n    'ccweb.files.extract/views/inspect/CSSListItemView',\n    'ccweb.files.extract/utils/CSSUtil',\n    'ccweb.files.extract/utils/TemplateUtil',\n    'text!ccweb.files.extract/views/templates/cssColorItemTemplate.html',\n    'text!ccweb.files.extract/views/templates/messageSelectSingleItemTemplate.html'\n], function ($, _, Backbone, ColorModel, UserSettingsModel, SelectionController, CSSListItemView, CSSUtil, TemplateUtil,\n             CSSColorItemTemplate, MessageSelectSingleItemTemplate) {\n    'use strict';\n    var InspectCSSView = Backbone.View.extend({\n\n        defaults: {\n            parentView: null,\n            cssListItemViews: [],\n            $messageEl: null\n        },\n\n        initialize: function (options) {\n            this.parentView = options.parentView;\n            this.cssListItemViews = [];\n            //story the message element\n            this.$messageEl = $(TemplateUtil.createTemplate(MessageSelectSingleItemTemplate));\n            this.render();\n            this.addHandlers();\n        },\n\n        render: function () {\n            var psdModel = SelectionController.getPSDModel(),\n                localContent = psdModel.get('localContent');\n\n            this.handleSelectionChange();\n        },\n\n        addHandlers: function () {\n            SelectionController.on('change:extractedStylesInSelection', this.handleSelectionChange, this);\n            graphite.events.on('preprocessorChanged', this.refreshCSS, this);\n            graphite.events.on('updateFontCSS', this.refreshCSS, this);\n            graphite.events.on('commitDropperColor', this.handleNewDropperColor, this);\n            graphite.events.on('preferredMeasurementUnitsChanged', this.refreshCSS, this);\n        },\n\n        removeEventListeners: function () {\n            SelectionController.off(null, null, this);\n            graphite.events.off(null, null, this);\n        },\n\n        refreshCSS: function () {\n            var selectedLayers = SelectionController.getSelectedLayers(),\n                cssContainer = $(this.parentView.el).find('.css-properties'),\n                preProcessor = UserSettingsModel.get('preprocessor'),\n                layerModel,\n                cssProperties,\n                i,\n                listItemView;\n\n            // only populate the list if one layer is selected\n            if (selectedLayers.length === 1) {\n                layerModel = selectedLayers[0];\n                // If we are using a preprocessor, we don't need vendor prefixes\n                cssProperties = layerModel.getCSSArray(preProcessor === 'css');\n\n                //TODO: we may want to sort the properties in a certain order?\n\n                this.clearCSSList();\n                for (i = 0; i < cssProperties.length; i++) {\n                    listItemView = new CSSListItemView({cssObj: cssProperties[i], preProcessor: preProcessor});\n                    this.cssListItemViews.push(listItemView);\n                    cssContainer.append(listItemView.el);\n                }\n            } else {\n                this.clearCSSList();\n                this.displayMessages();\n            }\n        },\n\n        handleNewDropperColor: function (extractedColor) {\n            var colorModel = new ColorModel(extractedColor),\n                $cssContainer = $(this.parentView.el).find('.css-properties'),\n                alpha = extractedColor.alpha < 1 ? extractedColor.alpha.toFixed(2) : null,\n                colorEl;\n            $cssContainer.empty();\n            colorEl = TemplateUtil.createTemplate(CSSColorItemTemplate, {value: colorModel.toHEXString()});\n            $cssContainer.append(colorEl);\n            colorEl = TemplateUtil.createTemplate(CSSColorItemTemplate, {value: colorModel.toRGBString(alpha)});\n            $cssContainer.append(colorEl);\n            colorEl = TemplateUtil.createTemplate(CSSColorItemTemplate, {value: colorModel.toHSLString(alpha)});\n            $cssContainer.append(colorEl);\n        },\n\n        handleSelectionChange: function () {\n            this.refreshCSS();\n        },\n\n        clearCSSList: function () {\n            var i,\n                listItem,\n                $cssContainer = $(this.parentView.el).find('.css-properties');\n\n            for (i = this.cssListItemViews.length - 1; i !== -1; i--) {\n                listItem = this.cssListItemViews.pop();\n                listItem.remove();\n            }\n\n            //remove the message element\n            this.$messageEl.remove();\n            $cssContainer.empty();\n\n            SelectionController.clearDOMSelection();\n        },\n\n        displayMessages: function () {\n            var selectedLayers = SelectionController.getSelectedLayers(),\n                cssContainer = $(this.parentView.el).find('.css-properties');\n\n            //if no layer is selected or more than one layer is selected display the same message\n            if ((selectedLayers.length === 0) ||\n                    (selectedLayers.length > 1)) {\n                cssContainer.append(this.$messageEl);\n            }\n        },\n\n        remove: function () {\n            this.removeEventListeners();\n            return Backbone.View.prototype.remove.call(this);\n        }\n    });\n\n    return InspectCSSView;\n});\n\n//# sourceURL=/lib/graphite-api/public/js/ccweb.files.extract/views/inspect/InspectCSSView.js"),eval("define('text!ccweb.files.extract/views/templates/fontFaceListItemTemplate.html',[],function () { return '<li class=\"font-face-list-item\">\\n    <p class=\"font-face-name\"><%-fontFace%></p>\\n    <ul>\\n        <% _.each(styles, function(textStyle){ %>\\n        <li class=\"text-style-size\"><p><%-convert(textStyle.get(\\'style\\').get(\\'size\\'))%></p></li>\\n        <% }); %>\\n    </ul>\\n</li>';});\n\n//# sourceURL=/text!ccweb.files.extract/views/templates/fontFaceListItemTemplate.html"),eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013-2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4 */\n/*global define: true, graphite: true*/\n\ndefine('ccweb.files.extract/views/inspect/InspectFontFaceView',[\n    'jquery',\n    'underscore',\n    'backbone',\n    'ccweb.files.extract/controllers/SelectionController',\n    'ccweb.files.extract/controllers/DetailsController',\n    'ccweb.files.extract/utils/StyleUtil',\n    'ccweb.files.extract/utils/TemplateUtil',\n    'ccweb.files.extract/utils/CSSUtil',\n    'text!ccweb.files.extract/views/templates/fontFaceListItemTemplate.html'\n], function ($, _, Backbone, SelectionController, DetailsController, StyleUtil, TemplateUtil, CSSUtil,\n    FontFaceListItemTemplate) {\n    'use strict';\n\n    var InspectFontFaceView = Backbone.View.extend({\n        initialize: function (data) {\n            this.ppi = data.ppi;\n            this.render();\n            this.addHandlers();\n        },\n\n        render: function () {\n            var self = this,\n                context = {\n                    convert: function (x) {\n                        return CSSUtil.convertPSDUnitsToPreferredUnits(x, true);\n                    }\n                };\n\n            context = _.extend(context, this.model);\n\n            this.model.styles.sort(this.sortTextSizeFunction);\n            this.setElement(TemplateUtil.createTemplate(FontFaceListItemTemplate, context));\n\n            this.$el.find('.text-style-size').each(function (index) {\n                $(this).data('model', self.model.styles[index]);\n            });\n        },\n\n        addHandlers: function () {\n            var self = this;\n            this.$el.find('.text-style-size').click(function () {\n                if ($(this).data('model') === DetailsController.get('selectedInspectItem')) {\n                    DetailsController.setSelectedInspectItem(null);\n                    graphite.events.trigger('hide-extract-code-popup');\n                } else {\n                    DetailsController.setSelectedInspectItem($(this).data('model'));\n                    graphite.events.trigger('show-extract-code-popup',\n                        {sourceElement: $(this), model: $(this).data('model'), ppi: self.ppi});\n\n                }\n            });\n\n            DetailsController.on('change:selectedInspectItem', this.handleSelectedInspectItemChange, this);\n            SelectionController.on('change:extractedStylesInSelection', this.handleSelectionChange, this);\n        },\n\n        removeEventListeners: function () {\n            DetailsController.off(null, null, this);\n            SelectionController.off(null, null, this);\n        },\n\n        sortTextSizeFunction: function (a, b) {\n            return parseFloat(a.get('style').get('size')) - parseFloat(b.get('style').get('size'));\n        },\n\n        //------------------------------------------------\n        // Handlers\n        //------------------------------------------------\n        handleSelectedInspectItemChange: function () {\n            var selectedInspectItem = DetailsController.get('selectedInspectItem');\n            this.$el.find('.text-style-size').each(function (index, value) {\n                if (StyleUtil.areUsageStylesEqual($(value).data('model'), selectedInspectItem)) {\n                    $(value).addClass('selected');\n                } else {\n                    $(value).removeClass('selected');\n                }\n            });\n        },\n\n\n        handleSelectionChange: function () {\n            var textStylesInSelection =\n                SelectionController.get('extractedStylesInSelection').textStyles;\n            var found = false;\n            var selectedLayers = SelectionController.getSelectedLayers();\n\n            this.$el.find('.text-style-size').each(function (index, value) {\n                found = false;\n                $.each(textStylesInSelection, function (textStyleIndex, textStyle) {\n                    if (StyleUtil.areUsageStylesEqual(textStyle, $(value).data('model'))) {\n                        found = true;\n                    }\n                    return !found;\n                });\n\n                $(this).removeClass('layer-hover');\n\n                if (found && selectedLayers.length > 0) {\n                    $(this).addClass('selected');\n                } else {\n                    $(this).removeClass('selected');\n\n                }\n            });\n        },\n\n        remove: function () {\n            this.removeEventListeners();\n            return Backbone.View.prototype.remove.call(this);\n        }\n    });\n\n    return InspectFontFaceView;\n});\n\n//# sourceURL=/lib/graphite-api/public/js/ccweb.files.extract/views/inspect/InspectFontFaceView.js"),eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4 */\n/*global define: true, graphite: true, navigator: true*/\n\ndefine('ccweb.files.extract/utils/FontUtil',[\n    'jquery',\n    'underscore'\n], function ($, _) {\n    'use strict';\n    var FontUtil = {\n\n        TYPEKIT_LOOKUP: 'https://typekit.com/api/v1/json/families/',\n        TYPEKIT_SEARCH_URL: 'http://typekit.com/search/fonts/?q=',\n        cache: {},\n\n        /**\n         *\n         * @param fontFamily\n         * @param updateCallback Invoked if we find a direct link to the family on TypeKit.com\n         * @param context context of callback\n         * @returns {*|string}\n         */\n        getTypeKitURL: function (fontFamily, updateCallback, context) {\n            var slug = fontFamily.replace(/\\s+/g, '-').toLowerCase(),\n                cachedResult = this.cache[slug],\n                self = this;\n            if (cachedResult === undefined) {\n                $.ajax({\n                    url: self.TYPEKIT_LOOKUP + slug,\n                    dataType: 'jsonp'\n                }).done(function (resp) {\n                    var webLink = resp && resp.family && resp.family.web_link,\n                        result = webLink || null;\n                    self.cache[slug] = result;\n                    if (result) {\n                        updateCallback.apply(context, [result]);\n                    }\n                });\n            }\n            return cachedResult || this.TYPEKIT_SEARCH_URL + encodeURIComponent(fontFamily);\n        }\n    };\n\n    return FontUtil;\n});\n\n//# sourceURL=/lib/graphite-api/public/js/ccweb.files.extract/utils/FontUtil.js"),eval('define(\'text!ccweb.files.extract/views/templates/fontFamilyListItemTemplate.html\',[],function () { return \'<li class="font-family-list-item">\\n    <div class="arrow"></div>\\n    <a class="typekit-anchor" target="_blank" title=\\\'<%-translate("Find font on typekit.com")%>\\\'></a>\\n    <p class="font-family-name"><%-get(\\\'name\\\')%></p>\\n    <div class="font-face-count"><p></p></div>\\n    <div style="clear:both;"></div>\\n    <ul class="font-face-list"></ul>\\n</li>\';});\n\n//# sourceURL=/text!ccweb.files.extract/views/templates/fontFamilyListItemTemplate.html'),eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013-2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4, bitwise: true */\n/*global define: true, graphite: true*/\n\ndefine('ccweb.files.extract/views/inspect/InspectFontFamilyView',[\n    'jquery',\n    'underscore',\n    'backbone',\n    'ccweb.files.extract/controllers/SelectionController',\n    'ccweb.files.extract/views/inspect/InspectFontFaceView',\n    'ccweb.files.extract/utils/TemplateUtil',\n    'ccweb.files.extract/utils/FontUtil',\n    'text!ccweb.files.extract/views/templates/fontFamilyListItemTemplate.html',\n    'plugin-dependencies'\n], function ($, _, Backbone, SelectionController, InspectFontFaceView, TemplateUtil, FontUtil,\n             FontFamilyListItemTemplate, deps) {\n    'use strict';\n\n    var InspectFontFamilyView = Backbone.View.extend({\n        fontFaceViews: [],\n\n        events: {\n            'click .font-family-name': 'handleClick',\n            'click .typekit-anchor': 'handleTypeKitLink'\n        },\n\n        initialize: function (data) {\n            this.ppi = data.ppi;\n            this.render();\n            this.addHandlers();\n        },\n\n        render: function () {\n            var self = this,\n                faces = this.model.get('faces'),\n                fontFace,\n                fontFaceObj,\n                isInteger,\n                $typekitAnchor,\n                $familyName,\n                count = 0;\n\n            this.setElement(TemplateUtil.createTemplate(FontFamilyListItemTemplate, this.model));\n            this.$el.addClass('closed');\n            this.$el.find('.font-face-list').hide();\n            $typekitAnchor = this.$el.find('.typekit-anchor');\n            $familyName = this.$el.find('.font-family-name');\n\n            // Configure TypeKit URL\n            var typekitURL = FontUtil.getTypeKitURL(this.model.get('friendlyName'), function (result) {\n                $typekitAnchor.attr('href', result);\n            }, this);\n            $typekitAnchor.attr('href', typekitURL);\n\n            var keys = _.keys(faces);\n            if (keys) {\n                keys.sort(this.sortFaces);\n            }\n\n            _.each(keys, function (faceName) {\n                var styles = faces[faceName];\n                styles.sort(self.sortTextSizeFunction);\n                isInteger = faceName >>> 0 === parseFloat(faceName);\n                faceName = isInteger ? 'font-weight ' + faceName : faceName;\n                fontFaceObj = {fontFace: faceName, styles: styles};\n                fontFace = new InspectFontFaceView({model: fontFaceObj, ppi: self.ppi});\n                self.fontFaceViews.push(fontFace);\n\n                $(self.el).find('.font-face-list').append(fontFace.el);\n                $(self.el).find('.font-face-list').append('<div style=\"clear:both;\"></div>');\n                count++;\n            });\n\n            this.$el.find('.font-face-list').append('<div class=\"list-bottom-padding\"></div>');\n            this.$el.find('.font-face-count p').text(count);\n\n        },\n\n        sortFaces: function (a, b) {\n            var faceValues = ['regular', 'thin', 'extralight', 'ultralight', 'light', 'normal',\n                'medium', 'semibold', 'demibold', 'bold', 'extrabold', 'ultrabold',\n                'black', 'heavy', 'italic', 'bolditalic'];\n            return faceValues.indexOf(a.toLowerCase().replace(/ /g, '')) - faceValues.indexOf(b.toLowerCase().replace(/ /g, ''));\n        },\n\n        updateClosedStatus: function () {\n            if (this.$el.hasClass('closed')) {\n                this.$el.find('.font-face-list').slideUp(50);\n                this.$el.find('.font-face-count').fadeIn(100);\n            } else {\n                this.$el.find('.font-face-list').slideDown(50);\n                this.$el.find('.font-face-count').fadeOut(100);\n            }\n        },\n\n        addHandlers: function () {\n            SelectionController.on('change:extractedStylesInSelection', this.handleSelectionChange, this);\n        },\n\n        handleClick: function () {\n            $(this.el).toggleClass('closed');\n            this.updateClosedStatus();\n        },\n\n        handleTypeKitLink: function () {\n            graphite.events.trigger('typekitSearch');\n        },\n\n        removeEventListeners: function () {\n            SelectionController.off(null, null, this);\n        },\n\n        handleSelectionChange: function () {\n            var self = this,\n                textStylesInSelection = SelectionController.get('extractedStylesInSelection').textStyles,\n                selectedLayers = SelectionController.getSelectedLayers();\n\n            $.each(textStylesInSelection, function (textStyleIndex, textStyle) {\n                if (textStyle.get('style').get('fontName') === self.model.get('name')) {\n                    // Only open font-family sections if we have something selected, otherwise with nothing selected, all styles will open\n                    if (selectedLayers.length > 0) {\n                        $(self.el).removeClass('closed');\n                        self.updateClosedStatus();\n                    }\n                }\n            });\n        },\n\n        remove: function () {\n            // remove font face views\n            _.each(this.fontFaceViews, function (fontFaceView) {\n                fontFaceView.remove();\n            });\n            this.fontFaceViews.length = 0;\n\n            this.removeEventListeners();\n            return Backbone.View.prototype.remove.call(this);\n        }\n    });\n\n    return InspectFontFamilyView;\n});\n\n//# sourceURL=/lib/graphite-api/public/js/ccweb.files.extract/views/inspect/InspectFontFamilyView.js"),eval("define('text!ccweb.files.extract/views/templates/colorListItemTemplate.html',[],function () { return '<li>\\n    <div class=\"color-chip\"></div>\\n</li>';});\n\n//# sourceURL=/text!ccweb.files.extract/views/templates/colorListItemTemplate.html"),eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013-2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4 */\n/*global define: true, graphite: true, window: true, clearTimeout: true, setTimeout: true*/\n\ndefine('ccweb.files.extract/views/inspect/BaseInspectColorView',[\n    'jquery',\n    'underscore',\n    'backbone',\n    'ccweb.files.extract/controllers/SelectionController',\n    'ccweb.files.extract/controllers/DetailsController',\n    'ccweb.files.extract/models/ColorUsageModel',\n    'ccweb.files.extract/utils/StyleUtil',\n    'ccweb.files.extract/utils/TemplateUtil',\n    'text!ccweb.files.extract/views/templates/colorListItemTemplate.html'\n], function ($, _, Backbone, SelectionController, DetailsController,\n        ColorUsageModel, StyleUtil, TemplateUtil, ColorListItemTemplate) {\n    'use strict';\n\n    var BaseInspectColorView = Backbone.View.extend({\n        events: {\n            'click': 'handleClick'\n        },\n\n        initialize: function () {\n            this.render();\n            this.addHandlers();\n        },\n\n        render: function () {\n            this.setElement(TemplateUtil.createTemplate(ColorListItemTemplate));\n        },\n\n\n        addHandlers: function () {\n            DetailsController.on('change:selectedInspectItem', this.handleSelectedInspectItemChange, this);\n            SelectionController.on('change:extractedStylesInSelection', this.handleSelectionChange, this);\n        },\n\n        removeEventListeners: function () {\n            DetailsController.off(null, null, this);\n            SelectionController.off(null, null, this);\n        },\n\n        //------------------------------------------------\n        // Handlers\n        //------------------------------------------------\n\n        handleClick: function () {\n            if (this.model === DetailsController.get('selectedInspectItem')) {\n                DetailsController.setSelectedInspectItem(null);\n            } else {\n                DetailsController.setSelectedInspectItem(this.model);\n\n                if (this.model instanceof ColorUsageModel) {\n                    this.showInfo();\n                }\n            }\n        },\n\n\n        handleSelectedInspectItemChange: function () {\n            if (this.model === DetailsController.get('selectedInspectItem')) {\n                this.$el.addClass('selected');\n            } else {\n                this.$el.removeClass('selected');\n            }\n\n            if (!DetailsController.get('selectedInspectItem')) {\n                graphite.events.trigger('hide-color-popup', null);\n            }\n        },\n\n        handleSelectionChange: function () {\n            var stylesInSelection = this.getStylesForSelection(),\n                colorUsage = this.model,\n                found = false,\n                selectedLayers = SelectionController.getSelectedLayers();\n\n            $.each(stylesInSelection, function (index, value) {\n                if (StyleUtil.areUsageStylesEqual(colorUsage, value)) {\n                    found = true;\n                }\n            });\n\n            this.$el.removeClass('layer-over');\n\n            if (found && selectedLayers.length > 0) {\n                this.$el.addClass('selected');\n            } else {\n                this.$el.removeClass('selected');\n            }\n        },\n\n        // override please\n        getStylesForSelection: function () {\n            // return an array of style models\n        },\n\n        // override please\n        getStylesForLayer: function (layer) {\n            // return an array of style usageModels.\n        },\n\n        showInfo: function () {\n            graphite.events.trigger('show-color-popup', { style: this.model, sourceElement: this.$el.find('.color-chip')});\n        },\n\n        remove: function () {\n            this.removeEventListeners();\n            return Backbone.View.prototype.remove.call(this);\n        }\n    });\n\n    return BaseInspectColorView;\n});\n\n//# sourceURL=/lib/graphite-api/public/js/ccweb.files.extract/views/inspect/BaseInspectColorView.js"),
eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013-2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4 */\n/*global define: true, graphite: true*/\n\ndefine('ccweb.files.extract/views/inspect/InspectSolidColorView',[\n    'jquery',\n    'underscore',\n    'ccweb.files.extract/views/inspect/BaseInspectColorView',\n    'ccweb.files.extract/controllers/SelectionController'\n], function ($, _, BaseInspectColorView, SelectionController) {\n    'use strict';\n    var InspectSolidColorView = BaseInspectColorView.extend({\n        render: function () {\n            BaseInspectColorView.prototype.render.apply(this, arguments);\n\n            this.$el.find('.color-chip').css('background-color',\n                this.model.get('style').toRGBString());\n        },\n\n        getStylesForSelection: function () {\n            return SelectionController.get('extractedStylesInSelection').colors;\n        },\n\n        getStylesForLayer: function (layer) {\n            // return an array of style usageModels.\n            return layer.getUsageModels().colors;\n        }\n\n    });\n\n    return InspectSolidColorView;\n});\n\n//# sourceURL=/lib/graphite-api/public/js/ccweb.files.extract/views/inspect/InspectSolidColorView.js"),eval('define(\'text!ccweb.files.extract/views/templates/dropperItemTemplate.html\',[],function () { return \'<li class="dropper-item" title=\\\'<%-translate("Color Picker")%>\\\'>\\n    <div class="color-chip"><div class="dropper"></div></div>\\n</li>\';});\n\n//# sourceURL=/text!ccweb.files.extract/views/templates/dropperItemTemplate.html'),eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013-2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4 */\n/*global define: true, graphite: true, window: true, clearTimeout: true, setTimeout: true*/\n\ndefine('ccweb.files.extract/views/inspect/DropperColorView',[\n    'jquery',\n    'underscore',\n    'backbone',\n    'ccweb.files.extract/controllers/SelectionController',\n    'ccweb.files.extract/utils/TemplateUtil',\n    'text!ccweb.files.extract/views/templates/dropperItemTemplate.html'\n], function ($, _, Backbone, SelectionController, TemplateUtil, DropperItemTemplate) {\n    'use strict';\n\n    var DropperColorView = Backbone.View.extend({\n\n        events: {\n            'click': 'handleClick'\n        },\n\n        initialize: function () {\n            this.render();\n        },\n\n        render: function () {\n            this.setElement(TemplateUtil.createTemplate(DropperItemTemplate));\n        },\n\n        //------------------------------------------------\n        // Handlers\n        //------------------------------------------------\n\n        handleClick: function (event) {\n            SelectionController.enableDropperTool();\n            event.stopPropagation();\n        },\n\n        remove: function () {\n            return Backbone.View.prototype.remove.call(this);\n        }\n    });\n\n    return DropperColorView;\n});\n\n//# sourceURL=/lib/graphite-api/public/js/ccweb.files.extract/views/inspect/DropperColorView.js"),eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013-2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4 */\n/*global define: true, graphite: true*/\n\ndefine('ccweb.files.extract/views/inspect/InspectGradientView',[\n    'jquery',\n    'underscore',\n    'ccweb.files.extract/views/inspect/BaseInspectColorView',\n    'ccweb.files.extract/controllers/SelectionController',\n    'ccweb.files.extract/controllers/DetailsController',\n    'ccweb.files.extract/utils/CSSUtil'\n], function ($, _, BaseInspectColorView, SelectionController,\n        DetailsController, CSSUtil) {\n    'use strict';\n    var InspectGradientView = BaseInspectColorView.extend({\n        render: function () {\n            BaseInspectColorView.prototype.render.apply(this, arguments);\n            CSSUtil.applyCSS(this.$el.find('.color-chip'), this.model.get('style'), true);\n        },\n\n        handleClick: function () {\n            if (this.model === DetailsController.get('selectedInspectItem')) {\n                graphite.events.trigger('hide-extract-code-popup');\n            } else {\n                graphite.events.trigger('show-extract-code-popup',\n                    {sourceElement: this.$el.find('.color-chip'), model: this.model});\n            }\n            BaseInspectColorView.prototype.handleClick.apply(this, arguments);\n        },\n\n        getStylesForSelection: function () {\n            return SelectionController.get('extractedStylesInSelection').gradients;\n        },\n\n        getStylesForLayer: function (layer) {\n            // return an array of style usageModels.\n            return layer.getUsageModels().gradients;\n        }\n    });\n\n    return InspectGradientView;\n});\n\n//# sourceURL=/lib/graphite-api/public/js/ccweb.files.extract/views/inspect/InspectGradientView.js"),eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4, bitwise: true */\n/*global define: true, graphite: true, document: true*/\n// This is a temporary inclusion until CCweb.view_context_menu() gets rearchitected\n// https://git.corp.adobe.com/Stormcloud/sonar/issues/3119\ndefine('ccweb.files.extract/views/inspect/ContextMenuView',[\n    'jquery',\n    'underscore',\n    'backbone',\n    'ccweb.files.extract/Constants'\n], function ($, _, Backbone, Constants) {\n    'use strict';\n\n    var ContextMenuView = Backbone.View.extend({\n\n        className : 'context-menu',\n\n        enabled : true,\n\n        initialize: function (options) {\n\n            _.bindAll(this,\n                'open',\n                'close',\n                'setItems',\n                'handleSelect'\n                );\n\n            this.menuName = options.name;\n            this.$el.addClass(options.name);\n            if (options.enabled === false) {\n                this.enabled = false;\n            }\n            this.items = options.items || [];\n            this.$toggle = options.$toggle || $('<div>');\n            this.$after = options.$after || this.$toggle;\n            this.position = options.position;\n            // this.labels = CCweb.view_context_menu_labels();\n            // this.toggleEvent = CCweb.util.isMobileSafari ? 'touchend' : 'click';\n            // this.itemEvent = CCweb.util.isMobileSafari ? 'touchend' : 'click';\n            // this.blurEvent = CCweb.util.isMobileSafari ? 'touchstart' : 'mousedown';\n            this.toggleEvent = 'click';\n            this.itemEvent = 'click';\n            this.blurEvent = 'mousedown';\n            this.isOpen = false;\n            this.isRendered = false;\n            this.setItems(this.items);\n\n            this.$toggle.bind(this.toggleEvent, this.open);\n\n        },\n\n        rebindToggle: function () {\n            var self = this;\n            this.close();\n            _.delay(function () {\n                self.$toggle.unbind(self.toggleEvent, self.open);\n                self.$toggle.bind(self.toggleEvent, self.open);\n            }, 300);\n        },\n\n        setItems: function (items) {\n\n            this.close();\n            this.items = items;\n            this.isRendered = false;\n            if (items.length === 0) {\n                this.$toggle.addClass('context-menu-empty');\n            } else {\n                this.$toggle.removeClass('context-menu-empty');\n            }\n\n            return this;\n        },\n        \n        checkItem: function (itemToCheck) {\n            this.$el.find('a').removeClass('active');\n            this.$el.find('a').each(function () {\n                if ($(this).attr('data') === itemToCheck) {\n                    $(this).addClass('active');\n                }\n            });\n        },\n        \n        placeMenu: function () {\n            var togglePos = this.$toggle.position();\n            var offsetParent = this.$toggle.offsetParent();\n            var scrollTop = offsetParent ? offsetParent.scrollTop() : 0;\n            \n            if (this.position === Constants.MenuPosition.TOP) {\n                this.$el.css('top', togglePos.top + scrollTop);\n            } else if (this.position === Constants.MenuPosition.BELOW) {\n                this.$el.css('top', togglePos.top + this.$toggle.outerHeight() + scrollTop);\n            }\n            \n            this.$el.css('left', togglePos.left);\n        },\n\n        open: function () {\n\n            if (!this.enabled) { return false; }\n            \n            this.placeMenu();\n            this.$toggle.addClass('menu-open');\n            this.$toggle.unbind(this.toggleEvent, this.open);\n            this.$el.css('opacity', 0);\n            this.render();\n            this.$after.after(this.$el);\n            this.trigger('show', this.$el, this.$toggle);\n            this.$el.find('a').bind(this.itemEvent, this.handleSelect);\n            this.$el.bind(this.blurEvent, this.stopClickProp);\n            $(document.body).bind(this.blurEvent, this.close);\n            this.isOpen = true;\n\n            this.$el.animate({ opacity: 1 }, 150);\n\n            return false;\n\n        },\n\n        close: function () {\n\n            if (this.isOpen === false) { return; }\n\n            this.$toggle.removeClass('menu-open');\n            this.$el.remove();\n            this.trigger('hide');\n            this.$el.find('a').unbind(this.itemEvent, this.handleSelect);\n            this.$el.unbind(this.blurEvent, this.stopClickProp);\n            $(document.body).unbind(this.blurEvent, this.close);\n            this.isOpen = false;\n\n            var self = this;\n            _.delay(function () { self.$toggle.bind(self.toggleEvent, self.open); }, 200);\n\n            return false;\n\n        },\n\n        handleSelect: function (ev) {\n            var selection = $(ev.currentTarget).attr('data');\n            this.trigger('selection', selection);\n            _.defer(this.close);\n            return false;\n        },\n\n        enable: function () {\n            this.enabled = true;\n        },\n\n        disable: function () {\n            this.enabled = false;\n        },\n\n        render: function () {\n\n            if (this.isRendered) { return this; }\n            \n            var key,\n                markup = '',\n                i;\n\n            for (i = this.items.length - 1; i >= 0; i--) {\n                key = this.items[i];\n                markup += '<a data=\"' + key + '\"><i class=\"icon-btn ' + key + '\"></i>' + this.labels[key] + '</a>';\n            }\n\n            this.$el.html(markup);\n            this.isRendered = true;\n\n            return this;\n        },\n\n        stopClickProp: function (e) {\n            if (e && e.stopImmediatePropagation) {\n                e.stopImmediatePropagation();\n            }\n        }\n    });\n\n    return ContextMenuView;\n});\n\n//# sourceURL=/lib/graphite-api/public/js/ccweb.files.extract/views/inspect/ContextMenuView.js"),eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4, bitwise: true */\n/*global define: true, graphite: true*/\n\ndefine('ccweb.files.extract/models/FontFamilyModel',[\n    'underscore',\n    'backbone'\n], function (_, Backbone) {\n    'use strict';\n    var FontFamilyModel = Backbone.Model.extend({\n\n        defaults: {\n            name: '',\n            faces: null\n        },\n\n        initialize: function () {\n            this.set('faces', {});\n        },\n\n        addTextStyle: function (textStyleUsage) {\n            var textStyle = textStyleUsage.get('style');\n\n            var faceObj;\n            var faces = this.get('faces');\n            var face;\n\n            for (face in faces) {\n                if (faces.hasOwnProperty(face)) {\n                    if (face === textStyle.get('fontFace')) {\n                        faceObj = faces[face];\n                        break;\n                    }\n                }\n            }\n\n            if (!faceObj) {\n                faceObj = [];\n                faces[textStyle.get('fontFace')] = faceObj;\n            }\n\n            faceObj.push(textStyleUsage);\n        }\n\n    });\n\n    return FontFamilyModel;\n\n});\n\n//# sourceURL=/lib/graphite-api/public/js/ccweb.files.extract/models/FontFamilyModel.js"),eval('/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4 */\n/*global define: true, graphite: true, brackets*/\n\ndefine(\'override/BracketsClipboard\',[\n    \'jquery\',\n    \'underscore\',\n    \'ext/NodeAPI\'\n], function ($, _, NodeAPI) {\n    "use strict";\n    var nodeDomain = NodeAPI.nodeDomain;\n    \n    // All BracketsClipboard clients share this data\n    var _clientMeta = {}, // tracks instances of BracketsClipboard\n        clientIdCounter = 0, // each instance of BracketsClipboard gets a unique ID\n        elementIdCounter = 0, // counter for DOM elements to be tracked by BracketsClipboard\n        _elementMeta = {}, // maps tracked DOM elements to BracketsClipboard instances\n        _globalConfig = {\n            hoverClass: "zeroclipboard-is-hover"\n        };\n\n    function BracketsClipboard(elements, options) {\n        var idNum = clientIdCounter++;\n        \n        this._handleClick       = this._handleClick.bind(this);\n        this._handleMouseover   = this._handleMouseover.bind(this);\n        this._handleMouseout    = this._handleMouseout.bind(this);\n\n        this.id = idNum.toString();\n        _clientMeta[this.id] = {\n            instance: this,\n            elements: [],\n            handlers: {}\n        };\n    }\n    \n    function _getAllClientsClippedToElement(element) {\n        var elementMetaId,\n            clientIds,\n            client,\n            clients = [];\n        \n        if (element && element.nodeType === 1) { // element is a regular DOM node\n            elementMetaId = element.clippingId;\n            if (_elementMeta.hasOwnProperty(elementMetaId)) {\n                clientIds = _elementMeta[elementMetaId];\n                if (clientIds && clientIds.length) {\n                    _.each(clientIds, function (clientId) {\n                        client = _clientMeta[clientId].instance;\n                        // Test if element is a BracketsClipboard\n                        if (client && client instanceof BracketsClipboard) {\n                            clients.push(client);\n                        }\n                    });\n                }\n            }\n        }\n        return clients;\n    }\n    \n    function _dispatchCallback(func, context, event, async) {\n        if (async) {\n            window.setTimeout(function () {\n                func.apply(context, event);\n            }, 0);\n        } else {\n            func.apply(context, event);\n        }\n    }\n    \n    var _dispatchClientCallbacks = function (eventName, context, event, async) {\n        var handlers = _clientMeta[this.id] && _clientMeta[this.id].handlers[eventName];\n    \n        if (handlers && handlers.length) {\n            var func,\n                originalContext = context || this;\n            \n            _.each(handlers, function (handler) {\n                func = handler;\n                context = originalContext;\n                \n                if (typeof func === "function") {\n                    _dispatchCallback(func, context, event, async);\n                }\n            });\n        }\n        \n        return this;\n    };\n    \n    var _dispatchEvent = function (eventName, event, element) {\n        var performCallbackAsync = true;\n        \n        eventName = eventName.toLowerCase().replace(/^on/, "");\n\n        switch (eventName) {\n        case "mouseover":\n            $(element).addClass(_globalConfig.hoverClass);\n            break;\n\n        case "mouseout":\n            $(element).removeClass(_globalConfig.hoverClass);\n            break;\n                \n        case "datarequested":\n            performCallbackAsync = false;\n            break;\n        }\n        \n        var context = element,\n            eventArgs = [ this, event ];\n        \n        return _dispatchClientCallbacks.call(this, eventName,\n                                             context, eventArgs, performCallbackAsync);\n    };\n    \n    function _dispatch(eventName, event) {\n        var currentElement = event.target;\n        \n        if (typeof eventName === "string" && eventName) {\n            var cleanEventName = eventName.toLowerCase().replace(/^on/, "");\n            if (cleanEventName) {\n                var clients = currentElement && _getAllClientsClippedToElement(currentElement);\n                _.each(clients, function (client) {\n                    _dispatchEvent.call(client, cleanEventName, event, currentElement);\n                });\n            }\n        }\n    }\n    \n    function _prepClip(elements) {\n        if (typeof elements === "string") {\n            throw new TypeError("BracketsClipboard expects dom elements.");\n        }\n        \n        if (!elements.length) {\n            return [ elements ];\n        }\n        \n        return elements;\n    }\n\n    BracketsClipboard.prototype._handleClick = function (event) {\n        // dispatch callback to clients that subscribed to the clipboard element\n        _dispatch("dataRequested", event);\n    };\n    \n    BracketsClipboard.prototype._handleMouseover = function (event) {\n        // add hover class\n        _dispatch("mouseover", event);\n    };\n    \n    BracketsClipboard.prototype._handleMouseout = function (event) {\n        // remove hover class\n        _dispatch("mouseout", event);\n    };\n\n    BracketsClipboard.prototype.clip = function (elements) {\n        var self = this;\n        \n        function attachHandlers(element) {\n            var $element = $(element);\n\n            $element.on("click.BracketsClipboard", self._handleClick);\n            $element.on("mouseover.BracketsClipboard", self._handleMouseover);\n            $element.on("mouseout.BracketsClipboard", self._handleMouseout);\n        }\n\n        elements = _prepClip(elements);\n        \n        _.each(elements, function (element) {\n            if (element && element.nodeType === 1) {\n                if (!element.clippingId) {\n                    element.clippingId = "clippingId_" + elementIdCounter++;\n                    _elementMeta[element.clippingId] = [self.id];\n                    attachHandlers(element);\n                }\n                \n                var clippedElements = _clientMeta[self.id].elements;\n                \n                if (!_.contains(clippedElements, element)) {\n                    clippedElements.push(element);\n                }\n            }\n        });\n        \n        return this;\n    };\n    \n    BracketsClipboard.prototype.unclip = function (elements) {\n        var self = this,\n            meta = _clientMeta[this.id];\n        \n        function removeHandlers(element) {\n            var $element = $(element);\n            \n            $element.off("click.BracketsClipboard");\n            $element.off("mouseover.BracketsClipboard");\n            $element.off("mouseout.BracketsClipboard");\n        }\n        \n        if (meta) {\n            var clippedElements = meta.elements;\n            var arrayIndex;\n\n            elements = _prepClip(elements);\n \n            _.each(elements, function (element) {\n                if (element && element.nodeType === 1) {\n                    arrayIndex = 0;\n                    while (_.contains(clippedElements, element)) {\n                        arrayIndex = _.indexOf(clippedElements, element);\n                        clippedElements.splice(arrayIndex, 1);\n                    }\n                    var clientIds = _elementMeta[element.clippingId];\n                    if (clientIds) {\n                        arrayIndex = 0;\n                        while (_.contains(clientIds, self.id)) {\n                            arrayIndex = _.indexOf(clientIds, self.id);\n                            clientIds.splice(arrayIndex, 1);\n                        }\n                        if (clientIds.length === 0) {\n                            removeHandlers(element);\n                            delete element.clippingId;\n                        }\n                    }\n                }\n            });\n        }\n        \n        return this;\n    };\n\n    BracketsClipboard.prototype.setText = function (newText) {\n        var self = this;\n        \n        if (newText && newText !== "") {\n            //_clipData["text/plain"] = newText;\n            nodeDomain.exec("copy", newText).done(function (error, result) {\n                _dispatchEvent.call(self, "complete");\n            });\n        }\n        return this;\n    };\n    \n    BracketsClipboard.prototype.on = function (eventName, func) {\n        var self = this,\n            event,\n            events,\n            added = {},\n            handlers = _clientMeta[this.id] && _clientMeta[this.id].handlers;\n        \n        if (typeof eventName === "string" && eventName) {\n            events = eventName.toLowerCase().split(/\\s+/);\n        } else if (typeof eventName === "object" &&\n                   eventName && typeof func === "undefined") {\n            \n            _.each(eventName, function (event) {\n                if (eventName.hasOwnProperty(event) &&\n                        typeof event === "string" &&\n                        event &&\n                        typeof eventName[event] === "function") {\n                    self.on(event, eventName[event]);\n                }\n            });\n        }\n        \n        if (events && events.length) {\n            _.each(events, function (event) {\n                eventName = event.replace(/^on/, "");\n                added[eventName] = true;\n                if (!handlers[eventName]) {\n                    handlers[eventName] = [];\n                }\n                handlers[eventName].push(func);\n            });\n            if (added.load) {\n                _dispatchEvent.call(this, "load");\n            }\n        }\n        return this;\n    };\n\n    \n    BracketsClipboard.prototype.off = function (eventName, func) {\n        var self = this,\n            i,\n            foundIndex,\n            events,\n            perEventHandlers,\n            handlers = _clientMeta[this.id] && _clientMeta[this.id].handlers;\n\n        if (arguments.length === 0) {\n            events = _.keys(handlers);\n        } else if (typeof eventName === "string" && eventName) {\n            events = eventName.split(/\\s+/);\n        } else if (typeof eventName === "object" && eventName && typeof func === "undefined") {\n            _.each(eventName, function (i) {\n                if (typeof i === "string" && i && typeof eventName[i] === "function") {\n                    this.off(i, eventName[i]);\n                }\n            });\n        }\n        if (events && events.length) {\n            _.each(events, function (event) {\n                eventName = event.toLowerCase().replace(/^on/, "");\n                perEventHandlers = handlers[eventName];\n                if (perEventHandlers && perEventHandlers.length) {\n                    if (func) {\n                        foundIndex = _.indexOf(perEventHandlers, func);\n                        while (foundIndex !== -1) {\n                            perEventHandlers.splice(foundIndex, 1);\n                            foundIndex = _.indexOf(perEventHandlers, func, foundIndex);\n                        }\n                    } else {\n                        handlers[eventName].length = 0;\n                    }\n                }\n            });\n        }\n        return this;\n    };\n\n    return BracketsClipboard;\n});\n\n//# sourceURL=/./BracketsClipboard.js'),eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4, bitwise: true */\n/*global define: true, graphite: true*/\n\ndefine('ccweb.files.extract/controllers/ClipboardController',[\n    'jquery',\n    'underscore',\n    'backbone',\n    'ccweb.files.extract/external/ZeroClipboard/ZeroClipboard'\n], function ($, _, Backbone, ZeroClipboard) {\n    'use strict';\n\n    var ClipboardController = Backbone.Model.extend({\n        clipboard: null,\n        loaded: false,\n\n        getClipboard: function () {\n            if (!this.clipboard) {\n                this.initController();\n            }\n\n            return this.clipboard;\n        },\n\n        initController: function () {\n            try {\n                this.clipboard = new ZeroClipboard();\n\n                // change state to 'copy-able' if swf successfully loads\n                this.clipboard.on('load', function () {\n                    graphite.events.trigger('clipboard-loaded');\n                });\n\n                this.clipboard.on('dataRequested', function () {\n                    graphite.events.trigger('clipboard-data-requested', this);\n                });\n\n                this.clipboard.on('complete', function () {\n                    graphite.events.trigger('clipboard-complete', this);\n                });\n\n                this.clipboard.on('mouseover', function () {\n                    graphite.events.trigger('clipboard-mouseover', this);\n                });\n            } catch (err) {\n                console.log(err);\n            }\n\n        }\n\n    });\n\n    return new ClipboardController();\n});\n\n//# sourceURL=/lib/graphite-api/public/js/ccweb.files.extract/controllers/ClipboardController.js"),eval('define(\'text!ccweb.files.extract/views/templates/autoExtractedItemsTemplate.html\',[],function () { return \'<div>\\n    <div id="aug21FilesHeader" class="aug21Header">\\n        <span class="aug21HeaderTextLarge aug21HeaderTextBlackBold">Update:</span><span class="aug21HeaderTextLarge"> Project Parfait is now available as Extract in Creative Cloud, <span class="aug21HeaderTextLarge aug21HeaderTextBlackBold">for free</span>. Get all the same features you love and more, including sharing with others.</span><br/><br/>\\n        <span class="aug21HeaderTextSmall">You can start using Extract by going to <a id="aug21CCFilesLink" href="https://creative.adobe.com/files">Creative Cloud Files</a>. Youll be able to download your uploaded PSDs and continue to use Project Parfait until <span class="aug21HeaderTextBlackBold aug21HeaderTextSmall">September 30.</span> <a id="aug21LearnMoreLink" href="http://www.adobe.com/go/extract_faq" target="_blank">Learn more here</a></span>\\n    </div>\\n    <h4 class="preprocessor-header">\\n        <div class="preprocessor">\\n            <b><%-preprocessors[currentPreprocessor].displayName%></b><em></em>\\n        </div>\\n        <button class="cssInspectorCopyAllButton topcoat-button"><%-translate("Copy All")%></button>\\n    </h4>\\n\\n    <ul class="css-properties"></ul>\\n    <ul class="panel-rows">\\n        <li>\\n            <label for="fontUnit"><%-translate("Preferred font unit")%></label>\\n            <div class="dropdown">    \\n                <div class="dropdown-btn fontUnit" id="fontUnit">\\n                    <%-currentUnitType%>\\n                </div>\\n            </div>\\n        </li>\\n        <li>\\n            <label for="baseFontInput" id="baseFontInputLabel"><%-translate("Base font size")%></label>\\n            <input id="baseFontInput" class="topcoat-text-input" type="text" class="prefix-input" value="16px" size="4">\\n        </li>\\n    </ul>\\n\\n    <h4><%-translate("Fonts")%></h4>\\n    <ul class="font-list"></ul>\\n    <h4><%-translate("Colors")%></h4>\\n    <ul class="solid-color-list"></ul>\\n    <h4><%-translate("Gradients")%></h4>\\n    <ul class="gradient-list"></ul>\\n</div>\';});\n\n//# sourceURL=/text!ccweb.files.extract/views/templates/autoExtractedItemsTemplate.html'),
eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013-2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4 */\n/*global define: true, graphite: true, window: true*/\n\ndefine('ccweb.files.extract/views/inspect/PSDInspectView',[\n    'jquery',\n    'underscore',\n    'backbone',\n    'ccweb.files.extract/views/inspect/InspectCSSView',\n    'ccweb.files.extract/views/inspect/InspectFontFamilyView',\n    'ccweb.files.extract/views/inspect/InspectSolidColorView',\n    'ccweb.files.extract/views/inspect/DropperColorView',\n    'ccweb.files.extract/views/inspect/InspectGradientView',\n    'ccweb.files.extract/views/inspect/ContextMenuView',\n    'ccweb.files.extract/models/FontFamilyModel',\n    'ccweb.files.extract/controllers/DetailsController',\n    'ccweb.files.extract/controllers/ClipboardController',\n    'ccweb.files.extract/controllers/SelectionController',\n    'ccweb.files.extract/models/ColorModel',\n    'ccweb.files.extract/models/ColorUsageModel',\n    'ccweb.files.extract/models/PSDSettingsModel',\n    'ccweb.files.extract/models/UserSettingsModel',\n    'plugin-dependencies',\n    'ccweb.files.extract/utils/TemplateUtil',\n    'ccweb.files.extract/Constants',\n    'ccweb.files.extract/utils/CSSUtil',\n    'text!ccweb.files.extract/views/templates/autoExtractedItemsTemplate.html'\n], function ($, _, Backbone, InspectCSSView, InspectFontFamilyView, InspectSolidColorView, DropperColorView,\n             InspectGradientView, ContextMenuView, FontFamilyModel, DetailsController, ClipboardController,\n             SelectionController, ColorModel, ColorUsageModel, PSDSettingsModel, UserSettingsModel,\n             deps, TemplateUtil, Constants, CSSUtil, AutoExtractedItemsTemplate) {\n    'use strict';\n\n    var PSDInspectView = Backbone.View.extend({\n        colorChips: [],\n        gradientChips: [],\n        fontFamilyViews: [],\n\n        events: {\n            'dblclick .css-properties': 'handleDoubleClickEvent',\n            'change #baseFontInput': 'handleBaseFontSizeChanged'\n        },\n\n        initialize: function () {\n            this.render();\n            this.model.on('change:extractedStyles', this.handleModelExtractedStylesChange, this);\n            DetailsController.on('change:selectedInspectItem', this.handleSelectedInspectItemChange, this);\n\n            if (this.model.get('extractedStyles')) {\n                this.handleModelExtractedStylesChange();\n            }\n            this.initCopyToClipboard();\n            graphite.events.on('commitDropperColor', this.handleNewDropperColor, this);\n        },\n\n        render: function () {\n\n            this.setElement(TemplateUtil.createTemplate(AutoExtractedItemsTemplate,\n                { preprocessors: CSSUtil.cssPreprocessors, currentPreprocessor: UserSettingsModel.get('preprocessor'),\n                    currentUnitType: UserSettingsModel.get('preferredFontUnits')}));\n\n            this.createCSSView();\n\n            this.createFontUnitMenu();\n            this.createPreprocessorMenu();\n\n            if (deps.parfait && window.graphite.isFeatureEnabled('aug21')) {\n                this.$el.find('#aug21FilesHeader').addClass('aug21');\n            }\n\n            return this;\n        },\n        \n        createPreprocessorMenu: function () {\n            var preprocessorItems = [],\n                preprocessorLabels = {};\n\n            _.each(CSSUtil.cssPreprocessors, function (details, key) {\n                if (details.enabled !== false) {\n                    preprocessorLabels[key] = details.displayName;\n                    preprocessorItems.unshift(key);\n                }\n            });\n            \n            this.preprocessorMenu = new ContextMenuView({\n                name : 'preprocessor-selector',\n                $toggle : this.$('div.preprocessor'),\n                $after : this.$('div.preprocessor'),\n                items : preprocessorItems,\n                position : Constants.MenuPosition.BELOW\n            });\n            this.preprocessorMenu.labels = preprocessorLabels;\n            this.$('.preprocessor').addClass('menu-active');\n            this.preprocessorMenu.on('show', this.handlePreprocessorMenuShow, this);\n            this.preprocessorMenu.on('selection', this.handlePreprocessorSelectionChange, this);\n        },\n        \n        createFontUnitMenu: function () {\n            var fontUnitItems = [],\n                fontUnitLabels = {};\n\n            _.each(Constants.FontUnitType, function (details, key) {\n                    fontUnitLabels[key] = details;\n                    fontUnitItems.unshift(key);\n                });\n            \n            this.fontUnitMenu = new ContextMenuView({\n                name : 'fontUnit-selector',\n                $toggle : this.$('div.fontUnit'),\n                $after : this.$('div.fontUnit'),\n                items : fontUnitItems,\n                position : Constants.MenuPosition.TOP\n            });\n            this.fontUnitMenu.labels = fontUnitLabels;\n            this.$('.fontUnit').addClass('menu-active');\n            this.fontUnitMenu.on('show', this.handleFontUnitMenuShow, this);\n            this.fontUnitMenu.on('selection', this.handleFontUnitSelectionChange, this);\n        },\n        \n        handleFontUnitMenuShow: function ($menu) {\n            var currentItem = UserSettingsModel.get('preferredFontUnits');\n            var key = (_.invert(Constants.FontUnitType))[currentItem];\n            this.fontUnitMenu.checkItem(key);\n        },\n\n        handleFontUnitSelectionChange: function (fontUnit) {\n            var unit = Constants.FontUnitType[fontUnit];\n            if (unit !== UserSettingsModel.get('preferredFontUnits')) {\n                this.handlePreferredUnitTypeChanged(unit);\n                UserSettingsModel.set('preferredFontUnits', unit);\n                this.$('.fontUnit').text(unit);\n            }\n        },\n\n        handlePreprocessorMenuShow: function ($menu) {\n            var currentPreprocessor = UserSettingsModel.get('preprocessor');\n            this.preprocessorMenu.checkItem(currentPreprocessor);\n        },\n\n        handlePreprocessorSelectionChange: function (preprocessor) {\n            if (preprocessor !== UserSettingsModel.get('preprocessor')) {\n                UserSettingsModel.set('preprocessor', preprocessor);\n                this.$('.preprocessor b').text(CSSUtil.cssPreprocessors[preprocessor].displayName);\n                graphite.events.trigger('preprocessorChanged', {preprocessor: preprocessor});\n            }\n        },\n\n        handleModelExtractedStylesChange: function () {\n            this.createTextStyleExamples();\n            this.createSolidColorChips();\n            this.createGradientChips();\n        },\n\n        initCopyToClipboard: function () {\n            var clipboard = ClipboardController.getClipboard();\n\n            //copy css button\n            var $copyAllBtn = this.$el.find('button.cssInspectorCopyAllButton');\n            clipboard.clip($copyAllBtn);\n\n            graphite.events.on('clipboard-data-requested', function (elem) {\n                if ($(elem).is($copyAllBtn)) {\n                    $copyAllBtn.html(deps.translate('Copied'));\n                    setTimeout(function () {\n                        $copyAllBtn.html(deps.translate('Copy All'));\n                    }, 1500);\n                    var layerModel = SelectionController.getSelectedLayers(),\n                        cssStr;\n                    if (layerModel.length !== 0) {\n                        if (layerModel.length === 1) {\n                            layerModel = layerModel[0];\n                            cssStr = layerModel.getCSSAsString(true, UserSettingsModel.get('preprocessor'));\n                            //copy css metrics event\n                            graphite.events.trigger('copy-css', {origin: 'CSSInspectorCopyAll'});\n                        } else {\n                            //We don't display any CSS for multiple selected layers\n                            cssStr = '';\n                        }\n                        clipboard.setText(cssStr);\n                    } else {\n                        var cssProperties = $('.css-properties')[0];\n                        var text = cssProperties.innerText || cssProperties.textContent;\n                        clipboard.setText(text);\n                    }\n                }\n            });\n\n        },\n\n        removeEventListeners: function () {\n            graphite.events.off(null, null, this);\n            this.model.off(null, null, this);\n            DetailsController.off(null, null, this);\n        },\n\n        //------------------------------------------------\n        // Creation helpers\n        //------------------------------------------------\n\n        createCSSView: function () {\n            var cssList = this.$el.find('.css-properties'),\n                baseFontSizeValue = PSDSettingsModel.get('baseFontSizeValue'),\n                baseFontSizeUnits = PSDSettingsModel.get('baseFontSizeUnits'),\n                preferredFontUnits = UserSettingsModel.get('preferredFontUnits');\n\n            if (!preferredFontUnits) {\n                preferredFontUnits = Constants.FontUnitType.PX;\n            }\n            this.$el.find('.fontUnit').text(preferredFontUnits);\n            this.handlePreferredUnitTypeChanged(preferredFontUnits);\n\n            this.cssView = new InspectCSSView({parentView: this});\n            this.cssView.el = cssList;\n        },\n\n        createTextStyleExamples: function () {\n            var list = this.$el.find('.font-list'),\n                fontExample,\n                fonts = this.processTextStyles(),\n                self = this,\n                ppi = CSSUtil.findModelResolution(self.model),\n                fontFamily;\n\n            list.empty();\n            $.each(fonts, function (index, value) {\n                fontExample = new InspectFontFamilyView({model: value, ppi: ppi});\n                list.append(fontExample.el);\n                self.fontFamilyViews.push(fontExample);\n            });\n\n            list.append($('<div style=\"clear:both;\"></div>'));\n        },\n\n\n        processTextStyles: function () {\n            var extractedStyles = this.model.get('extractedStyles'),\n                textStyles = extractedStyles ? extractedStyles.textStyles : {},\n                fontFamilies = [],\n                fontFamily,\n                textStyle;\n\n            $.each(textStyles, function (textStyleindex, textStyleUsage) {\n                fontFamily = null;\n                textStyle = textStyleUsage.get('style');\n                // try to find font family for text style\n                $.each(fontFamilies, function (fontFamilyIndex, family) {\n                    if (textStyle.get('fontName') === family.get('name')) {\n                        fontFamily = family;\n                        return false;\n                    }\n                    return true;\n                });\n\n                if (!fontFamily) {\n                    fontFamily = new FontFamilyModel({\n                        name: textStyle.get('fontName'),\n                        friendlyName: textStyle.get('friendlyName')\n                    });\n                    fontFamilies.push(fontFamily);\n                }\n\n                // add text style to font family\n                fontFamily.addTextStyle(textStyleUsage);\n            });\n\n            return fontFamilies;\n        },\n\n        createSolidColorChips: function () {\n            var list = this.$el.find('.solid-color-list'),\n                colorChip,\n                dropper,\n                colors = this.model.get('extractedStyles').colors,\n                self = this;\n\n            colors.sort(this.sortColorFunction);\n\n            $.each(colors, function (index, value) {\n                colorChip = new InspectSolidColorView({model: value});\n                list.append(colorChip.el);\n                self.colorChips.push(colorChip);\n            });\n\n            // Append dropper chip\n            dropper = new DropperColorView({model: new Backbone.Model()});\n            list.prepend(dropper.el);\n            list.append($('<div style=\"clear:both;\"></div>'));\n        },\n\n        handleNewDropperColor: function (lastColor) {\n            var $dropperChip = $('.dropper-item .color-chip');\n\n            if (lastColor) {\n                var usageModel = new ColorUsageModel(),\n                    colorModel = new ColorModel(lastColor),\n                    $dropperItem = $('.dropper-item');\n\n                usageModel.set('style', colorModel);\n                if (lastColor.alpha !== 1) {\n                    usageModel.set('alphas', [lastColor.alpha.toFixed(2)]);\n                }\n                this.model.get('extractedStyles').colors.push(usageModel);\n                var colorChip = new InspectSolidColorView({model: usageModel});\n                colorChip.$el.insertAfter($dropperItem);\n                this.colorChips.push(colorChip);\n            }\n\n            $dropperChip.css('background-color', '');\n        },\n\n\n        createGradientChips: function () {\n            var list = this.$el.find('.gradient-list'),\n                gradientChip,\n                gradients = this.model.get('extractedStyles').gradients,\n                self = this;\n\n            gradients.sort(this.sortColorFunction);\n\n            $.each(gradients, function (index, value) {\n                gradientChip = new InspectGradientView({model: value});\n                list.append(gradientChip.el);\n                self.gradientChips.push(gradientChip);\n            });\n\n            list.append($('<div style=\"clear:both;\"></div>'));\n        },\n\n        //------------------------------------------------\n        // Handlers\n        //------------------------------------------------\n\n        handleBaseFontSizeChanged: function () {\n            var $baseFontSizeInput = this.$el.find('#baseFontInput'),\n                newBaseFontSizeStr = $baseFontSizeInput.val(),\n                regEx = /(\\d+)\\s*(.*)/,\n                matches = regEx.exec(newBaseFontSizeStr),\n                baseFontSizeValue = PSDSettingsModel.get('baseFontSizeValue'), //Stored on the model b/c this may change per PSD\n                baseFontSizeUnits = PSDSettingsModel.get('baseFontSizeUnits'),\n                origValue = baseFontSizeValue + baseFontSizeUnits,\n                parsedValue;\n\n            //Figure out what number the user put in and what units they chose\n            if (matches && matches.length >= 1) {\n                parsedValue = parseFloat(matches[1]);\n                if ((parsedValue > 0) && (parsedValue < 1000)) {\n                    baseFontSizeValue = parseFloat(matches[1]); //Get the value, check later for units\n                }\n                if (matches.length >= 2) {\n                    switch (matches[2].trim().toLowerCase()) {\n                        case 'px':\n                            baseFontSizeUnits = Constants.FontUnitType.PX;\n                            break;\n                        default:\n                            baseFontSizeUnits = Constants.FontUnitType.PX;\n                            break;\n                    }\n                }\n            } else {\n                //User cleared the field, reset to default values\n                baseFontSizeValue = Constants.BaseFontDefaultSize;\n                baseFontSizeUnits = Constants.FontUnitType.PX;\n            }\n            if (baseFontSizeValue) {\n                PSDSettingsModel.set('baseFontSizeValue', baseFontSizeValue);\n                if (baseFontSizeUnits) {\n                    $baseFontSizeInput.val(baseFontSizeValue + baseFontSizeUnits);\n                    PSDSettingsModel.set('baseFontSizeUnits', baseFontSizeUnits);\n                } else {\n                    $baseFontSizeInput.val(baseFontSizeValue.toString() + baseFontSizeUnits);\n                }\n            } else {\n                $baseFontSizeInput.val(baseFontSizeValue + baseFontSizeUnits);\n            }\n            if (origValue !== baseFontSizeValue + baseFontSizeUnits) {\n                graphite.events.trigger('updateFontCSS');\n                graphite.events.trigger('baseFontSizeChanged', {newBaseUnits: baseFontSizeValue + baseFontSizeUnits});\n                this.createTextStyleExamples();\n            }\n        },\n\n        handlePreferredUnitTypeChanged: function (preferredFontUnits) {\n            var baseFontSizeValue = PSDSettingsModel.get('baseFontSizeValue'),\n                baseFontSizeUnits = PSDSettingsModel.get('baseFontSizeUnits');\n\n            if (preferredFontUnits && preferredFontUnits !== Constants.FontUnitType.PX) {\n                if (!baseFontSizeValue) {\n                    baseFontSizeValue = 16;\n                    PSDSettingsModel.set('baseFontSizeValue', baseFontSizeValue);\n                }\n                if (!baseFontSizeUnits) {\n                    baseFontSizeUnits = Constants.FontUnitType.PX;\n                    PSDSettingsModel.set('baseFontSizeUnits', baseFontSizeUnits);\n                }\n                this.$el.find('#baseFontInputLabel').removeClass('disabledLabel');\n                this.$el.find('#baseFontInput').prop('disabled', false);\n                this.$el.find('#baseFontInput').val(baseFontSizeValue + baseFontSizeUnits);\n            } else {\n                this.$el.find('#baseFontInputLabel').addClass('disabledLabel');\n                this.$el.find('#baseFontInput').prop('disabled', true);\n                this.$el.find('#baseFontInput').val('');\n            }\n\n            if (preferredFontUnits && preferredFontUnits !== UserSettingsModel.get('preferredFontUnits')) {\n                UserSettingsModel.set('preferredFontUnits', preferredFontUnits);\n                graphite.events.trigger('updateFontCSS');\n                graphite.events.trigger('preferredFontUnitsChanged', {preferredUnits: preferredFontUnits});\n                this.createTextStyleExamples();\n            }\n        },\n\n        handleSelectedInspectItemChange: function () {\n            if (!DetailsController.get('selectedInspectItem')) {\n                graphite.events.trigger('hide-extract-code-popup');\n            }\n        },\n\n        handleDoubleClickEvent: function () {\n            graphite.events.trigger('cssDoublClick');\n        },\n\n        //------------------------------------------------\n        // Helpers\n        //------------------------------------------------\n\n        sortColorFunction: function (a, b) {\n            return b.get('layers').length - a.get('layers').length;\n        },\n\n        remove: function () {\n            this.cssView.remove();\n            this.cssView = null;\n\n            this.removeEventListeners();\n\n            // Remove color chip views\n            _.each(this.colorChips, function (colorChip) {\n                colorChip.remove();\n            });\n            this.colorChips.length = 0;\n\n            // Remove gradient chip views\n            _.each(this.gradientChips, function (gradientChip) {\n                gradientChip.remove();\n            });\n            this.gradientChips.length = 0;\n\n            // Remove font family views\n            _.each(this.fontFamilyViews, function (fontFamily) {\n                fontFamily.remove();\n            });\n            this.fontFamilyViews.length = 0;\n\n            Backbone.View.prototype.remove.call(this);\n        }\n\n    });\n\n    return PSDInspectView;\n});\n\n//# sourceURL=/lib/graphite-api/public/js/ccweb.files.extract/views/inspect/PSDInspectView.js"),eval('/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4 */\n/*global define: true, graphite: true, window: true*/\n\ndefine(\'override/views/inspect/BracketsPSDInspectView\',[\n    "ccweb.files.extract/views/inspect/PSDInspectView"\n], function (PSDInspectView) {\n    "use strict";\n\n    var BracketsPSDInspectView = PSDInspectView.extend({\n\n        initCopyToClipboard: function () {\n            // monkey patch to fix https://git.corp.adobe.com/jhagenst/brackets-parfait-extension/issues/199\n            // do nothing\n        }\n\n    });\n\n    return BracketsPSDInspectView;\n});\n//# sourceURL=/./views/inspect/BracketsPSDInspectView.js'),eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4, bitwise: true */\n/*global define: true, graphite: true*/\n\ndefine('ccweb.files.extract/models/DerivedAssetModel',[\n    'underscore',\n    'backbone'\n], function (_, Backbone) {\n    'use strict';\n    var mimeTypes = {\n        png : 'image/png',\n        svg : 'image/svg+xml',\n        jpg : 'image/jpeg',\n        jpeg : 'image/jpeg'\n    };\n    function getMimeByName(name) {\n        if (!name) {\n            return '';\n        }\n        var ext = name.substring(name.lastIndexOf('.') + 1);\n        return mimeTypes[ext] || '';\n    }\n    var DerivedAssetModel = Backbone.Model.extend({\n\n        defaults: {\n            guid: '',\n            dimension: '',\n            updated: '',\n            fileName: '',\n            mimeType: '',\n            originatingLayers: null\n        },\n\n        parse: function (response) {\n            var result = {\n                id: response.id,\n                guid: response.id,\n                name: response.name,\n                mimeType: getMimeByName(response.name)\n            };\n            return result;\n        }\n\n    });\n\n    return DerivedAssetModel;\n\n});\n\n//# sourceURL=/lib/graphite-api/public/js/ccweb.files.extract/models/DerivedAssetModel.js"),eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4, bitwise: true */\n/*global define: true, graphite: true*/\n\ndefine('ccweb.files.extract/collections/DerivedAssetCollection',[\n    'backbone',\n    'ccweb.files.extract/models/DerivedAssetModel'\n], function (Backbone, DerivedAssetModel) {\n    'use strict';\n    var DerivedAssetCollection = Backbone.Collection.extend({\n        model: DerivedAssetModel,\n\n        parse: function (response) {\n            return response;\n        }\n    });\n\n    return DerivedAssetCollection;\n\n});\n\n//# sourceURL=/lib/graphite-api/public/js/ccweb.files.extract/collections/DerivedAssetCollection.js"),eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4, bitwise: true */\n/*global define: true, graphite: true, setTimeout: true, window : true*/\n\ndefine('ccweb.files.extract/controllers/DerivedAssetController',[\n    'jquery',\n    'underscore',\n    'backbone',\n    'ccweb.files.extract/collections/DerivedAssetCollection',\n    'ccweb.files.extract/models/DerivedAssetModel',\n    'ccweb.files.extract/Constants'\n], function ($, _, Backbone, DerivedAssetCollection, DerivedAssetModel, Constants) {\n    'use strict';\n    var DerivedAssetController = Backbone.Model.extend({\n\n        downloadFrames: [],\n        maxDownloads: 3,\n        fileExtMap : {\n            'svg': '.svg',\n            'jpg': '.jpg',\n            'jpeg': '.jpg',\n            'png8': '.png',\n            'png32': '.png'\n        },\n\n        derivedAssetCollection: new DerivedAssetCollection(),\n\n        getDerivedAssets: function (psdModel, successCallback, errorCallback, context) {\n            if (!this.derivedAssetCollection) {\n                this.derivedAssetCollection = new DerivedAssetCollection();\n            } else if (this.psdGuid !== psdModel.get('id')) {\n                this.derivedAssetCollection.reset();\n            }\n\n            this.psdGuid = psdModel.get('id');\n\n            graphite.serverAPI.loadDerivedAssetCollection(this.derivedAssetCollection, psdModel, successCallback, errorCallback, context);\n            return this.derivedAssetCollection;\n        },\n\n\n        exportAsset: function (layerModels, assetName, imageFormat, quality, scaleFactor, psdModel, completeCallback, errorCallback, context) {\n            var psdGuid,\n                layerIds = [],\n                iImageQuality = parseInt(quality, 10),\n                i,\n                queryString = '',\n                joiner = '?',\n                localContent = psdModel.get('localContent');\n\n\n            for (i = 0; i < layerModels.length; i++) {\n                layerIds.push(layerModels[i].get('layerId'));\n            }\n            // Handle request to extract from marketing PSD.\n            if (localContent) {\n                queryString = '';\n                psdGuid = psdModel.get('id');\n                queryString = queryString + joiner + 'layerIds=' + layerIds.join(',');\n                joiner = '&';\n                queryString = queryString + joiner + 'encodingType=' + imageFormat;\n                queryString = queryString + joiner + 'encodingQualityFactor=' + iImageQuality;\n                queryString = queryString + joiner + 'assetName=' + encodeURIComponent(assetName);\n\n                //create a iframe to download the asset\n                if (localContent) {\n                    this.queueDownload('/api/v1/localcontent/' + psdGuid + '/derived' + queryString);\n                } else {\n                    this.queueDownload('/api/v1/psd/' + psdGuid + '/asset/derived' + queryString);\n                }\n                return;\n            }\n\n            iImageQuality = parseInt(quality, 10);\n\n            //generate unique asset name\n            assetName = this.generateUniqueAssetName(assetName, imageFormat);\n\n            var jsonPostObject = {\n                layerIds: layerIds,\n                encodingType: imageFormat,\n                encodingQualityFactor: iImageQuality,\n                psdGuid: psdModel.get('id'),\n                scale: scaleFactor,\n                layerCompId: psdModel.get('layerCompId'),\n                noCache: $.now(),\n                assetName: assetName\n            };\n\n            var that = this;\n\n            function onSuccess(data) {\n                var response = JSON.parse(data.responseText);\n                \n                if (graphite.inPublicOneUp()) {\n                    that.queueDownload(graphite.serverAPI.getDerivedDownloadURL(response.id, response.name));\n                } else {\n                    /**** HACK start ****/\n                    var model = new DerivedAssetModel();\n\n                    if (response.metadata && response.metadata.asset) {\n                        response.name = response.metadata.asset.fileName;\n                    }\n\n                    model.attributes = model.parse(response);\n\n                    // Replace if duplicate\n                    var origModels = that.derivedAssetCollection.where({name: model.get('name')});\n                    if (origModels && origModels.length) {\n                        that.derivedAssetCollection.remove(origModels);\n                    }\n\n                    that.derivedAssetCollection.add(model);\n\n                    /**** HACK end ****/\n                }\n                if (completeCallback) {\n                    completeCallback.apply(context, [data]);\n                }\n            }\n\n            function onError(errMsg) {\n                graphite.events.trigger('assetExtractionFailure', {});\n                if (errorCallback) {\n                    errorCallback.apply(context, [errMsg]);\n                }\n            }\n\n            graphite.serverAPI.createDerivedAsset(jsonPostObject, onSuccess, onError, this);\n        },\n\n        queueDownload: function (url) {\n            var $frameEl = $('<iframe style=\"display:none;\" class=\"downloader\">').appendTo($('body'));\n            $frameEl.attr('src', url);\n            this.downloadFrames.unshift($frameEl);\n\n            // Clean up least recently used frames beyond our max.\n            if (this.downloadFrames.length > this.maxDownloads) {\n                this.downloadFrames[this.maxDownloads].remove();\n                this.downloadFrames.length = this.maxDownloads;\n            }\n        },\n\n        generateUniqueAssetName: function (assetName, imageFormat) {\n            var fileExt = this.fileExtMap[imageFormat];\n            var lookUpAssetName = assetName + fileExt;\n            var bFileExists = true;\n            var suffix = 0;\n            var newAssetName = assetName;\n            while (bFileExists) {\n                var origModels = this.derivedAssetCollection.where({name: lookUpAssetName});\n                if (origModels && origModels.length) {\n                    //increment the suffix if found.\n                    suffix++;\n                    newAssetName = assetName + ' (' + suffix + ')';\n                    lookUpAssetName = newAssetName + fileExt;\n                    continue; //continue looking\n                }\n                bFileExists = false;\n            }\n            return newAssetName;\n        }\n    });\n\n    return new DerivedAssetController();\n\n});\n\n//# sourceURL=/lib/graphite-api/public/js/ccweb.files.extract/controllers/DerivedAssetController.js"),
eval('define(\'text!ccweb.files.extract/views/templates/derivedAssetListItemTemplate.html\',[],function () { return \'<li class="derived-asset-list-item" title="<%-name%>">\\n    <div class="image-wrapper">\\n        <a href="#">\\n            <% if (mimeType === \\\'image/svg+xml\\\') { %>\\n                <div></div>\\n            <% } else { %>\\n                <div style="background: url(\\\'<%- graphite.serverAPI.getDerivedRenditionURL(guid) %>\\\') center center no-repeat; background-size: contain;"></div>\\n            <% } %>\\n        </a>\\n    </div>\\n    <span class="asset-label" title="<%-name%>"> <%-name%> </span>\\n    <div class="del-button" title=\\\'<%-translate("Delete Asset")%>\\\'></div>\\n</li>\\n\';});\n\n//# sourceURL=/text!ccweb.files.extract/views/templates/derivedAssetListItemTemplate.html'),eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013-2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4 */\n/*global define: true, graphite: true*/\n\ndefine('ccweb.files.extract/views/assets/DerivedAssetView',[\n    'jquery',\n    'underscore',\n    'backbone',\n    'ccweb.files.extract/controllers/SelectionController',\n    'ccweb.files.extract/controllers/DetailsController',\n    'ccweb.files.extract/models/LayerModelMap',\n    'ccweb.files.extract/utils/ImageUtil',\n    'ccweb.files.extract/utils/TemplateUtil',\n    'text!ccweb.files.extract/views/templates/derivedAssetListItemTemplate.html'\n], function ($, _, Backbone, SelectionController, DetailsController, LayerModelMap, ImageUtil,\n             TemplateUtil, DerivedAssetListItemTemplate) {\n    'use strict';\n\n    var InspectDerivedAssetView = Backbone.View.extend({\n        events: {\n            'load img': 'handleImageLoad',\n            'mouseenter': 'handleMouseEnter',\n            'mouseleave': 'handleMouseLeave',\n            'click .del-button': 'handleDeleteButton'\n        },\n\n        initialize: function () {\n            this.render();\n            this.addHandlers();\n        },\n\n        render: function () {\n            this.setElement(TemplateUtil.createTemplate(DerivedAssetListItemTemplate, this.model.attributes));\n            this.$deleteButton = this.$el.find('.del-button');\n        },\n\n\n        addHandlers: function () {\n            var self = this;\n\n            this.$el.click(function (event) {\n                event.preventDefault();\n                if (SelectionController.get('inspectedAsset') &&\n                        SelectionController.get('inspectedAsset').get('id') === self.model.get('id')) {\n                    DetailsController.setInspectedAsset(null);\n                } else {\n                    DetailsController.setInspectedAsset(self.model);\n                }\n                //initial metric tracking for when downloading the extracted asset\n                graphite.events.trigger('downloading-extracted-asset');\n                if (!self.$downloadFrame) {\n                    self.$downloadFrame = $('<iframe class=\"download-frame\"/>');\n                    self.$el.append(self.$downloadFrame);\n                }\n\n                // Ensure resource is accessible before ultimately downloading.\n                var assetURL = graphite.serverAPI.getDerivedDownloadURL(self.model.get('guid'), self.model.get('name'));\n                graphite.serverAPI.getAssetETag(self.model.get('guid'),\n                    function (response) {\n                        self.$downloadFrame.attr('src', assetURL);\n                    },\n                    function (response) {\n                        if (response.status === 401) {\n                            graphite.events.trigger('reauthenticate');\n                        }\n                    },\n                    this);\n            });\n        },\n\n        removeEventListeners: function () {\n            DetailsController.off(null, null, this);\n        },\n\n        //------------------------------------------------\n        // Handlers\n        //------------------------------------------------\n\n        handleImageLoad: function (event) {\n            var image = event.target;\n            var wrapper = $(image).parent();\n            ImageUtil.sizeAndCenterImage(image,\n                parseInt(wrapper.width(), 10),\n                parseInt(wrapper.height(), 10),\n                ImageUtil.ImageScaleType.FIT,\n                false);\n        },\n\n        handleMouseEnter: function () {\n            this.$deleteButton.css('visibility', 'visible');\n        },\n\n        handleMouseLeave: function () {\n            this.$deleteButton.css('visibility', 'hidden');\n        },\n\n        handleDeleteButton: function (event) {\n            this.$el.addClass('pending-delete');\n            graphite.serverAPI.deleteDerivedAsset(this.model.get('guid'),\n                this.handleDeleteSuccess,\n                this.handleDeleteError,\n                this);\n            event.stopImmediatePropagation();\n        },\n\n        handleDeleteSuccess: function () {\n            var collection = this.model.collection;\n            collection.remove(this.model);\n        },\n\n        handleDeleteError: function (result) {\n            if (result && result.status === 401) {\n                graphite.events.trigger('reauthenticate');\n            }\n            this.$el.removeClass('pending-delete');\n        },\n\n        remove: function () {\n            if (this.$downloadFrame) {\n                this.$downloadFrame.remove();\n                this.$downloadFrame = null;\n            }\n            this.$deleteButton = null;\n            this.removeEventListeners();\n            return Backbone.View.prototype.remove.call(this);\n        }\n    });\n\n    return InspectDerivedAssetView;\n});\n\n//# sourceURL=/lib/graphite-api/public/js/ccweb.files.extract/views/assets/DerivedAssetView.js"),eval('define(\'text!ccweb.files.extract/views/templates/derivedAssetsListTemplate.html\',[],function () { return \'<div>\\n    <span class=\\\'desc\\\'><%=translate("Extracted Assets") + " - <i>" + translate("Click to download") + "</i>"%></span>\\n    <ul class="derived-assets-list"></ul>\\n</div>\';});\n\n//# sourceURL=/text!ccweb.files.extract/views/templates/derivedAssetsListTemplate.html'),eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4 */\n/*global define: true, graphite: true, window: true*/\n\ndefine('ccweb.files.extract/views/assets/PSDAssetsView',[\n    'jquery',\n    'underscore',\n    'backbone',\n    'ccweb.files.extract/controllers/DerivedAssetController',\n    'ccweb.files.extract/views/assets/DerivedAssetView',\n    'ccweb.files.extract/Constants',\n    'plugin-dependencies',\n    'ccweb.files.extract/utils/TemplateUtil',\n    'text!ccweb.files.extract/views/templates/derivedAssetsListTemplate.html'\n], function ($, _, Backbone, DerivedAssetController, InspectDerivedAssetView,\n       Constants, deps, TemplateUtil, DerivedAssetsListTemplate) {\n    'use strict';\n\n    var PSDAssetsView = Backbone.View.extend({\n        derivedAssetCollection: null,\n\n        initialize: function () {\n            this.assetViews = [];\n            this.render();\n            this.loadDerivedAssets();\n        },\n\n        render: function () {\n            this.setElement(TemplateUtil.createTemplate(DerivedAssetsListTemplate));\n            return this;\n        },\n\n        loadDerivedAssets: function () {\n            var localContent = this.model.get('localContent');\n\n            if (!localContent) {\n                this.derivedAssetCollection = DerivedAssetController.getDerivedAssets(this.model,\n                    this.handleDerivedAssetSuccess, this.handleDerivedAssetError, this);\n                this.derivedAssetCollection.on('add', this.handleDerivedAssetAdd, this);\n                this.derivedAssetCollection.on('remove', this.handleDerivedAssetRemove, this);\n            }\n        },\n\n        //------------------------------------------------\n        // Handlers\n        //------------------------------------------------\n\n        handleDerivedAssetSuccess: function () {\n            var list = this.$el.find('.derived-assets-list'),\n                self = this,\n                asset;\n\n            $.each(this.derivedAssetCollection.models, function (index, value) {\n                asset = new InspectDerivedAssetView({model: value});\n                self.assetViews.push(asset);\n                list.append(asset.el);\n            });\n\n            //notification params\n            var params = {\n                numExtractedAssets: this.assetViews.length,\n                flash: false //flash is false when we are loading the page\n            };\n\n            //update the asset counter\n            graphite.events.trigger('assetExtracted', params);\n        },\n\n        handleDerivedAssetAdd: function (assetModel) {\n            var list = this.$el.find('.derived-assets-list'),\n                asset = new InspectDerivedAssetView({model: assetModel});\n            this.assetViews.push(asset);\n            list.prepend(asset.el);\n\n            //notification params\n            var params = {\n                numExtractedAssets: this.assetViews.length,\n                flash: true //flash is true when adding new asset\n            };\n\n            //update the asset counter on successful addition\n            graphite.events.trigger('assetExtracted', params);\n        },\n\n        handleDerivedAssetRemove: function (assetModel) {\n            var view,\n                i;\n            for (i = 0; i < this.assetViews.length; i++) {\n                view = this.assetViews[i];\n                if (view.model.get('guid') === assetModel.get('guid')) {\n                    view.remove();\n                    this.assetViews.splice(i, 1);\n                    break;\n                }\n            }\n\n            //notification params\n            var params = {};\n            params.numExtractedAssets = this.assetViews.length;\n            params.flash = false; //flash is false when removing an asset\n\n            //update the asset counter on successful deletion\n            graphite.events.trigger('assetExtracted', params);\n        },\n\n        handleDerivedAssetError: function (response) {\n            if (response.status !== 404 && response.status !== 401 && response.status !== 0) {\n                deps.notifyUser(deps.translate('Error retrieving derived assets ({0})', response.status));\n            }\n        },\n\n        //------------------------------------------------\n        // Helpers\n        //------------------------------------------------\n\n        remove: function () {\n            this.assetViews = [];\n            Backbone.View.prototype.remove.call(this);\n        }\n\n    });\n\n    return PSDAssetsView;\n});\n\n//# sourceURL=/lib/graphite-api/public/js/ccweb.files.extract/views/assets/PSDAssetsView.js"),eval('define(\'text!ccweb.files.extract/views/templates/detailPanelTemplate.html\',[],function () { return \'<div class="tabs dark media-container" id="detail-panel">\\n    <button class="topcoat-button upload-button"><%-translate("Upload a PSD")%></button>\\n    <nav role="tablist">\\n        <a id="psdInspectTab" data-toggle="tab" class="active details-tab"><%-translate("Styles")%></a>\\n        <a id="psdLayersTab" data-toggle="tab" class="disabled details-tab"><%-translate("Layers")%></a>\\n        <% if (loggedIn && !graphite.inPublicOneUp()) { %>\\n        <a id="psdAssetsTab" data-toggle="tab" class="disabled details-tab"><%-translate("Assets")%>&nbsp;<span id="assetCounter" style="display:none;"></span></a>\\n        <% } %>\\n    </nav>\\n    <section id="psdInfoSection" role="tab" class="active"></section>\\n    <section id="psdInspectSection" role="tab"></section>\\n    <% if (loggedIn && !graphite.inPublicOneUp()) { %>\\n    <section id="psdAssetsSection" role="tab"></section>\\n    <% } %>\\n</div>\';});\n\n//# sourceURL=/text!ccweb.files.extract/views/templates/detailPanelTemplate.html'),eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013-2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4 */\n/*global define: true, graphite: true, setTimeout: true, window: true*/\n\ndefine('ccweb.files.extract/views/detail/DetailPanelView',[\n    'jquery',\n    'underscore',\n    'backbone',\n    'ccweb.files.extract/Constants',\n    'ccweb.files.extract/views/layers/LayersListView',\n    'ccweb.files.extract/views/inspect/PSDInspectView',\n    'ccweb.files.extract/views/assets/PSDAssetsView',\n    'ccweb.files.extract/controllers/DetailsController',\n    'plugin-dependencies',\n    'ccweb.files.extract/utils/TemplateUtil',\n    'text!ccweb.files.extract/views/templates/detailPanelTemplate.html'\n], function ($, _, Backbone, Constants, LayersListView, PSDInspectView,\n    PSDAssetsView, DetailsController, deps, TemplateUtil, DetailPanelTemplate) {\n    'use strict';\n\n    var DetailPanelView = Backbone.View.extend({\n        layersListView: null,\n        psdInspectView: null,\n        events: {\n            'click .details-tab': 'handleTabClick',\n            'click .upload-button': 'handleUploadPSD'\n        },\n\n        initialize: function () {\n            this.render();\n            DetailsController.on('change:selectedTab', this.handleSelectedTabChange, this);\n            graphite.events.on('drawPreviewFinish', this.handleDrawPreviewFinish, this);\n            graphite.events.on('assetExtracted', this.handleAssetExtracted, this);\n        },\n\n        render: function () {\n            this.setElement(TemplateUtil.createTemplate(DetailPanelTemplate,\n                {\n                    loggedIn: deps.utils.getCurrentPage()\n                }));\n\n            if (this.model !== null) {\n                var $psdInspectSection = this.$el.find('#psdInspectSection'),\n                    $psdInfoSection = this.$el.find('#psdInfoSection'),\n                    $psdAssetsSection = this.$el.find('#psdAssetsSection'),\n                    localContent = this.model.get('localContent');\n\n                this.psdInspectView = new PSDInspectView({model: this.model});\n                this.layersListView = new LayersListView({model: this.model});\n\n                $psdInspectSection.empty();\n                $psdInspectSection.append(this.layersListView.el);\n\n                $psdInfoSection.empty();\n                $psdInfoSection.append(this.psdInspectView.el);\n\n                if (!localContent && !graphite.inPublicOneUp()) {\n                    this.assetsListView = new PSDAssetsView({model: this.model});\n                    $psdAssetsSection.empty();\n                    $psdAssetsSection.append(this.assetsListView.el);\n                }\n\n                this.$el.find('section').scroll(function () {\n                    graphite.events.trigger('hide-extract-asset-popup');\n                    graphite.events.trigger('hide-extract-code-popup');\n                    graphite.events.trigger('hide-color-popup');\n                });\n            }\n\n            return this;\n        },\n\n        handleTabClick: function (event) {\n            DetailsController.setSelectedTab($(event.target).attr('id'));\n        },\n\n        handleUploadPSD: function (event) {\n            graphite.events.trigger('upload-psd-public-one-up');\n            window.location.href = '/files';\n        },\n\n        handleSelectedTabChange: function () {\n            var selectedTab = DetailsController.get('selectedTab'),\n                sections = this.$el.find('section');\n\n            this.$el.find('a').each(function (index) {\n                if ($(this).attr('id') === selectedTab) {\n                    $(this).addClass('active');\n                    $(sections[index]).addClass('active');\n                    $(sections[index]).children().first().trigger('activate');\n                } else {\n                    $(this).removeClass('active');\n                    $(sections[index]).removeClass('active');\n                }\n            });\n\n            if (selectedTab === 'psdAssetsTab') {\n                this.$el.find('#assetCounter').removeClass('new_asset');\n            }\n\n            //trigger selected-tab event\n            graphite.events.trigger('selectedTab', {selectedTab: selectedTab});\n        },\n\n        handleDrawPreviewFinish: function () {\n            this.enableExtraTabs();\n            DetailsController.setSelectedTab('psdInspectTab');\n        },\n\n        enableExtraTabs: function () {\n            this.$el.find('#psdLayersTab').removeClass('disabled');\n            this.$el.find('#psdAssetsTab').removeClass('disabled');\n        },\n\n        handleAssetExtracted: function (params) {\n            var assetsTabIsActive = this.$el.find('#psdAssetsTab').hasClass('active');\n            //find the asset counter and update its value\n            if (params) {\n                if (params.numExtractedAssets > 0) {\n                    this.$el.find('#assetCounter').show();\n                    this.$el.find('#assetCounter').text(params.numExtractedAssets);\n\n                    if (params.flash) {\n                        var self = this;\n                        this.$el.find('#assetCounter').addClass('new_asset');\n                        if (assetsTabIsActive) {\n                            //Only flash the counter for a short time since we're on that tab\n                            setTimeout(function () {\n                                self.$el.find('#assetCounter').removeClass('new_asset');\n                            }, Constants.flashTimeout);\n                        }\n                    }\n                } else {\n                    this.$el.find('#assetCounter').hide();\n                }\n            }\n        },\n\n        removeEventListeners: function () {\n            DetailsController.off(null, null, this);\n            graphite.events.off(null, null, this);\n        },\n\n        destroyViews: function (views) {\n            var self = this;\n            _.each(views, function (view) {\n                if (self.hasOwnProperty(view)) {\n                    self[view].remove();\n                    delete self[view];\n                }\n            });\n        },\n\n        remove: function () {\n            this.removeEventListeners();\n            this.destroyViews(['psdInspectView', 'layersListView', 'assetsListView']);\n            return Backbone.View.prototype.remove.call(this);\n        }\n    });\n\n    return DetailPanelView;\n});\n\n//# sourceURL=/lib/graphite-api/public/js/ccweb.files.extract/views/detail/DetailPanelView.js"),eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013-2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4 */\n/*global define: true, graphite: true, setTimeout: true, window: true*/\n\ndefine('override/views/detail/BracketsDetailPanelView',[\n    'ccweb.files.extract/views/detail/DetailPanelView',\n    'ccweb.files.extract/views/layers/LayersListView',\n    'ccweb.files.extract/views/inspect/PSDInspectView',\n    'ccweb.files.extract/utils/TemplateUtil',\n    'plugin-dependencies',\n    'text!ccweb.files.extract/views/templates/detailPanelTemplate.html'\n], function (DetailPanelView, LayersListView, PSDInspectView, TemplateUtil, deps, DetailPanelTemplate) {\n    'use strict';\n\n    var BracketsDetailPanelView = DetailPanelView.extend({\n\n        render: function () {\n            this.setElement(TemplateUtil.createTemplate(DetailPanelTemplate,\n                {\n                    loggedIn: deps.utils.getCurrentPage()\n                }));\n\n            if (this.model !== null) {\n                var $psdInspectSection = this.$el.find('#psdInspectSection'),\n                    $psdInfoSection = this.$el.find('#psdInfoSection'),\n                    localContent = this.model.get('localContent');\n\n                this.psdInspectView = new PSDInspectView({model: this.model});\n                this.layersListView = new LayersListView({model: this.model});\n\n                $psdInspectSection.empty();\n                $psdInspectSection.append(this.layersListView.el);\n\n                $psdInfoSection.empty();\n                $psdInfoSection.append(this.psdInspectView.el);\n\n                this.$el.find('section').scroll(function () {\n                    graphite.events.trigger('hide-extract-asset-popup');\n                    graphite.events.trigger('hide-extract-code-popup');\n                    graphite.events.trigger('hide-color-popup');\n                });\n            }\n\n            return this;\n        }\n    });\n\n    return BracketsDetailPanelView;\n});\n\n//# sourceURL=/./views/detail/BracketsDetailPanelView.js"),eval('define(\'text!ccweb.files.extract/views/templates/helpDialogTemplate.html\',[],function () { return \'<!-- Help panel -->\\n<div class="keystroke-window-overlay" style="display:none;">\\n    <div class="keystroke-window-wrapper">\\n        <div class="keystroke-header">\\n            <a class="keystroke-info-icon"></a> <span class="keystroke-header-title"><%-translate("Shortcuts")%></span>\\n        </div>\\n\\n        <div class="keystroke-main-col">\\n            <div class="keystroke-item keystroke-separator">\\n                <div class="keystroke-item-keys">\\n                    <a class="keystroke-item-key"><%-ctrl%></a> / <a class="keystroke-item-key"><%-shift%></a> + <a class="keystroke-item-key">Click</a>\\n                </div><span class="keystroke-item-title"><%-translate("Multi-Select")%></span>\\n\\n                <p class="keystroke-item-text"><%-translate("Selects or deselects a layer to add it to or remove it from a group of selected layers.")%></p>\\n            </div>\\n\\n            <div class="keystroke-item keystroke-separator">\\n                <div class="keystroke-item-keys">\\n                    <a class="keystroke-item-key">X</a>\\n                </div><span class="keystroke-item-title"><%-translate("Toggle Measurement Tooltip")%></span>\\n\\n                <p class="keystroke-item-text"><%-translate("Toggles measurement tooltip on hover.")%></p>\\n            </div>\\n\\n            <div class="keystroke-item keystroke-separator">\\n                <div class="keystroke-item-keys"><a class="keystroke-item-key"><%-alt%></a> + <a class="keystroke-item-key">&minus;</a>/<a class="keystroke-item-key">+</a></div><span class="keystroke-item-title"><%-translate("Zoom")%></span>\\n\\n                <p class="keystroke-item-text"><%-translate("Zoom preview canvas in and out.")%></p>\\n            </div>\\n\\n            <div class="keystroke-item keystroke-separator">\\n                <div class="keystroke-item-keys">\\n                    <a class="keystroke-item-key">E</a>\\n                </div><span class="keystroke-item-title"><%-translate("Eyedropper Tool")%></span>\\n\\n                <p class="keystroke-item-text"><%-translate("Allows extraction of pixel-level color values.")%></p>\\n            </div>\\n\\n\\n            <div class="keystroke-item">\\n                <div class="keystroke-item-keys">\\n                    <a class="keystroke-item-key">&larr;</a>\\n                </div><span class="keystroke-item-title"><%-translate("Select Parent Layer")%></span>\\n\\n                <p class="keystroke-item-text"><%=translate("Pressing &larr; will select the layer that is parent to the current layer.")%></p>\\n            </div>\\n\\n            <div class="keystroke-item">\\n                <div class="keystroke-item-keys">\\n                    <a class="keystroke-item-key">&rarr;</a>\\n                </div><span class="keystroke-item-title"><%-translate("Select First Child")%></span>\\n\\n                <p class="keystroke-item-text"><%=translate("Pressing &rarr; will select the first child layer of the current layer. If the currently selected layer has no children, this key does nothing.")%></p>\\n            </div>\\n\\n            <div class="keystroke-item keystroke-separator">\\n                <div class="keystroke-item-keys">\\n                    <a class="keystroke-item-key">&darr;</a><a class=\\n                                                                       "keystroke-item-key">&uarr;</a>\\n                </div><span class="keystroke-item-title"><%-translate("Next/Previous Sibling Layer")%></span>\\n\\n                <p class="keystroke-item-text"><%=translate("Selects the next or previous sibling layer. Pressing &uarr; will select the previous sibling and pressing &darr; will select the next sibling layer.")%></p>\\n            </div>\\n\\n            <div class="keystroke-item">\\n                <div class="keystroke-item-keys">\\n                    <a class="keystroke-item-key">Esc</a>\\n                </div><span class="keystroke-item-title"><%-translate("Clear/Exit")%></span>\\n\\n                <p class="keystroke-item-text"><%=translate("Pressing &ldquo;Esc&rdquo; clears the current selection, exits the current mode, or dismisses a dialog.")%></p>\\n            </div>\\n        </div>\\n    </div>\\n</div>\\n\';});\n\n//# sourceURL=/text!ccweb.files.extract/views/templates/helpDialogTemplate.html'),eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013-2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4 */\n/*global define: true, graphite: true*/\n\ndefine('ccweb.files.extract/views/detail/HelpView',[\n    'jquery',\n    'underscore',\n    'backbone',\n    'ccweb.files.extract/utils/TemplateUtil',\n    'text!ccweb.files.extract/views/templates/helpDialogTemplate.html',\n    'ccweb.files.extract/utils/KeyboardUtils'\n], function ($, _, Backbone, TemplateUtil, HelpDialogTemplate, KeyboardUtils) {\n    'use strict';\n\n    var HelpView = Backbone.View.extend({\n        visible: false,\n\n        events: {\n            'click': 'handleHide'\n        },\n\n        blurTargets: '.psd-preview-view, #detail-panel, .selection-controlbar, .psd-header',\n\n        initialize: function () {\n            _.bindAll(this, 'handleToggle', 'handleHide');\n            this.render();\n\n            graphite.events.on('toggle-help-dialog', this.handleToggle, this);\n            graphite.events.on('hide-help-dialog', this.handleHide, this);\n\n        },\n\n        render: function () {\n            this.setElement(TemplateUtil.createTemplate(HelpDialogTemplate, {\n                ctrl: KeyboardUtils.getMetaKeyName('ctrl'),\n                alt: KeyboardUtils.getMetaKeyName('alt'),\n                shift: KeyboardUtils.getMetaKeyName('shift')\n            }));\n            return this;\n        },\n\n        removeEventListeners: function () {\n            graphite.events.off(null, null, this);\n        },\n\n        remove: function () {\n            this.removeEventListeners();\n            return Backbone.View.prototype.remove.call(this);\n        },\n\n        //------------------------------------------------\n        // Handlers\n        //------------------------------------------------\n        handleToggle: function () {\n            if (this.visible) {\n                this.handleHide();\n            } else {\n                this.handleShow();\n            }\n        },\n\n        handleHide: function () {\n            $(this.blurTargets).removeClass('blur-background');\n\n            this.$el.hide();\n            this.visible = false;\n        },\n\n        handleShow: function () {\n            $(this.blurTargets).addClass('blur-background');\n\n            this.$el.show();\n            this.visible = true;\n            // for metrics fire this event when the help dialog is shown\n            graphite.events.trigger('help-dialog');\n        }\n    });\n\n    return HelpView;\n});\n\n//# sourceURL=/lib/graphite-api/public/js/ccweb.files.extract/views/detail/HelpView.js"),eval('define(\'text!ccweb.files.extract/views/templates/toolbarTemplate.html\',[],function () { return \'<div class="selection-controlbar">\\n    <button class="firstuser-shortcut-guide" title=\\\'<%-translate("First User Experience Guide (i)")%>\\\'><i class="icon-btn"></i></button>\\n    <button class="keyboard-shortcut-guide" title=\\\'<%-translate("Keyboard Shortcuts Guide (?)")%>\\\'><i class="icon-btn"></i></button>\\n</div>\';});\n\n//# sourceURL=/text!ccweb.files.extract/views/templates/toolbarTemplate.html'),eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4, bitwise: true */\n/*global define: true, graphite: true*/\n\ndefine('ccweb.files.extract/collections/LayerCollection',[\n    'backbone',\n    'ccweb.files.extract/models/LayerModel'\n], function (Backbone, LayerModel) {\n    'use strict';\n    var LayerCollection = Backbone.Collection.extend({\n        model: LayerModel,\n        assetID: null,\n        version: null\n    });\n    return LayerCollection;\n});\n\n//# sourceURL=/lib/graphite-api/public/js/ccweb.files.extract/collections/LayerCollection.js"),
eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4, bitwise: true */\n/*global define: true, graphite: true*/\n\ndefine('ccweb.files.extract/models/LayerCompModel',[\n    'underscore',\n    'backbone'\n], function (_, Backbone) {\n    'use strict';\n\n    var LayerCompModel = Backbone.Model.extend({\n\n        initialize: function () {\n            // NOOP\n        }\n\n    });\n\n    return LayerCompModel;\n\n});\n\n//# sourceURL=/lib/graphite-api/public/js/ccweb.files.extract/models/LayerCompModel.js"),eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4, bitwise: true */\n/*global define: true, graphite: true*/\n\ndefine('ccweb.files.extract/models/PSDModel',[\n    'underscore',\n    'backbone',\n    'ccweb.files.extract/collections/LayerCollection',\n    './LayerCompModel',\n    './LayerModelMap',\n    'ccweb.files.extract/utils/UTF8'\n], function (_, Backbone, LayerCollection, LayerCompModel, LayerModelMap, UTF8) {\n    'use strict';\n    var PSDModel = Backbone.Model.extend({\n\n        defaults: {\n            id: '',\n            info: '',\n            imgdata: {\n                originalFile: '',\n                bounds: {\n                    bottom: 0,\n                    left: 0,\n                    right: 0,\n                    top: 0\n                }\n            },\n            layerCollection: null,\n            layerComps: null,\n            layerCompId: null,\n            extractedStyles: null,\n            localContent: false,\n            status: 0,\n            authless: false\n        },\n\n        toString: function () {\n            return '[object PSDModel id: ' + this.get('id') + ', info: ' + this.get('info') + ']';\n        },\n\n        initialize: function (options) {\n            this.id = options.id;\n        },\n\n        decodeChildNames: function (children) {\n            var that = this;\n            if (children) {\n                children.forEach(function (child) {\n                    child.layerName = UTF8.decodeCharacters(child.layerName);\n                    that.decodeChildNames(child.children);\n                });\n            }\n        },\n\n        parse: function (response) {\n            response.imgdata.originalFile = decodeURIComponent(response.imgdata.originalFile);\n            this.decodeChildNames(response.children);\n            this.set('imgdata', response.imgdata);\n            this.set('info', response.info);\n            this.set('width', response.imgdata.bounds.right);\n            this.set('height', response.imgdata.bounds.bottom);\n\n            LayerModelMap.reset();\n            var layerCollection = new LayerCollection();\n            layerCollection.add(layerCollection.parse(response.children), {parse: true});\n            this.set('layerCollection', layerCollection);\n\n            //trigger the numLayer event to track # of layers in psd\n            graphite.events.trigger('num-layers', response.imgdata);\n\n            this.extractStyles();\n\n            var layerComps = this.extractLayerComps(response.layerComps);\n            this.set('layerComps', layerComps);\n            graphite.events.trigger('layerCompsLoaded');\n\n            var layerCompId = this.get('layerCompId');\n            if (layerComps && layerComps.length && !layerCompId) {\n                //Checking !layerCompId ensures that we only fire this once per PSD\n                graphite.events.trigger('layerCompShown');\n            }\n            this.set('status', 200);\n            this.unset('errorInfo');\n        },\n\n        extractStyles: function () {\n            var layers = this.get('layerCollection'),\n                layer,\n                usageModels = {\n                    colors: [],\n                    textStyles: [],\n                    gradients: []\n                },\n                i,\n                newUsageModels;\n\n            for (i = 0; i < layers.length; i++) {\n                layer = layers.at(i);\n                newUsageModels = layer.getUsageModels();\n                layer.combineUsageModels(usageModels, newUsageModels);\n            }\n\n            this.set('extractedStyles', _.clone(usageModels));\n        },\n\n        extractLayerComps: function (comps) {\n            var comp,\n                layerComp,\n                i,\n                result = [];\n\n            for (i = 0; i < comps.length; i++) {\n                comp = comps[i];\n                layerComp = new LayerCompModel({\n                    id: comp.id,\n                    name: UTF8.decodeCharacters(comp.name),\n                    capturedInfo: comp.capturedInfo\n                });\n                result.push(layerComp);\n            }\n            return result;\n        },\n\n        _resetLayerSelection: function (layers) {\n            var self = this;\n            if (layers) {\n                layers.each(function (layer) {\n                    layer.set('selected', false);\n                    layers = layer.get('layerCollection');\n                    self._resetLayerSelection(layers);\n                });\n            }\n        },\n\n        reset: function () {\n            this._resetLayerSelection(this.get('layerCollection'));\n        }\n    });\n\n    return PSDModel;\n});\n\n//# sourceURL=/lib/graphite-api/public/js/ccweb.files.extract/models/PSDModel.js"),eval('/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4 */\n/*global define: true, graphite: true*/\n\ndefine(\'controllers/AssetController\',[\n    "jquery",\n    "underscore",\n    "backbone",\n    "ccweb.files.extract/models/PSDModel",\n    "ccweb.files.extract/Constants"\n], function ($, _, Backbone, PSDModel, Constants) {\n    "use strict";\n    var AssetController = Backbone.Model.extend({\n        getAsset: function (assetId, layerCompId, successCallback, errorCallback, context, path) {\n            var localContent = context ? context.localContent : false,\n                isAuthless = path.match(Constants.RE_SHORT_URL) !== null,\n                psdModel;\n\n            psdModel = new PSDModel({\n                id: assetId,\n                layerCompId: layerCompId,\n                localContent: localContent,\n                path: path,\n                authless: isAuthless\n            });\n\n            if (localContent) {\n                graphite.serverAPI.loadLocalPsdModel(psdModel, context.localContent.directory + \'/graphite.json\', successCallback, errorCallback, context);\n            } else {\n                graphite.serverAPI.loadPsdModelFromPath(psdModel, successCallback, errorCallback, context);\n            }\n\n            return psdModel;\n        }\n\n    });\n\n    return new AssetController();\n});\n//# sourceURL=/lib/graphite-api/public/js/controllers/AssetController.js'),eval('define(\'text!ccweb.files.extract/views/templates/layerCompsTemplate.html\',[],function () { return \'<div id="layerCompDropdown" class="layer-comp-select">\\n    <div class="label" title="<%-layerComps[currentIndex].get(\\\'name\\\')%>"><%-layerComps[currentIndex].get(\\\'name\\\')%></div>\\n    <span class="layerCompIndexLabel"><%-currentIndex + 1%> <%-translate("of")%> <%-layerComps.length%></span>\\n    <% _.each(layerComps, function(layerComp) { %>\\n    <ul class="layerCompDropdownItem">\\n        <li title="<%-layerComp.get(\\\'name\\\')%>"><a id="<%-layerComp.get(\\\'id\\\')%>" href="#"><%-layerComp.get(\\\'name\\\')%></a></li>\\n    </ul>\\n    <% }); %>\\n</div>\\n<div class="header-separator"></div>\';});\n\n//# sourceURL=/text!ccweb.files.extract/views/templates/layerCompsTemplate.html'),eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4 */\n/*global define: true, graphite: true, window: true, document: true*/\n\ndefine('ccweb.files.extract/views/detail/LayerCompView',[\n    'jquery',\n    'underscore',\n    'backbone',\n    'ccweb.files.extract/utils/TemplateUtil',\n    'ccweb.files.extract/controllers/ZoomController',\n    'ccweb.files.extract/controllers/SelectionController',\n    'ccweb.files.extract/controllers/AssetController',\n    'text!ccweb.files.extract/views/templates/layerCompsTemplate.html',\n    'plugin-dependencies'\n], function ($, _, Backbone, TemplateUtil, ZoomController, SelectionController, AssetController, LayerCompsTemplate, deps) {\n    'use strict';\n    var LayerCompView = Backbone.View.extend({\n\n        className: 'layer-comp-controls',\n\n        events: {\n            'click #layerCompDropdown': 'handleActivate',\n            'click a': 'handleSelectOption'\n        },\n\n        initialize: function () {\n            _.bindAll(this, 'handleMouseDown', 'requestLayerComp');\n            graphite.events.on('layerCompsLoaded', this.handleLayerCompsLoaded, this);\n            $(document).off('mousedown.layerComps');\n            $(document).on('mousedown.layerComps', this.handleMouseDown);\n            this.render();\n        },\n\n        render: function () {\n            this.handleLayerCompsLoaded();\n            return this;\n        },\n\n        remove: function () {\n            if (this.$el) {\n                graphite.events.off(null, null, this);\n                this.$el.empty();\n                return Backbone.View.prototype.remove.call(this);\n            }\n        },\n\n        handleLayerCompsLoaded: function () {\n            var psdModel = SelectionController.getPSDModel(),\n                layerComps = SelectionController.getPSDModel().get('layerComps'),\n                appliedComp = psdModel.get('imgdata').appliedLayerCompId || 0,\n                lastDocLabel = deps.translate('Last Document State'),\n                currentLayerComp,\n                currentCompIndex;\n\n            this.$el.empty();\n            if (layerComps && (layerComps.length > 0)) {\n\n                // Append pseudo layer item (Last Document State).\n                if (layerComps[0].get('name') !== lastDocLabel) {\n                    layerComps.unshift(new Backbone.Model({name: lastDocLabel, id: 0}));\n                }\n\n                // Setup template data.\n                currentLayerComp = _.find(layerComps, function (item) {\n                    return item.id === appliedComp;\n                });\n                currentLayerComp = currentLayerComp || layerComps[0];\n                currentCompIndex = layerComps.indexOf(currentLayerComp);\n\n                this.$el.html(TemplateUtil.createTemplate(LayerCompsTemplate,\n                    {layerComps: layerComps, currentIndex: currentCompIndex}));\n                graphite.events.trigger('layerCompChangeComplete');\n            }\n        },\n\n        handleActivate: function (event) {\n            this.$el.find('#layerCompDropdown').toggleClass('active');\n            return false;\n        },\n\n        handleMouseDown: function (event) {\n            var $target = $(event.target);\n            if (!$target.is(this.$el) && this.$el.find($target).length === 0) {\n                $('#layerCompDropdown').removeClass('active');\n            }\n        },\n\n        handleSelectOption: function (event) {\n            var psdModel = SelectionController.getPSDModel(),\n                appliedComp = psdModel.get('imgdata').appliedLayerCompId,\n                $selection = $(event.target),\n                selectedId = parseInt($selection.attr('id'), 10);\n\n            if (selectedId !== appliedComp) {\n                psdModel.get('imgdata').appliedLayerCompId = selectedId;\n                this.handleLayerCompsLoaded();\n                _.defer(this.requestLayerComp, selectedId);\n            }\n\n            $('#layerCompDropdown').removeClass('active');\n            event.stopPropagation();\n            event.preventDefault();\n        },\n\n        requestLayerComp: function (selectedId) {\n            var oldModel = SelectionController.getPSDModel(),\n                psdModel;\n            graphite.events.trigger('layerCompChanging');\n            this.$el.find('#layerCompDropdown').addClass('disabled');\n            psdModel = AssetController.getAsset(oldModel.id, selectedId,\n                function () {\n                    // Notify, while giving animated progress indicator a chance\n                    // to reflect a fully complete status.\n                    _.delay(function () {\n                        graphite.events.trigger('layerCompChanged', psdModel);\n                    }, 500);\n                },\n                function () {}, this, oldModel.get(\"path\"));\n        }\n\n    });\n\n    return LayerCompView;\n});\n\n//# sourceURL=/lib/graphite-api/public/js/ccweb.files.extract/views/detail/LayerCompView.js"),eval('define(\'text!override/views/templates/zoomControlsTemplate.html\',[],function () { return \'<!-- Zoom Controls -->\\n<span class="file-dim"><%= imgdata.bounds.right %> x <%= imgdata.bounds.bottom %></span>\\n<div class="header-separator"></div>\\n<div class="zoom-input topcoat-text-input" title=\\\'<%-translate("ALT +/- to zoom in and out")%>\\\'>100%</div>\\n<div class="zoom-fit-button btn-quiet" title=\\\'<%-translate("Zoom to fit width in view")%>\\\'><%-translate("FIT")%></div>\\n<div class="zoom-100-button btn-quiet" title=\\\'<%-translate("Zoom to 100%")%>\\\'>1:1</div>\\n<div class="header-separator"></div>\';});\n\n//# sourceURL=/text!override/views/templates/zoomControlsTemplate.html'),eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4 */\n/*global define: true, graphite: true, window: true, document: true*/\n\ndefine('override/views/detail/BracketsZoomView',[\n    'jquery',\n    'underscore',\n    'backbone',\n    'ccweb.files.extract/utils/TemplateUtil',\n    'ccweb.files.extract/controllers/ZoomController',\n    'ccweb.files.extract/controllers/SelectionController',\n    'text!ccweb.files.extract/views/templates/zoomControlsTemplate.html'\n], function ($, _, Backbone, TemplateUtil, ZoomController, SelectionController, ZoomControlsTemplate) {\n    'use strict';\n    var BracketsZoomView = Backbone.View.extend({\n\n        className: 'zoom-controls',\n\n        events: {\n            'click .zoom-100-button': 'handleOneToOne',\n            'click .zoom-fit-button': 'handleZoomToFit',\n            'click .zoom-input': 'handleZoomInputClick',\n            'focus .zoom-input': 'handleFocus',\n            'keydown .zoom-input': 'handleInputKey',\n            'keypress .zoom-input': 'handleKeyPress',\n            'blur .zoom-input': 'handleBlur'\n        },\n\n        initialize: function () {\n            _.bindAll(this, 'handleDocumentKey', 'toggleZoomButtonStates');\n            this.render();\n            graphite.events.on('zoomChanged', this.handleZoomChange, this);\n            graphite.events.on('zoomToFit', this.handleZoomToFit, this);\n            graphite.events.on('drawPreviewFinish', this.toggleZoomButtonStates, this);\n            graphite.events.on('psdModelInfoChanged', this.render, this);\n            $(document).on('keydown.zoomview', this.handleDocumentKey);\n            $(window).on('resize.zoomView', _.debounce(this.toggleZoomButtonStates, 300));\n        },\n\n        render: function () {\n            this.$el.html(TemplateUtil.createTemplate(ZoomControlsTemplate, SelectionController.getPSDModel().toJSON()));\n            this.$zoomInput = this.$el.find('.zoom-input');\n            this.setInputLabel();\n            return this;\n        },\n\n        remove: function () {\n            $(document).off('keydown.zoomview', this.handleDocumentKey);\n            $(window).off('.zoomView');\n            graphite.events.off(null, null, this);\n            this.$zoomInput = null;\n            this.$el.empty();\n            return Backbone.View.prototype.remove.call(this);\n        },\n\n        setInputLabel: function () {\n            this.$zoomInput.text(ZoomController.getZoomPercent());\n        },\n\n        handleZoomInputClick: function () {\n            if (!this.editingZoom) {\n                this.startEditing();\n            }\n        },\n\n        handleZoomToFit: function () {\n            var psdModel = SelectionController.getPSDModel(),\n                imageBounds = psdModel.get('imgdata').bounds,\n                $psdPreviewView = $('.psd-preview-view'),\n                viewWidth = $psdPreviewView.outerWidth() - 50,\n                imageWidth = imageBounds.right - imageBounds.left,\n                zoomLevel = viewWidth / imageWidth;\n\n            zoomLevel = zoomLevel > 1.0 || viewWidth <= 0 ? 1.0 : zoomLevel;\n            ZoomController.setZoomLevel(zoomLevel);\n        },\n\n        handleOneToOne: function () {\n            ZoomController.setZoomLevel(1);\n        },\n\n        handleZoomChange: function () {\n            this.setInputLabel();\n            this.toggleZoomButtonStates();\n        },\n\n        toggleZoomButtonStates: function () {\n            var $fitButton = this.$el.find('.zoom-fit-button'),\n                $zoom100Button = this.$el.find('.zoom-100-button'),\n                zoomLevel = ZoomController.getZoomLevel(),\n                psdModel = SelectionController.getPSDModel(),\n                imageBounds = psdModel.get('imgdata').bounds,\n                $psdPreviewView = $('.psd-preview-view'),\n                viewWidth = $psdPreviewView.outerWidth() - 50,\n                imageWidth = imageBounds.right - imageBounds.left,\n                fitZoomLevel = viewWidth / (imageWidth * zoomLevel);\n\n            if ($psdPreviewView.length && $psdPreviewView.outerWidth()) {\n                $fitButton.toggleClass(\"disabled\", fitZoomLevel === zoomLevel || fitZoomLevel >= 1);\n                $zoom100Button.toggleClass(\"disabled\", zoomLevel === 1.0);\n            }\n        },\n\n        handleInputKey: function (event) {\n            var keyCode = event.keyCode;\n            if (this.editingZoom) {\n                if (keyCode === 27) {\n                    this.stopEditing();\n                } else if (keyCode === 9 ||\n                        keyCode === 13 ||\n                        keyCode === 14) {\n                    event.stopImmediatePropagation();\n                    event.preventDefault();\n                    this.commitEdit();\n                }\n            }\n        },\n        \n        handleKeyPress: function (event) {\n            // limit the length of text that can be entered\n            return (this.$zoomInput[0].innerText.length <= 8);\n        },\n\n        handleDocumentKey: function (event) {\n            var keyCode = event.keyCode;\n            if (event.altKey) {\n                if (keyCode === 189 || keyCode === 109 || keyCode === 173) {\n                    event.stopPropagation();\n                    event.preventDefault();\n                    ZoomController.zoomOut();\n                } else if (keyCode === 187 || keyCode === 107 || keyCode === 61) {\n                    event.stopPropagation();\n                    event.preventDefault();\n                    ZoomController.zoomIn();\n                }\n            }\n        },\n\n        handleBlur: function () {\n            this.setInputLabel();\n            this.stopEditing();\n        },\n\n        startEditing: function () {\n            this.revertVal = this.$zoomInput.text();\n            this.$zoomInput.attr(\"contenteditable\", true);\n            this.editingZoom = true;\n            this.$zoomInput[0].ownerDocument.defaultView.getSelection().selectAllChildren(this.$zoomInput[0]);\n            this.$zoomInput.addClass(\"editing\");\n            this.$zoomInput.focus();\n        },\n\n        stopEditing: function () {\n            this.$zoomInput.attr(\"contenteditable\", false);\n            this.editingZoom = false;\n            this.$zoomInput.removeClass(\"editing\");\n        },\n\n        commitEdit: function () {\n            var value = parseFloat(this.$zoomInput.text()) / 100.0,\n                zoom = (!isNaN(value) && value > 0) ? value : ZoomController.getZoomLevel();\n            this.stopEditing();\n            ZoomController.setZoomLevel(zoom);\n        }\n\n    });\n    return BracketsZoomView;\n});\n\n//# sourceURL=/./views/detail/BracketsZoomView.js"),eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013-2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4 */\n/*global define: true, graphite: true, window: true*/\n\ndefine('ccweb.files.extract/views/detail/SelectionBarView',[\n    'jquery',\n    'underscore',\n    'backbone',\n    'ccweb.files.extract/controllers/DetailsController',\n    'ccweb.files.extract/Constants',\n    'plugin-dependencies',\n    'text!ccweb.files.extract/views/templates/toolbarTemplate.html',\n    'ccweb.files.extract/views/inspect/ContextMenuView',\n    'ccweb.files.extract/utils/TemplateUtil',\n    './LayerCompView',\n    './ZoomView'\n], function ($, _, Backbone, DetailsController, Constants, deps, ToolbarTemplate, ContextMenuView, TemplateUtil, LayerCompView, ZoomView) {\n    'use strict';\n\n    var SelectionBarView = Backbone.View.extend({\n        events: {\n            'click .direct-select': 'handleDirectSelectToolChange',\n            'click .firstuser-shortcut-guide': 'handleFirstUserExperienceShortcutGuideClick',\n            'click .show-measurements-on-hover': 'handleMeasurementToggleClick'\n        },\n        initialize: function () {\n            this.bToggleMeasurementKeyDown = false;\n\n            this.render();\n\n            DetailsController.on('change:toggleMeasurementOnHover', this.handleMeasurementToggleChange, this);\n        },\n\n        render: function () {\n            var labels = {\n                regularSelect: deps.translate('Regular Select'),\n                directSelect: deps.translate('Direct Select'),\n                showMeasurementsOnHover: deps.translate('Toggle Show Info on hover')\n            };\n            this.setElement(TemplateUtil.createTemplate(ToolbarTemplate, labels));\n            this.zoomControlsView = new ZoomView();\n            this.$el.append(this.zoomControlsView.$el);\n            this.layerCompControlsView = new LayerCompView();\n            this.$el.append(this.layerCompControlsView.$el);\n            this.createHelpMenu();\n            return this;\n        },\n\n        removeEventListeners: function () {\n            DetailsController.off(null, null, this);\n        },\n\n        handleFirstUserExperienceShortcutGuideClick: function () {\n            graphite.events.trigger('toggle-first-user-overlay');\n        },\n\n        handleDirectSelectToolChange: function () {\n            DetailsController.changeActiveTool(Constants.Tool.SELECT_DIRECT);\n        },\n\n        handleMeasurementToggleClick: function () {\n            if (!this.bToggleMeasurementKeyDown) {\n                this.bToggleMeasurementKeyDown = true;\n                this.$el.find('.show-measurements-on-hover').addClass('active');\n            } else {\n                this.bToggleMeasurementKeyDown = false;\n                this.$el.find('.show-measurements-on-hover').removeClass('active');\n            }\n\n            //send the toggle event\n            graphite.events.trigger('toggle-hover-measurement');\n        },\n\n        handleMeasurementToggleChange: function () {\n            if (!this.bToggleMeasurementKeyDown) {\n                this.bToggleMeasurementKeyDown = true;\n                this.$el.find('.show-measurements-on-hover').addClass('active');\n            } else {\n                this.bToggleMeasurementKeyDown = false;\n                this.$el.find('.show-measurements-on-hover').removeClass('active');\n            }\n        },\n\n        handleActiveToolChange: function () {\n            var newTool = DetailsController.get('activeTool');\n            $(this.el).find('button').removeClass('active');\n\n            switch (newTool) {\n            case Constants.Tool.SELECT_DIRECT:\n                $(this.el).find('.direct-select ').addClass('active');\n                graphite.events.trigger('activeTool', {activeTool: deps.translate('Direct Select')});\n                break;\n            default:\n                console.log('Invalid Tool activated');\n            }\n        },\n\n        remove: function () {\n            this.zoomControlsView.remove();\n            this.zoomControlsView = null;\n            this.layerCompControlsView.remove();\n            this.layerCompControlsView = null;\n            this.removeEventListeners();\n            Backbone.View.prototype.remove.call(this);\n        },\n\n        createHelpMenu: function () {\n            var preprocessorItems = ['Extract Help', 'Extract FAQ', 'Extract Forums', 'Keyboard Shortcuts'].reverse(),\n                preprocessorLabels = {\n                    'Extract Help': deps.translate('Extract Help'),\n                    'Extract FAQ': deps.translate('Extract FAQ'),\n                    'Extract Forums': deps.translate('Extract Forums'),\n                    'Keyboard Shortcuts': deps.translate('Keyboard Shortcuts')\n                },\n                button = this.$('.keyboard-shortcut-guide');\n            this.preprocessorMenu = new ContextMenuView({\n                name : 'help-selector',\n                $toggle : button,\n                $after : button,\n                items : preprocessorItems,\n                position : Constants.MenuPosition.BELOW\n            });\n            this.preprocessorMenu.labels = preprocessorLabels;\n            button.addClass('menu-active');\n\n            this.preprocessorMenu.on('selection', function (menu) {\n                if (menu === 'Keyboard Shortcuts') {\n                    graphite.events.trigger('toggle-help-dialog');\n                } else if (menu === 'Extract Help') {\n                    window.open('http://adobe.com/go/extract_help', '_blank');\n                } else if (menu === 'Extract FAQ') {\n                    window.open('http://adobe.com/go/extract_faq', '_blank');\n                } else if (menu === 'Extract Forums') {\n                    window.open('http://www.adobe.com/go/extract_forums', '_blank');\n                }\n            }, this);\n        }\n\n    });\n\n    return SelectionBarView;\n});\n\n//# sourceURL=/lib/graphite-api/public/js/ccweb.files.extract/views/detail/SelectionBarView.js"),eval("define('text!ccweb.files.extract/views/templates/popupTemplate.html',[],function () { return '<div class=\"popup-contents\"></div>\\n<div class=\"notch\"></div>';});\n\n//# sourceURL=/text!ccweb.files.extract/views/templates/popupTemplate.html"),eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013-2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4 */\n/*global define: true, graphite: true, window: true, document: true*/\n\ndefine('ccweb.files.extract/views/popup/BasePopupView',[\n    'jquery',\n    'underscore',\n    'backbone',\n    'ccweb.files.extract/utils/TemplateUtil',\n    'text!ccweb.files.extract/views/templates/popupTemplate.html'\n], function ($, _, Backbone, TemplateUtil, PopupTemplate) {\n    'use strict';\n    var BasePopupView = Backbone.View.extend({\n        source: null,\n\n        events: {\n            'click .close-button': 'handleCloseClick'\n        },\n\n        initialize: function () {\n            _.bindAll(this,\n                'handleShow',\n                'closePopup');\n            this.source = null;\n            this.render();\n            this.$el.hide();\n            this.addHandlers();\n        },\n\n        render: function () {\n            this.$el.html(TemplateUtil.createTemplate(PopupTemplate));\n            // this.$el.addClass('popup');\n            return this;\n        },\n\n\n        addHandlers: function () {\n        },\n\n\n        //------------------------------------------------\n        // Handlers\n        //------------------------------------------------\n        handleShow: function (params) {\n            if ((this.$el.parent().offset() === undefined) || (params.sourceElement.offset() === undefined)) {\n                return;\n            }\n            this.source = params.sourceElement;\n\n            this.$el.show();\n\n            this.positionPopup();\n\n            this.isMouseOver = false;\n\n            var popup = this,\n                mdHandler = $.proxy(this.handleMouseDown, this),\n                meHandler = $.proxy(this.handleMouseEnter, this),\n                mlHandler = $.proxy(this.handleMouseLeave, this),\n                kuHandler = $.proxy(this.handleKeyUp, this);\n\n            // listeners\n            if (popup.dontListen) {\n                popup.dontListen();\n            }\n            $(window).on('mousedown', mdHandler);\n            popup.$el.on('mouseenter', meHandler);\n            popup.$el.on('mouseleave', mlHandler);\n            $(document).on('keyup', kuHandler);\n            this.dontListen = function () {\n                $(window).off('mousedown', mdHandler);\n                popup.$el.off('mouseenter', meHandler);\n                popup.$el.off('mouseleave', mlHandler);\n                $(document).off('keyup', kuHandler);\n            };\n        },\n\n\n        positionPopup: function () {\n            var $workArea = $('.extract-plugin');\n            if ($workArea.length === 0) {\n                $workArea = $('#main');\n            }\n            var workAreaOffset = $workArea.offset().top + $workArea.outerHeight(true);\n\n            var source = this.source;\n\n            // find y offset\n            var yoffset = this.$el.parent().offset().top;\n            var sourceHeight = source.height() +\n                parseInt(source.css('padding-top'), 10) +\n                parseInt(source.css('padding-bottom'), 10);\n            var popupHeight = parseInt(this.$el.height(), 10) +\n                parseInt(this.$el.css('padding-top'), 10) +\n                parseInt(this.$el.css('padding-bottom'), 10);\n            var notch = this.$el.find('.notch');\n            var $psdHeader = $('.psd-header');\n\n            notch.show();\n            var ny = this.getSourceYOffset() - yoffset + sourceHeight;\n            if (ny + popupHeight + notch.height() > workAreaOffset - yoffset) {\n                ny = source.offset().top - yoffset - this.$el.height() -\n                    (2 * parseInt(this.$el.css('padding-top'), 10));\n\n                this.$el.addClass('top');\n                this.$el.removeClass('bottom');\n            } else {\n                ny += notch.height();\n                this.$el.addClass('bottom');\n                this.$el.removeClass('top');\n            }\n\n            // Constrain to view\n            if ($psdHeader.length && $psdHeader.offset()) {\n                var topmostY = $psdHeader.offset().top + $psdHeader.outerHeight() + 10;\n                if (ny + yoffset < topmostY) {\n                    ny = topmostY;\n                    notch.hide();\n                }\n            }\n\n            this.$el.css('top', ny);\n\n\n            //find x offset\n            var sourceWidth = source.width() +\n                parseInt(source.css('padding-left'), 10) +\n                parseInt(source.css('padding-right'), 10);\n            var popupWidth = parseInt(this.$el.width(), 10) +\n                parseInt(this.$el.css('padding-left'), 10) +\n                parseInt(this.$el.css('padding-right'), 10);\n            var nx = this.getSourceXOffset() + ((sourceWidth - popupWidth) / 2);\n\n            if (nx + popupWidth > $(window).width() - 5) {\n                nx = $(window).width() - popupWidth - 5;\n            }\n\n            this.$el.css('left', nx);\n\n            // center notch to source button\n            var notchx = this.getSourceXOffset() - (nx + parseInt(this.$el.css('border-left-width'), 10)) +\n                parseInt(source.css('margin-left'), 10) + ((sourceWidth - notch.width()) / 2);\n\n            notch.css('left', notchx);\n        },\n\n\n        handleCloseClick: function () {\n            this.closePopup();\n        },\n\n        handleMouseEnter: function () {\n            this.isMouseOver = true;\n        },\n\n        handleMouseLeave: function () {\n            this.isMouseOver = false;\n        },\n\n        handleMouseDown: function () {\n            if (!this.isMouseOver) {\n                this.closePopup();\n            }\n        },\n\n        handleKeyUp: function (event) {\n            if (event.keyCode === 27) { // esc key\n                this.closePopup();\n            }\n        },\n\n        //------------------------------------------------\n        // Helpers\n        //------------------------------------------------\n\n        getSourceXOffset: function () {\n            return this.source.offset() ? this.source.offset().left : 0;\n        },\n\n        getSourceYOffset: function () {\n            return this.source.offset() ? this.source.offset().top : 0;\n        },\n\n        closePopup: function () {\n            if (this.$el.css('display') !== 'none') {\n                this.$el.hide();\n                if (this.dontListen) {\n                    this.dontListen();\n                }\n            }\n        }\n\n    });\n\n    return BasePopupView;\n});\n\n//# sourceURL=/lib/graphite-api/public/js/ccweb.files.extract/views/popup/BasePopupView.js"),
eval('/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013-2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4 */\n/*global define: true, graphite: true, window: true, document: true*/\n\ndefine(\'override/views/popup/BracketsBasePopupView\',[\n    "jquery",\n    "ccweb.files.extract/views/popup/BasePopupView"\n], function ($, BasePopupView) {\n    "use strict";\n    var BracketsBasePopupView = BasePopupView.extend({\n\n        positionPopup: function () {\n            var popupParentOffset = this.$el.parent().offset(),\n                source = this.source;\n\n            // find y offset\n            var yoffset = popupParentOffset.top;\n            var sourceHeight = source.height() +\n                parseInt(source.css("padding-top"), 10) +\n                parseInt(source.css("padding-bottom"), 10);\n            var popupHeight = parseInt(this.$el.height(), 10) +\n                parseInt(this.$el.css("padding-top"), 10) +\n                parseInt(this.$el.css("padding-bottom"), 10);\n            var notch = this.$el.find(".notch");\n\n            var ny = this.getSourceYOffset() - yoffset + sourceHeight;\n            if (ny + popupHeight + notch.height() > $(window).height() - yoffset) {\n                ny = source.offset().top - yoffset - this.$el.height() -\n                    (2 * parseInt(this.$el.css("padding-top"), 10));\n\n                this.$el.addClass("top");\n                this.$el.removeClass("bottom");\n            } else {\n                ny += notch.height();\n                this.$el.addClass("bottom");\n                this.$el.removeClass("top");\n            }\n\n            this.$el.css("top", ny);\n\n\n            //find x offset\n            var sourceOffsetLeft = this.getSourceXOffset() - popupParentOffset.left;\n            var sourceWidth = source.width() +\n                parseInt(source.css("padding-left"), 10) +\n                parseInt(source.css("padding-right"), 10);\n            var popupWidth = parseInt(this.$el.width(), 10) +\n                parseInt(this.$el.css("padding-left"), 10) +\n                parseInt(this.$el.css("padding-right"), 10);\n            var nx = sourceOffsetLeft + ((sourceWidth - popupWidth) / 2);\n\n            if (nx + popupWidth > $(window).width() - 5) {\n                nx = $(window).width() - popupWidth - 5;\n            }\n\n            this.$el.css("left", nx);\n\n            // center notch to source button\n            var notchx = sourceOffsetLeft - (nx + parseInt(this.$el.css("border-left"), 10)) +\n                parseInt(source.css("margin-left"), 10) + ((sourceWidth - notch.width()) / 2);\n\n            notch.css("left", notchx);\n        }\n    });\n\n    return BracketsBasePopupView;\n});\n//# sourceURL=/./views/popup/BracketsBasePopupView.js'),eval('/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4 */\n/*global define: true*/\n\ndefine(\'ccweb.files.extract/utils/LayerNameParser\',[], function () {\n\n    /* jshint ignore:start */\n\n    /*\n     * Generated by PEG.js 0.8.0 from a peg.js grammar\n     * obtained from the Generator team.\n     *\n     * http://pegjs.majda.cz/\n     */\n\n    function peg$subclass(child, parent) {\n        function ctor() { this.constructor = child; }\n        ctor.prototype = parent.prototype;\n        child.prototype = new ctor();\n    }\n\n    function SyntaxError(message, expected, found, offset, line, column) {\n        this.message  = message;\n        this.expected = expected;\n        this.found    = found;\n        this.offset   = offset;\n        this.line     = line;\n        this.column   = column;\n\n        this.name     = "SyntaxError";\n    }\n\n    peg$subclass(SyntaxError, Error);\n\n    function parse(input) {\n        var options = arguments.length > 1 ? arguments[1] : {},\n\n            peg$FAILED = {},\n\n            peg$startRuleFunctions = { start: peg$parsestart },\n            peg$startRuleFunction  = peg$parsestart,\n\n            peg$c0 = { type: "other", description: "List of layer specifications" },\n            peg$c1 = peg$FAILED,\n            peg$c2 = /^[+,]/,\n            peg$c3 = { type: "class", value: "[+,]", description: "[+,]" },\n            peg$c4 = function(first, rest) {\n                rest.unshift(first);\n                return rest;\n            },\n            peg$c5 = function(only) {\n                return [only];\n            },\n            peg$c6 = { type: "other", description: "Layer specification" },\n            peg$c7 = function(layername) { // Unparsed layer name part\n                return {\n                    name: layername.trim()\n                };\n            },\n            peg$c8 = { type: "other", description: "A single folder name that ends with a slash and does not begin with a dot" },\n            peg$c9 = "/",\n            peg$c10 = { type: "literal", value: "/", description: "\\"/\\"" },\n            peg$c11 = function(chars) { return chars[0] == "."; },\n            peg$c12 = void 0,\n            peg$c13 = function(chars) {\n                return chars\n            },\n            peg$c14 = null,\n            peg$c15 = [],\n            peg$c16 = function(size, folders, filepart) { // Parsed layer name part\n                var result = {\n                    name: text().trim(),\n                    file: filepart.filename,\n                    extension: filepart.extension,\n                }\n\n                if (folders.length > 0) {\n                    result.folder = folders.join("/");\n                }\n\n                if (filepart.hasOwnProperty("quality")) {\n                    result.quality = filepart.quality;\n                }\n\n                if (size) {\n                    if (size.hasOwnProperty("scale")) {\n                        result.scale = size.scale;\n                    }\n\n                    if (size.hasOwnProperty("width")) {\n                        result.width = size.width;\n                    }\n\n                    if (size.hasOwnProperty("widthUnit")) {\n                        result.widthUnit = size.widthUnit;\n                    }\n\n                    if (size.hasOwnProperty("height")) {\n                        result.height = size.height;\n                    }\n\n                    if (size.hasOwnProperty("heightUnit")) {\n                        result.heightUnit = size.heightUnit;\n                    }\n                }\n\n                return result;\n            },\n            peg$c17 = { type: "other", description: "Filename and quality suffix" },\n            peg$c18 = function(nameparts, suffix) {\n                var filename = String.prototype.concat.apply("", nameparts) + suffix.extension,\n                    result = {\n                        filename: filename.trim(),\n                        extension: suffix.extension.toLowerCase()\n                    };\n\n                if (suffix.hasOwnProperty("quality")) {\n                    result.quality = suffix.quality;\n                }\n\n                return result;\n            },\n            peg$c19 = { type: "other", description: "File extension and quality suffix" },\n            peg$c20 = /^[a-zA-Z]/,\n            peg$c21 = { type: "class", value: "[a-zA-Z]", description: "[a-zA-Z]" },\n            peg$c22 = "-",\n            peg$c23 = { type: "literal", value: "-", description: "\\"-\\"" },\n            peg$c24 = "%",\n            peg$c25 = { type: "literal", value: "%", description: "\\"%\\"" },\n            peg$c26 = function(extension, quality, pct) {\n                var result = {\n                    extension: extension.join(""),\n                };\n\n                if (quality.length > 0 || pct) {\n                    result.quality = quality.join("") + (pct ? pct : "");\n                }\n\n                return result;\n            },\n            peg$c27 = { type: "other", description: "Relative or absolute scale" },\n            peg$c28 = " ",\n            peg$c29 = { type: "literal", value: " ", description: "\\" \\"" },\n            peg$c30 = function(abs) {\n                return abs;\n            },\n            peg$c31 = function(scale) {\n                return {\n                    scale: scale\n                };\n            },\n            peg$c32 = { type: "other", description: "Absolute scale" },\n            peg$c33 = "x",\n            peg$c34 = { type: "literal", value: "x", description: "\\"x\\"" },\n            peg$c35 = function(width, height) {\n                var result = {};\n\n                if (width.hasOwnProperty("value")) {\n                    result.width = width.value;\n                }\n\n                if (width.hasOwnProperty("unit")) {\n                    result.widthUnit = width.unit;\n                }\n\n                if (height.hasOwnProperty("value")) {\n                    result.height = height.value;\n                }\n\n                if (height.hasOwnProperty("unit")) {\n                    result.heightUnit = height.unit;\n                }\n\n                return result;\n            },\n            peg$c36 = { type: "other", description: "Absolute scale component" },\n            peg$c37 = function(value, unit) {\n                var result = {\n                    value: value,\n                };\n\n                if (unit) {\n                    result.unit = unit;\n                }\n\n                return result;\n            },\n            peg$c38 = "?",\n            peg$c39 = { type: "literal", value: "?", description: "\\"?\\"" },\n            peg$c40 = function() { // wildcard component\n                return {\n                    // no unit\n                };\n            },\n            peg$c41 = { type: "other", description: "Unit abbreviation" },\n            peg$c42 = /^[a-z]/i,\n            peg$c43 = { type: "class", value: "[a-z]i", description: "[a-z]i" },\n            peg$c44 = function(first, second) {\n                return first + second;\n            },\n            peg$c45 = function(num) {\n                return num / 100;\n            },\n            peg$c46 = function(chars) {\n                return chars.join("")\n            },\n            peg$c47 = ".",\n            peg$c48 = { type: "literal", value: ".", description: "\\".\\"" },\n            peg$c49 = { type: "other", description: "A sequence of characters that ends with a dot" },\n            peg$c50 = function(chars) {\n                return chars.concat(".");\n            },\n            peg$c51 = { type: "other", description: "A sequence of characters, including dots" },\n            peg$c52 = function(chars) {\n                return chars.join("");\n            },\n            peg$c53 = { type: "other", description: "A sequence of characters, excluding dots" },\n            peg$c54 = { type: "other", description: "A character, including dots" },\n            peg$c55 = /^[^,+]/,\n            peg$c56 = { type: "class", value: "[^,+]", description: "[^,+]" },\n            peg$c57 = { type: "other", description: "A character, excluding dots and other weird things" },\n            peg$c58 = /^[^+,."\\/*<>?!:|\\\\\\0-\\x1F]/,\n            peg$c59 = { type: "class", value: "[^+,.\\"\\\\/*<>?!:|\\\\\\\\\\\\0-\\\\x1F]", description: "[^+,.\\"\\\\/*<>?!:|\\\\\\\\\\\\0-\\\\x1F]" },\n            peg$c60 = { type: "other", description: "A nonnegative number, which may or may not have leading zeros" },\n            peg$c61 = function(parts) { return parseFloat(parts); },\n            peg$c62 = function(parts) { return parseFloat("0" + parts); },\n            peg$c63 = /^[0-9]/,\n            peg$c64 = { type: "class", value: "[0-9]", description: "[0-9]" },\n            peg$c65 = { type: "other", description: "whitespace" },\n            peg$c66 = /^[ \\t\\n\\r]/,\n            peg$c67 = { type: "class", value: "[ \\\\t\\\\n\\\\r]", description: "[ \\\\t\\\\n\\\\r]" },\n\n            peg$currPos          = 0,\n            peg$reportedPos      = 0,\n            peg$cachedPos        = 0,\n            peg$cachedPosDetails = { line: 1, column: 1, seenCR: false },\n            peg$maxFailPos       = 0,\n            peg$maxFailExpected  = [],\n            peg$silentFails      = 0,\n\n            peg$result;\n\n        if ("startRule" in options) {\n            if (!(options.startRule in peg$startRuleFunctions)) {\n                throw new Error("Can\'t start parsing from rule \\"" + options.startRule + "\\".");\n            }\n\n            peg$startRuleFunction = peg$startRuleFunctions[options.startRule];\n        }\n\n        function text() {\n            return input.substring(peg$reportedPos, peg$currPos);\n        }\n\n        function offset() {\n            return peg$reportedPos;\n        }\n\n        function line() {\n            return peg$computePosDetails(peg$reportedPos).line;\n        }\n\n        function column() {\n            return peg$computePosDetails(peg$reportedPos).column;\n        }\n\n        function expected(description) {\n            throw peg$buildException(\n                null,\n                [{ type: "other", description: description }],\n                peg$reportedPos\n            );\n        }\n\n        function error(message) {\n            throw peg$buildException(message, null, peg$reportedPos);\n        }\n\n        function peg$computePosDetails(pos) {\n            function advance(details, startPos, endPos) {\n                var p, ch;\n\n                for (p = startPos; p < endPos; p++) {\n                    ch = input.charAt(p);\n                    if (ch === "\\n") {\n                        if (!details.seenCR) { details.line++; }\n                        details.column = 1;\n                        details.seenCR = false;\n                    } else if (ch === "\\r" || ch === "\\u2028" || ch === "\\u2029") {\n                        details.line++;\n                        details.column = 1;\n                        details.seenCR = true;\n                    } else {\n                        details.column++;\n                        details.seenCR = false;\n                    }\n                }\n            }\n\n            if (peg$cachedPos !== pos) {\n                if (peg$cachedPos > pos) {\n                    peg$cachedPos = 0;\n                    peg$cachedPosDetails = { line: 1, column: 1, seenCR: false };\n                }\n                advance(peg$cachedPosDetails, peg$cachedPos, pos);\n                peg$cachedPos = pos;\n            }\n\n            return peg$cachedPosDetails;\n        }\n\n        function peg$fail(expected) {\n            if (peg$currPos < peg$maxFailPos) { return; }\n\n            if (peg$currPos > peg$maxFailPos) {\n                peg$maxFailPos = peg$currPos;\n                peg$maxFailExpected = [];\n            }\n\n            peg$maxFailExpected.push(expected);\n        }\n\n        function peg$buildException(message, expected, pos) {\n            function cleanupExpected(expected) {\n                var i = 1;\n\n                expected.sort(function(a, b) {\n                    if (a.description < b.description) {\n                        return -1;\n                    } else if (a.description > b.description) {\n                        return 1;\n                    } else {\n                        return 0;\n                    }\n                });\n\n                while (i < expected.length) {\n                    if (expected[i - 1] === expected[i]) {\n                        expected.splice(i, 1);\n                    } else {\n                        i++;\n                    }\n                }\n            }\n\n            function buildMessage(expected, found) {\n                function stringEscape(s) {\n                    function hex(ch) { return ch.charCodeAt(0).toString(16).toUpperCase(); }\n\n                    return s\n                        .replace(/\\\\/g,   \'\\\\\\\\\')\n                        .replace(/"/g,    \'\\\\"\')\n                        .replace(/\\x08/g, \'\\\\b\')\n                        .replace(/\\t/g,   \'\\\\t\')\n                        .replace(/\\n/g,   \'\\\\n\')\n                        .replace(/\\f/g,   \'\\\\f\')\n                        .replace(/\\r/g,   \'\\\\r\')\n                        .replace(/[\\x00-\\x07\\x0B\\x0E\\x0F]/g, function(ch) { return \'\\\\x0\' + hex(ch); })\n                        .replace(/[\\x10-\\x1F\\x80-\\xFF]/g,    function(ch) { return \'\\\\x\'  + hex(ch); })\n                        .replace(/[\\u0180-\\u0FFF]/g,         function(ch) { return \'\\\\u0\' + hex(ch); })\n                        .replace(/[\\u1080-\\uFFFF]/g,         function(ch) { return \'\\\\u\'  + hex(ch); });\n                }\n\n                var expectedDescs = new Array(expected.length),\n                    expectedDesc, foundDesc, i;\n\n                for (i = 0; i < expected.length; i++) {\n                    expectedDescs[i] = expected[i].description;\n                }\n\n                expectedDesc = expected.length > 1\n                    ? expectedDescs.slice(0, -1).join(", ")\n                    + " or "\n                    + expectedDescs[expected.length - 1]\n                    : expectedDescs[0];\n\n                foundDesc = found ? "\\"" + stringEscape(found) + "\\"" : "end of input";\n\n                return "Expected " + expectedDesc + " but " + foundDesc + " found.";\n            }\n\n            var posDetails = peg$computePosDetails(pos),\n                found      = pos < input.length ? input.charAt(pos) : null;\n\n            if (expected !== null) {\n                cleanupExpected(expected);\n            }\n\n            return new SyntaxError(\n                    message !== null ? message : buildMessage(expected, found),\n                expected,\n                found,\n                pos,\n                posDetails.line,\n                posDetails.column\n            );\n        }\n\n        function peg$parsestart() {\n            var s0;\n\n            s0 = peg$parsespeclist();\n\n            return s0;\n        }\n\n        function peg$parsespeclist() {\n            var s0, s1, s2, s3;\n\n            peg$silentFails++;\n            s0 = peg$currPos;\n            s1 = peg$parsespec();\n            if (s1 !== peg$FAILED) {\n                if (peg$c2.test(input.charAt(peg$currPos))) {\n                    s2 = input.charAt(peg$currPos);\n                    peg$currPos++;\n                } else {\n                    s2 = peg$FAILED;\n                    if (peg$silentFails === 0) { peg$fail(peg$c3); }\n                }\n                if (s2 !== peg$FAILED) {\n                    s3 = peg$parsespeclist();\n                    if (s3 !== peg$FAILED) {\n                        peg$reportedPos = s0;\n                        s1 = peg$c4(s1, s3);\n                        s0 = s1;\n                    } else {\n                        peg$currPos = s0;\n                        s0 = peg$c1;\n                    }\n                } else {\n                    peg$currPos = s0;\n                    s0 = peg$c1;\n                }\n            } else {\n                peg$currPos = s0;\n                s0 = peg$c1;\n            }\n            if (s0 === peg$FAILED) {\n                s0 = peg$currPos;\n                s1 = peg$parsespec();\n                if (s1 !== peg$FAILED) {\n                    peg$reportedPos = s0;\n                    s1 = peg$c5(s1);\n                }\n                s0 = s1;\n            }\n            peg$silentFails--;\n            if (s0 === peg$FAILED) {\n                s1 = peg$FAILED;\n                if (peg$silentFails === 0) { peg$fail(peg$c0); }\n            }\n\n            return s0;\n        }\n\n        function peg$parsespec() {\n            var s0, s1, s2, s3;\n\n            peg$silentFails++;\n            s0 = peg$parsefilespec();\n            if (s0 === peg$FAILED) {\n                s0 = peg$currPos;\n                s1 = peg$parse_();\n                if (s1 !== peg$FAILED) {\n                    s2 = peg$parsechars();\n                    if (s2 !== peg$FAILED) {\n                        s3 = peg$parse_();\n                        if (s3 !== peg$FAILED) {\n                            peg$reportedPos = s0;\n                            s1 = peg$c7(s2);\n                            s0 = s1;\n                        } else {\n                            peg$currPos = s0;\n                            s0 = peg$c1;\n                        }\n                    } else {\n                        peg$currPos = s0;\n                        s0 = peg$c1;\n                    }\n                } else {\n                    peg$currPos = s0;\n                    s0 = peg$c1;\n                }\n            }\n            peg$silentFails--;\n            if (s0 === peg$FAILED) {\n                s1 = peg$FAILED;\n                if (peg$silentFails === 0) { peg$fail(peg$c6); }\n            }\n\n            return s0;\n        }\n\n        function peg$parsefolder() {\n            var s0, s1, s2, s3;\n\n            peg$silentFails++;\n            s0 = peg$currPos;\n            s1 = peg$parsegoodcharsanddots();\n            if (s1 !== peg$FAILED) {\n                if (input.charCodeAt(peg$currPos) === 47) {\n                    s2 = peg$c9;\n                    peg$currPos++;\n                } else {\n                    s2 = peg$FAILED;\n                    if (peg$silentFails === 0) { peg$fail(peg$c10); }\n                }\n                if (s2 !== peg$FAILED) {\n                    peg$reportedPos = peg$currPos;\n                    s3 = peg$c11(s1);\n                    if (s3) {\n                        s3 = peg$c1;\n                    } else {\n                        s3 = peg$c12;\n                    }\n                    if (s3 !== peg$FAILED) {\n                        peg$reportedPos = s0;\n                        s1 = peg$c13(s1);\n                        s0 = s1;\n                    } else {\n                        peg$currPos = s0;\n                        s0 = peg$c1;\n                    }\n                } else {\n                    peg$currPos = s0;\n                    s0 = peg$c1;\n                }\n            } else {\n                peg$currPos = s0;\n                s0 = peg$c1;\n            }\n            peg$silentFails--;\n            if (s0 === peg$FAILED) {\n                s1 = peg$FAILED;\n                if (peg$silentFails === 0) { peg$fail(peg$c8); }\n            }\n\n            return s0;\n        }\n\n        function peg$parsefilespec() {\n            var s0, s1, s2, s3, s4, s5, s6;\n\n            s0 = peg$currPos;\n            s1 = peg$parse_();\n            if (s1 !== peg$FAILED) {\n                s2 = peg$parsescale();\n                if (s2 === peg$FAILED) {\n                    s2 = peg$c14;\n                }\n                if (s2 !== peg$FAILED) {\n                    s3 = peg$parse_();\n                    if (s3 !== peg$FAILED) {\n                        s4 = [];\n                        s5 = peg$parsefolder();\n                        while (s5 !== peg$FAILED) {\n                            s4.push(s5);\n                            s5 = peg$parsefolder();\n                        }\n                        if (s4 !== peg$FAILED) {\n                            s5 = peg$parsefilename();\n                            if (s5 !== peg$FAILED) {\n                                s6 = peg$parse_();\n                                if (s6 !== peg$FAILED) {\n                                    peg$reportedPos = s0;\n                                    s1 = peg$c16(s2, s4, s5);\n                                    s0 = s1;\n                                } else {\n                                    peg$currPos = s0;\n                                    s0 = peg$c1;\n                                }\n                            } else {\n                                peg$currPos = s0;\n                                s0 = peg$c1;\n                            }\n                        } else {\n                            peg$currPos = s0;\n                            s0 = peg$c1;\n                        }\n                    } else {\n                        peg$currPos = s0;\n                        s0 = peg$c1;\n                    }\n                } else {\n                    peg$currPos = s0;\n                    s0 = peg$c1;\n                }\n            } else {\n                peg$currPos = s0;\n                s0 = peg$c1;\n            }\n\n            return s0;\n        }\n\n        function peg$parsefilename() {\n            var s0, s1, s2;\n\n            peg$silentFails++;\n            s0 = peg$currPos;\n            s1 = [];\n            s2 = peg$parsegoodcharsthendot();\n            if (s2 !== peg$FAILED) {\n                while (s2 !== peg$FAILED) {\n                    s1.push(s2);\n                    s2 = peg$parsegoodcharsthendot();\n                }\n            } else {\n                s1 = peg$c1;\n            }\n            if (s1 !== peg$FAILED) {\n                s2 = peg$parsefileext();\n                if (s2 !== peg$FAILED) {\n                    peg$reportedPos = s0;\n                    s1 = peg$c18(s1, s2);\n                    s0 = s1;\n                } else {\n                    peg$currPos = s0;\n                    s0 = peg$c1;\n                }\n            } else {\n                peg$currPos = s0;\n                s0 = peg$c1;\n            }\n            peg$silentFails--;\n            if (s0 === peg$FAILED) {\n                s1 = peg$FAILED;\n                if (peg$silentFails === 0) { peg$fail(peg$c17); }\n            }\n\n            return s0;\n        }\n\n        function peg$parsefileext() {\n            var s0, s1, s2, s3, s4;\n\n            peg$silentFails++;\n            s0 = peg$currPos;\n            s1 = [];\n            if (peg$c20.test(input.charAt(peg$currPos))) {\n                s2 = input.charAt(peg$currPos);\n                peg$currPos++;\n            } else {\n                s2 = peg$FAILED;\n                if (peg$silentFails === 0) { peg$fail(peg$c21); }\n            }\n            if (s2 !== peg$FAILED) {\n                while (s2 !== peg$FAILED) {\n                    s1.push(s2);\n                    if (peg$c20.test(input.charAt(peg$currPos))) {\n                        s2 = input.charAt(peg$currPos);\n                        peg$currPos++;\n                    } else {\n                        s2 = peg$FAILED;\n                        if (peg$silentFails === 0) { peg$fail(peg$c21); }\n                    }\n                }\n            } else {\n                s1 = peg$c1;\n            }\n            if (s1 !== peg$FAILED) {\n                if (input.charCodeAt(peg$currPos) === 45) {\n                    s2 = peg$c22;\n                    peg$currPos++;\n                } else {\n                    s2 = peg$FAILED;\n                    if (peg$silentFails === 0) { peg$fail(peg$c23); }\n                }\n                if (s2 === peg$FAILED) {\n                    s2 = peg$c14;\n                }\n                if (s2 !== peg$FAILED) {\n                    s3 = [];\n                    s4 = peg$parsedigit();\n                    while (s4 !== peg$FAILED) {\n                        s3.push(s4);\n                        s4 = peg$parsedigit();\n                    }\n                    if (s3 !== peg$FAILED) {\n                        if (input.charCodeAt(peg$currPos) === 37) {\n                            s4 = peg$c24;\n                            peg$currPos++;\n                        } else {\n                            s4 = peg$FAILED;\n                            if (peg$silentFails === 0) { peg$fail(peg$c25); }\n                        }\n                        if (s4 === peg$FAILED) {\n                            s4 = peg$c14;\n                        }\n                        if (s4 !== peg$FAILED) {\n                            peg$reportedPos = s0;\n                            s1 = peg$c26(s1, s3, s4);\n                            s0 = s1;\n                        } else {\n                            peg$currPos = s0;\n                            s0 = peg$c1;\n                        }\n                    } else {\n                        peg$currPos = s0;\n                        s0 = peg$c1;\n                    }\n                } else {\n                    peg$currPos = s0;\n                    s0 = peg$c1;\n                }\n            } else {\n                peg$currPos = s0;\n                s0 = peg$c1;\n            }\n            peg$silentFails--;\n            if (s0 === peg$FAILED) {\n                s1 = peg$FAILED;\n                if (peg$silentFails === 0) { peg$fail(peg$c19); }\n            }\n\n            return s0;\n        }\n\n        function peg$parsescale() {\n            var s0, s1, s2;\n\n            peg$silentFails++;\n            s0 = peg$parserelscale();\n            if (s0 === peg$FAILED) {\n                s0 = peg$currPos;\n                s1 = peg$parseabsscale();\n                if (s1 !== peg$FAILED) {\n                    if (input.charCodeAt(peg$currPos) === 32) {\n                        s2 = peg$c28;\n                        peg$currPos++;\n                    } else {\n                        s2 = peg$FAILED;\n                        if (peg$silentFails === 0) { peg$fail(peg$c29); }\n                    }\n                    if (s2 !== peg$FAILED) {\n                        peg$reportedPos = s0;\n                        s1 = peg$c30(s1);\n                        s0 = s1;\n                    } else {\n                        peg$currPos = s0;\n                        s0 = peg$c1;\n                    }\n                } else {\n                    peg$currPos = s0;\n                    s0 = peg$c1;\n                }\n            }\n            peg$silentFails--;\n            if (s0 === peg$FAILED) {\n                s1 = peg$FAILED;\n                if (peg$silentFails === 0) { peg$fail(peg$c27); }\n            }\n\n            return s0;\n        }\n\n        function peg$parserelscale() {\n            var s0, s1;\n\n            s0 = peg$currPos;\n            s1 = peg$parsepercent();\n            if (s1 !== peg$FAILED) {\n                peg$reportedPos = s0;\n                s1 = peg$c31(s1);\n            }\n            s0 = s1;\n\n            return s0;\n        }\n\n        function peg$parseabsscale() {\n            var s0, s1, s2, s3, s4, s5;\n\n            peg$silentFails++;\n            s0 = peg$currPos;\n            s1 = peg$parseabscomp();\n            if (s1 !== peg$FAILED) {\n                s2 = peg$parse_();\n                if (s2 !== peg$FAILED) {\n                    if (input.substr(peg$currPos, 1).toLowerCase() === peg$c33) {\n                        s3 = input.charAt(peg$currPos);\n                        peg$currPos++;\n                    } else {\n                        s3 = peg$FAILED;\n                        if (peg$silentFails === 0) { peg$fail(peg$c34); }\n                    }\n                    if (s3 !== peg$FAILED) {\n                        s4 = peg$parse_();\n                        if (s4 !== peg$FAILED) {\n                            s5 = peg$parseabscomp();\n                            if (s5 !== peg$FAILED) {\n                                peg$reportedPos = s0;\n                                s1 = peg$c35(s1, s5);\n                                s0 = s1;\n                            } else {\n                                peg$currPos = s0;\n                                s0 = peg$c1;\n                            }\n                        } else {\n                            peg$currPos = s0;\n                            s0 = peg$c1;\n                        }\n                    } else {\n                        peg$currPos = s0;\n                        s0 = peg$c1;\n                    }\n                } else {\n                    peg$currPos = s0;\n                    s0 = peg$c1;\n                }\n            } else {\n                peg$currPos = s0;\n                s0 = peg$c1;\n            }\n            peg$silentFails--;\n            if (s0 === peg$FAILED) {\n                s1 = peg$FAILED;\n                if (peg$silentFails === 0) { peg$fail(peg$c32); }\n            }\n\n            return s0;\n        }\n\n        function peg$parseabscomp() {\n            var s0, s1, s2;\n\n            peg$silentFails++;\n            s0 = peg$currPos;\n            s1 = peg$parsenumber();\n            if (s1 !== peg$FAILED) {\n                s2 = peg$parseunit();\n                if (s2 === peg$FAILED) {\n                    s2 = peg$c14;\n                }\n                if (s2 !== peg$FAILED) {\n                    peg$reportedPos = s0;\n                    s1 = peg$c37(s1, s2);\n                    s0 = s1;\n                } else {\n                    peg$currPos = s0;\n                    s0 = peg$c1;\n                }\n            } else {\n                peg$currPos = s0;\n                s0 = peg$c1;\n            }\n            if (s0 === peg$FAILED) {\n                s0 = peg$currPos;\n                if (input.charCodeAt(peg$currPos) === 63) {\n                    s1 = peg$c38;\n                    peg$currPos++;\n                } else {\n                    s1 = peg$FAILED;\n                    if (peg$silentFails === 0) { peg$fail(peg$c39); }\n                }\n                if (s1 !== peg$FAILED) {\n                    peg$reportedPos = s0;\n                    s1 = peg$c40();\n                }\n                s0 = s1;\n            }\n            peg$silentFails--;\n            if (s0 === peg$FAILED) {\n                s1 = peg$FAILED;\n                if (peg$silentFails === 0) { peg$fail(peg$c36); }\n            }\n\n            return s0;\n        }\n\n        function peg$parseunit() {\n            var s0, s1, s2;\n\n            peg$silentFails++;\n            s0 = peg$currPos;\n            if (peg$c42.test(input.charAt(peg$currPos))) {\n                s1 = input.charAt(peg$currPos);\n                peg$currPos++;\n            } else {\n                s1 = peg$FAILED;\n                if (peg$silentFails === 0) { peg$fail(peg$c43); }\n            }\n            if (s1 !== peg$FAILED) {\n                if (peg$c42.test(input.charAt(peg$currPos))) {\n                    s2 = input.charAt(peg$currPos);\n                    peg$currPos++;\n                } else {\n                    s2 = peg$FAILED;\n                    if (peg$silentFails === 0) { peg$fail(peg$c43); }\n                }\n                if (s2 !== peg$FAILED) {\n                    peg$reportedPos = s0;\n                    s1 = peg$c44(s1, s2);\n                    s0 = s1;\n                } else {\n                    peg$currPos = s0;\n                    s0 = peg$c1;\n                }\n            } else {\n                peg$currPos = s0;\n                s0 = peg$c1;\n            }\n            peg$silentFails--;\n            if (s0 === peg$FAILED) {\n                s1 = peg$FAILED;\n                if (peg$silentFails === 0) { peg$fail(peg$c41); }\n            }\n\n            return s0;\n        }\n\n        function peg$parsepercent() {\n            var s0, s1, s2;\n\n            s0 = peg$currPos;\n            s1 = peg$parsenumber();\n            if (s1 !== peg$FAILED) {\n                if (input.charCodeAt(peg$currPos) === 37) {\n                    s2 = peg$c24;\n                    peg$currPos++;\n                } else {\n                    s2 = peg$FAILED;\n                    if (peg$silentFails === 0) { peg$fail(peg$c25); }\n                }\n                if (s2 !== peg$FAILED) {\n                    peg$reportedPos = s0;\n                    s1 = peg$c45(s1);\n                    s0 = s1;\n                } else {\n                    peg$currPos = s0;\n                    s0 = peg$c1;\n                }\n            } else {\n                peg$currPos = s0;\n                s0 = peg$c1;\n            }\n\n            return s0;\n        }\n\n        function peg$parsegoodcharsanddots() {\n            var s0, s1, s2;\n\n            s0 = peg$currPos;\n            s1 = [];\n            s2 = peg$parsegoodcharanddot();\n            if (s2 !== peg$FAILED) {\n                while (s2 !== peg$FAILED) {\n                    s1.push(s2);\n                    s2 = peg$parsegoodcharanddot();\n                }\n            } else {\n                s1 = peg$c1;\n            }\n            if (s1 !== peg$FAILED) {\n                peg$reportedPos = s0;\n                s1 = peg$c46(s1);\n            }\n            s0 = s1;\n\n            return s0;\n        }\n\n        function peg$parsegoodcharanddot() {\n            var s0;\n\n            s0 = peg$parsegoodchar();\n            if (s0 === peg$FAILED) {\n                if (input.charCodeAt(peg$currPos) === 46) {\n                    s0 = peg$c47;\n                    peg$currPos++;\n                } else {\n                    s0 = peg$FAILED;\n                    if (peg$silentFails === 0) { peg$fail(peg$c48); }\n                }\n            }\n\n            return s0;\n        }\n\n        function peg$parsegoodcharsthendot() {\n            var s0, s1, s2;\n\n            peg$silentFails++;\n            s0 = peg$currPos;\n            s1 = peg$parsegoodchars();\n            if (s1 !== peg$FAILED) {\n                if (input.charCodeAt(peg$currPos) === 46) {\n                    s2 = peg$c47;\n                    peg$currPos++;\n                } else {\n                    s2 = peg$FAILED;\n                    if (peg$silentFails === 0) { peg$fail(peg$c48); }\n                }\n                if (s2 !== peg$FAILED) {\n                    peg$reportedPos = s0;\n                    s1 = peg$c50(s1);\n                    s0 = s1;\n                } else {\n                    peg$currPos = s0;\n                    s0 = peg$c1;\n                }\n            } else {\n                peg$currPos = s0;\n                s0 = peg$c1;\n            }\n            peg$silentFails--;\n            if (s0 === peg$FAILED) {\n                s1 = peg$FAILED;\n                if (peg$silentFails === 0) { peg$fail(peg$c49); }\n            }\n\n            return s0;\n        }\n\n        function peg$parsechars() {\n            var s0, s1, s2;\n\n            peg$silentFails++;\n            s0 = peg$currPos;\n            s1 = [];\n            s2 = peg$parsechar();\n            if (s2 !== peg$FAILED) {\n                while (s2 !== peg$FAILED) {\n                    s1.push(s2);\n                    s2 = peg$parsechar();\n                }\n            } else {\n                s1 = peg$c1;\n            }\n            if (s1 !== peg$FAILED) {\n                peg$reportedPos = s0;\n                s1 = peg$c52(s1);\n            }\n            s0 = s1;\n            peg$silentFails--;\n            if (s0 === peg$FAILED) {\n                s1 = peg$FAILED;\n                if (peg$silentFails === 0) { peg$fail(peg$c51); }\n            }\n\n            return s0;\n        }\n\n        function peg$parsegoodchars() {\n            var s0, s1, s2;\n\n            peg$silentFails++;\n            s0 = peg$currPos;\n            s1 = [];\n            s2 = peg$parsegoodchar();\n            if (s2 !== peg$FAILED) {\n                while (s2 !== peg$FAILED) {\n                    s1.push(s2);\n                    s2 = peg$parsegoodchar();\n                }\n            } else {\n                s1 = peg$c1;\n            }\n            if (s1 !== peg$FAILED) {\n                peg$reportedPos = s0;\n                s1 = peg$c52(s1);\n            }\n            s0 = s1;\n            peg$silentFails--;\n            if (s0 === peg$FAILED) {\n                s1 = peg$FAILED;\n                if (peg$silentFails === 0) { peg$fail(peg$c53); }\n            }\n\n            return s0;\n        }\n\n        function peg$parsechar() {\n            var s0, s1;\n\n            peg$silentFails++;\n            if (peg$c55.test(input.charAt(peg$currPos))) {\n                s0 = input.charAt(peg$currPos);\n                peg$currPos++;\n            } else {\n                s0 = peg$FAILED;\n                if (peg$silentFails === 0) { peg$fail(peg$c56); }\n            }\n            peg$silentFails--;\n            if (s0 === peg$FAILED) {\n                s1 = peg$FAILED;\n                if (peg$silentFails === 0) { peg$fail(peg$c54); }\n            }\n\n            return s0;\n        }\n\n        function peg$parsegoodchar() {\n            var s0, s1;\n\n            peg$silentFails++;\n            if (peg$c58.test(input.charAt(peg$currPos))) {\n                s0 = input.charAt(peg$currPos);\n                peg$currPos++;\n            } else {\n                s0 = peg$FAILED;\n                if (peg$silentFails === 0) { peg$fail(peg$c59); }\n            }\n            peg$silentFails--;\n            if (s0 === peg$FAILED) {\n                s1 = peg$FAILED;\n                if (peg$silentFails === 0) { peg$fail(peg$c57); }\n            }\n\n            return s0;\n        }\n\n        function peg$parsenumber() {\n            var s0, s1, s2, s3, s4, s5, s6;\n\n            peg$silentFails++;\n            s0 = peg$currPos;\n            s1 = peg$currPos;\n            s2 = peg$currPos;\n            s3 = peg$parsedigits();\n            if (s3 !== peg$FAILED) {\n                s4 = peg$currPos;\n                if (input.charCodeAt(peg$currPos) === 46) {\n                    s5 = peg$c47;\n                    peg$currPos++;\n                } else {\n                    s5 = peg$FAILED;\n                    if (peg$silentFails === 0) { peg$fail(peg$c48); }\n                }\n                if (s5 !== peg$FAILED) {\n                    s6 = peg$parsedigits();\n                    if (s6 !== peg$FAILED) {\n                        s5 = [s5, s6];\n                        s4 = s5;\n                    } else {\n                        peg$currPos = s4;\n                        s4 = peg$c1;\n                    }\n                } else {\n                    peg$currPos = s4;\n                    s4 = peg$c1;\n                }\n                if (s4 === peg$FAILED) {\n                    s4 = peg$c14;\n                }\n                if (s4 !== peg$FAILED) {\n                    s3 = [s3, s4];\n                    s2 = s3;\n                } else {\n                    peg$currPos = s2;\n                    s2 = peg$c1;\n                }\n            } else {\n                peg$currPos = s2;\n                s2 = peg$c1;\n            }\n            if (s2 !== peg$FAILED) {\n                s2 = input.substring(s1, peg$currPos);\n            }\n            s1 = s2;\n            if (s1 !== peg$FAILED) {\n                peg$reportedPos = s0;\n                s1 = peg$c61(s1);\n            }\n            s0 = s1;\n            if (s0 === peg$FAILED) {\n                s0 = peg$currPos;\n                s1 = peg$currPos;\n                s2 = peg$currPos;\n                if (input.charCodeAt(peg$currPos) === 46) {\n                    s3 = peg$c47;\n                    peg$currPos++;\n                } else {\n                    s3 = peg$FAILED;\n                    if (peg$silentFails === 0) { peg$fail(peg$c48); }\n                }\n                if (s3 !== peg$FAILED) {\n                    s4 = peg$parsedigits();\n                    if (s4 !== peg$FAILED) {\n                        s3 = [s3, s4];\n                        s2 = s3;\n                    } else {\n                        peg$currPos = s2;\n                        s2 = peg$c1;\n                    }\n                } else {\n                    peg$currPos = s2;\n                    s2 = peg$c1;\n                }\n                if (s2 !== peg$FAILED) {\n                    s2 = input.substring(s1, peg$currPos);\n                }\n                s1 = s2;\n                if (s1 !== peg$FAILED) {\n                    peg$reportedPos = s0;\n                    s1 = peg$c62(s1);\n                }\n                s0 = s1;\n            }\n            peg$silentFails--;\n            if (s0 === peg$FAILED) {\n                s1 = peg$FAILED;\n                if (peg$silentFails === 0) { peg$fail(peg$c60); }\n            }\n\n            return s0;\n        }\n\n        function peg$parsedigits() {\n            var s0, s1;\n\n            s0 = [];\n            s1 = peg$parsedigit();\n            if (s1 !== peg$FAILED) {\n                while (s1 !== peg$FAILED) {\n                    s0.push(s1);\n                    s1 = peg$parsedigit();\n                }\n            } else {\n                s0 = peg$c1;\n            }\n\n            return s0;\n        }\n\n        function peg$parsedigit() {\n            var s0;\n\n            if (peg$c63.test(input.charAt(peg$currPos))) {\n                s0 = input.charAt(peg$currPos);\n                peg$currPos++;\n            } else {\n                s0 = peg$FAILED;\n                if (peg$silentFails === 0) { peg$fail(peg$c64); }\n            }\n\n            return s0;\n        }\n\n        function peg$parse_() {\n            var s0, s1;\n\n            peg$silentFails++;\n            s0 = [];\n            s1 = peg$parsewhitespace();\n            while (s1 !== peg$FAILED) {\n                s0.push(s1);\n                s1 = peg$parsewhitespace();\n            }\n            peg$silentFails--;\n            if (s0 === peg$FAILED) {\n                s1 = peg$FAILED;\n                if (peg$silentFails === 0) { peg$fail(peg$c65); }\n            }\n\n            return s0;\n        }\n\n        function peg$parsewhitespace() {\n            var s0;\n\n            if (peg$c66.test(input.charAt(peg$currPos))) {\n                s0 = input.charAt(peg$currPos);\n                peg$currPos++;\n            } else {\n                s0 = peg$FAILED;\n                if (peg$silentFails === 0) { peg$fail(peg$c67); }\n            }\n\n            return s0;\n        }\n\n        peg$result = peg$startRuleFunction();\n\n        if (peg$result !== peg$FAILED && peg$currPos === input.length) {\n            return peg$result;\n        } else {\n            if (peg$result !== peg$FAILED && peg$currPos < input.length) {\n                peg$fail({ type: "end", description: "end of input" });\n            }\n\n            throw peg$buildException(null, peg$maxFailExpected, peg$maxFailPos);\n        }\n    }\n\n    return {\n        SyntaxError: SyntaxError,\n        parse:       parse\n    };\n\n    /* jshint ignore:end */\n\n});\n\n//# sourceURL=/lib/graphite-api/public/js/ccweb.files.extract/utils/LayerNameParser.js'),
eval('define(\'text!ccweb.files.extract/views/templates/extractAssetTemplate.html\',[],function () { return \'<h3 class="title"><%-translate("Save as Image...")%></h3>\\n<span class="close-button"></span>\\n<input type="text" class="topcoat-text-input file-name">\\n<div class="options">\\n    <div>\\n        <input type="radio" name="imagetype" value="png8"/>\\n        <p><%-translate("PNG 8 Alpha")%></p>\\n    </div>\\n    <div>\\n        <input type="radio" name="imagetype" value="png32"/>\\n        <p><%-translate("PNG 32")%></p>\\n    </div>\\n    <div>\\n        <input type="radio" name="imagetype" value="jpeg" checked />\\n        <p><%-translate("JPG")%></p>\\n    </div>\\n    <div>\\n        <input type="radio" name="imagetype" value="svg" />\\n        <p><%-translate("SVG")%></p>\\n    </div>\\n</div>\\n<div class="subtitle"><%-translate("Quality")%></div>\\n<div class="optimize clearfix">\\n    <input type="text" class="topcoat-text-input optimize-percentage" value="80" />\\n    <input type="range" class="topcoat-range optimize-range" value="80" />\\n    <div class="format-description"><%-translate("test")%></div>\\n</div>\\n<div class="scale clearfix <%- settings.get(\\\'scaleExtractedAssets\\\') ? \\\'\\\' : \\\'disabled\\\'%>" title=\\\'<%-translate("Extract asset at specified scale factor")%>\\\'>\\n    <input type="checkbox" class="scale-enable" value="checkbox" <%- settings.get(\\\'scaleExtractedAssets\\\') ? \\\'checked\\\' : \\\'\\\'%> />\\n    <div class="scale-enable-checkbox topcoat-checkbox__checkmark"></div>\\n    <label><%-translate("Scale at")%></label>\\n    <input type="text" class="topcoat-text-input scale-factor" value="<%- parseFloat(settings.get(\\\'assetScaleFactor\\\').toFixed()) %>x" />\\n</div>\\n<div class="popup-footer clearfix">\\n    <button id="downloadBtn" class="topcoat-button--cta"><%-translate("Save")%></button>\\n</div>\\n<div class="notch"></div>\';});\n\n//# sourceURL=/text!ccweb.files.extract/views/templates/extractAssetTemplate.html'),eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013-2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4, regexp: true */\n/*global define: true, graphite: true, window: true*/\n\ndefine('ccweb.files.extract/views/popup/ExtractAssetView',[\n    'jquery',\n    'underscore',\n    'backbone',\n    'plugin-dependencies',\n    'ccweb.files.extract/controllers/DerivedAssetController',\n    'ccweb.files.extract/controllers/SelectionController',\n    'ccweb.files.extract/views/popup/BasePopupView',\n    'ccweb.files.extract/utils/TemplateUtil',\n    'ccweb.files.extract/utils/LayerNameParser',\n    'ccweb.files.extract/models/UserSettingsModel',\n    'text!ccweb.files.extract/views/templates/extractAssetTemplate.html'\n], function ($, _, Backbone, deps, DerivedAssetController, SelectionController,\n    BasePopupView, TemplateUtil, LayerNameParser, UserSettingsModel, ExtractAssetTemplate) {\n    'use strict';\n    var ExtractAssetView = BasePopupView.extend({\n\n        className: 'extract-asset-popup popup',\n\n        selectedLayers: null,\n        qualityRange: null,\n        qualityPercent: null,\n        fileFormat: null,\n        sizeSpan: null,\n        extractSize: null,\n        optimizeLabel: null,\n        optimizeBox: null,\n        formatDescription: null,\n        description: {\n            png8: deps.translate('256 colors. Lowest file size. Alpha transparency to be retained if present in element.'),\n            png32: deps.translate('Lossless format so better quality.'),\n            svg: deps.translate('We use the standard W3C SVG format which is supported by all viewers.')\n        },\n\n        events: {\n            'click #downloadBtn': 'handleExportAsset',\n            'change .scale-enable': 'scaleEnabledChanged',\n            'change .scale-factor': 'scaleFactorChanged'\n        },\n\n        initialize: function () {\n            BasePopupView.prototype.initialize.apply(this, arguments);\n            this.onbeforeunload = this.handleClose;\n        },\n\n        updatePercent: function (value) {\n            this.qualityPercent.val(value);\n            this.updateSizeAndDescription();\n        },\n\n        updateRange: function (value) {\n            this.qualityRange.val(parseInt(value, 10));\n            this.updateSizeAndDescription();\n        },\n\n        updateSizeAndDescription: function () {\n            var fileFormatSelected = this.getFileFormat();\n\n            if (fileFormatSelected === 'jpeg') {\n                this.optimizeLabel.html(deps.translate('Optimize'));\n                this.optimizeBox.removeClass('optimize-description');\n                this.qualityRange.css('display', 'block');\n                this.qualityPercent.css('display', 'block');\n                this.formatDescription.css('display', 'none');\n            } else {\n                this.optimizeLabel.html(deps.translate('Description'));\n                this.optimizeBox.addClass('optimize-description');\n                this.qualityRange.css('display', 'none');\n                this.qualityPercent.css('display', 'none');\n                this.formatDescription.css('display', 'block');\n\n                // Update the description\n                this.formatDescription.html(this.description[fileFormatSelected]);\n            }\n        },\n\n        render: function () {\n            BasePopupView.prototype.render.apply(this, arguments);\n\n            this.$el.find('.popup-contents').html(TemplateUtil.createTemplate(ExtractAssetTemplate, {settings: UserSettingsModel}));\n\n            this.qualityRange = this.$el.find('.optimize-range');\n            this.qualityPercent = this.$el.find('.optimize-percentage');\n            this.fileFormat = this.$el.find('.options');\n            this.sizeSpan = this.$el.find('#extract-size-value');\n            this.extractSize = this.$el.find('.extract-size');\n            this.optimizeLabel = this.$el.find('.subtitle');\n            this.optimizeBox = this.$el.find('.optimize');\n            this.formatDescription = this.$el.find('.format-description');\n            this.scale = this.$el.find('.scale');\n            this.scaleEnabled = this.$el.find('.scale-enable');\n            this.scaleFactor = this.$el.find('.scale-factor');\n\n            // Only enable if feature is enabled for now.\n            this.scale.toggle(true);\n\n            return this;\n        },\n\n        addHandlers: function () {\n            var self = this;\n            BasePopupView.prototype.addHandlers.apply(this, arguments);\n\n            graphite.events.on('show-extract-asset-popup', this.handleShow, this);\n            graphite.events.on('hide-extract-asset-popup', this.closePopup, this);\n\n            this.$el.mousedown(function (event) {\n                event.stopPropagation();\n            });\n\n            this.fileFormat.change(function () {\n                self.updateSizeAndDescription();\n            });\n\n            this.qualityRange.change(function () {\n                self.updatePercent(this.value);\n            });\n\n            this.qualityPercent.change(function () {\n                self.updateRange(this.value);\n            });\n\n            this.qualityPercent.keyup(function () {\n                self.updateRange(this.value);\n            });\n\n            //swallow key up events\n            this.$el.find('input.file-name').keyup(function (event) {\n                self.handleKeyUp(event);\n                event.stopImmediatePropagation();\n            });\n\n            this.$el.find('input.file-name').keypress(function (event) {\n                if (event.which === 13) {\n                    self.handleExportAsset();\n                }\n            });\n        },\n\n        removeEventListeners: function () {\n            graphite.events.off(null, null, this);\n        },\n\n        //------------------------------------------------\n        // Handlers\n        //------------------------------------------------\n        handleShow: function () {\n            // If we're not logged in, don't allow extraction of multiple layers at once\n            // Using deps.user() for now, assuming that will be the gate for multi extraction\n            var selectedLayers = deps.utils.getCurrentPage() ? SelectionController.getSelectedLayers() :\n                    SelectionController.getSelectedLayers().slice(0, 1);\n\n            this.selectedVisibleLayers = SelectionController.expandSelection(selectedLayers);\n\n            var layerModel = selectedLayers[0];\n            if (layerModel && this.selectedVisibleLayers.length) {\n                this.deriveAssetDetails(layerModel);\n\n                if (this.selectedVisibleLayers.length === 1) {\n                    this.$el.find('.title').html(deps.translate('Save as Image...'));\n                } else {\n                    this.$el.find('.title').html(deps.translate('Save {0} Layers as Image...', this.selectedVisibleLayers.length));\n                }\n\n                this.updateSizeAndDescription();\n                BasePopupView.prototype.handleShow.apply(this, arguments);\n            }\n        },\n\n        closePopup: function () {\n            // Reset scale UI since our generator derived name might have\n            // overridden the user provided scale.\n            var scaleEnabled = UserSettingsModel.get('scaleExtractedAssets');\n            this.scaleEnabled.prop('checked', scaleEnabled);\n            this.scaleFactor.val(UserSettingsModel.get('assetScaleFactor') + 'x');\n            this.scale.toggleClass('disabled', !scaleEnabled);\n\n            BasePopupView.prototype.closePopup.call(this);\n        },\n\n        handleExportAsset: function () {\n            //default image quality\n            var imageQuality = -1,\n                scaleFactor = this.scaleEnabled.prop('checked') && !this.scale.hasClass('incompatible') ?\n                        parseFloat(this.scaleFactor.val()) : null,\n                fileName;\n\n            var fileFormatSelected = this.getFileFormat();\n            if (fileFormatSelected === 'jpeg') {\n                //image quality slider for jpeg format\n                imageQuality = this.qualityPercent.val();\n            }\n\n            fileName = this.normalizeFileName(this.$el.find('.file-name').val());\n\n            DerivedAssetController.exportAsset(\n                this.selectedVisibleLayers,\n                fileName,\n                this.getFileFormat(),\n                imageQuality,\n                scaleFactor,\n                this.model,\n                this.handleExportAssetComplete,\n                this.handleExportAssetError,\n                this\n            );\n\n            graphite.events.trigger('extract-asset-download-init', {fileFormatSelected: fileFormatSelected});\n\n            if (scaleFactor && scaleFactor !== 1) {\n                graphite.events.trigger('asset-extracted-scaled', {scaleFactor: scaleFactor});\n            }\n\n            this.closePopup();\n        },\n\n        //------------------------------------------------\n        // Handlers\n        //------------------------------------------------\n        handleExportAssetComplete: function () {\n        },\n\n        handleExportAssetError: function (result) {\n            if (result.status === 401) {\n                graphite.events.trigger('reauthenticate');\n            } else if (result.status === 507) {\n                deps.notifyUser(deps.translate('Error extracting asset. You\\'ve possibly exceeded your storage limit.'));\n            } else {\n                deps.notifyUser(deps.translate('Error extracting asset.'));\n            }\n        },\n\n        scaleEnabledChanged: function () {\n            var enabled = this.scaleEnabled.prop('checked');\n            this.scale.toggleClass('disabled', !enabled);\n            UserSettingsModel.set('scaleExtractedAssets', enabled);\n        },\n\n        scaleFactorChanged: function () {\n            var factor = parseFloat(this.scaleFactor.val()),\n                newFactor = UserSettingsModel.get('assetScaleFactor');\n            if (!isNaN(factor) && factor >= 0.1 && factor <= 5) {\n                newFactor = parseFloat(factor.toFixed(1));\n            } else if (!isNaN(factor) && factor > 5) {\n                newFactor = 5;\n            } else if (!isNaN(factor) && factor < 0.1) {\n                newFactor = 0.1;\n            }\n            UserSettingsModel.set('assetScaleFactor', newFactor);\n            this.scaleFactor.val(newFactor + 'x');\n        },\n\n        //------------------------------------------------\n        // Helpers\n        //------------------------------------------------\n\n        getFileFormat: function () {\n            return this.fileFormat.find('input[name=imagetype]:checked').val();\n        },\n\n        setFileFormat: function (value) {\n            this.fileFormat.find('input[value=' + value + ']').prop('checked', true);\n        },\n\n        remove: function () {\n            this.removeEventListeners();\n            BasePopupView.prototype.remove.call(this);\n        },\n\n        /**\n         * Sanitize the extracted file name. For now we nix any invalid\n         * characters and remove the extension (as one will already be\n         * applied during extraction matching the appropriate format).\n         * @param name\n         */\n        normalizeFileName: function (name) {\n            name = name.substr(0, name.lastIndexOf('.')) || name;\n            name = name.replace(/(\\/|\\\\|:|\\*|\\?|\"|<|>|\\||\\,|^\\.\\.\\.)/g, '_');\n            return name;\n        },\n\n        /**\n         * Leverages the generator parser to infer extracted asset details\n         * such as file name, encoding, optimization, etc. As we move forward,\n         * Extract will be able to honor more and more of these hints.\n         */\n        deriveAssetDetails: function (layerModel) {\n            var fileName = layerModel.get('layerName'),\n                format = 'jpeg',\n                extractInfo,\n                assetDetails,\n                quality,\n                multiplier,\n                scale,\n                extension;\n\n            // Remove leading chars\n            fileName = fileName.replace(/^(\\/|\\\\|\\.)+/, '');\n\n            try {\n                extractInfo = LayerNameParser.parse(fileName);\n                if (extractInfo && extractInfo.length > 0) {\n                    assetDetails = extractInfo[0];\n                    fileName = assetDetails.file || fileName;\n                    quality = assetDetails.quality;\n                    scale = assetDetails.scale;\n                    extension = assetDetails.extension || 'jpg';\n\n                    switch (extension.toLowerCase()) {\n                    case 'jpg':\n                    case 'jpeg':\n                    case 'gif':\n                        multiplier = quality && quality.indexOf('%') !== -1 ? 1 : 10;\n                        quality = quality ? parseInt(quality, 10) * multiplier : 80;\n                        this.updatePercent(quality);\n                        this.updateRange(quality);\n                        break;\n                    case 'png':\n                        format = quality === '8' ? 'png8' : 'png32';\n                        break;\n                    case 'svg':\n                        format = 'svg';\n                        break;\n                    }\n                }\n            } catch (e) {}\n\n            if (scale && scale >= 0.1 && scale <= 5) {\n                this.scaleEnabled.prop('checked', true);\n                this.scale.toggleClass('disabled', false);\n                this.scaleFactor.val(parseFloat(scale.toFixed(1)) + 'x');\n            }\n\n            this.setFileFormat(format);\n            fileName = this.normalizeFileName(fileName);\n            this.$el.find('.file-name').val(fileName);\n        }\n    });\n\n    return ExtractAssetView;\n});\n\n//# sourceURL=/lib/graphite-api/public/js/ccweb.files.extract/views/popup/ExtractAssetView.js"),eval('define(\'text!ccweb.files.extract/views/templates/extractCodeTemplate.html\',[],function () { return \'<h3 class="title"><%-translate("Styles")%></h3>\\n<span class="close-button"></span>\\n<textarea class="topcoat-textarea" readonly><%-translate("Useful CSS here")%></textarea>\\n<p class="all-code"></p>\\n<button class="action-button"></button>\\n<div class="notch"></div>\';});\n\n//# sourceURL=/text!ccweb.files.extract/views/templates/extractCodeTemplate.html'),eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013-2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4 */\n/*global define: true, graphite: true*/\n\ndefine('ccweb.files.extract/views/popup/ExtractCodeView',[\n    'jquery',\n    'underscore',\n    'backbone',\n    'ccweb.files.extract/controllers/ClipboardController',\n    'ccweb.files.extract/models/TextStyleUsageModel',\n    'ccweb.files.extract/models/UserSettingsModel',\n    'ccweb.files.extract/models/GradientUsageModel',\n    'ccweb.files.extract/views/popup/BasePopupView',\n    'ccweb.files.extract/utils/CSSUtil',\n    'ccweb.files.extract/utils/TemplateUtil',\n    'text!ccweb.files.extract/views/templates/extractCodeTemplate.html',\n    'plugin-dependencies'\n], function ($, _, Backbone, ClipboardController, TextStyleUsageModel,\n             UserSettingsModel, GradientUsageModel, BasePopupView, CSSUtil, TemplateUtil,\n             ExtractCodeTemplate, deps) {\n    'use strict';\n\n    var ExtractCodeView = BasePopupView.extend({\n\n        className: 'extract-code-popup popup',\n\n        copyString: deps.translate('Copy'),\n        copiedString: deps.translate('Copied'),\n        viewMoreString: deps.translate('View more'),\n        viewLessString: deps.translate('View less'),\n\n        events: {\n            'click .all-code': 'handleViewMoreClick',\n            'click .action-button': 'handleSelectClick',\n            'dblclick .topcoat-textarea': 'handleDoubleClickEvent'\n        },\n\n        initialize: function () {\n            BasePopupView.prototype.initialize.apply(this, arguments);\n\n            this.initCopyToClipboard();\n\n            // events\n            graphite.events.on('show-extract-code-popup', this.handleShow, this);\n            graphite.events.on('hide-extract-code-popup', this.closePopup, this);\n        },\n\n        render: function () {\n            BasePopupView.prototype.render.apply(this, arguments);\n\n            this.$el.find('.popup-contents').html(TemplateUtil.createTemplate(ExtractCodeTemplate));\n\n            this.$actionButton = this.$el.find('.action-button');\n            this.$actionButton.html(this.copyString);\n            return this;\n        },\n\n        initCopyToClipboard: function () {\n            ClipboardController.getClipboard().clip(this.$actionButton);\n            graphite.events.on('clipboard-loaded', this.handleClipboardLoaded, this);\n            graphite.events.on('clipboard-data-requested', this.handleClipboardDataRequest, this);\n            graphite.events.on('clipboard-complete', this.handleClipboardComplete, this);\n            graphite.events.on('clipboard-mouseover', this.handleClipboardMouseOver, this);\n        },\n\n        //------------------------------------------------\n        // Handlers\n        //------------------------------------------------\n\n        handleClipboardLoaded: function () {\n            this.$actionButton.addClass('clipboard-enabled');\n        },\n\n        handleClipboardDataRequest: function (elem) {\n            var clip = ClipboardController.getClipboard();\n            if (elem === this.$actionButton[0]) {\n                clip.setText(this.$el.find('textarea').text());\n                graphite.events.trigger('copy-css', {origin: 'StylesPopup'});\n            }\n        },\n\n        handleClipboardComplete: function () {\n            var view = this;\n            view.$actionButton.html(view.copiedString);\n            view.timeout && clearTimeout(view.timeout);\n            view.timeout = setTimeout(function () {\n                view.$actionButton.html(view.copyString);\n            }, 1500);\n        },\n\n        handleClipboardMouseOver: function () {\n            this.isMouseOver = true;\n        },\n\n        handleShow: function (params) {\n            this.reset();\n            BasePopupView.prototype.handleShow.apply(this, arguments);\n\n            this.setCSS(params.model, params.ppi);\n        },\n\n        handleSelectClick: function () {\n            this.$el.find('textarea').select();\n        },\n\n        handleDoubleClickEvent: function () {\n            graphite.events.trigger('cssDoublClick');\n        },\n\n        handleViewMoreClick: function () {\n            var textArea = this.$el.find('textarea'),\n                allCode = this.$el.find('.all-code');\n\n            if (this.$el.hasClass('expanded')) {\n                this.reset(true);\n            } else {\n                this.$el.addClass('expanded');\n                allCode.html(this.viewLessString);\n                textArea.height(textArea[0].scrollHeight - parseInt(textArea.css('padding-top'), 10) - parseInt(textArea.css('padding-bottom'), 10));\n            }\n\n            this.positionPopup();\n        },\n\n\n        //------------------------------------------------\n        // Helpers\n        //------------------------------------------------\n        setCSS: function (model, ppi) {\n            var textArea = this.$el.find('textarea'),\n                preProcessor = UserSettingsModel.get('preprocessor'),\n                cssProperties = model.get('style').getCSS(preProcessor === 'css', ppi),\n                cssStringArray = [],\n                cssString;\n\n            if (model instanceof TextStyleUsageModel ||\n                    model instanceof GradientUsageModel) {\n                _.each(cssProperties, function (property) {\n                    cssString = CSSUtil.formatCSSString(property.property, property.value, preProcessor);\n                    // Sometimes getCSSString can return a null string if it's a prefixed value.\n                    if (cssString) {\n                        cssStringArray.push(cssString);\n                    }\n                });\n                textArea.text(cssStringArray.join('\\n'));\n            } else {\n                // empty for now\n                textArea.text('Useful CSS here');\n            }\n\n            this.updateViewMoreButton();\n        },\n\n\n        updateViewMoreButton: function () {\n            var viewMoreButton, textArea;\n            viewMoreButton = this.$el.find('.all-code');\n            textArea = this.$el.find('textarea');\n\n            if (textArea[0].scrollHeight - parseInt(textArea.css('padding-top'), 10) - parseInt(textArea.css('padding-bottom'), 10) >\n                    parseInt(textArea.height(), 10)) {\n                viewMoreButton.html(this.viewMoreString);\n                viewMoreButton.show();\n            } else {\n                viewMoreButton.hide();\n            }\n        },\n\n        reset: function (preserveCopied) {\n            this.$el.removeClass('expanded');\n            this.$el.find('.all-code').html(this.viewMoreString);\n\n            if (!preserveCopied) {\n                this.$el.find('.action-button').html(this.copyString);\n            }\n            this.$el.find('textarea').height('60px');\n        },\n\n        removeEventListeners: function () {\n            graphite.events.off(null, null, this);\n        },\n\n        remove: function () {\n            this.removeEventListeners();\n            return Backbone.View.prototype.remove.call(this);\n        }\n\n    });\n\n    return ExtractCodeView;\n});\n\n//# sourceURL=/lib/graphite-api/public/js/ccweb.files.extract/views/popup/ExtractCodeView.js"),eval('define(\'text!ccweb.files.extract/views/templates/colorChipPopupTemplate.html\',[],function () { return \'<div class="dropdown">\\n    <div class="dropdown-btn color-format">\\n        <%-colorFormat%>\\n    </div>\\n</div>\\n<textarea class="topcoat-textarea" readonly>rgba(100,100,100)</textarea>\';});\n\n//# sourceURL=/text!ccweb.files.extract/views/templates/colorChipPopupTemplate.html'),eval('define(\'text!ccweb.files.extract/views/templates/alphaListPopupTemplate.html\',[],function () { return \'<div class="alpha-list">\\n    <p class="opacities-label">Opacity:</p>\\n    <ul>\\n        <% _.each(alphas, function(alpha){ %>\\n        <li class="color-alpha"><p><%-alpha%></p></li>\\n        <% }); %>\\n    </ul>\\n</div>\\n\';});\n\n//# sourceURL=/text!ccweb.files.extract/views/templates/alphaListPopupTemplate.html'),eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013-2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4 */\n/*global define: true, graphite: true*/\n\ndefine('ccweb.files.extract/views/popup/ColorChipPopupView',[\n    'jquery',\n    'underscore',\n    'backbone',\n    './BasePopupView',\n    'ccweb.files.extract/controllers/SelectionController',\n    'ccweb.files.extract/models/ColorUsageModel',\n    'ccweb.files.extract/utils/StyleUtil',\n    'ccweb.files.extract/utils/TemplateUtil',\n    'ccweb.files.extract/views/inspect/ContextMenuView',\n    'text!ccweb.files.extract/views/templates/colorChipPopupTemplate.html',\n    'text!ccweb.files.extract/views/templates/alphaListPopupTemplate.html',\n    'ccweb.files.extract/Constants'\n], function ($, _, Backbone, BasePopupView, SelectionController, ColorUsageModel,\n    StyleUtil, TemplateUtil, ContextMenuView, ColorChipPopupTemplate, AlphaListPopupTemplate, Constants) {\n    'use strict';\n\n    var ColorChipPopupView = BasePopupView.extend({\n\n        className: 'color-chip-popup popup',\n\n        colorUsage: null,\n        currentAlpha: 1,\n        handleShowColorProxied: null,\n        handleHideColorProxied: null,\n        colorFormat: 'RGB',\n\n        initialize: function () {\n            BasePopupView.prototype.initialize.apply(this, arguments);\n            this.addHandlers();\n        },\n\n        addHandlers: function () {\n            graphite.events.on('show-color-popup', this.handleShowColor, this);\n            graphite.events.on('hide-color-popup', this.handleHideColor, this);\n        },\n\n        removeEventListeners: function () {\n            graphite.events.off(null, null, this);\n        },\n\n        render: function () {\n            BasePopupView.prototype.render.apply(this, arguments);\n\n            this.$el.find('.popup-contents').html(TemplateUtil.createTemplate(ColorChipPopupTemplate, {colorFormat: Constants.ColorFormat[this.colorFormat]}));\n\n            this.createColorFormatMenu();\n            return this;\n        },\n        \n        createColorFormatMenu: function () {\n            var colorFormatItems = [],\n                colorFormatLabels = {};\n\n            _.each(Constants.ColorFormat, function (details, key) {\n                    colorFormatLabels[key] = details;\n                    colorFormatItems.unshift(key);\n                });\n            \n            this.colorFormatMenu = new ContextMenuView({\n                name : 'colorFormat-selector',\n                $toggle : this.$('div.color-format'),\n                $after : this.$('div.color-format'),\n                items : colorFormatItems,\n                position : Constants.MenuPosition.TOP\n            });\n            this.colorFormatMenu.labels = colorFormatLabels;\n            this.$('.color-format').addClass('menu-active');\n            this.colorFormatMenu.on('show', this.handleColorFormatMenuShow, this);\n            this.colorFormatMenu.on('selection', this.handleColorFormatSelectionChange, this);\n        },\n        \n        handleColorFormatMenuShow: function ($menu) {\n            this.colorFormatMenu.checkItem(this.colorFormat);\n        },\n\n        handleColorFormatSelectionChange: function (colorFormat) {\n            if (colorFormat !== this.colorFormat) {\n                var formatStr = Constants.ColorFormat[colorFormat];\n                this.handleColorFormatChange(formatStr);\n                this.$('.color-format').text(formatStr);\n                this.colorFormat = colorFormat;\n            }\n        },\n\n        //------------------------------------------------\n        // Handlers\n        //------------------------------------------------\n\n        handleShowColor: function (params) {\n            if (!this.colorUsage ||\n                    !this.$el.is(':visible') ||\n                    !StyleUtil.areUsageStylesEqual(params.style, this.colorUsage)) {\n                this.colorUsage = params.style;\n                this.currentAlpha = null;\n                this.handleShow({sourceElement: params.sourceElement});\n                this.updateColorString(Constants.ColorFormat[this.colorFormat]);\n                this.initAlphaList();\n            }\n        },\n\n\n        handleHideColor: function (hideColor) {\n            if (this.colorUsage &&\n                    (!hideColor || StyleUtil.areUsageStylesEqual(hideColor, this.colorUsage))) {\n                this.closePopup();\n            }\n        },\n\n\n        handleColorFormatChange: function (newColorFormat) {\n            this.updateColorString(newColorFormat);\n            graphite.events.trigger('color-format', {format: newColorFormat});\n        },\n\n\n        //------------------------------------------------\n        // Helpers\n        //------------------------------------------------\n        initAlphaList: function () {\n            var self = this;\n            this.$el.find('.alpha-list').remove();\n\n            // only show alphas if we have more alpha values than 1.0\n            var showAlphas = false,\n                alphas = this.colorUsage.get('alphas'),\n                colorAlphas;\n            $.each(alphas, function (index, alpha) {\n                if (alpha !== 1) {\n                    showAlphas = true;\n                }\n            });\n\n            if (showAlphas) {\n                this.$el.append(TemplateUtil.createTemplate(AlphaListPopupTemplate, {alphas: alphas}));\n                colorAlphas = this.$el.find('.color-alpha');\n                colorAlphas.each(function (index) {\n                    $(this).data('alpha', alphas[index]);\n                    if (alphas[index] === self.currentAlpha) {\n                        $(this).addClass('selected');\n                    }\n                });\n\n                colorAlphas.mouseenter(function () {\n                    graphite.events.trigger('show-alpha-usage',\n                        {alpha: $(this).data('alpha')});\n\n                });\n\n                this.$el.find('.alpha-list ul').mouseleave(function () {\n                    graphite.events.trigger('hide-alpha-usage');\n                });\n\n                colorAlphas.click(function () {\n                    $.each(colorAlphas, function () {\n                        $(this).removeClass('selected');\n                    });\n\n                    self.currentAlpha = $(this).data('alpha');\n                    self.updateColorString(Constants.ColorFormat[self.colorFormat]);\n\n                    $(this).addClass('selected');\n                });\n            }\n        },\n\n\n        updateColorString: function (newColorFormat) {\n            var color,\n                colorFormat,\n                $textarea = this.$el.find('textarea');\n            if (this.colorUsage instanceof ColorUsageModel) {\n                color = this.colorUsage.get('style');\n                if (newColorFormat === Constants.ColorFormat.RGB) {\n                    $textarea.val(color.toRGBString(this.currentAlpha));\n                } else if (newColorFormat === Constants.ColorFormat.HEX) {\n                    $textarea.val(color.toHEXString(this.currentAlpha));\n                } else {\n                    $textarea.val(color.toHSLString(this.currentAlpha));\n                }\n            }\n\n            $textarea.select();\n        },\n\n        remove: function () {\n            this.removeEventListeners();\n            BasePopupView.prototype.remove.call(this);\n        }\n    });\n\n    return ColorChipPopupView;\n});\n\n//# sourceURL=/lib/graphite-api/public/js/ccweb.files.extract/views/popup/ColorChipPopupView.js"),
eval('define(\'text!ccweb.files.extract/views/templates/layerThumbPopupTemplate.html\',[],function () { return \'<div class="layer-thumb">\\n    <canvas class="sprite_preview preview" ></canvas>\\n    <span id="layerWarningMessage" style="display: none"><%-translate("Warning: This layer contains an incompatible graphic option: blend mode")%></span>\\n</div>\';});\n\n//# sourceURL=/text!ccweb.files.extract/views/templates/layerThumbPopupTemplate.html'),eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013-2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4 */\n/*global define: true, graphite: true*/\n\ndefine('ccweb.files.extract/views/popup/LayerThumbPopupView',[\n    'jquery',\n    'underscore',\n    'backbone',\n    'ccweb.files.extract/views/popup/BasePopupView',\n    'plugin-dependencies',\n    'ccweb.files.extract/utils/ImageUtil',\n    'ccweb.files.extract/utils/TemplateUtil',\n    'ccweb.files.extract/utils/SpriteSheetUtils',\n    'text!ccweb.files.extract/views/templates/layerThumbPopupTemplate.html'\n], function ($, _, Backbone, BasePopupView, deps, ImageUtil, TemplateUtil, SpriteSheetUtils, LayerThumbPopupTemplate) {\n    'use strict';\n    var LayerThumbPopupView = BasePopupView.extend({\n\n        className: 'layer-thumb-popup popup',\n\n        initialize: function () {\n            BasePopupView.prototype.initialize.apply(this, arguments);\n\n            // events\n            graphite.events.on('load-layer-thumb-popup', this.handleLoadThumb, this);\n            graphite.events.on('show-layer-thumb-popup', this.handleShow, this);\n            graphite.events.on('hide-layer-thumb-popup', this.closePopup, this);\n        },\n\n        render: function () {\n            BasePopupView.prototype.render.apply(this, arguments);\n            var contents = this.$el.find('.popup-contents').html(\n                TemplateUtil.createTemplate(LayerThumbPopupTemplate)\n            );\n\n            return this;\n        },\n\n        removeEventListeners: function () {\n            graphite.events.off(null, null, this);\n        },\n\n        handleImageLoad: function () {\n            ImageUtil.sizeAndCenterImage(this.$el.find('.preview')[0],\n                parseInt(this.$el.find('.layer-thumb').width(), 10),\n                parseInt(this.$el.find('.layer-thumb').height(), 10),\n                ImageUtil.ImageScaleType.FIT,\n                false);\n        },\n\n        //------------------------------------------------\n        // Handlers\n        //------------------------------------------------\n\n        handleLoadThumb: function () {\n            var model = arguments[0].model,\n                props = model.get('properties'),\n                blendOptions = props ? props.get('blendOptions') : null;\n\n            SpriteSheetUtils.renderSpriteModel(this, model, '.layer-thumb', '.sprite_preview', true);\n\n            var warningMsgElem = this.$el.find('#layerWarningMessage');\n            var warningMessages = [];\n\n            // Check for blend modes rendered incorrectly\n            if (blendOptions &&\n                    blendOptions.mode &&\n                    blendOptions.mode !== 'passThrough' &&\n                    !model.get('isFlattened') &&\n                    model.get('visible')) {\n                warningMessages.push(deps.translate('This layer contains blend modes that may not be rendered correctly with the current combination of visible layers.'));\n            }\n\n            // Check for font substitution\n            if (model.isFontSubstitution()) {\n                warningMessages.push(deps.translate('This layer contains font substitutions so the font-size CSS reported is approximate.'));\n            }\n\n            if (warningMessages.length > 0) {\n                warningMsgElem.show();\n                warningMsgElem.html(warningMessages.join('<br><br>'));\n            } else {\n                warningMsgElem.hide();\n            }\n        },\n\n        closePopup: function () {\n            BasePopupView.prototype.closePopup.apply(this, arguments);\n            this.$el.find('.preview').attr('src', '');\n        },\n\n        remove: function () {\n            this.removeEventListeners();\n            BasePopupView.prototype.remove.call(this);\n        }\n\n    });\n\n    return LayerThumbPopupView;\n});\n\n//# sourceURL=/lib/graphite-api/public/js/ccweb.files.extract/views/popup/LayerThumbPopupView.js"),eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013-2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4 */\n/*global define: true, graphite: true, Image: true, clearTimeout: true, setTimeout: true*/\n\ndefine('ccweb.files.extract/controllers/FlattenedAssetController',[\n    'jquery',\n    'underscore',\n    'ccweb.files.extract/controllers/SelectionController',\n    'ccweb.files.extract/controllers/DetailsController',\n    'ccweb.files.extract/models/LayerModelMap',\n    'ccweb.files.extract/models/LayerModel',\n    'ccweb.files.extract/utils/MeasurementUtil'\n], function ($, _, SelectionController, DetailsController, LayerModelMap, LayerModel, MeasurementUtil) {\n    'use strict';\n\n    var FlattenedAssetController = {\n        activeRequests: {},\n        requestDelay: 1000,\n        cachedImages: {},\n\n        /**\n         * Used to invalidate a pre-existing flattened sprite. We\n         * request another that matches the current visibility state\n         * of the flattenedSprite model's 'included layers'.\n         * @param model\n         */\n        invalidateSprite: function (model) {\n            var psdModelID = SelectionController.getPSDModel().id,\n                layerCompId = SelectionController.getPSDModel().get('layerCompId'),\n                spriteInfo = this.deriveSpriteInfo(model, psdModelID),\n                refreshRequest,\n                cachedImage = this.cachedImages[spriteInfo.key()],\n                self = this;\n\n            if (!cachedImage && this.isOriginalPSDVisibility(model)) {\n                // For initial state obtain sprite from our DetailsController\n                cachedImage = {\n                    image: DetailsController.spriteSheets[model.get('flattenedSprite').sheetID],\n                    bounds: model.get('flattenedSprite').bounds\n                };\n                this.cachedImages[spriteInfo.key()] = cachedImage;\n            }\n\n            if (spriteInfo.visibleLayers && spriteInfo.visibleLayers.length === 0) {\n                this.replaceFlattenedSprite(model, null);\n            } else if (cachedImage && cachedImage.image.complete) {\n                this.replaceFlattenedSprite(model, cachedImage.image, cachedImage.bounds);\n            } else {\n                refreshRequest = {};\n                refreshRequest.model = model;\n                refreshRequest.psdModelID = psdModelID;\n                refreshRequest.layerCompId = layerCompId;\n                refreshRequest.info = spriteInfo;\n                refreshRequest.delayTimer = setTimeout(function () {\n                    self.activateRequest(refreshRequest);\n                }, this.requestDelay);\n                this.queueRequest(refreshRequest);\n            }\n        },\n\n        /**\n         * Used to denote that a flattened sprite model is in sync\n         * with its included layer visibility.\n         * @param model\n         */\n        validateSprite: function (model) {\n            this.cancelRequest(model);\n        },\n\n        /**\n         * Once our lazy-load timeout has expired, fire off\n         * the actual image request.\n         * @param request\n         */\n        activateRequest: function (request) {\n            var self = this,\n                imageLoaded = function () {\n                    self.imageLoaded(request);\n                },\n                imageError = function (result) {\n                    self.imageError(request);\n                },\n                psdModel = SelectionController.getPSDModel();\n\n            request.image = graphite.serverAPI.getDerivedSpriteImage(psdModel, request.info.visibleLayers, imageLoaded, imageError);\n            request.delayTimer = null;\n        },\n\n        /**\n         * Invoked when replacement sprite sheet has been received.\n         * @param request\n         */\n        imageLoaded: function (request) {\n            // Only service if still relevant to our loaded document\n            // and request wasn't cancelled.\n            var activeRequest = this.activeRequests[request.model.get('layerId')],\n                bounds = {top: 0, left: 0, right: request.image.width, bottom: request.image.height};\n\n            // Cache successful request.\n            this.cachedImages[request.info.key()] = { image: request.image, bounds: bounds };\n\n            if (activeRequest && activeRequest.info.key() === request.info.key() &&\n                    request.psdModelID === SelectionController.getPSDModel().id) {\n                this.replaceFlattenedSprite(request.model, request.image, bounds);\n                this.cancelRequest(request.model);\n            }\n        },\n\n        /**\n         * Invoked when replacement sprite sheet had load error.\n         * We'll just use blank/empty sprite.\n         * @param request\n         */\n        imageError: function (request) {\n            // Only service if still relevant to our loaded document\n            // and request wasn't cancelled.\n            if (this.activeRequests[request.model.get('layerId')] &&\n                    request.psdModelID === SelectionController.getPSDModel().id) {\n                this.replaceFlattenedSprite(request.model, null);\n            }\n            this.cancelRequest(request.model);\n        },\n\n        /**\n         * Performs the actual replacement of a flattened sprite rendition\n         * Updates the associated layers and dispatches notification of\n         * completion.\n         * @param model\n         * @param image\n         * @param optional imageBounds\n         */\n        replaceFlattenedSprite: function (model, image, imageBounds) {\n            var elemId = 'flattenedLayer' + model.get('layerId'),\n                $spriteElem = $('#' + elemId),\n                flattenedSprite = model.get('flattenedSprite'),\n                curLayerModel,\n                curBounds,\n                layerBounds,\n                layerVisible,\n                context,\n                PSDModel = SelectionController.getPSDModel(),\n                psdBounds = PSDModel.get('imgdata').bounds;\n\n            if ($spriteElem.length) {\n                context = $spriteElem[0].getContext('2d');\n                context.clearRect(0, 0, $spriteElem.width(), $spriteElem.height());\n\n                // Replace rendition of our previous flattened sprite.\n                if (image) {\n                    $spriteElem[0].width = imageBounds.right - imageBounds.left;\n                    $spriteElem[0].height = imageBounds.bottom - imageBounds.top;\n                    context.drawImage(image, imageBounds.left, imageBounds.top, $spriteElem[0].width, $spriteElem[0].height,\n                        0, 0, $spriteElem[0].width, $spriteElem[0].height);\n                }\n\n                // Capture the current set of visibility matching the\n                // new rendition, also gather up cumulative bounds for the new\n                // set of visible items so we can adjust our flattened sprite\n                // element position.\n                layerVisible = model.getEffectiveVisibility();\n                model.set('renderedVisible', layerVisible);\n                layerBounds = model.get('bounds');\n                curBounds = {\n                    top: layerVisible ? layerBounds.top : psdBounds.bottom,\n                    left: layerVisible ? layerBounds.left : psdBounds.right\n                };\n\n                _.each(flattenedSprite.includedLayers, function (layerId) {\n                    curLayerModel = LayerModelMap.getModel(layerId);\n                    layerVisible = curLayerModel.getEffectiveVisibility();\n                    layerBounds = curLayerModel.get('bounds');\n                    curLayerModel.set('renderedVisible', layerVisible);\n                    if (curLayerModel.getEffectiveVisibility()) {\n                        curBounds.left = Math.min(curBounds.left, layerBounds.left);\n                        curBounds.top = Math.min(curBounds.top, layerBounds.top);\n                    }\n                });\n\n                if (SelectionController.clipLayersToImage) {\n                    curBounds.top = Math.max(0, curBounds.top);\n                    curBounds.left = Math.max(0, curBounds.left);\n                }\n\n                // Find nearest visible parent div and place\n                // the validated sprite element in its proper\n                // location.\n                this.applyParentAndPosition(model, curBounds, $spriteElem, flattenedSprite, PSDModel);\n\n                // Notify so that the new flattened sprite can be leveraged.\n                graphite.events.trigger('flattenedSpriteUpdated', model);\n            }\n        },\n\n        /**\n         * The div representing the layer set our flattened sprite belongs to\n         * may be hidden so we must hoist our flattened sprite element to a visible\n         * parent.  Position in DOM is recomputed each time a flattened sprite is\n         * validated.\n         * @param model\n         * @param $spriteElem\n         * @returns parent model;\n         */\n        placeSprite: function (model, $spriteElem) {\n            var candidate = model.get('parentModel'),\n                layerChildren,\n                parentModel,\n                lastFlattenedChild,\n                $adjacentElem,\n                $parentElem,\n                layer,\n                i;\n\n            // Start at our layer model and walk up to find our nearest\n            // visible parent.\n            while (candidate && candidate instanceof LayerModel && candidate.getEffectiveOpacity() != 1) {\n                candidate = candidate.get('parentModel');\n            }\n\n            if (candidate) {\n                // Determine sibling to insert next to.\n                layerChildren = candidate.get('layerCollection');\n                for (i = 0; i < layerChildren.length; i++) {\n                    layer = layerChildren.at(i);\n                    if (layer.get('flattenedParent') === model.get('layerId')) {\n                        lastFlattenedChild = layer;\n                    }\n                }\n                if (lastFlattenedChild) {\n                    $adjacentElem = $('#layer' + lastFlattenedChild.get('layerId'));\n                }\n\n                // Assign pending parent element.\n                if (candidate instanceof LayerModel) {\n                    // Append to the candidate.\n                    $parentElem = $('#layer' + candidate.get('layerId'));\n                    parentModel = candidate;\n                } else {\n                    // Append to root of layer tree.\n                    $parentElem = $('#psdpreview_root');\n                }\n\n                // Insert in new location as appropriate.\n                if ($parentElem) {\n                    if ($adjacentElem) {\n                        $adjacentElem.before($spriteElem);\n                    } else {\n                        $parentElem.prepend($spriteElem);\n                    }\n                }\n            }\n\n            return parentModel;\n        },\n\n        /**\n         * Places our flattened sprite with a new visible\n         * parent and updates the CSS position accordingly.\n         * @param model\n         * @param $spriteElem\n         * @returns parent model\n         */\n        applyParentAndPosition: function (model, curBounds, $spriteElem, flattenedSprite, PSDModel) {\n            var parentModel = this.placeSprite(model, $spriteElem),\n                parentBounds = parentModel ? MeasurementUtil.getVisibleBounds(parentModel, PSDModel) : null;\n\n            if (!parentBounds) {\n                parentBounds = {top: 0, left: 0};\n            }\n\n            // Provide alternate psdOrigin\n            if (flattenedSprite) {\n                flattenedSprite.altPsdOrigin = _.clone(curBounds);\n            }\n\n            // Update sprite element position\n            $spriteElem.css({\n                left: curBounds.left - parentBounds.left + 'px',\n                top: curBounds.top - parentBounds.top + 'px'\n            });\n        },\n\n        /**\n         * Denote actively outstanding refresh request.\n         * @param request\n         */\n        queueRequest: function (request) {\n            var model = request.model,\n                id = request.model.get('layerId');\n\n            this.cancelRequest(model);\n            this.activeRequests[id] = request;\n            $('.spinner').show();\n        },\n\n        /**\n         * Cancels outstanding refresh request.\n         * @param request\n         */\n        cancelRequest: function (model) {\n            var id = model.get('layerId'),\n                request = this.activeRequests[id];\n            if (request) {\n                clearTimeout(request.delayTimer);\n                delete this.activeRequests[id];\n            }\n            if (Object.keys(this.activeRequests).length === 0) {\n                $('.spinner').hide();\n            }\n        },\n\n        /**\n         * Helper that returns true if a flattened sprite and its\n         * members match their original psd visibility.\n         * @param model\n         */\n        isOriginalPSDVisibility: function (model) {\n            var visibility = model.getEffectiveVisibility(),\n                result = visibility === model.get('psdVisible'),\n                flattenedSprite = model.get('flattenedSprite'),\n                curLayerModel;\n            if (result) {\n                _.each(flattenedSprite.includedLayers, function (layerId) {\n                    curLayerModel = LayerModelMap.getModel(layerId);\n                    visibility = curLayerModel.getEffectiveVisibility();\n                    if (visibility !== curLayerModel.get('psdVisible')) {\n                        result = false;\n                    }\n                });\n            }\n            return result;\n        },\n\n        /**\n         * Construct URL required to obtain our new flattened sprite\n         * instance.\n         * @param request\n         */\n        deriveSpriteInfo: function (model, psdModelID) {\n            var flattenedSprite = model.get('flattenedSprite'),\n                visibleLayers = [],\n                spriteInfo = {\n                    psdId: psdModelID,\n                    visibleLayers: [],\n                    key: function () {\n                        return psdModelID + ',' + this.visibleLayers.join(',');\n                    }\n                },\n                curLayerModel;\n\n            if (model.getEffectiveVisibility()) {\n                visibleLayers.push(model);\n            }\n\n            _.each(flattenedSprite.includedLayers, function (layerId) {\n                curLayerModel = LayerModelMap.getModel(layerId);\n                if (curLayerModel.getEffectiveVisibility()) {\n                    visibleLayers.push(curLayerModel);\n                }\n            });\n\n            visibleLayers = SelectionController.expandSelection(visibleLayers);\n\n            spriteInfo.visibleLayers = _.unique(_.map(visibleLayers, function (layer) {\n                return layer.get('layerId');\n            }));\n\n            return spriteInfo;\n        },\n\n        reset: function () {\n            this.activeRequests = {};\n            this.cachedImages = {};\n        }\n    };\n\n    return FlattenedAssetController;\n});\n\n//# sourceURL=/lib/graphite-api/public/js/ccweb.files.extract/controllers/FlattenedAssetController.js"),eval("define('text!ccweb.files.extract/views/templates/inspectFontCalloutTemplate.html',[],function () { return '<div class=\"font-callout\">\\n    <p>T</p>\\n    <div class=\"callout-notch\"></div>\\n</div>';});\n\n//# sourceURL=/text!ccweb.files.extract/views/templates/inspectFontCalloutTemplate.html"),eval('define(\'text!ccweb.files.extract/views/templates/inspectColorCalloutTemplate.html\',[],function () { return \'<div class="color-callout">\\n    <p class="alpha-value">1.0</p>\\n    <div class="callout-notch"></div>\\n</div>\';});\n\n//# sourceURL=/text!ccweb.files.extract/views/templates/inspectColorCalloutTemplate.html'),eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013-2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4 */\n/*global define: true, graphite: true*/\n\ndefine('ccweb.files.extract/views/preview/InspectStyleOverlayView',[\n    'jquery',\n    'underscore',\n    'backbone',\n    'ccweb.files.extract/controllers/SelectionController',\n    'ccweb.files.extract/controllers/DetailsController',\n    'ccweb.files.extract/controllers/ZoomController',\n    'ccweb.files.extract/models/ColorUsageModel',\n    'ccweb.files.extract/models/TextStyleUsageModel',\n    'ccweb.files.extract/models/GradientUsageModel',\n    'ccweb.files.extract/models/LayerModelMap',\n    'ccweb.files.extract/utils/CSSUtil',\n    'ccweb.files.extract/utils/TemplateUtil',\n    'text!ccweb.files.extract/views/templates/inspectFontCalloutTemplate.html',\n    'text!ccweb.files.extract/views/templates/inspectColorCalloutTemplate.html'\n], function ($, _, Backbone, SelectionController, DetailsController, ZoomController,\n    ColorUsageModel, TextStyleUsageModel, GradientUsageModel, LayerModelMap,\n    CSSUtil, TemplateUtil, InspectFontCalloutTemplate, InspectColorCalloutTemplate) {\n    'use strict';\n\n    var InspectStyleOverlayView = Backbone.View.extend({\n        colorCalloutDict: {},\n        inspectableLayers: {},\n\n        initialize: function () {\n            this.render();\n            this.model.on('change:extractedStyles', this.handleExtractedStylesChanged, this);\n\n            this.addHandlers();\n\n            if (this.model.get('extractedStyles')) {\n                this.handleExtractedStylesChanged();\n            }\n        },\n\n        render: function () {\n            var div = $('<div id=\"inspectStyleOverlay\">');\n            this.setElement(div);\n        },\n\n        handleExtractedStylesChanged: function () {\n            this.loadInspectableLayers();\n        },\n\n        addHandlers: function () {\n            // events\n            graphite.events.on('show-style-usage', this.handleShowStyleUsage, this);\n            graphite.events.on('hide-style-usage', this.handleHideStyleUsage, this);\n            graphite.events.on('show-originating-layers', this.handleShowOriginatingLayers, this);\n            graphite.events.on('hide-originating-layers', this.handleHideOriginatingLayers, this);\n            graphite.events.on('show-alpha-usage', this.handleShowAlphaUsage, this);\n            graphite.events.on('hide-alpha-usage', this.handleHideAlphaUsage, this);\n            graphite.events.on('zoomChanged', this.handleSelectedInspectItemChange, this);\n\n            DetailsController.on('change:selectedInspectItem', this.handleSelectedInspectItemChange, this);\n\n            SelectionController.on('change:extractedStylesInSelection', _.bind(this.updateCallouts, this, TextStyleUsageModel, null));\n        },\n\n        removeEventListeners: function () {\n            this.model.off(null, null, this);\n            graphite.events.off(null, null, this);\n            DetailsController.off(null, null, this);\n            SelectionController.off(null, null, this);\n            SelectionController.unbind('change:extractedStylesInSelection');\n        },\n\n        attachCalloutClickHandler: function (callout, layer) {\n            var self = this;\n\n            //first remove all previous click handlers for callout\n            callout.unbind('click');\n            callout.click(function () {\n                SelectionController.changeSelection([layer], false);\n\n                if (!SelectionController.isLayerVisible(layer, true)) {\n                    if (layer.get('spriteSheet') !== undefined) {\n                        var canvas = self.inspectableLayers.spriteSheetLayers;\n                        var bounds = layer.get('bounds');\n                        canvas[0].width = bounds.right - bounds.left;\n                        canvas[0].height = bounds.bottom - bounds.top;\n                        canvas.css('top', bounds.top + 'px');\n                        canvas.css('left', bounds.left + 'px');\n\n                        var context = canvas[0].getContext('2d');\n                        var spriteBounds = layer.get('spriteSheet').bounds;\n                        var image = SelectionController.spriteSheets[layer.get('spriteSheet').sheetID];\n                        context.drawImage(image, spriteBounds.left, spriteBounds.top, spriteBounds.right - spriteBounds.left, spriteBounds.bottom - spriteBounds.top, 0, 0, spriteBounds.right - spriteBounds.left, spriteBounds.bottom - spriteBounds.top);\n\n                        canvas.show();\n                    } else {\n                        self.inspectableLayers[layer.get('layerId')].show();\n                    }\n                }\n            });\n\n        },\n\n\n        //------------------------------------------------\n        // Inspectable layers\n        //------------------------------------------------\n        loadInspectableLayers: function () {\n            var inspectableItems, extractedStyles, layers, self;\n\n            this.inspectableLayers = {};\n            inspectableItems = [];\n            extractedStyles = this.model.get('extractedStyles');\n            self = this;\n\n            inspectableItems = inspectableItems.concat(extractedStyles.colors,\n                extractedStyles.textStyles,\n                extractedStyles.gradients);\n\n            $.each(inspectableItems, function (itemIndex, item) {\n                layers = item.get('layers');\n\n                $.each(layers, function (layerIndex, layer) {\n                    self.loadInspectableLayer(layer);\n                });\n            });\n        },\n\n\n        loadInspectableLayer: function (layer) {\n            var layerId = layer.get('layerId'),\n                image,\n                imgURL,\n                self,\n                canvas,\n                context,\n                bounds;\n\n            if (layer.get('spriteSheet') !== undefined) {\n                if (!this.inspectableLayers.spriteSheetLayers) {\n                    canvas = $('<canvas class=\"inspectable-layer\">');\n                    this.inspectableLayers.spriteSheetLayers = canvas;\n                    this.$el.append(canvas);\n                }\n            }\n        },\n\n\n        //------------------------------------------------\n        // Style Usage and callouts\n        //------------------------------------------------\n        handleShowStyleUsage: function (params) {\n            this.updateHoverRects(params.styles);\n            this.updateCallouts(params.styles[0].constructor, params.styles);\n        },\n\n\n        handleHideStyleUsage: function (params) {\n            this.updateCallouts(params[0].constructor, null);\n            graphite.events.trigger('item-hovered-over', [], false);\n        },\n\n        updateHoverRects: function (styles) {\n            var layers = [];\n            $.each(styles, function (styleIndex, style) {\n                layers = layers.concat(style.get('layers'));\n            });\n            graphite.events.trigger('item-hovered-over', layers, false);\n        },\n\n        handleSelectedInspectItemChange: function () {\n            this.updateCallouts(TextStyleUsageModel, null);\n            this.updateCallouts(ColorUsageModel, null);\n            this.updateCallouts(GradientUsageModel, null);\n        },\n\n        handleShowAlphaUsage: function (params) {\n            this.getCalloutsForStyleType(ColorUsageModel).each(function () {\n                if ($(this).is(':visible')) {\n                    $(this).removeClass('defocused');\n                    if (params.alpha !== $(this).data('alpha')) {\n                        $(this).addClass('defocused');\n                    }\n                }\n            });\n        },\n\n        handleHideAlphaUsage: function () {\n            this.getCalloutsForStyleType(ColorUsageModel).each(function () {\n                if ($(this).is(':visible')) {\n                    $(this).removeClass('defocused');\n                }\n            });\n        },\n\n        updateCallouts: function (styleType, overStyles) {\n            this.getCalloutsForStyleType(styleType).each(function () {\n                $(this).hide();\n                $(this).removeClass('defocused');\n            });\n\n            // figure out what callouts to show\n            var toShow = [];\n            var selectedItem = DetailsController.get('selectedInspectItem');\n            if (overStyles) {\n                toShow = toShow.concat(overStyles);\n            }\n\n            if (selectedItem &&\n                    selectedItem.constructor === styleType &&\n                    selectedItem !== overStyles) {\n                toShow.push(selectedItem);\n            }\n\n            if (toShow.length) {\n                this.showCalloutsForStyles(styleType, toShow);\n            } else {\n                this.$el.find('canvas.inspectable-layer').hide();\n            }\n        },\n\n\n        showCalloutsForStyles: function (styleType, styles) {\n            var self = this;\n            var callouts = this.getCalloutsForStyleType(styleType);\n            var callout;\n            var count = 0;\n\n            $.each(styles, function (styleIndex, style) {\n                $.each(style.get('layers'), function (layerIndex, layer) {\n                    if (callouts[count]) {\n                        callout = $(callouts[count]);\n                        count++;\n                    } else {\n                        callout = self.createCalloutForStyleType(styleType);\n                        $(self.el).append(callout);\n                    }\n                    self.initCallout(callout, style, layer);\n                });\n            });\n        },\n\n\n        getCalloutsForStyleType: function (styleType) {\n            var calloutSelector = '';\n            switch (styleType) {\n            case TextStyleUsageModel:\n                calloutSelector = '.font-callout';\n                break;\n            case ColorUsageModel:\n                calloutSelector = '.solid-color-callout';\n                break;\n            case GradientUsageModel:\n                calloutSelector = '.gradient-callout';\n                break;\n            default:\n                console.warn('Unknown callout for model');\n                break;\n            }\n            return this.$el.find(calloutSelector);\n        },\n\n\n        createCalloutForStyleType: function (styleType, model) {\n            var callout;\n            switch (styleType) {\n            case TextStyleUsageModel:\n                callout = $(TemplateUtil.createTemplate(InspectFontCalloutTemplate));\n                break;\n            case ColorUsageModel:\n                callout = $(TemplateUtil.createTemplate(InspectColorCalloutTemplate));\n                callout.addClass('solid-color-callout');\n                break;\n            case GradientUsageModel:\n                callout = $(TemplateUtil.createTemplate(InspectColorCalloutTemplate));\n                callout.addClass('gradient-callout');\n                break;\n            default:\n                console.warn('Unknown callout for model');\n                break;\n            }\n            return callout;\n        },\n\n\n        initCallout: function (callout, model, layer) {\n            if (model instanceof ColorUsageModel) {\n                callout.css('background', 'none');\n                callout.css('background-color', model.get('style').toRGBString());\n\n                $.each(layer.get('colors'), function (index, color) {\n                    var alphaValue,\n                        alpha;\n                    if (color.isEqual(model.get('style'))) {\n                        alphaValue = callout.find('.alpha-value');\n                        alpha = color.get('alpha');\n                        if (alpha === 1) {\n                            alphaValue.hide();\n                        } else {\n                            alphaValue.show();\n                            alphaValue.text(alpha);\n                        }\n                        callout.data('alpha', alpha);\n                    }\n                });\n\n            } else if (model instanceof GradientUsageModel) {\n                callout.css('background', 'none');\n                callout.find('.alpha-value').hide();\n                CSSUtil.applyCSS(callout, model.get('style'), true);\n            }\n\n            callout.removeClass('invisible');\n            if (!SelectionController.isLayerVisible(layer, true)) {\n                callout.addClass('invisible');\n            }\n\n            callout.show();\n            this.positionCallout(callout, layer);\n            this.attachCalloutClickHandler(callout, layer);\n        },\n\n\n        //------------------------------------------------\n        // Derived Assets\n        //------------------------------------------------\n        handleShowOriginatingLayers: function (params) {\n            var layers = params.assetModel.get('originatingLayers');\n            this.hideShowOriginatingLayers(layers, true);\n        },\n\n\n        handleHideOriginatingLayers: function (params) {\n            var layers = params.get('originatingLayers');\n            this.hideShowOriginatingLayers(layers, false);\n        },\n\n        hideShowOriginatingLayers: function (layers, show) {\n            var layer,\n                i;\n            for (i = 0; i < layers.length; i++) {\n                layer = LayerModelMap.getLayerInfoForId(layers[i]).item;\n                if (show) {\n                    $(layer).addClass('originating-layer');\n                } else {\n                    $(layer).removeClass('originating-layer');\n                }\n            }\n        },\n\n        remove: function () {\n            this.removeEventListeners();\n            return Backbone.View.prototype.remove.call(this);\n        },\n\n        //------------------------------------------------\n        // Helpers\n        //------------------------------------------------\n        positionCallout: function (callout, layerModel) {\n            var top, left;\n\n            var bounds = ZoomController.zoomRect(layerModel.get('bounds'));\n            var layerHeight = bounds.bottom - bounds.top;\n            var calloutWidth = parseInt(callout.css('width'), 10);\n            var calloutHeight = parseInt(callout.css('height'), 10);\n            var notchWidth = parseInt(callout.find('.callout-notch').width(), 10);\n\n            top = bounds.top + (layerHeight - calloutHeight) / 2 - 4;\n            if (top < 0) {\n                top = 0;\n            }\n\n            left = bounds.left - calloutWidth - notchWidth - 7;\n            if (left < 0) {\n                left = 0;\n            }\n\n            callout.css({\n                top:  top + 'px',\n                left: left + 'px'\n            });\n        }\n    });\n\n    return InspectStyleOverlayView;\n});\n\n//# sourceURL=/lib/graphite-api/public/js/ccweb.files.extract/views/preview/InspectStyleOverlayView.js"),
eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013-2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4 */\n/*global define: true, graphite: true*/\n\ndefine('ccweb.files.extract/views/preview/SelectionOverlayView',[\n    'jquery',\n    'underscore',\n    'backbone',\n    'ccweb.files.extract/controllers/SelectionController',\n    'ccweb.files.extract/controllers/ZoomController',\n    'ccweb.files.extract/utils/MeasurementUtil'\n], function ($, _, Backbone, SelectionController, ZoomController, MeasurementUtil) {\n    'use strict';\n    var SelectionOverlayView = Backbone.View.extend({\n        selectionButtonBars: [],\n\n        parentView: null,\n\n        initialize: function (options) {\n            _.bindAll(this, 'handleSelectionChange', 'handleHoverOver');\n            this.parentView = options.parentView;\n            this.render();\n            graphite.events.on('selection-changed', this.handleSelectionChange, this);\n            graphite.events.on('item-hovered-over', this.handleHoverOver, this);\n            graphite.events.on('zoomChanged', this.handleZoomChanged, this);\n        },\n\n        render: function () {\n            var div = this.parentView.$el.find('#selection-overlay')[0];\n            this.setElement(div);\n        },\n\n        //------------------------------------------------\n        // Handlers\n        //------------------------------------------------\n\n        drawOutline: function (layerModel, className) {\n            var newOutlineRect,\n                outlineOffset,\n                overlayWidth = this.$el.width(),\n                overlayHeight = this.$el.height(),\n                isEdgeAdjacent,\n                bounds;\n\n            //Show the selection rects\n            bounds = MeasurementUtil.getVisibleBounds(layerModel, SelectionController.getPSDModel());\n            bounds = ZoomController.zoomRect(bounds);\n\n            // Inset outline if our layerModel is adjacent\n            // to our overlay edge.\n            isEdgeAdjacent = bounds.top <= 0 ||\n                bounds.left <= 0 ||\n                bounds.right >= overlayWidth ||\n                bounds.bottom >= overlayHeight;\n            outlineOffset = isEdgeAdjacent ? -1 : 0;\n\n            newOutlineRect = $('<div class=\"' + className + '\"></div>');\n            newOutlineRect.css({\n                'top': bounds.top + 'px',\n                'left': bounds.left + 'px',\n                'height': bounds.bottom - bounds.top,\n                'width': bounds.right - bounds.left,\n                'outline-offset': outlineOffset + 'px'\n            });\n            this.$el.append(newOutlineRect);\n        },\n\n        handleSelectionChange: function () {\n            var newSelection = SelectionController.getSelectedLayers(),\n                i,\n                j;\n\n            // first remove all the existing buttonbars\n            // (if performance becomes an issue we can recycle existing buttonbars)\n            for (i = 0; i < this.selectionButtonBars.length; i++) {\n                this.selectionButtonBars[i].remove();\n            }\n\n            this.selectionButtonBars = [];\n            this.$el.find('.selection').remove();\n            $('#selection-overlay').find('.hover').remove();\n\n            for (j = 0; j < newSelection.length; j++) {\n                this.drawOutline(newSelection[j], 'selection');\n            }\n        },\n\n        handleZoomChanged: function () {\n            this.$el.find('.hover').remove();\n            SelectionController.changeSelection([], false);\n        },\n\n        handleHoverOver: function (hoverArray) {\n            var i;\n            this.$el.find('.hover').remove();\n\n            for (i = 0; i < hoverArray.length; i++) {\n                if (!this.isItemSelected(hoverArray[i])) {\n                    this.drawOutline(hoverArray[i], 'hover');\n                }\n            }\n        },\n\n        //------------------------------------------------\n        // Helpers\n        //------------------------------------------------\n\n        isItemSelected: function (item) {\n            var id, layerModel;\n            //Draw the selection box around selected layers\n            for (id in SelectionController.selectionMap) {\n                if (SelectionController.selectionMap.hasOwnProperty(id)) {\n                    layerModel = SelectionController.selectionMap[id];\n                    if (item === layerModel) {\n                        return true;\n                    }\n                }\n            }\n            return false;\n        },\n\n        removeEventListeners: function () {\n            graphite.events.off(null, null, this);\n        },\n\n        remove: function () {\n            this.removeEventListeners();\n            return Backbone.View.prototype.remove.call(this);\n        }\n\n    });\n\n    return SelectionOverlayView;\n});\n\n\n//# sourceURL=/lib/graphite-api/public/js/ccweb.files.extract/views/preview/SelectionOverlayView.js"),eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013-2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4 */\n/*global define: true, graphite: true, window: true*/\n\ndefine('ccweb.files.extract/views/popup/BasePreviewPopupView',[\n    'jquery',\n    'underscore',\n    'backbone',\n    './BasePopupView'\n], function ($, _, Backbone, BasePopupView) {\n    'use strict';\n    var BasePreviewPopupView = BasePopupView.extend({\n        events: {\n            'mouseenter': 'handleMouseEnter',\n            'mouseleave': 'handleMouseLeave'\n        },\n\n        handleMouseDown: function (event) {\n            event.stopPropagation();\n        },\n\n        handleShow: function (params) {\n            if (this.$el.parent().offset() === undefined) {\n                return;\n            }\n            this.source = params.sourceElement;\n            if (!this.source) {\n                this.source = null;\n            }\n            this.$el.show();\n            this.positionPopup();\n            this.isMouseOver = false;\n\n            // listeners\n            $(window).on('mousedown', $.proxy(this.handleMouseDown, this));\n        },\n\n        //------------------------------------------------\n        // Helpers\n        //------------------------------------------------\n        //Finds the position we'd like to place the popup relative to the source element\n        positionPopup: function () {\n            var parentOffset = this.$el.parent().offset().top,\n                parentHeight = this.$el.parent().height(),\n                parentWidth = this.$el.parent().width(),\n                sourceHeight = this.getSourceOuterHeight(),\n                sourceWidth = this.getSourceOuterWidth() || parentWidth,\n                popupHeight = this.$el.outerHeight(),\n                popupWidth = this.$el.outerWidth(),\n                previewAreaWidth = $('div.psd-preview-view').width() - 10,\n                hScrollPos =  $('div.psd-preview-view').scrollLeft(),\n                $notch = this.$el.find('.notch'),\n                $extractPlugin = $('.extract-plugin'),\n                extractPluginOffset = $extractPlugin.offset().top + $extractPlugin.outerHeight(true),\n                notchHeight = $notch.height(),\n                notchWidth = $notch.width(),\n                notchAdjustment = 0,\n                nY = this.getSourceYOffset() + sourceHeight,\n                nX = this.getSourceXOffset() + ((sourceWidth - popupWidth) / 2),\n                isTop = true;\n\n            this.$el.removeClass('top bottom');\n\n            // Popup is placed below source by default. If popup is not visible\n            // in current viewport then we place above the source.\n            if (nY + popupHeight + notchHeight > extractPluginOffset - parentOffset) {\n                nY = this.getSourceYOffset() - popupHeight + 4;\n            } else {\n                isTop = false;\n                nY += notchHeight - 4;\n            }\n\n            // If we've placed the popup outside of our parent bounds, then we\n            // place popup interior to the source at the bottom, if the popup is\n            // out of view then we place interior to the source at the top.\n            if (nY < 0 || (nY + popupHeight > parentHeight)) {\n                isTop = true;\n                nY = (this.getSourceYOffset() + sourceHeight) - popupHeight + 3;\n                if (nY + popupHeight + notchHeight > extractPluginOffset - parentOffset) {\n                    isTop = false;\n                    nY = this.getSourceYOffset() + notchHeight - 4;\n                }\n            }\n\n            // Assign final orientation for styling purposes.\n            this.$el.addClass(isTop ? 'top' : 'bottom');\n\n            // Initial placement of notch.\n            $notch.css('left', (popupWidth - notchWidth) / 2);\n\n            //Adjust horizontally to ensure fully within our parent bounds and adjust the notch position\n            if (nX < hScrollPos) {\n                notchAdjustment = Math.min(hScrollPos - nX, (popupWidth-notchWidth)/2);\n                $notch.css('left', ((popupWidth - notchWidth) / 2) - notchAdjustment);\n                nX = hScrollPos;\n            }\n            if (nX + popupWidth > previewAreaWidth + hScrollPos) {\n                notchAdjustment = Math.min(nX - (previewAreaWidth + hScrollPos - popupWidth), (popupWidth-notchWidth)/2);\n                $notch.css('left', (popupWidth - notchWidth) / 2 + notchAdjustment);\n                nX = previewAreaWidth + hScrollPos - popupWidth;\n            }\n\n            // Final placement of popup.\n            this.$el.css({top: nY, left: nX});\n        },\n\n        getSourceXOffset: function () {\n            return Math.max(0, this.source.offset().left - this.$el.parent().offset().left);\n        },\n\n        getSourceYOffset: function () {\n            return Math.max(0, this.source.offset().top - this.$el.parent().offset().top);\n        },\n\n        getSourceOuterWidth: function () {\n            return this.source.outerWidth();\n        },\n\n        getSourceOuterHeight: function () {\n            return this.source.outerHeight();\n        }\n\n    });\n\n    return BasePreviewPopupView;\n});\n\n//# sourceURL=/lib/graphite-api/public/js/ccweb.files.extract/views/popup/BasePreviewPopupView.js"),eval('define(\'text!ccweb.files.extract/views/templates/measurementPopupTemplate.html\',[],function () { return \'<div id="measurementPopupInfo">\\n    <div id="measurementPreferredUnits" class="measurementPreferredUnits"><span id="preferredUnitPx" class="selectedUnit">PX</span><br/><span id="preferredUnitPct">%</span></div>\\n    <div class="measurementElementInfoDim">W: <span class="copyable width">0</span> <br/>H: <span class="copyable height">0</span></div>\\n    <div class="measurementElementInfoPos">X: <span class="copyable x">0</span> <br/>Y: <span class="copyable y">0</span></div>\\n    <div class="measurementElementCopyControls"><span id="copyCSSLink" class="copyable"><%-translate("Copy CSS")%></span><br/><span id="copyTextLink" class="copyable"><%-translate("Copy Text")%></span></div>\\n    <div class="measurementElementAssetExtract" title=\\\'<%-translate("Extract asset")%>\\\'></div>\\n    <div class="assetExtractPopup"></div>\\n</div>\\n\';});\n\n//# sourceURL=/text!ccweb.files.extract/views/templates/measurementPopupTemplate.html'),eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013-2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE: All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any. The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4 */\n/*global define: true, graphite: true, setTimeout: true, window: true*/\n\ndefine('ccweb.files.extract/views/popup/MeasurementPopupView',[\n    'jquery',\n    'underscore',\n    'backbone',\n    'ccweb.files.extract/Constants',\n    'ccweb.files.extract/views/popup/BasePreviewPopupView',\n    'plugin-dependencies',\n    'ccweb.files.extract/controllers/ClipboardController',\n    'ccweb.files.extract/controllers/ZoomController',\n    'ccweb.files.extract/controllers/SelectionController',\n    'ccweb.files.extract/models/LayerModelMap',\n    'ccweb.files.extract/models/UserSettingsModel',\n    'ccweb.files.extract/utils/TemplateUtil',\n    'ccweb.files.extract/utils/MeasurementUtil',\n    'ccweb.files.extract/utils/UTF8',\n    'text!ccweb.files.extract/views/templates/measurementPopupTemplate.html'\n], function ($, _, Backbone, Constants, BasePreviewPopupView, deps,\n        ClipboardController, ZoomController, SelectionController, LayerModelMap, UserSettingsModel,\n        TemplateUtil, MeasurementUtil, UTF8, MeasurementPopupTemplate) {\n\n    'use strict';\n\n    var MeasurementPopupView = BasePreviewPopupView.extend({\n\n        className: 'measurementPopup popup measurementTooltip',\n\n        sourceElement: null,\n        layerModel: null,\n        layerList: null,\n        displayWidth: null,\n        displayHeight: null,\n\n        events: {\n            'click #preferredUnitPx': 'handlePreferredMeasurementUnitChange',\n            'mousedown #preferredUnitPx': 'handleMouseDown',\n            'click #preferredUnitPct': 'handlePreferredMeasurementUnitChange',\n            'mousedown #preferredUnitPct': 'handleMouseDown',\n            'click #copyCSSLink': 'handleCopyableClick',\n            'mousedown #copyCSSLink': 'handleMouseDown',\n            'click #copyTextLink': 'handleCopyableClick',\n            'click .copyable': 'handleCopyableClick',\n            'mousedown #copyTextLink': 'handleMouseDown'\n        },\n\n        initialize: function () {\n            BasePreviewPopupView.prototype.initialize.apply(this, arguments);\n            this.initCopyToClipboard();\n            \n            graphite.events.on('layerVisiblityChanged', this.layerVisiblityChanged, this);\n        },\n\n        render: function () {\n            BasePreviewPopupView.prototype.render.apply(this, arguments);\n\n            this.$el.find('.popup-contents').html(\n                TemplateUtil.createTemplate(MeasurementPopupTemplate)\n            );\n\n            var copyCssLink = this.$el.find('#copyCSSLink'),\n                copyTextLink = this.$el.find('#copyTextLink'),\n                extractIcon = this.$el.find('.measurementElementAssetExtract'),\n                popup = this.$el.find('.assetExtractPopup'),\n                copyables = this.$el.find('.copyable');\n\n            if (UserSettingsModel.get('preferredMeasurementUnits') !== Constants.MeasurementUnitType.PX) {\n                this.$el.find('#measurementPreferredUnits span').toggleClass('selectedUnit');\n            }\n\n            copyCssLink.html(deps.translate('Copy CSS'));\n            copyTextLink.html(deps.translate('Copy Text'));\n\n            copyables.attr('title', deps.translate('Click to copy'));\n            copyables.hover(this.highlightLabel, this.unhighlightLabel);\n            \n            var it = this;\n\n            extractIcon.click(function (event) {\n                // add click handler for the measurement popup extract button\n                graphite.events.trigger('show-extract-asset-popup', {\n                    sourceElement: extractIcon,\n                    origin: 'measurementPopup'\n                });\n                it.extractAssetPopup = $('.extract-asset-popup');\n                it.extractAssetPopupParent = it.extractAssetPopup.parent();\n                var css = {\n                        left: 103,\n                        top: 'auto',\n                        bottom: 'auto'\n                    };\n                css[it.extractAssetPopup.hasClass('top') ? 'bottom' : 'top'] = 68;\n                popup.append(it.extractAssetPopup.css(css));\n                event.stopPropagation();\n            });\n            this.layerVisiblityChanged();\n\n            return this;\n        },\n        \n        layerVisiblityChanged: function (params) {\n            if (SelectionController.canExtractAsset()) {\n                this.$el.find('.measurementElementAssetExtract').css('display', 'inline-block');\n            } else {\n                this.$el.find('.measurementElementAssetExtract').css('display', 'none');\n            }\n        },\n\n        initCopyToClipboard: function () {\n            var self = this,\n                clipboard = ClipboardController.getClipboard(),\n                copyables = this.$el.find('.copyable');\n\n            //copy text link\n            var copyTextBtn = this.$el.find('#copyTextLink');\n\n            //copy css button\n            var copyCSSBtn = this.$el.find('#copyCSSLink');\n\n            _.each(copyables, function (elem) {\n                clipboard.clip(elem);\n            });\n\n            graphite.events.on('clipboard-data-requested', function (elem) {\n                if (elem === copyTextBtn[0]) {\n                    if (self.layerModel && self.layerModel.get('type') === Constants.Type.LAYER_TEXT) {\n                        clipboard.setText(UTF8.decodeCharacters($.trim(self.layerModel.get('properties').get('rawText'))));\n                        //copy text event\n                        graphite.events.trigger('copy-text');\n                        self.showSuccessTooltip(deps.translate('Text copied to clipboard'));\n                    }\n                } else if (elem === copyCSSBtn[0]) {\n                    if (self.layerModel) {\n                        var cssStr = self.layerModel.getCSSAsString(true, UserSettingsModel.get('preprocessor'));\n                        clipboard.setText(cssStr);\n                        //copy css event\n                        graphite.events.trigger('copy-css', {origin: 'HUD'});\n                        self.showSuccessTooltip(deps.translate('CSS copied to clipboard'));\n                    }\n                } else if ($(elem).hasClass('copyable')) {\n                    this.handleCopyableElement($(elem));\n                }\n            }, this);\n        },\n\n        // Handles special case copyable values that are specific to MeasurementPopupView, otherwise\n        // just adds the element's value as 'px' value to clipboard.\n        handleCopyableElement: function ($elem) {\n            var clipboard = ClipboardController.getClipboard(),\n                copyMsg = deps.translate('Value copied to clipboard'),\n                bounds = this.lastMeasuredBounds,\n                clipValue;\n\n            if ($elem.hasClass('width') || $elem.hasClass('height')) {\n                clipValue = 'width: ' + this.displayWidth +\n                            ';\\nheight: ' + this.displayHeight + ';';\n                copyMsg = deps.translate('Size copied to clipboard');\n            } else if ($elem.hasClass('x') || $elem.hasClass('y')) {\n                clipValue = 'top: ' + bounds.top + 'px;\\nleft: ' + bounds.left + 'px;';\n                copyMsg = deps.translate('Position copied to clipboard');\n            } else {\n                clipValue = $elem.text();\n            }\n\n            clipboard.setText(clipValue);\n            graphite.events.trigger('copy-value', {origin: 'HUD'});\n            this.showSuccessTooltip(copyMsg);\n        },\n\n        showSuccessTooltip: function (message) {\n            var parent = this.$el.parent().get(0);\n            $(parent).append('<div id=\"notificationTooltip\" style=\"display:none\"><span>' + message + '</span></div>');\n            var tooltip = $('#notificationTooltip');\n            var tipWidth = tooltip.width();\n            var tipHeight = tooltip.height();\n            var elementBounds = this.layerModel ? this.layerModel.attributes.bounds : this.layerGroupBounds;\n            var tipPosLeft = ((elementBounds.left + (elementBounds.right - elementBounds.left) / 2) * ZoomController.getZoomLevel()) - tipWidth / 2;\n            var tipPosTop = ((elementBounds.top + (elementBounds.bottom - elementBounds.top) / 2) * ZoomController.getZoomLevel()) - tipHeight / 2;\n            tooltip.css({top: tipPosTop, left: tipPosLeft});\n            tooltip.fadeIn(250);\n            setTimeout(function () {\n                tooltip.remove();\n            }, Constants.toolTipTimeout);\n        },\n\n        //------------------------------------------------\n        // Handlers\n        //------------------------------------------------\n\n\n        handleCopyableClick: function (event) {\n            event.stopPropagation();\n        },\n\n        highlightLabel: function () {\n            $(this).addClass('zeroclipboard-is-hover');\n        },\n\n        unhighlightLabel: function () {\n            $(this).removeClass('zeroclipboard-is-hover');\n        },\n\n        handlePreferredMeasurementUnitChange: function (event) {\n            var newPreferredUnits = (event.target.id === 'preferredUnitPx') ? Constants.MeasurementUnitType.PX : Constants.MeasurementUnitType.PCT,\n                i;\n            if (newPreferredUnits !== UserSettingsModel.get('preferredMeasurementUnits')) {\n                UserSettingsModel.set('preferredMeasurementUnits', newPreferredUnits);\n                this.$el.find('#measurementPreferredUnits span').toggleClass('selectedUnit');\n                this.sourceElement = null;\n                this.handleShowMeasurementInfo((this.layerList) ? {layerList: this.layerList} : {layerModel: this.layerModel});\n                graphite.events.trigger('preferredMeasurementUnitsChanged', {preferredMeasurementUnits: newPreferredUnits});\n            }\n            event.stopPropagation();\n        },\n\n        handleShowMeasurementInfo: function (params) {\n            var dimensionDiv = this.$el.find('.measurementElementInfoDim'),\n                psdModel = SelectionController.getPSDModel(),\n                containingLayerBounds,\n                bounds,\n                rectA,\n                rectB;\n            this.layerModel = null;\n            this.layerList = null;\n            this.layerGroupBounds = null;\n\n            //Figure out the bounds of whichever layers are selected and calculate the dimensions\n            containingLayerBounds = psdModel.get('imgdata').bounds; //By default the whole PSD contains the selected layers\n            if (params.layerList instanceof Array) {\n                bounds = MeasurementUtil.calcLayerGroupBounds(params.layerList, psdModel);\n                if ((params.layerList.length === 2) && (UserSettingsModel.get('preferredMeasurementUnits') === Constants.MeasurementUnitType.PCT)) {\n                    //If there are exactly two layers selected, check to see if one layer completely contains the other.\n                    //If it does, then we have the special case of showing percentage measurements of the smaller to the larger.\n                    rectA = MeasurementUtil.getVisibleBounds(params.layerList[0], psdModel);\n                    rectB = MeasurementUtil.getVisibleBounds(params.layerList[1], psdModel);\n\n                    if (MeasurementUtil.rect1ContainsRect2(rectA, rectB)) {\n                        bounds = rectB;\n                        containingLayerBounds = rectA;\n                    } else if (MeasurementUtil.rect1ContainsRect2(rectB, rectA)) {\n                        bounds = rectA;\n                        containingLayerBounds = rectB;\n                    }\n                }\n            } else {\n                bounds = MeasurementUtil.getVisibleBounds(params.layerModel, psdModel);\n            }\n            var calculatedMeasurements = MeasurementUtil.getMeasurementsOfRectInsideRect(bounds, containingLayerBounds);\n            this.displayWidth = calculatedMeasurements.displayWidth;\n            this.displayHeight = calculatedMeasurements.displayHeight;\n            dimensionDiv.find('.width').text(calculatedMeasurements.displayWidth);\n            dimensionDiv.find('.height').text(calculatedMeasurements.displayHeight);\n\n            if (params.layerList instanceof Array) {\n                this.layerList = params.layerList;\n                this.lastMeasuredBounds = _.clone(bounds);\n                this.layerGroupBounds = params.layerList[0].attributes.bounds;\n\n                this.placePopupOutOfTheWay(params.layerList);\n            } else {\n                this.layerModel = params.layerModel;\n                this.placePopupRelativeToLayerElement(params.layerModel);\n            }\n        },\n\n        placePopupRelativeToLayerElement: function (layerElement) {\n            var notchElement = this.$el.find('.notch'),\n                positionDiv = this.$el.find('.measurementElementInfoPos'),\n                copyTextLink = this.$el.find('#copyTextLink'),\n                psdModel = SelectionController.getPSDModel(),\n                bounds;\n\n            notchElement.show();\n            positionDiv.show();\n            if (!layerElement || (layerElement.get('type') !== Constants.Type.LAYER_TEXT)) {\n                copyTextLink.addClass('disabled');\n            } else {\n                copyTextLink.removeClass('disabled');\n            }\n\n            if (layerElement) {\n                var newSourceElement = LayerModelMap.getLayerInfoForId(layerElement.attributes.layerId).item;\n                if (this.sourceElement !== newSourceElement) {\n                    this.sourceElement = newSourceElement;\n                    bounds = MeasurementUtil.getVisibleBounds(layerElement, psdModel);\n                    this.lastMeasuredBounds = _.clone(bounds);\n                    this.layerBounds = ZoomController.zoomRect(bounds);\n\n                    positionDiv.find('.x').text(bounds.left + 'px');\n                    positionDiv.find('.y').text(bounds.top + 'px');\n\n                    this.handleShow({sourceElement: $(this.sourceElement)});\n                }\n            } else {\n                this.closePopup();\n                this.sourceElement = null;\n            }\n        },\n\n        placePopupOutOfTheWay: function (layerList) {\n            var notchElement = this.$el.find('.notch'),\n                positionDiv = this.$el.find('.measurementElementInfoPos'),\n                copyCSSLink = this.$el.find('#copyCSSLink'),\n                copyTextLink = this.$el.find('#copyTextLink'),\n                $measurementOverlay = $('#measurementOverlay'),\n                $previewView = $('div.psd-preview-view'),\n                hScrollPos =  $previewView.scrollLeft(),\n                vScrollPos =  $previewView.scrollTop(),\n                previewAreaHeight = $previewView.height(),\n                previewAreaWidth = $previewView.width() - 10,\n                maxX = Math.min(previewAreaWidth, this.$el.parent().width()),\n                maxY = Math.min(previewAreaHeight, this.$el.parent().height()),\n                verticalPadding = Math.min(Math.floor(maxY/10), 90), //Use less vertical padding when we have less vertical space\n                bounds,\n                $bannerElements,\n                $bannerElement1,\n                $bannerElement2;\n\n            notchElement.hide();\n            positionDiv.hide();\n            copyCSSLink.addClass('disabled');\n            copyTextLink.addClass('disabled');\n\n            //Figure the bounds for our popup. Start by assuming we're going to place it in the middle, centered horizontally\n            var popupBounds = {left: (maxX - this.$el.outerWidth()) / 2 + hScrollPos,\n                top: (maxY - this.$el.outerHeight())/2 + vScrollPos,\n                right: (maxX + this.$el.outerWidth()) / 2 + hScrollPos,\n                bottom: (maxY + this.$el.outerHeight())/2 + vScrollPos};\n\n            if (layerList.length === 2) {\n                $bannerElements = $measurementOverlay.find('div.measurementOffsetsBanner');\n                $bannerElement1 = $bannerElements.first();\n                $bannerElement2 = $bannerElements.slice(1).first();\n                //We need to figure out what the banner's actual bounds will be, but that's difficult because\n                //it's currently animating and is contained in a parent that's also animating. So we figure\n                //where the banner will end up after the animations by inferring from the current CSS values.\n                var bannerLeft = parseInt($bannerElement1.css('left'), 10),\n                    bannerParentLeft = parseInt($bannerElement1.parent().css('left'), 10),\n                    bannerParentParentOffsetLeft = $bannerElement1.parent().parent().offset().left,\n                    bannerTop = parseInt($bannerElement1.css('top'), 10),\n                    bannerParentTop = parseInt($bannerElement1.parent().css('top'), 10),\n                    bannerParentParentOffsetTop = $bannerElement1.parent().parent().offset().top,\n                    pendingBannerX = bannerLeft + bannerParentLeft + bannerParentParentOffsetLeft - $measurementOverlay.offset().left,\n                    pendingBannerY = bannerTop + bannerParentTop + bannerParentParentOffsetTop - $measurementOverlay.offset().top;\n\n                //Now that we've computed the position of the first banner, figure out it's bounds\n                var banner1Bounds = {left: pendingBannerX, top: pendingBannerY, right: pendingBannerX + $bannerElement1.outerWidth(), bottom: pendingBannerY + $bannerElement1.outerHeight()};\n                var banner2Bounds = {left: 0, top: 0, right: 0, bottom: 0};\n\n                //Now determine if there is a second banner and it's bounds\n                if ($bannerElement2.length === 1) {\n                    bannerLeft = parseInt($bannerElement2.css('left'), 10);\n                    bannerParentLeft = parseInt($bannerElement2.parent().css('left'), 10);\n                    bannerParentParentOffsetLeft = $bannerElement2.parent().parent().offset().left;\n                    bannerTop = parseInt($bannerElement2.css('top'), 10);\n                    bannerParentTop = parseInt($bannerElement2.parent().css('top'), 10);\n                    bannerParentParentOffsetTop = $bannerElement2.parent().parent().offset().top;\n                    pendingBannerX = bannerLeft + bannerParentLeft + bannerParentParentOffsetLeft - $measurementOverlay.offset().left;\n                    pendingBannerY = bannerTop + bannerParentTop + bannerParentParentOffsetTop - $measurementOverlay.offset().top;\n                    banner2Bounds = {left: pendingBannerX, top: pendingBannerY, right: pendingBannerX + $bannerElement2.outerWidth(), bottom: pendingBannerY + $bannerElement2.outerHeight()};\n                }\n\n                //And then figure out if the popup intersects with either banner so we know if we need to move it to the top\n                if (MeasurementUtil.boundsIntersect(banner1Bounds, popupBounds) || MeasurementUtil.boundsIntersect(banner2Bounds, popupBounds)) {\n                    //The bounds intersect, so place the popup near the top\n                    popupBounds.top = verticalPadding + $previewView.scrollTop();\n                    popupBounds.bottom = popupBounds.top + this.$el.outerHeight();\n\n                    //Can we put it at the top?\n                    if (MeasurementUtil.boundsIntersect(banner1Bounds, popupBounds) || MeasurementUtil.boundsIntersect(banner2Bounds, popupBounds)) {\n                        //The bounds intersect, so place the popup near the bottom\n                        popupBounds.top = maxY - this.$el.outerHeight() - verticalPadding + $('div.psd-preview-view').scrollTop();\n                        popupBounds.bottom = popupBounds.top + this.$el.outerHeight();\n                    }\n\n                    //TODO - If the bounds intersect at the bottom as well we will need to search for an open space to put the popup\n                }\n            }\n            this.$el.show();\n            this.$el.css({left: popupBounds.left, top: popupBounds.top});\n        },\n\n        getSourceXOffset: function () {\n            return this.layerBounds.left;\n        },\n\n        getSourceYOffset: function () {\n            return this.layerBounds.top;\n        },\n\n        getSourceOuterWidth: function () {\n            return this.layerBounds.right - this.layerBounds.left;\n        },\n\n        getSourceOuterHeight: function () {\n            return this.layerBounds.bottom - this.layerBounds.top;\n        },\n\n        destroy: function () {\n            if (this.extractAssetPopup) {\n                graphite.events.trigger('hide-extract-asset-popup');\n                this.extractAssetPopupParent.append(this.extractAssetPopup);\n                delete this.extractAssetPopupParent;\n                delete this.extractAssetPopup;\n            }\n            graphite.events.off(null, null, this);\n        }\n\n    });\n\n    return MeasurementPopupView;\n});\n\n//# sourceURL=/lib/graphite-api/public/js/ccweb.files.extract/views/popup/MeasurementPopupView.js"),
eval('define(\'text!ccweb.files.extract/views/templates/measurementOffsetsBoxTemplate.html\',[],function () { return \'<div id="measurementOffsetsBox" class="measurementOffsetsBox">\\n    <canvas id="measurementOffsetsCanvas" class="measurementOffsetsCanvas">\\n    </canvas>\\n</div>\';});\n\n//# sourceURL=/text!ccweb.files.extract/views/templates/measurementOffsetsBoxTemplate.html'),eval('define(\'text!ccweb.files.extract/views/templates/measurementOffsetsBannerTemplate.html\',[],function () { return \'<div id="measurementOffsetsBanner" class="measurementOffsetsBanner measurementPopup popup measurementTooltip">\\n    <span id="measurementOffsetX" class="noWrap copyable"><i class="xOffsetIcon"></i>20</span><br/>\\n    <span id="measurementOffsetY" class="noWrap copyable"><i class="yOffsetIcon"></i>200</span>\\n    <div class="notch"></div>\\n</div>\';});\n\n//# sourceURL=/text!ccweb.files.extract/views/templates/measurementOffsetsBannerTemplate.html'),eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013-2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4 */\n/*global define: true, graphite: true*/\n\ndefine('ccweb.files.extract/views/popup/MeasurementOffsetPopupView',[\n    'jquery',\n    'underscore',\n    'backbone',\n    'ccweb.files.extract/Constants',\n    'ccweb.files.extract/views/popup/BasePreviewPopupView',\n    'ccweb.files.extract/controllers/ZoomController',\n    'ccweb.files.extract/controllers/ClipboardController',\n    'ccweb.files.extract/models/UserSettingsModel',\n    'ccweb.files.extract/utils/TemplateUtil',\n    'text!ccweb.files.extract/views/templates/measurementOffsetsBoxTemplate.html',\n    'text!ccweb.files.extract/views/templates/measurementOffsetsBannerTemplate.html'\n], function ($, _, Backbone, Constants, BasePreviewPopupView, ZoomController, ClipboardController, UserSettingsModel,\n             TemplateUtil, MeasurementOffsetsBoxTemplate, MeasurementOffsetsBannerTemplate) {\n\n    'use strict';\n    var instanceId = 0;\n\n    var MeasurementOffsetPopupView = BasePreviewPopupView.extend({\n        id: 0,\n        showParams: null,\n\n        initialize: function () {\n            BasePreviewPopupView.prototype.initialize.apply(this, arguments);\n            this.id = instanceId;\n            instanceId++;\n            graphite.events.on('preferredMeasurementUnitsChanged', this.handlePreferredMeasurementUnitsChanged, this);\n        },\n\n        render: function () {\n            BasePreviewPopupView.prototype.render.apply(this, arguments);\n\n            this.$el.find('.popup-contents').html(\n                TemplateUtil.createTemplate(MeasurementOffsetsBoxTemplate)\n            );\n\n            return this;\n        },\n\n\n        //------------------------------------------------\n        // Handlers\n        //------------------------------------------------\n        handlePreferredMeasurementUnitsChanged: function () {\n            this.updateMeasurementDisplay();\n        },\n\n        handleShowMeasurementInfo: function (params) {\n            this.showParams = $.extend(true, {}, params); //do a deep clone of the params object\n            if (params.bounds) {\n                graphite.events.trigger('show-measurement-offsets');\n\n                var $measurementOffsetsBox = this.$el.find('#measurementOffsetsBox');\n\n                // Account for box-sizing:border-box 1px border\n                var canvasWidth = params.bounds.width - 2;\n                var canvasHeight = params.bounds.height - 2;\n\n                //Show the pre-calculated offsets between two elements\n                //Size the div to the bounds parameter\n                $measurementOffsetsBox.css({'top': params.bounds.top + 'px', 'left': (params.bounds.left) + 'px',\n                                            'height': Math.max(1, canvasHeight), 'width': Math.max(1, canvasWidth)});\n                var $drawingCanvas = this.$el.find('#measurementOffsetsCanvas');\n                $drawingCanvas[0].width = Math.max(1, params.bounds.width);\n                $drawingCanvas[0].height = Math.max(1, params.bounds.height);\n\n                var drawingContext = $drawingCanvas[0].getContext('2d');\n                this.$el.show();\n\n                drawingContext.lineWidth = 1;\n                drawingContext.strokeStyle = '#000';\n                var arrowheadSize = 3;\n\n                var midX = Math.floor(canvasWidth / 2) + 0.5;\n                var midY = Math.floor(canvasHeight / 2) + 0.5;\n\n                drawingContext.moveTo(0, midY);\n\n                //Only draw the horizontal arrow line if there is room for it\n                if (canvasHeight >= 5) {\n                    //Draw the left arrowhead if there is room for it\n                    if (canvasWidth > (arrowheadSize + 3) * 2) {\n                        drawingContext.lineTo(arrowheadSize, midY - arrowheadSize);\n                        drawingContext.stroke();\n                        drawingContext.moveTo(0, midY);\n                        drawingContext.lineTo(arrowheadSize, midY + arrowheadSize);\n                        drawingContext.stroke();\n                        drawingContext.moveTo(0, midY);\n                    }\n\n                    drawingContext.lineTo(canvasWidth, midY);\n                    drawingContext.stroke();\n\n                    //Draw the right arrowhead if there is room for it\n                    if (canvasWidth > (arrowheadSize + 3) * 2) {\n                        drawingContext.lineTo(canvasWidth - arrowheadSize, midY - arrowheadSize);\n                        drawingContext.stroke();\n                        drawingContext.moveTo(canvasWidth, midY);\n                        drawingContext.lineTo(canvasWidth - arrowheadSize, midY + arrowheadSize);\n                        drawingContext.stroke();\n                    }\n                }\n\n                //Only draw the vertical arrow line if there is room for it\n                if (canvasWidth >= 5) {\n                    //Draw the top arrowhead if there is room for it\n                    if (canvasHeight > (arrowheadSize + 3) * 2) {\n                        drawingContext.moveTo(midX, 0);\n                        drawingContext.lineTo(midX - arrowheadSize, arrowheadSize);\n                        drawingContext.stroke();\n                        drawingContext.moveTo(midX, 0);\n                        drawingContext.lineTo(midX + arrowheadSize, arrowheadSize);\n                        drawingContext.stroke();\n                    }\n\n                    drawingContext.moveTo(midX, 0);\n                    drawingContext.lineTo(midX, canvasHeight);\n                    drawingContext.stroke();\n\n                    //Draw the bottom arrowhead if there is room for it\n                    if (canvasHeight > (arrowheadSize + 3) * 2) {\n                        drawingContext.lineTo(midX - arrowheadSize, canvasHeight - arrowheadSize);\n                        drawingContext.stroke();\n                        drawingContext.moveTo(midX, canvasHeight);\n                        drawingContext.lineTo(midX + arrowheadSize, canvasHeight - arrowheadSize);\n                        drawingContext.stroke();\n                    }\n                }\n\n                //Draw the offset info banner with the correct values\n                $measurementOffsetsBox.append(\n                    TemplateUtil.createTemplate(MeasurementOffsetsBannerTemplate)\n                );\n\n                var copyables = this.$el.find('.copyable'),\n                    clipboard = ClipboardController.getClipboard();\n\n                _.each(copyables, function (elem) {\n                    clipboard.clip(elem);\n                });\n\n                this.updateMeasurementDisplay();\n\n                var $banner = this.$el.find('#measurementOffsetsBanner');\n                $banner.click(function (e) {\n                    e.stopPropagation();\n                });\n\n                //Check where the banner box will fit and place it\n                var notch = this.$el.find('.notch');\n                notch.show();\n                var bannerLeft = (canvasWidth - $banner.outerWidth()) / 2;\n                var bannerTop = 0;\n                if ((canvasWidth >= ($banner.outerWidth() + (arrowheadSize + 3) * 2)) &&\n                        (canvasHeight >= ($banner.outerHeight() + (arrowheadSize + 3) * 2))) {\n                    //The banner fits inside, place it in the center of the box\n                    bannerTop = (canvasHeight - $banner.outerHeight()) / 2;\n                    notch.hide();\n                } else {\n                    //Place the banner outside the box, above or below\n                    bannerTop = canvasHeight + 6;\n                    if (bannerTop + $banner.outerHeight() > $('#selection-overlay').height()) {\n                        bannerTop = -$banner.outerHeight() - 6;\n                    }\n                }\n                $banner.css({top: bannerTop + 'px', left: bannerLeft + 'px'});\n\n                //center notch on the popup\n                var notchWidth = 20; //Hardcode the width rather than try to calculate the length of the triangle base\n                var notchx = ($banner.outerWidth() - notchWidth) / 2;\n                notch.css({left: notchx, top: '-6px'});\n            } else {\n                this.closePopup();\n            }\n        },\n\n        updateMeasurementDisplay: function () {\n            var params = $.extend(true, {}, this.showParams),\n                unscaledMeasurements = ZoomController.zoomSize(params.bounds, true),\n                preferredMeasurementUnits = UserSettingsModel.get('preferredMeasurementUnits');\n\n            if (preferredMeasurementUnits === Constants.MeasurementUnitType.PCT) {\n                //Convert the pixel values to percent\n                params.containerBounds.width = params.containerBounds.right - params.containerBounds.left;\n                params.containerBounds.height = params.containerBounds.bottom - params.containerBounds.top;\n                params.containerBounds = ZoomController.zoomSize(params.containerBounds, true);\n                unscaledMeasurements.width = +(unscaledMeasurements.width/params.containerBounds.width * 100).toFixed(1);\n                unscaledMeasurements.height = +(unscaledMeasurements.height/params.containerBounds.height * 100).toFixed(1);\n            } else {\n                unscaledMeasurements.width = Math.round(unscaledMeasurements.width);\n                unscaledMeasurements.height = Math.round(unscaledMeasurements.height);\n            }\n\n            this.$el.find('#measurementOffsetX').html('<i class=\"xOffsetIcon\"></i>' + unscaledMeasurements.width + preferredMeasurementUnits);\n            this.$el.find('#measurementOffsetY').html('<i class=\"yOffsetIcon\"></i>' + unscaledMeasurements.height + preferredMeasurementUnits);\n        }\n\n    });\n\n    return MeasurementOffsetPopupView;\n});\n\n//# sourceURL=/lib/graphite-api/public/js/ccweb.files.extract/views/popup/MeasurementOffsetPopupView.js"),eval("define('text!ccweb.files.extract/views/templates/measurementOverlayTemplate.html',[],function () { return '<div id=\"measurementOverlay\"></div>';});\n\n//# sourceURL=/text!ccweb.files.extract/views/templates/measurementOverlayTemplate.html"),eval('define(\'text!ccweb.files.extract/views/templates/measurementTooltipTemplate.html\',[],function () { return \'<div id="measurementTooltipInfo" class="measurementTooltip">\\n    <div class="measurementElementInfoDim">W: 0 <br/>H: 0</div>\\n    <div class="measurementElementInfoPos">X: 0 <br/>Y: 0</div>\\n</div>\';});\n\n//# sourceURL=/text!ccweb.files.extract/views/templates/measurementTooltipTemplate.html'),eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013-2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4 */\n/*global define: true, graphite: true*/\n\ndefine('ccweb.files.extract/views/preview/MeasurementOverlayView',[\n    'jquery',\n    'underscore',\n    'backbone',\n    'plugin-dependencies',\n    'ccweb.files.extract/Constants',\n    'ccweb.files.extract/utils/TemplateUtil',\n    'ccweb.files.extract/utils/MeasurementUtil',\n    'ccweb.files.extract/controllers/SelectionController',\n    'ccweb.files.extract/controllers/DetailsController',\n    'ccweb.files.extract/controllers/ZoomController',\n    'ccweb.files.extract/views/popup/MeasurementPopupView',\n    'ccweb.files.extract/views/popup/MeasurementOffsetPopupView',\n    'text!ccweb.files.extract/views/templates/measurementOverlayTemplate.html',\n    'text!ccweb.files.extract/views/templates/measurementTooltipTemplate.html'\n], function ($, _, Backbone, deps, Constants, TemplateUtil, MeasurementUtil, SelectionController,\n        DetailsController, ZoomController, MeasurementPopupView, MeasurementOffsetPopupView,\n        MeasurementOverlayTemplate, MeasurementTooltipTemplate) {\n\n    'use strict';\n    var MeasurementOverlayView = Backbone.View.extend({\n        measurementTooltip: null,\n        mouseOverElement: null,\n\n        initialize: function () {\n            _.bindAll(this, 'handleMouseMove', 'handleMouseLeave');\n            this.measurementTooltip = null;\n            this.mouseOverElement = null;\n            this.bShowMeasurementOnHover = false;\n            this.render();\n        },\n\n        render: function () {\n            this.setElement(TemplateUtil.createTemplate(MeasurementOverlayTemplate));\n            var tooltip = TemplateUtil.createTemplate(MeasurementTooltipTemplate);\n            this.$el.append($(tooltip));\n            this.measurementTooltip = this.$el.find('#measurementTooltipInfo');\n            this.measurementTooltip.hide();\n        },\n\n        addHandlers: function () {\n            this.$el.on('mousemove', this.handleMouseMove);\n            this.$el.on('mouseleave', this.handleMouseLeave);\n            graphite.events.on('selection-changed', this.refreshSelection, this);\n            graphite.events.on('zoomChanged', this.refreshSelection, this);\n            graphite.events.on('toggle-hover-measurement', this.toggleHoverMeasurement, this);\n        },\n\n        //------------------------------------------------\n        // Handlers\n        //------------------------------------------------\n        handleMouseMove: function (event) {\n            var itemMousedOver,\n                itemArray,\n                curX = event.clientX + $(document).scrollLeft(),\n                curY = event.clientY + $(document).scrollTop();\n\n            this.lastMouseX = curX;\n            this.lastMouseY = curY;\n\n            if (DetailsController.get('activeTool') !== Constants.Tool.SELECT_DIRECT) {\n                return;\n            }\n\n            //check if measurement bShowMeasurementOnHover is on or off\n            if (!this.bShowMeasurementOnHover) {\n                $('#selection-overlay').find('.hover').remove();\n                if ($(event.target).is(this.$el)) {\n                    itemMousedOver = SelectionController.itemAtPoint(curX, curY);\n\n                    //Only trigger a hover event if we actually have a new item\n                    itemArray = (itemMousedOver && !this.isItemSelected(itemMousedOver)) ? [itemMousedOver] : [];\n                    graphite.events.trigger('item-hovered-over', itemArray, true);\n                    this.measurementTooltip.hide();\n                } else {\n                    graphite.events.trigger('item-hovered-over', [], true);\n                }\n                return;\n            }\n\n            // Hide if not hovering over preview elements.\n            if (!$(event.target).is(this.$el) &&\n                    !$(event.target).is(this.measurementTooltip) &&\n                    this.measurementTooltip.find($(event.target)).length === 0) {\n                this.measurementTooltip.hide();\n                return;\n            }\n\n            this.syncMeasurementTooltip(this.lastMouseX, this.lastMouseY);\n        },\n\n        handleMouseLeave: function () {\n            this.measurementTooltip.hide();\n            graphite.events.trigger('item-hovered-over', [], true);\n        },\n\n        positionMeasurementTooltip: function (x, y) {\n            var overlayOffset = this.$el.offset(),\n                tooltipWidth = this.measurementTooltip.width(),\n                tooltipX = Math.min(x - overlayOffset.left + 3, this.$el.width() - tooltipWidth,\n                    $('#detail-panel').offset().left - tooltipWidth - overlayOffset.left),\n                tooltipY = Math.max(y - overlayOffset.top - 50, 0);\n            this.measurementTooltip.css({left: tooltipX, top: tooltipY, width: tooltipWidth + 1 + 'px'});\n        },\n\n        syncMeasurementTooltip: function (x, y) {\n            var itemMousedOver = SelectionController.itemAtPoint(x, y);\n            if (itemMousedOver) {\n                this.measurementTooltip.css({left: 0, top: 0, width: 'auto'}); //Move the tooltip to give it room to resize if needed\n\n                if (itemMousedOver !== this.mouseOverElement) {\n                    //Only set the tooltip info for the current item if we actually have a new item\n                    this.mouseOverElement = itemMousedOver;\n                    var bounds = MeasurementUtil.getMeasurementsOfLayerAgainstPSDBounds(itemMousedOver);\n                    this.measurementTooltip.find('.measurementElementInfoDim').html('W: ' + bounds.displayWidth + '<br/> H: ' + bounds.displayHeight);\n                    this.measurementTooltip.find('.measurementElementInfoPos').html('X: ' + bounds.left + 'px' + '<br/> Y: ' + bounds.top + 'px');\n\n                    //Only trigger a hover event if we actually have a new item\n                    graphite.events.trigger('item-hovered-over', [itemMousedOver], true);\n                }\n\n                //Position the tooltip properly\n                this.positionMeasurementTooltip(x, y);\n                this.measurementTooltip.show();\n            } else {\n                //We're not hovering over any items\n                this.measurementTooltip.hide();\n            }\n        },\n\n        refreshSelection: function () {\n            var selectionList = SelectionController.getSelectedLayers(),\n                PSDModel = SelectionController.getPSDModel(),\n                measurementPopup,\n                measurementOffsetPopup,\n                layerModel,\n                rectBounds;\n\n            // Nuke all the measurement overlay children except our measurement tooltip.\n            if (this.measurementPopupView) {\n                this.measurementPopupView.destroy();\n            }\n            this.$el.children().remove();\n            this.$el.append(this.measurementTooltip);\n\n            if (selectionList.length === 1) {\n                //Show the measurement popup\n                layerModel = selectionList[0];\n                measurementPopup = new MeasurementPopupView();\n                this.measurementPopupView = measurementPopup;\n                this.$el.append(measurementPopup.el);\n                measurementPopup.handleShowMeasurementInfo({layerModel: layerModel});\n            } else if (selectionList.length === 2) {\n                var bounds1 = MeasurementUtil.getVisibleBounds(selectionList[0], PSDModel);\n                bounds1 = ZoomController.zoomRect(bounds1);\n                var bounds2 = MeasurementUtil.getVisibleBounds(selectionList[1], PSDModel);\n                bounds2 = ZoomController.zoomRect(bounds2);\n\n                var containerBounds;\n                if (MeasurementUtil.rect1ContainsRect2(bounds1, bounds2)) {\n                    containerBounds = bounds1;\n                } else if (MeasurementUtil.rect1ContainsRect2(bounds2, bounds1)) {\n                    containerBounds = bounds2;\n                } else {\n                    //if neither container is inside the other, the 'container' for measurements is the whole PSD\n                    containerBounds = PSDModel.get('imgdata').bounds;\n                    containerBounds = ZoomController.zoomRect(containerBounds);\n                }\n\n                //Calculate the measurement rect bounds\n                rectBounds = {top: 0, left: 0, height: 100, width: 100};\n                if (bounds1.top >= bounds2.bottom) {\n                    rectBounds.top = bounds2.bottom;\n                    rectBounds.height = bounds1.top - bounds2.bottom;\n                } else if (bounds2.top >= bounds1.bottom) {\n                    rectBounds.top = bounds1.bottom;\n                    rectBounds.height = bounds2.top - bounds1.bottom;\n                } else {\n                    rectBounds.top = Math.min(bounds1.top, bounds2.top);\n                    rectBounds.height = Math.abs(bounds1.top - bounds2.top);\n                }\n\n                if (bounds1.left > bounds2.right) {\n                    rectBounds.left = bounds2.right;\n                    rectBounds.width = bounds1.left - bounds2.right;\n                } else if (bounds2.left > bounds1.right) {\n                    rectBounds.left = bounds1.right;\n                    rectBounds.width = bounds2.left - bounds1.right;\n                } else {\n                    rectBounds.left = Math.min(bounds1.left, bounds2.left);\n                    rectBounds.width = Math.abs(bounds1.left - bounds2.left);\n                }\n\n                //Show the measurement offsets in a popup\n                measurementOffsetPopup = new MeasurementOffsetPopupView();\n                this.$el.append(measurementOffsetPopup.el);\n                measurementOffsetPopup.handleShowMeasurementInfo({bounds: rectBounds, containerBounds: containerBounds});\n\n                //If one rect is fully contained within the other also show measurements from bottom right corner to bottom right corner\n                if (MeasurementUtil.rect1ContainsRect2(bounds1, bounds2) || MeasurementUtil.rect1ContainsRect2(bounds2, bounds1)) {\n                    rectBounds.left = Math.min(bounds1.right, bounds2.right);\n                    rectBounds.width = Math.abs(bounds1.right - bounds2.right);\n                    rectBounds.top = Math.min(bounds1.bottom, bounds2.bottom);\n                    rectBounds.height = Math.abs(bounds1.bottom - bounds2.bottom);\n\n                    //Show the measurement rect after making sure width & height aren't 0\n                    rectBounds.height = Math.max(1, rectBounds.height);\n                    rectBounds.width = Math.max(1, rectBounds.width);\n\n                    //Show the measurement offsets in a popup\n                    measurementOffsetPopup = new MeasurementOffsetPopupView();\n                    this.$el.append(measurementOffsetPopup.el);\n                    measurementOffsetPopup.handleShowMeasurementInfo({bounds: rectBounds, containerBounds: containerBounds});\n                }\n            }\n\n            if (selectionList.length >= 2) {\n                measurementPopup = new MeasurementPopupView();\n                this.measurementPopupView = measurementPopup;\n                this.$el.append(measurementPopup.el);\n                measurementPopup.handleShowMeasurementInfo({layerList: selectionList});\n            }\n        },\n\n        toggleHoverMeasurement: function () {\n            this.bShowMeasurementOnHover = !this.bShowMeasurementOnHover;\n            this.syncMeasurementTooltip(this.lastMouseX, this.lastMouseY);\n            this.measurementTooltip.toggle(this.bShowMeasurementOnHover);\n        },\n\n        removeEventListeners: function () {\n            graphite.events.off(null, null, this);\n        },\n\n        remove: function () {\n            this.removeEventListeners();\n            return Backbone.View.prototype.remove.call(this);\n        },\n\n        //------------------------------------------------\n        // Helpers\n        //------------------------------------------------\n\n        isItemSelected: function (item) {\n            var id, layerModel;\n            //Draw the selection box around selected layers\n            for (id in SelectionController.selectionMap) {\n                if (SelectionController.selectionMap.hasOwnProperty(id)) {\n                    layerModel = SelectionController.selectionMap[id];\n                    if (item === layerModel) {\n                        return true;\n                    }\n                }\n            }\n            return false;\n        }\n\n    });\n\n    return MeasurementOverlayView;\n\n});\n\n//# sourceURL=/lib/graphite-api/public/js/ccweb.files.extract/views/preview/MeasurementOverlayView.js"),eval('define(\'text!ccweb.files.extract/views/templates/lensTemplate.html\',[],function () { return \'<div class="lens" style="display: none;">\\n    <div class="inner">\\n        <canvas class="lens-grid" width="70" height="70"></canvas>\\n        <div class="center"></div>\\n    </div>\\n</div>\';});\n\n//# sourceURL=/text!ccweb.files.extract/views/templates/lensTemplate.html'),eval('define(\'text!ccweb.files.extract/views/templates/workerProgressTemplate.html\',[],function () { return \'<div id="workerProgress">\\n    <div class="worker-status">Processing...</div>\\n    <div class="worker-progress-base"><div class="worker-progress-bar"></div></div>\\n    <div class="worker-status-tip"><%- tip %></div>\\n</div>\';});\n\n//# sourceURL=/text!ccweb.files.extract/views/templates/workerProgressTemplate.html'),eval('define(\'text!ccweb.files.extract/views/templates/psdPreviewTemplate.html\',[],function () { return \'<% var w = width || imgdata.bounds.right; %>\\n<% var h = height || imgdata.bounds.bottom; %>\\n<div class="center-helper" style="margin-bottom: <%- -(h/2 + 50)%>px;"></div>\\n<div class="preview-container" style="width: <%- w %>px; height: <%- h %>px;">\\n    <div style="width: <%- w %>px; height: <%- h %>px;" id="psdpreview_root"></div>\\n    <% if (localContent || layerCompId) { %>\\n    <img style="width: <%- w %>px; height: <%- h %>px;" id="tempPreview" class="tempPreview">\\n    <% } else { %>\\n    <img style="width: <%- w %>px; height: <%- h %>px;" id="tempPreview" class="tempPreview">\\n    <% } %>\\n    <div id="selection-overlay" style=" width: <%- w %>px; height: <%- h %>px;"></div>\\n</div>\\n<div class="spinner"></div>\';});\n\n//# sourceURL=/text!ccweb.files.extract/views/templates/psdPreviewTemplate.html'),eval('define(\'text!ccweb.files.extract/views/templates/psdPreviewDivTemplate.html\',[],function () { return \'<div class="psd-layer-group" style="top: <%= bounds.top %>px; left: <%= bounds.left %>px; bottom: <%= bounds.bottom %>px; right: <%= bounds.right %>px;" >\\n    <canvas class="psd-layer-group preview"  ></canvas>\\n</div>\';});\n\n//# sourceURL=/text!ccweb.files.extract/views/templates/psdPreviewDivTemplate.html'),eval("define('text!ccweb.files.extract/views/templates/psdPreviewDivSpriteSheetTemplate.html',[],function () { return '<div class=\"psd-layer-group\" style=\"top: <%= bounds.top %>px; left: <%= bounds.left %>px; bottom: <%= bounds.bottom %>px; right: <%= bounds.right %>px;\" ></div>';});\n\n//# sourceURL=/text!ccweb.files.extract/views/templates/psdPreviewDivSpriteSheetTemplate.html"),eval("define('text!ccweb.files.extract/views/templates/psdPreviewLayerTemplate.html',[],function () { return '<canvas class=\"psd-layer\" style=\"top: <%= bounds.top %>px; left: <%= bounds.left %>px;\" ></canvas>';});\n\n//# sourceURL=/text!ccweb.files.extract/views/templates/psdPreviewLayerTemplate.html"),eval('define(\'text!ccweb.files.extract/views/templates/errorNotificationTemplate.html\',[],function () { return \'<div class="error-notification">\\n    <div class="centered-wrapper">\\n        <div class="error-icon"></div>\\n        <div class="error-msg"><%= messageText %></div>\\n    </div>\\n</div>\';});\n\n//# sourceURL=/text!ccweb.files.extract/views/templates/errorNotificationTemplate.html'),eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4 */\n/*global define: true, graphite: true, require: true*/\ndefine('plugin-components/image-loader',[],\n    function () {\n        \"use strict\";\n        return null;\n    }\n    );\n//# sourceURL=/lib/graphite-api/public/js/libs/pluginshim/image-loader.js"),eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013-2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4 */\n/*global define: true, graphite: true, Image: true, window:true, setTimeout: true */\n\ndefine('ccweb.files.extract/views/preview/PSDPreviewView',[\n    'jquery',\n    'underscore',\n    'backbone',\n    'ccweb.files.extract/Constants',\n    'ccweb.files.extract/controllers/SelectionController',\n    'ccweb.files.extract/controllers/DetailsController',\n    'ccweb.files.extract/controllers/ZoomController',\n    'ccweb.files.extract/controllers/FlattenedAssetController',\n    'ccweb.files.extract/models/LayerModelMap',\n    'ccweb.files.extract/utils/KeyboardUtils',\n    'ccweb.files.extract/views/preview/InspectStyleOverlayView',\n    'ccweb.files.extract/views/preview/SelectionOverlayView',\n    'ccweb.files.extract/views/preview/MeasurementOverlayView',\n    'ccweb.files.extract/utils/MeasurementUtil',\n    'ccweb.files.extract/utils/TemplateUtil',\n    'text!ccweb.files.extract/views/templates/lensTemplate.html',\n    'text!ccweb.files.extract/views/templates/workerProgressTemplate.html',\n    'text!ccweb.files.extract/views/templates/psdPreviewTemplate.html',\n    'text!ccweb.files.extract/views/templates/psdPreviewDivTemplate.html',\n    'text!ccweb.files.extract/views/templates/psdPreviewDivSpriteSheetTemplate.html',\n    'text!ccweb.files.extract/views/templates/psdPreviewLayerTemplate.html',\n    'text!ccweb.files.extract/views/templates/errorNotificationTemplate.html',\n    'plugin-dependencies',\n    'plugin-components/image-loader'\n], function ($, _, Backbone, Constants, SelectionController, DetailsController,\n    ZoomController, FlattenedAssetController, LayerModelMap, KeyboardUtils,\n    InspectStyleOverlayView, SelectionOverlayView, MeasurementOverlayView,\n    MeasurementUtil, TemplateUtil, LensTemplate, WorkerProgressTemplate, PSDPreviewTemplate,\n    PSDPreviewDivTemplate, PSDPreviewDivSpriteSheetTemplate, PSDPreviewLayerTemplate, ErrorNotificationTemplate,\n    deps, imageLoader) {\n    'use strict';\n    var PSDPreviewView = Backbone.View.extend({\n        className: 'psd-preview-view',\n        events: {\n            'click': 'handleClickEvent',\n            'mousedown': 'handleMouseDownEvent',\n            'mouseup': 'handleMouseUpEvent',\n            'dblclick': 'handleDoubleClickEvent'\n        },\n\n        isClickDrag: false,\n        extractionStartTime: null,\n        divTemplateId: null,\n        selectionOverlay: null,\n        inspectStyleOverlay: null,\n        measurementOverlay: null,\n        extractTooltip: null,\n\n        initialize: function () {\n            _.bindAll(this, 'hideTempPreview', 'attached', '_previewImageDataReceived');\n\n            this.addHandlers();\n            this.renderProgressPane();\n\n            this.$defocused = $('<div class=\"defocused\"></div>');\n\n            this.model.on('change:info', this.handleModelInfoChanged, this);\n            this.model.on('change:extractedStyles', this.handleExtractedStylesChanged, this);\n            this.model.on('change:status', this.handleStatusChanged, this);\n\n            this.handleStatusChanged();\n        },\n\n        // Post DOM initialization\n        attached: function () {\n            // Only bootstrap component parts if we haven't already.\n            if (!this.measurementOverlay) {\n                if (this.model.get('info')) {\n                    this.handleModelInfoChanged();\n                } else {\n                    // Render our place holder early if we have the requisite bounds while\n                    // we await our model info. For now we fake image bounds until the real\n                    // data arrives.\n                    if (this.model.get('width') && this.model.get('height')) {\n                        var bounds = this.model.get('imgdata').bounds;\n                        this.renderContainer();\n                        bounds.bottom = this.model.get('height');\n                        bounds.right = this.model.get('width');\n                        graphite.events.trigger('zoomToFit');\n                        this.applyCurrentZoomLevel(true);\n                    }\n                }\n                if (this.model.get('extractedStyles')) {\n                    this.handleExtractedStylesChanged();\n                }\n            }\n        },\n\n        handleStatusChanged: function () {\n            var status = this.model.get('status');\n            if (status < 200) {\n                // new/pending\n                this.renderSpinner();\n            } else if (status >= 400) {\n                // normally, it goes away after spritesheet load. But in case of error we have to do it\n                $('.preview-loading-spinner').remove();\n            }\n        },\n\n        handleModelInfoChanged: function () {\n            // simple test to determine if spritesheets are available\n            var hasSpriteSheets = false,\n                version = this.model.get('info').version,\n                versionParts;\n\n            if (version) {\n                versionParts = version.split('.');\n                if (versionParts.length > 2 && (parseInt(versionParts[0], 10) > 0 || parseInt(versionParts[1], 10) >= 7)) {\n                    hasSpriteSheets = true;\n                    // Remove the canvas from the divTemplate we don't need it when using sprite sheets\n                    this.divTemplateId = PSDPreviewDivSpriteSheetTemplate;\n                } else {\n                    this.divTemplateId = PSDPreviewDivTemplate;\n                }\n                this.hasSpriteSheets = hasSpriteSheets;\n\n                graphite.events.trigger('psdModelInfoChanged');\n                this.render();\n            }\n        },\n\n        handleExtractedStylesChanged: function () {\n            this.addLayerSpritesBackToFront(this.model);\n            this.model.set('renderedSprites', true);\n            DetailsController.triggerWhenSpriteSheetsLoaded('drawPreviewFinish');\n        },\n\n        render: function () {\n            this.renderContainer();\n\n            this.inspectStyleOverlay = new InspectStyleOverlayView({model: this.model});\n            this.selectionOverlay = new SelectionOverlayView({parentView: this});\n            this.measurementOverlay = new MeasurementOverlayView({model: this.model});\n            this.$psdLens = $(TemplateUtil.createTemplate(LensTemplate));\n\n            this.$el.find('.preview-container').append(this.inspectStyleOverlay.el);\n            this.$el.find('.preview-container').append(this.measurementOverlay.el);\n\n            graphite.events.trigger('zoomToFit');\n            this.applyCurrentZoomLevel(true);\n            this.measurementOverlay.addHandlers();\n            return this;\n        },\n\n        renderSpinner: function () {\n            this.$el.append('<div class=\"spinner preview-loading-spinner\" style=\"display:block;\"></div>');\n        },\n\n        renderProgressPane: function () {\n            var tips = [\n                deps.translate('Use shift-click to measure the distance between elements in the PSD view.'),\n                deps.translate('After extracting assets, find them in the Assets tab where they can be downloaded locally.'),\n                deps.translate('Select a color swatch in the Styles tab to see where the color is used in your design.'),\n                deps.translate('You can select multiple layers in the Layers tab and export them as a single image.'),\n                deps.translate('Select layer comps with the drop down above the PSD view.'),\n                deps.translate('Zoom in and out on your PSD view using ALT +/-.'),\n                deps.translate('Use the arrow keys to traverse the layers in your design.'),\n                deps.translate('Hover over thumbnails in the Layers tab to see a preview for a layer or layer group.')\n            ];\n\n            this.$progressPane = $(TemplateUtil.createTemplate(WorkerProgressTemplate,\n                {tip: deps.translate('Tip: ') + tips[Math.round(Math.random() * (tips.length - 1))]}));\n            this.$progressPane.hide();\n            this.$el.append(this.$progressPane);\n        },\n\n        renderContainer: function () {\n            if (this.$el.find('.preview-container').length === 0) {\n                this.$el.append(TemplateUtil.createTemplate(PSDPreviewTemplate,\n                    _.defaults(this.model.toJSON(), {width: 0, height: 0})));\n                this.$tempPreview = this.$el.find('#tempPreview');\n                this._loadPreviewImage();\n            }\n        },\n\n        showProgressPane: function (workerGuid) {\n            if (!this.workerProgressShown) {\n                $('.psd-preview-view').addClass('worker-progress-shown');\n                $('.worker-status').text(deps.translate('Processing') + ' 0%...');\n                $('.worker-progress-bar').css('width', 0);\n                this.$progressPane.show();\n                this.workerProgressShown = true;\n            }\n            this.workerGuid = workerGuid;\n        },\n\n        hideProgressPane: function (workerGuid) {\n            if (workerGuid === -1 || this.workerGuid === workerGuid) {\n                $('.psd-preview-view').removeClass('worker-progress-shown');\n                $('.worker-status').text(deps.translate('Processing') + ' 100%');\n                $('.worker-progress-bar').width('100%');\n                this.$progressPane.fadeOut(300);\n                this.workerProgressShown = false;\n                this.workerGuid = null;\n            }\n        },\n\n        updateProgressPane: function (workerGuid, status, progress) {\n            var msg,\n                complete;\n            \n            if (!this.workerProgressShown && workerGuid === this.model.get('id')) {\n                this.showProgressPane(workerGuid);\n            }\n            \n            if (this.workerGuid === workerGuid) {\n                if (status === 'queued') {\n                    msg = deps.translate('Job queued...');\n                    $('.worker-progress-bar').width(0);\n                } else {\n                    complete = (!isNaN(progress) ? Math.round(progress) : 0) + '%';\n                    msg = deps.translate('Processing') + ' ' + complete + '...';\n                    $('.worker-progress-bar').width(complete);\n                }\n                $('.worker-status').text(msg);\n            }\n        },\n\n        addHandlers: function () {\n            graphite.events.on('drawPreviewFinish', this.hideTempPreview, this);\n            graphite.events.on('zoomChanged', this.applyCurrentZoomLevel, this);\n            graphite.events.on('flattenedSpriteUpdated', this.updateFlattenedLayers, this);\n            graphite.events.on('layerCompChanging', this.layerCompChanging, this);\n            graphite.events.on('showWorkerProgress', this.showProgressPane, this);\n            graphite.events.on('hideWorkerProgress', this.hideProgressPane, this);\n            graphite.events.on('updateWorkerProgress', this.updateProgressPane, this);\n            graphite.events.on('jsonExtractionFailure', this.handleJSONExtractionFailure, this);\n            graphite.events.on('dropperStart', this.handleDropperStart, this);\n            graphite.events.on('dropperStop', this.handleDropperStop, this);\n            graphite.events.on('extract-asset-download-init', this.handleAssetExtractInit, this);\n            graphite.events.on('assetExtracted', this.handleAssetExtracted, this);\n            graphite.events.on('assetExtractionFailure', this.handleAssetExtracted, this);\n            graphite.events.on('multiSelectPending', this.handleMultiSelectPending, this);\n            graphite.events.on('selection-changed', this.handleSelectionChanged, this);\n        },\n\n        isItemSelected: function (item) {\n            var id, layerModel;\n            //Draw the selection box around selected layers\n            for (id in SelectionController.selectionMap) {\n                if (SelectionController.selectionMap.hasOwnProperty(id)) {\n                    layerModel = SelectionController.selectionMap[id];\n                    if (item === layerModel) {\n                        return true;\n                    }\n                }\n            }\n            return false;\n        },\n\n\n        //These are the layers that could be light boxed from the summary view\n        getPriorityLayers: function () {\n            var typeArrays = [],\n                typeArray,\n                type,\n                layers,\n                retMap = {},\n                i,\n                j,\n                k;\n            typeArrays.push(this.model.get('extractedStyles').colors);\n            typeArrays.push(this.model.get('extractedStyles').textStyles);\n            typeArrays.push(this.model.get('extractedStyles').gradients);\n\n            for (i = 0; i < typeArrays.length; i++) {\n                typeArray = typeArrays[i];\n                for (k = 0; k < typeArray.length; k++) {\n                    type = typeArray[k];\n                    layers = type.get('layers');\n                    for (j = 0; j < layers.length; j++) {\n                        retMap[layers[j].get('layerId')] = true;\n                    }\n                }\n            }\n\n            return retMap;\n        },\n\n        addLayerSpritesBackToFront: function (model) {\n            var queue = [],\n                currentModel = model,\n                parentModel,\n                childTmplId,\n                childElem,\n                flattenedElem,\n                bounds,\n                previewRoot = this.$el.find('#psdpreview_root'),\n                parentContainer,\n                zIndex = 0,\n                isGroup,\n                specialLayers = this.getPriorityLayers(),\n                layerCollection;\n\n            while (currentModel) {\n                isGroup = currentModel.get('type') === Constants.Type.LAYER_GROUP;\n                parentModel = currentModel.get('parentModel');\n                if (parentModel) {\n                    childTmplId = isGroup ? this.divTemplateId : PSDPreviewLayerTemplate;\n                    childElem = $(TemplateUtil.createTemplate(childTmplId, currentModel.toJSON()));\n                    flattenedElem = null;\n                    bounds = currentModel.get('bounds');\n                    MeasurementUtil.setLayerBounds(childElem, false, currentModel, parentModel, SelectionController);\n\n                    childElem.attr('id', 'layer' + currentModel.get('layerId'));\n\n                    if (currentModel.isVisibleOnStage()) {\n                        childElem.show();\n                    } else {\n                        childElem.hide();\n                    }\n\n                    parentContainer = LayerModelMap.getLayerInfoForId(parentModel.get('layerId')) ?\n                            LayerModelMap.getLayerInfoForId(parentModel.get('layerId')).item : null;\n                    if (!parentContainer) {\n                        parentContainer = previewRoot;\n                    }\n\n                    if (currentModel.get('flattenedSprite')) {\n                        flattenedElem = $(TemplateUtil.createTemplate(PSDPreviewLayerTemplate, currentModel.toJSON()));\n                        flattenedElem.attr('id', 'flattenedLayer' + currentModel.get('layerId'));\n                        var curBounds = MeasurementUtil.setLayerBounds(flattenedElem, true, currentModel, parentModel, SelectionController);\n                        parentContainer.append(flattenedElem);\n                        FlattenedAssetController.applyParentAndPosition(currentModel, curBounds,\n                                flattenedElem, currentModel.get('flattenedSprite'), this.model);\n                        if (!isGroup) {\n                            childElem.css('visibility', 'hidden');\n                        }\n                    } else if (currentModel.get('flattenedParent')) {\n                        //Hide the layer if it's involved in a blend mode\n                        childElem.css('visibility', 'hidden');\n                    }\n\n                    LayerModelMap.addLayerToMap(currentModel.get('layerId'), childElem, flattenedElem, currentModel);\n\n                    if (this.hasSpriteSheets) {\n                        // Load our flattened sprite representation.\n                        if (flattenedElem) {\n                            this.loadSpriteSheet(flattenedElem, currentModel, currentModel.get('flattenedSprite'), true);\n                        }\n\n                        // Also load our single sprite representation (if not a layer set)\n                        if (!isGroup) {\n                            this.loadSpriteSheet(childElem, currentModel, currentModel.get('spriteSheet'));\n                        } else {\n                            if (currentModel.get('properties') && currentModel.get('properties').get('blendOptions')) {\n                                var blendOptions = currentModel.get('properties').get('blendOptions'),\n                                    opacity = (blendOptions.opacity || 100) / 100,\n                                    fillOpacity = (blendOptions.fillOpacity || 100) / 100;\n                                childElem.css('opacity', opacity * fillOpacity);\n                            }\n                        }\n                    } else {\n                        if (!parentContainer) {\n                            this.loadImage(currentModel, bounds, true);\n                        } else if (parentContainer.parentsUntil(previewRoot).length === 0 ||\n                                specialLayers[currentModel.get('layerId')]) {\n                            this.loadImage(currentModel, bounds, false);\n                        }\n                    }\n                    parentContainer.append(childElem);\n\n                    this.addEventHandlers(currentModel, parentContainer, previewRoot);\n                }\n\n                layerCollection = currentModel.get('layerCollection');\n                if (layerCollection) {\n                    /*jshint loopfunc: true */\n                    layerCollection.each(function (layerModel) {\n                        layerModel.set('parentModel', currentModel);\n                        layerModel.set('zIndex', zIndex);\n                        zIndex++;\n                        queue.push(layerModel);\n                    });\n                    /*jshint loopfunc: false */\n                }\n                currentModel = queue.shift();\n            }\n        },\n\n\n        loadImage: function (currentModel, bounds, display) {\n            if ((bounds.right !== bounds.left) && (bounds.top !== bounds.bottom)) {\n                var image = new Image();\n                // DPO - I suspect this is never used because it referred to an API that no longer exists. Updating anyway.\n                var imgURL = graphite.serverAPI.getLayerURL(this.model.id, currentModel.get('layerId'));\n                image.title = currentModel.get('layerId');\n                image.addEventListener('load', function () {\n                    var elem = LayerModelMap.getLayerInfoForId(this.title).item;\n                    if (currentModel.get('type') === Constants.Type.LAYER_GROUP) {\n                        elem = elem.children().first();\n                    }\n                    var context = elem[0].getContext('2d');\n                    context.drawImage(this, 0, 0);\n                    if (!display) {\n                        elem.css('display', 'none');\n                    }\n                    currentModel.set('rendered', true);\n                }, false);\n                graphite.serverAPI.loadCrossDomainImage(image, imgURL);\n            }\n        },\n\n\n        loadSpriteSheet: function (element, currentModel, spriteSheet, isSpriteElem) {\n            var isGroup = currentModel.get('type') === Constants.Type.LAYER_GROUP,\n                isFlattenedSprite = currentModel.get('flattenedSprite');\n\n            // We don't draw layer groups in the preview view\n            if ((spriteSheet === undefined) || (isGroup && !isFlattenedSprite)) {\n                return;\n            }\n\n            if (spriteSheet.sheetID) {\n                DetailsController.drawSpriteSheet(spriteSheet.sheetID, this.drawSprite(element, currentModel, isSpriteElem));\n            } else if (spriteSheet.color) {\n                this.drawRectangle(currentModel, spriteSheet.color, spriteSheet.opacity);\n            }\n        },\n\n        drawSprite: function ($element, model, isSpriteElem) {\n            return function (image) {\n                var context = $element[0].getContext('2d'),\n                    flattenedSprite = model.get('flattenedSprite'),\n                    bounds = isSpriteElem && flattenedSprite ?\n                            flattenedSprite.bounds : model.get('spriteSheet').bounds,\n                    width = bounds.right - bounds.left,\n                    height = bounds.bottom - bounds.top;\n\n                context.drawImage(image, bounds.left, bounds.top,\n                    width, height, 0, 0, width, height);\n            };\n        },\n\n        drawRectangle: function (model, color, opacity) {\n            var elem = LayerModelMap.getLayerInfoForId(model.get('layerId')).item;\n            var bounds = model.get('bounds');\n            var context = elem[0].getContext('2d');\n\n            context.globalAlpha = opacity / 255;\n            context.beginPath();\n            context.rect(0, 0, bounds.right - bounds.left, bounds.bottom - bounds.top);\n            context.fillStyle = 'rgb(' + color.red + ',' + color.green + ',' + color.blue + ')';\n            context.fill();\n        },\n\n\n        addEventHandlers: function (currentItem, parentContainer, previewRoot) {\n            var self = this;\n            currentItem.on('change:visible', function () {\n                self.layerVisibilityChanged(this);\n            });\n\n            currentItem.on('focus', function () {\n                if (previewRoot.find(self.$defocused).length === 0) {\n                    previewRoot.append(self.$defocused);\n                }\n                var layerId = '#layer' + this.get('layerId');\n                parentContainer.find(layerId).addClass('focused');\n\n                self.groupExpanded(this);\n            });\n        },\n\n\n        groupExpanded: function (layerGroup) {\n            this.refreshVisibilityForFocus(layerGroup);\n            var parent = layerGroup.get('parentModel');\n            if (!parent.get('info')) {\n                this.groupExpanded(parent);\n            }\n        },\n\n        refreshVisibilityForFocus: function (layerModel) {\n            if (layerModel.get('type') !== Constants.Type.LAYER_GROUP) {\n                this.refreshVisibilityForItem(layerModel);\n            } else {\n                var layerCollection = layerModel.get('layerCollection');\n                var self = this;\n                if (layerCollection) {\n                    layerCollection.each(function (model) {\n                        self.refreshVisibilityForItem(model);\n                    });\n                }\n\n                if (!this.hasSpriteSheets) {\n                    var layerElem = LayerModelMap.getLayerInfoForId(layerModel.get('layerId')).item;\n                    if (layerElem) {\n                        layerElem.children().first().hide();\n                    }\n                }\n            }\n        },\n\n        refreshVisibilityForItem: function (layerModel) {\n            var layerElem = LayerModelMap.getLayerInfoForId(layerModel.get('layerId')).item,\n                clippedLayers = layerModel.get('clippedLayers'),\n                that = this;\n\n            if (layerModel.isVisibleOnStage()) {\n                layerElem.show();\n            } else {\n                layerElem.hide();\n            }\n\n            if (clippedLayers) {\n                clippedLayers.forEach(function (model) {\n                    that.refreshVisibilityForItem(model);\n                });\n            }\n        },\n\n        layerVisibilityChanged: function (layerModel) {\n            this.updateFlattenedLayers(layerModel);\n            this.refreshVisibilityForItem(layerModel);\n        },\n\n        /**\n         * Walks layer tree and flattens or expands the layer\n         * views based on the currently visible layers. If our\n         * blendmode group layer's visibility matches the initial\n         * state when first loaded, we leverage a flattened sprite.\n         * If the layer visibility for any members of the blendmode\n         * group vary from the initial state, we hide the flattened\n         * sprite and represent each with its own sprite.\n         *\n         * For layers that do not belong to a blend mode group we do\n         * nothing.\n         *\n         * @param model The layer most recent shown/hidden.\n         */\n        updateFlattenedLayers: function (model) {\n            var flattenedParentId = model.get('flattenedParent'),\n                flattenedParentModel = LayerModelMap.getModel(flattenedParentId),\n                flattenedSprite = model.get('flattenedSprite'),\n                origVisibilityState = true,\n                layerSpriteInfo = [],\n                $flattenedSpriteElem,\n                curLayerModel,\n                $curLayerView,\n                affectedSprites = [],\n                flattenedSpriteModels = [],\n                self = this;\n\n            // Gather up the affected 'flattened' sprite layers\n            if (flattenedParentModel || flattenedSprite) {\n                flattenedParentModel = flattenedParentModel || model;\n                flattenedSpriteModels.push(flattenedParentModel);\n            } else if (model.get('type') === Constants.Type.LAYER_GROUP) {\n                flattenedSpriteModels = model.findDescendantFlattenedSprites();\n            }\n\n            // Gather up info for each affected model.\n            _.each(flattenedSpriteModels, function (layer) {\n                flattenedSprite = layer.get('flattenedSprite');\n                if (flattenedSprite) {\n                    $flattenedSpriteElem = LayerModelMap.getLayerInfoForId(layer.get('layerId')).flattenedItem;\n                    affectedSprites.push({\n                        layer: layer,\n                        flattenedSprite: flattenedSprite,\n                        $flattenedSpriteElem: $flattenedSpriteElem\n                    });\n                }\n            });\n\n            // For each flattened sprite that was possibly affected by the\n            // layer that was just toggled, determine if we need to flatten or\n            // unflatten it.\n            _.each(affectedSprites, function (spriteInfo) {\n                origVisibilityState = true;\n                flattenedSprite = spriteInfo.flattenedSprite;\n                $flattenedSpriteElem = spriteInfo.$flattenedSpriteElem;\n\n                // Walk all included layers for the current flattenedParent and determine\n                // if its visibility is different than the initial document state.\n                _.each(flattenedSprite.includedLayers, function (layerId) {\n                    curLayerModel = LayerModelMap.getModel(layerId);\n                    $curLayerView = LayerModelMap.getLayerInfoForId(curLayerModel.get('layerId')).item;\n                    layerSpriteInfo.push({\n                        model: curLayerModel,\n                        $elem: $curLayerView,\n                        elemVisibility: $curLayerView.css('visibility')\n                    });\n\n                    // Mark this layer group's collective visibility state as being different\n                    // than the initial loaded state that the flattened sprite represents.\n                    if (origVisibilityState && !curLayerModel.isEffectiveRenderedVisibility()) {\n                        origVisibilityState = false;\n                    }\n                });\n\n                if (origVisibilityState) {\n                    $flattenedSpriteElem.css('visibility', 'visible');\n                    self._flattenLayerElems(true, layerSpriteInfo);\n                    FlattenedAssetController.validateSprite(spriteInfo.layer);\n                } else {\n                    $flattenedSpriteElem.css('visibility', 'hidden');\n                    self._flattenLayerElems(false, layerSpriteInfo);\n                    FlattenedAssetController.invalidateSprite(spriteInfo.layer);\n                }\n\n            });\n\n        },\n\n        handleClickEvent: function (event) {\n            if ($(event.target).parents('.popup').length || $(event.target).hasClass('popup')) {\n                return;\n            }\n            var activeTool = DetailsController.get('activeTool');\n            if (activeTool === Constants.Tool.SELECT_DIRECT) {\n                // Select the item\n                SelectionController.set('shouldScrollLayers', true);\n                SelectionController.selectItemAtPoint(event.clientX + $(document).scrollLeft(),\n                    event.clientY + $(document).scrollTop(),\n                    KeyboardUtils.isMultiSelectKey(event));\n                event.stopPropagation();\n            }\n        },\n\n        logCanvasClick: function (eventName, x, y) {\n            var hitItemModel = SelectionController.itemAtPoint(x, y),\n                hitType = hitItemModel ? hitItemModel.get('type') : 'nothingUnderCursor';\n\n            graphite.events.trigger('canvasClick', {type: eventName, layerType: hitType });\n        },\n\n        handleDoubleClickEvent: function (event) {\n            this.logCanvasClick('doubleClick', event.clientX, event.clientY);\n        },\n\n        handleMouseDownEvent: function (event) {\n            if (event.button === 2) {\n                this.logCanvasClick('rightClick', event.clientX, event.clientY);\n            } else if (event.button === 0) {\n                var page = { x: event.pageX, y: event.pageY };\n\n                $(window).on('mousemove.dragDetect', function (event) {\n                    this.isClickDrag = true;\n\n                    if (Math.abs(event.pageX - page.x) > 20 || Math.abs(event.pageY - page.y) > 20) {\n                        graphite.events.trigger('canvasClickDrag');\n                        $(window).off('.dragDetect');\n                    }\n                });\n            }\n        },\n\n        handleMouseUpEvent: function () {\n            $(window).off('.dragDetect');\n            this.isClickDrag = false;\n        },\n\n        layerCompChanging: function () {\n            $('.preview-loading-spinner').remove();\n            this.renderSpinner();\n        },\n\n        handleAssetExtractInit: function () {\n            this.extractionStartTime = new Date().getTime();\n            if (!graphite.inPublicOneUp()) {\n                this.showSuccessTooltip(deps.translate('Extracting asset. Look for it in the Assets tab.'));\n            }\n        },\n\n        handleAssetExtracted: function (params) {\n            if (this.extractTooltip) {\n                var tooltipDuration = Constants.NotificationTooltip.MIN_DURATION - (new Date().getTime() - this.extractionStartTime);\n                var self = this;\n                if (tooltipDuration <= 0) {\n                    this.extractTooltip.remove();\n                    this.extractTooltip = null;\n                } else {\n                    setTimeout(function () {\n                        self.extractTooltip.remove();\n                        self.extractTooltip = null;\n                    }, tooltipDuration);\n                }\n            }\n        },\n\n        handleMultiSelectPending: function (pending) {\n            var selection = SelectionController.getSelectedLayers();\n            $('.extract-plugin').toggleClass('measure-pending', pending && selection.length === 1);\n        },\n\n        handleSelectionChanged: function () {\n            var selection = SelectionController.getSelectedLayers();\n            if (selection.length !== 1) {\n                $('.extract-plugin').removeClass('measure-pending');\n            }\n        },\n\n        showSuccessTooltip: function (message) {\n            var measurementPopup = this.$el.find('#measurementPopupInfo');\n            var $parent = measurementPopup.parent();\n            $parent.append('<div id=\"notificationTooltip\"><span>' + message + '</span></div>');\n            this.extractTooltip = $('#notificationTooltip');\n            var tipWidth = this.extractTooltip.width();\n            var tipHeight = this.extractTooltip.height();\n            var hScrollPos =  $('div.psd-preview-view').scrollLeft();\n            var tipPosLeft = measurementPopup.position().left + (measurementPopup.outerWidth() / 2) - (tipWidth / 2);\n            var previewAreaWidth = $('div.psd-preview-view').width() + hScrollPos - 10;\n            //Check to make sure our placement doesn't get cut off by borders\n            if (tipPosLeft < hScrollPos) {\n                tipPosLeft = hScrollPos;\n            }\n            if ((tipPosLeft + tipWidth) > previewAreaWidth) {\n                tipPosLeft = previewAreaWidth - tipWidth;\n            }\n            var tipPosTop;\n            if (measurementPopup.hasClass('bottom')) {\n                //Place the tooltip just below the blue HUD\n                tipPosTop = measurementPopup.position().top + measurementPopup.outerHeight() + 5;\n            } else {\n                //Place the tooltip just above the blue HUD\n                tipPosTop = measurementPopup.position().top - tipHeight - 15;\n            }\n            this.extractTooltip.css({top: tipPosTop, left: tipPosLeft});\n            this.extractTooltip.fadeIn(250);\n        },\n\n        hideTempPreview: function () {\n            this.$tempPreview.css('display', 'none');\n            this.tempPreviewHidden = true;\n        },\n\n        setBackgroundWhite: function () {\n            var $previewRoot = this.$el.find('#psdpreview_root');\n            $previewRoot.css('background', 'white');\n        },\n\n        showErrorNotification: function (message) {\n            var basePath = deps.utils.getCurrentBasePath(),\n                isPublicOneUp = graphite.inPublicOneUp();\n\n            if (basePath === 'file' || basePath === 'link') {\n                var anchorText =  isPublicOneUp ? deps.translate('Go to Comments to preview the PSD.') :\n                        deps.translate('Go to Details to preview the PSD.');\n                message.messageText += '<a class=\"details-anchor\"> ' + anchorText + '</a>';\n            }\n\n            if (this.$notification) {\n                this.$notification.find('.details-anchor').off('.details');\n                this.$notification.remove();\n                this.$notification = null;\n            }\n\n            // Render\n            this.$el.append(TemplateUtil.createTemplate(ErrorNotificationTemplate, message));\n            this.$notification = this.$el.find('.error-notification');\n\n            // Attach anchor listener so we can delegate to an alternative plugin.\n            var $anchor = this.$el.find('.details-anchor');\n            if ($anchor.length) {\n                $anchor.on('click.details', function (e) {\n                    e.preventDefault();\n                    deps.events.trigger('plugin.show', isPublicOneUp ? 'ccweb.files.activity_public' : 'ccweb.files.details');\n                });\n            }\n\n            // Hide remainder of preview UI in error state.\n            this.$el.addClass('has-error');\n        },\n\n        removeEventListeners: function () {\n            this.model.off(null, null, this);\n            graphite.events.off(null, null, this);\n        },\n\n        remove: function () {\n            FlattenedAssetController.reset();\n            if (this.inspectStyleOverlay) {\n                this.inspectStyleOverlay.remove();\n            }\n            if (this.selectionOverlay) {\n                this.selectionOverlay.remove();\n            }\n            if (this.measurementOverlay) {\n                this.measurementOverlay.remove();\n            }\n            if (this.$progressPane) {\n                this.$progressPane.remove();\n                this.$progressPane = null;\n            }\n            if (this.$psdLens) {\n                this.$psdLens.remove();\n                this.$psdLens = null;\n            }\n            if (this.$notification) {\n                this.$notification.find('.details-anchor').off('.details');\n                this.$notification.remove();\n                this.$notification = null;\n            }\n            this.inspectStyleOverlay = null;\n            this.selectionOverlay = null;\n            this.measurementOverlay = null;\n            this.removeEventListeners();\n            return Backbone.View.prototype.remove.call(this);\n        },\n\n        //------------------------------------------------\n        // Private Helpers\n        //------------------------------------------------\n\n        _loadPreviewImage: function () {\n            if (imageLoader) {\n                var loaderConfig = {\n                    id : this.model.get('assetId'),\n                    modified : this.model.get('modified'),\n                    height : this.model.get('width'),\n                    width : this.model.get('height'),\n                    type: this.model.get('type'),\n                    name: this.model.get('fileName'),\n                    link: graphite.linkId\n                };\n                imageLoader(loaderConfig, this._previewImageDataReceived);\n            } else if (!this.model.get('localContent') && !this.model.get('layerCompId')) {\n                this.$tempPreview.attr('src', graphite.serverAPI.getDefaultRenditionURL(this.model.get('id')));\n            }\n        },\n\n        _previewImageDataReceived: function ($img) {\n            // Replace our preview image with a clone of\n            // the newly received preview image.\n            if ($img && $img.length) {\n                if ($img.attr('src').indexOf(deps.utils.getFileIconPath()) === -1) {\n                    var width = this.model.get('width'),\n                        height = this.model.get('height'),\n                        $canvas = $('<canvas id=\"tempPreview\" class=\"tempPreview\"></canvas>'),\n                        context = $canvas[0].getContext('2d');\n\n                    $canvas.css({\n                        width: width + 'px',\n                        height: height + 'px'\n                    });\n\n                    $canvas[0].width = width;\n                    $canvas[0].height = height;\n\n                    if ($img[0].width && $img[0].height) {\n                        context.drawImage($img[0], 0, 0, $img[0].width, $img[0].height, 0, 0, width, height);\n                    }\n\n                    this.$tempPreview.replaceWith($canvas);\n                    this.$tempPreview = $canvas;\n                    ZoomController.zoomElementScale(this.$tempPreview);\n\n                    if (this.tempPreviewHidden) {\n                        this.hideTempPreview();\n                    }\n                }\n            }\n        },\n\n        _flattenLayerElems: function (doFlatten, layerSpriteInfo) {\n            var visibleVal = doFlatten ? 'hidden' : 'visible';\n            _.each(layerSpriteInfo, function (info) {\n                info.model.set('isFlattened', doFlatten);\n                if (info.elemVisibility !== visibleVal && info.$elem) {\n                    info.$elem.css('visibility', visibleVal);\n                }\n            });\n        },\n\n        applyCurrentZoomLevel: function (notransition) {\n            var $previewContainer = this.$el.find('.preview-container'),\n                $previewRoot = this.$el.find('#psdpreview_root'),\n                $preview = this.$el.find('#tempPreview'),\n                $selectionOverlay = this.$el.find('#selection-overlay'),\n                bounds = this.model.get('imgdata').bounds,\n                size = {width: bounds.right, height: bounds.bottom},\n                skipTransition = notransition === true;\n\n            // Disable CSS transitions if requested.\n            $previewContainer.toggleClass('notransition', skipTransition);\n            $previewRoot.toggleClass('notransition', skipTransition);\n\n            ZoomController.zoomElementSize($previewContainer, size);\n            ZoomController.zoomElementSize($selectionOverlay, size);\n            ZoomController.zoomElementScale($previewRoot);\n            ZoomController.zoomElementScale($preview);\n\n            // Ensure when zoomed > 100% that we don't clip to unscaled bounds.\n            $previewRoot.css('overflow', ZoomController.getZoomLevel() > 1 ? 'visible' : 'hidden');\n        },\n\n        handleDropperStart: function () {\n            var $lensGrid = this.$psdLens.find('.lens-grid'),\n                miniCanvas = $('<canvas/>')[0],\n                miniContext = miniCanvas.getContext('2d'),\n                lastColor,\n                gridSize = 7,\n                halfGrid = 3,\n                self = this;\n\n            $('.extract-plugin').append(this.$psdLens);\n            this.$psdLens.hide();\n\n            miniCanvas.width = gridSize;\n            miniCanvas.height = gridSize;\n\n            this.$el.on('mousedown.dropper', function (event) {\n                // Notify everyone that the user has extracted a color.\n                if (lastColor) {\n                    graphite.events.trigger('commitDropperColor', lastColor);\n                }\n            });\n\n            $(window).on('click.dropper', function (event) {\n                SelectionController.disableDropperTool();\n                $('.dropper-item .color-chip').css('background-color', '');\n                self.$psdLens.css('border-color', '');\n                event.preventDefault();\n                event.stopPropagation();\n            });\n\n            this.$el.on('mouseleave.dropper', function (event) {\n                self.$psdLens.hide();\n            });\n\n            this.$el.on('mouseenter.dropper', function (event) {\n                self.$psdLens.show();\n            });\n\n            this.$el.on('mousemove.dropper', function (event) {\n\n                var topLeft = SelectionController.convertClientPtToPSDPt(event.clientX - halfGrid, event.clientY - halfGrid),\n                    lensBounds = {\n                        top: Math.round(topLeft.y),\n                        left: Math.round(topLeft.x),\n                        bottom: Math.round(topLeft.y) + gridSize,\n                        right: Math.round(topLeft.x) + gridSize\n                    },\n                    intersects = SelectionController.findIntersectsBackToFront(lensBounds),\n                    i;\n\n                self.$psdLens.show();\n\n                // Clear mini context\n                miniContext.clearRect(0, 0, gridSize, gridSize);\n\n                // Composite all sprites that intersected with our lens in\n                // our mini 7x7 canvas.\n                for (i = intersects.length - 1; i >= 0; i--) {\n                    var bits = intersects[i].intersect,\n                        item = intersects[i].item,\n                        canvasItem,\n                        element;\n\n                    if (item.get('flattenedSprite')) {\n                        canvasItem = LayerModelMap.getLayerInfoForId(item.get('layerId')).flattenedItem;\n                    } else {\n                        canvasItem = LayerModelMap.getLayerInfoForId(item.get('layerId')).item;\n                    }\n                    element = canvasItem[0];\n                    miniContext.drawImage(element, bits.left, bits.top, bits.width, bits.height, bits.destLeft, bits.destTop, bits.width, bits.height);\n                }\n\n                // Let's note the current color at the center of\n                // our lens, and update our swatches for this frame.\n                var pixel = miniContext.getImageData(halfGrid, halfGrid, 1, 1);\n                lastColor = null;\n                if (pixel.data && pixel.data.length >= 4 && pixel.data[3] > 0) {\n                    lastColor = {};\n                    lastColor.red = pixel.data[0];\n                    lastColor.green = pixel.data[1];\n                    lastColor.blue = pixel.data[2];\n                    lastColor.alpha = pixel.data[3] / 255;\n                    var rgb = 'rgb(' + lastColor.red + ',' + lastColor.green + ',' + lastColor.blue + ')';\n                    $('.dropper-item .color-chip').css('background-color', rgb);\n                    self.$psdLens.css('border-color', rgb);\n                } else {\n                    $('.dropper-item .color-chip').css('background-color', '');\n                    self.$psdLens.css('border-color', '');\n                }\n\n                // Now we blit to our larger lens making sure that result is pixellated.\n                var lensContext = $lensGrid[0].getContext('2d');\n                lensContext.webkitImageSmoothingEnabled = false;\n                lensContext.mozImageSmoothingEnabled = false;\n                lensContext.msImageSmoothingEnabled = false;\n                lensContext.clearRect(0, 0, gridSize * 10, gridSize * 10);\n                lensContext.drawImage(miniCanvas, 0, 0, gridSize, gridSize, 0, 0, gridSize * 10, gridSize * 10);\n\n                // Move our updated lens to current cursor position.\n                self.$psdLens.css({\n                    left: event.clientX + 'px',\n                    top: event.clientY - $('.extract-plugin').offset().top +   'px'\n                });\n            });\n        },\n\n        handleDropperStop: function () {\n            $(window).off('.dropper');\n            this.$el.off('.dropper');\n            $('.dropper-item .color-chip').css('background-color', '');\n            this.$psdLens.hide();\n        }\n\n    });\n\n    return PSDPreviewView;\n});\n\n//# sourceURL=/lib/graphite-api/public/js/ccweb.files.extract/views/preview/PSDPreviewView.js"),
eval('/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013-2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4 */\n/*global define, graphite */\n\ndefine(\'override/views/preview/BracketsPSDPreviewView\',[\n    \'ccweb.files.extract/Constants\',\n    \'ccweb.files.extract/controllers/DetailsController\',\n    \'ccweb.files.extract/controllers/SelectionController\',\n    \'ccweb.files.extract/views/preview/PSDPreviewView\'\n], function (Constants, DetailsController, SelectionController, PSDPreviewView) {\n    "use strict";\n    \n    var BracketsPSDPreviewView = PSDPreviewView.extend({\n        \n        handleClickEvent: function (event) {\n            PSDPreviewView.prototype.handleClickEvent.call(this, event);\n            \n            // Patch to log metrics for layer selection\n            var activeTool = DetailsController.get("activeTool");\n            if (activeTool === Constants.Tool.SELECT_DIRECT) {\n                var layerAtPoint = SelectionController.itemAtPoint(event.clientX, event.clientY);\n\n                if (layerAtPoint) {\n                    graphite.events.trigger("layer-select", {\n                        source: "preview",\n                        numLayers: SelectionController.getSelectedLayers().length,\n                        type: layerAtPoint.get("type")\n                    });\n                }\n            }\n        },\n\n        _loadPreviewImage: function () {\n            // Patch usage of img src with call to ImageServiceAPI/StorageServiceAPI\n            if (!this.model.get("localContent")) {\n                var self = this,\n                    maxLen = Math.max(this.model.get("width"), this.model.get("height")),\n                    size = Math.round(maxLen / 2);\n\n                // size is used to define the longest edge of the rendition.\n                // We use half the size here for 2 reasons (1) smaller file\n                // download and (2) for the end user to see the progression\n                // from a somewhat pixelated JPG preview to the full-res PNG\n                // sprites.\n                graphite.serverAPI.getRendition(this.model, size, function (err, dataURI) {\n                    self.$tempPreview.attr("src", dataURI);\n\n                    graphite.events.trigger("preview-rendition-finish", {\n                        previewRenditionDuration: Date.now() - self.model.get("previewStarted")\n                    });\n                });\n            } else {\n                PSDPreviewView.prototype._loadPreviewImage.call(this);\n            }\n        }\n        \n    });\n\n    return BracketsPSDPreviewView;\n});\n\n//# sourceURL=/./views/preview/BracketsPSDPreviewView.js'),eval('define(\'text!ccweb.files.extract/views/templates/mobileWarningTemplate.html\',[],function () { return \'<div class="mobile-centered-container">\\n    <div class="mobile-warning"><div class="extract-icon"></div><%-translate("Extract requires a minimum width of 800 pixels")%></div>\\n</div>\\n\';});\n\n//# sourceURL=/text!ccweb.files.extract/views/templates/mobileWarningTemplate.html'),eval('define(\'text!ccweb.files.extract/views/templates/psdHeaderTemplate.html\',[],function () { return \'<div class="psd-header">\\n    <div class="psd-header-nowrap">\\n        <a class="back-to-files" href="/#"></a>\\n        <div class="header-separator"></div>\\n        <span class="file-name"><%- imgdata.originalFile %></span>\\n    </div>\\n</div>\\n\';});\n\n//# sourceURL=/text!ccweb.files.extract/views/templates/psdHeaderTemplate.html'),eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013-2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4 */\n/*global define: true, graphite: true, document: true*/\n\ndefine('ccweb.files.extract/views/detail/PSDDetailsView',[\n    'jquery',\n    'underscore',\n    'backbone',\n    'ccweb.files.extract/controllers/DetailsController',\n    'ccweb.files.extract/controllers/KeyboardController',\n    'ccweb.files.extract/controllers/SelectionController',\n    'ccweb.files.extract/controllers/ZoomController',\n    './DetailPanelView',\n    './HelpView',\n    './SelectionBarView',\n    'ccweb.files.extract/views/popup/ExtractAssetView',\n    'ccweb.files.extract/views/popup/ExtractCodeView',\n    'ccweb.files.extract/views/popup/ColorChipPopupView',\n    'ccweb.files.extract/views/popup/LayerThumbPopupView',\n    'ccweb.files.extract/views/preview/PSDPreviewView',\n    'ccweb.files.extract/Constants',\n    'plugin-dependencies',\n    'text!ccweb.files.extract/views/templates/mobileWarningTemplate.html',\n    'text!ccweb.files.extract/views/templates/psdHeaderTemplate.html',\n    'text!ccweb.files.extract/views/templates/errorNotificationTemplate.html',\n    'ccweb.files.extract/utils/TemplateUtil'\n], function ($, _, Backbone, DetailsController, KeyboardController, SelectionController, ZoomController,\n        DetailPanelView, HelpView, SelectionBarView, ExtractAssetView, ExtractCodeView,\n        ColorChipPopupView, LayerThumbPopupView, PSDPreviewView, Constants, deps, MobileWarningTemplate, \n        PSDHeaderTemplate, ErrorNotificationTemplate, TemplateUtil) {\n    'use strict';\n\n    var PSDDetailsView = Backbone.View.extend({\n        assetId: null,\n        tagName: 'section',\n\n        /* Cached Views */\n        detailPanelView: null,\n        previewView: null,\n        extractAssetPopup: null,\n        extractCodePopup: null,\n        colorChipPopup: null,\n        layerThumbPopup: null,\n        helpView: null,\n        selectionBar: null,\n\n        initialize: function () {\n            this.model.set('previewStarted', Date.now());\n            graphite.events.trigger('drawPreviewStart', {\n                fileSize: this.model.get('size'),\n                width: this.model.get('width'),\n                height: this.model.get('height')\n            });\n\n            this.model.on('change:imgdata', this.handleModelImgdataChanged, this);\n            this.model.on('change:renderedSprites', this.handleRenderedSpritesChanged, this);\n            this.model.on('change:status', this.handleStatusChanged, this);\n\n            this.addHandlers();\n\n            this.render();\n            this.handleModelImgdataChanged();\n            this.handleStatusChanged();\n        },\n\n        render: function () {\n            ZoomController.reset();\n            SelectionController.setPSDModel(this.model);\n            DetailsController.setPSDModel(this.model);\n\n            this.detailPanelView = new DetailPanelView({model: this.model});\n            this.selectionBar = new SelectionBarView();\n            this.previewView = new PSDPreviewView({model: this.model});\n            this.extractAssetPopup = new ExtractAssetView({model: this.model});\n            this.extractCodePopup = new ExtractCodeView({model: this.model});\n            this.colorChipPopup = new ColorChipPopupView();\n            this.layerThumbPopup = new LayerThumbPopupView();\n\n            this.helpView = new HelpView();\n            SelectionController.psdView = this.previewView;\n\n            this.$el.append(TemplateUtil.createTemplate(MobileWarningTemplate));\n            this.$el.append(this.previewView.el);\n            this.$el.append(this.selectionBar.el);\n            this.$el.append(this.detailPanelView.el);\n            this.$el.append(this.extractAssetPopup.el);\n            this.$el.append(this.extractCodePopup.el);\n            this.$el.append(this.colorChipPopup.el);\n            this.$el.append(this.layerThumbPopup.el);\n\n            if (this.$el.find('.keystroke-window-overlay').length === 0) {\n                this.$el.append(this.helpView.el);\n            }\n\n            graphite.events.trigger('do-first-use-overlay-check');\n\n            return this;\n        },\n\n        handleModelImgdataChanged: function () {\n            this.$el.find('.psd-header').remove();\n            this.$el.append(TemplateUtil.createTemplate(PSDHeaderTemplate, this.model.toJSON()));\n\n            this.$el.find('.psd-header .back-to-files').text(deps.translate('Files'));\n            if (deps.utils.getCurrentPage() !== undefined) {\n                this.$el.find('.psd-header .back-to-files').css('visibility', 'visible');\n                this.$el.find('.psd-header .header-separator').css('visibility', 'visible');\n            } else {\n                this.$el.find('.psd-header .back-to-files').css('visibility', 'hidden');\n                this.$el.find('.psd-header .header-separator').css('visibility', 'hidden');\n            }\n        },\n\n        handleRenderedSpritesChanged: function () {\n        },\n\n        handleStatusChanged: function () {\n            var errMsg,\n                status = this.model.get('status');\n            if (status >= 300) {\n                var err = this.model.get('errorInfo');\n                if (err && err.errorCode === Constants.WorkerErrorCodes.GRAPHITE_REJECTED) {\n                    var matches = err.errorMessage.match(/File rejected - too many layers \\((\\d+)\\/(\\d+)\\)/);\n                    if (matches) {\n                        var layerCount = matches[1];\n                        var layerLimit = matches[2];\n                        errMsg = deps.translate('Uh oh, this PSD has an exceptional number of layers and has failed to process. Please keep the number of layers below {0}. This PSD has {1}.', layerLimit, layerCount);\n                    } else {\n                        // fail of some sort. Be generic.\n                        errMsg = deps.translate('Uh oh, this PSD has an exceptional number of layers and has failed to process.');\n                    }\n                }\n                errMsg = errMsg || deps.translate('Uh oh, this PSD was not successfully processed because it\\'s not currently compatible with Extract.');\n            }\n\n            if (errMsg) {\n                this.showErrorNotification({messageText: errMsg});\n            }\n        },\n\n        addHandlers: function () {\n            KeyboardController.attachKeyHandlers();\n        },\n\n        removeEventListeners: function () {\n            this.model.off(null, null, this);\n            graphite.events.off(null, null, this);\n            KeyboardController.removeKeyHandlers();\n        },\n\n        showErrorNotification: function (message) {\n            if (this.previewView) {\n                this.previewView.showErrorNotification(message);\n            }\n        },\n\n        destroyViews: function (views) {\n            var self = this;\n            _.each(views, function (view) {\n                if (self.hasOwnProperty(view)) {\n                    self[view].remove();\n                    delete self[view];\n                }\n            });\n        },\n\n        remove: function () {\n            this.removeEventListeners();\n\n            var views = ['detailPanelView', 'previewView', 'extractAssetPopup', 'extractCodePopup',\n                    'colorChipPopup', 'layerThumbPopup', 'helpView', 'selectionBar'];\n\n            this.destroyViews(views);\n            SelectionController.psdView = null;\n\n            this.$el.empty();\n            this.stopListening();\n            return this;\n        }\n\n    });\n\n    return PSDDetailsView;\n\n});\n\n//# sourceURL=/lib/graphite-api/public/js/ccweb.files.extract/views/detail/PSDDetailsView.js"),eval('/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4, maxerr: 50 */\n/*global define, brackets */\n\ndefine(\'ext/Strings\',[\'require\',\'exports\',\'module\',\'i18n!nls/urls\',\'i18n!nls/str\',\'i18n!nls/strings\'],function (require, exports, module) {\n    "use strict";\n\n    var _           = brackets.getModule("thirdparty/lodash"),\n        urls        = require("i18n!nls/urls"),\n        stringsCCW  = require("i18n!nls/str"),                  // strings used by Extract CCW\n        stringsE4B  = require("i18n!nls/strings");              // E4B-specific strings\n\n    var additionalGlobals = $.extend({}, urls);\n    \n    // Insert application strings\n    _.forEach(stringsE4B, function (value, key) {\n        _.forEach(additionalGlobals, function (item, name) {\n            stringsE4B[key] = stringsE4B[key].replace(new RegExp("{" + name + "}", "g"), additionalGlobals[name]);\n        });\n    });\n    \n    module.exports = _.extend({}, stringsCCW, stringsE4B, urls);\n});\n//# sourceURL=/./Strings.js'),eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013-2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4 */\n/*global define, brackets, graphite, document*/\n\ndefine('override/views/detail/BracketsPSDDetailsView',[\n    'jquery',\n    'underscore',\n    'backbone',\n    'ccweb.files.extract/controllers/DetailsController',\n    'ccweb.files.extract/controllers/SelectionController',\n    'ccweb.files.extract/controllers/ZoomController',\n    'ccweb.files.extract/views/detail/PSDDetailsView',\n    'ccweb.files.extract/views/detail/SelectionBarView',\n    'ccweb.files.extract/views/preview/PSDPreviewView',\n    'ccweb.files.extract/views/popup/LayerThumbPopupView',\n    'ccweb.files.extract/views/detail/DetailPanelView',\n    'ccweb.files.extract/Constants',\n    'ext/Constants',\n    'ext/Strings',\n    'ccweb.files.extract/utils/TemplateUtil'\n], function ($, _, Backbone, DetailsController, SelectionController,\n        ZoomController, PSDDetailsView, SelectionBarView, PSDPreviewView,\n        LayerThumbPopupView, DetailPanelView, Constants, PSDLensConstants,\n        Strings, TemplateUtil) {\n    \"use strict\";\n\n    var BracketsPSDDetailsView = PSDDetailsView.extend({\n\n        template: '<div></div>',\n\n        _renderSelectionBarView: function () {\n            // TODO monkey patch SelectionBarView instead?\n            // layers toggle button inside SelectionBarView\n            var $toggleLayers = $('<a href=\"#\" class=\"e4b-layers-toggle-button\" title=\"' + Strings.SHOW_HIDE_LAYERS + '\">&nbsp;</a>');\n            $toggleLayers.addClass(\"selected\");\n            $toggleLayers.click(function () {\n                $toggleLayers.toggleClass(\"selected\");\n                $(\"#detail-panel\").toggle();\n\n                graphite.events.trigger(\"layers-panel-toggle\", {\n                    visible: $(\"#detail-panel:visible\").length > 0\n                });\n            });\n            \n            this.selectionBar.$el.prepend($toggleLayers);\n\n            // HACK E4B puts SelectionBarView into the main panel title bar\n            // where Parfait instead includes it within PSDDetailsView. The\n            // SelectionBarView lifecycle is still controlled by\n            // BracketsPSDDetailsView. We only change DOM insertion here.\n            var selectionBarEl = this.selectionBar.el,\n                $placeholder = $(\"#e4b-main-panel .e4b-selectionbar-placeholder\");\n\n            $placeholder.prepend(selectionBarEl);\n        },\n        \n        render: function () {\n            this.incompatibleBlendOptionsExist = false;\n\n            ZoomController.reset();\n            SelectionController.setPSDModel(this.model);\n            DetailsController.setPSDModel(this.model);\n            \n            this.detailPanelView = new DetailPanelView({model: this.model});\n            this.selectionBar = new SelectionBarView();\n            this.layerThumbPopup = new LayerThumbPopupView();\n            this.previewView = new PSDPreviewView({model: this.model});\n\n            this._renderSelectionBarView();\n            \n            // HACK Activate the Layers tab by default\n            graphite.events.on(\"drawPreviewFinish\", function () {\n                DetailsController.setSelectedTab(\"psdLayersTab\");\n            }, this);\n            \n            SelectionController.psdView = this.previewView;\n\n            this.$el.append(this.previewView.el);\n            this.$el.append(this.detailPanelView.el);\n            this.$el.append(this.layerThumbPopup.el);\n\n            return this;\n        },\n\n        handleModelImgdataChanged: function () {\n            // do nothing\n        },\n\n        handleRenderedSpritesChanged: function () {\n            // TODO where to show parfait notificaitons?\n            // if (this.incompatibleBlendOptionsExist) {\n            //     //add the notification message for incompatible blend mode\n            //     var messageObj = {};\n            //     messageObj.messageText = Strings.UNSUPPORTED_BLEND_MODES;\n            //     this.showNotification(messageObj);\n            // }\n        },\n\n        addHandlers: function () {\n            graphite.events.on(\"incompatibleGraphicOptionsInPSD\", function () { this.incompatibleBlendOptionsExist = true; }, this);\n        },\n\n        removeEventListeners: function () {\n            graphite.events.off(null, null, this);\n\n            // Overwrite parent behavior since KeyboardController is omitted here\n            // KeyboardController.removeKeyHandlers();\n        },\n\n        remove: function () {\n            SelectionController.changeSelection();\n            this.$el.removeClass(\"active\");\n            this.removeEventListeners();\n            var views = [\"detailPanelView\", \"selectionBar\", \"previewView\", \"layerThumbPopup\"];\n            this.destroyViews(views);\n            SelectionController.psdView = null;\n            this.currentNotification = null;\n            if (this.$notification) {\n                this.$notification.empty();\n            }\n            this.$el.empty();\n            this.stopListening();\n            return this;\n        }\n\n    });\n\n    return BracketsPSDDetailsView;\n\n});\n\n//# sourceURL=/./views/detail/BracketsPSDDetailsView.js"),eval('define(\'text!ccweb.files.extract/views/templates/interceptBinaryTemplate.html\',[],function () { return \'<div id="interceptPopupBinary">\\n    <%-translate("Did this work as expected?")%>\\n    <div class="popup-footer"><span id="interceptYesLink" class="popup-button"><%-translate("Yes")%></span> <span id="interceptNoLink" class="popup-button"><%-translate("No")%></span>\\n    </div>\\n    <i id="interceptCloseLink" class="popup-close">&times;</i>\\n</div>\';});\n\n//# sourceURL=/text!ccweb.files.extract/views/templates/interceptBinaryTemplate.html'),eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013-2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE: All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any. The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4 */\n/*global define: true, graphite: true, setTimeout: true, window: true*/\n\ndefine('ccweb.files.extract/views/popup/InterceptPopupView',[\n    'jquery',\n    'underscore',\n    'backbone',\n    'ccweb.files.extract/Constants',\n    'ccweb.files.extract/views/popup/BasePreviewPopupView',\n    'plugin-dependencies',\n    'ccweb.files.extract/controllers/ZoomController',\n    'ccweb.files.extract/utils/TemplateUtil',\n    'text!ccweb.files.extract/views/templates/interceptBinaryTemplate.html'\n], function ($, _, Backbone, Constants, BasePreviewPopupView, deps, ZoomController, TemplateUtil, InterceptBinaryTemplate) {\n\n    'use strict';\n\n    var InterceptPopupView = BasePreviewPopupView.extend({\n\n        className: 'interceptBinary measurementTooltip popup',\n        events: {\n            'click #interceptYesLink': 'handleYesClick',\n            'click #interceptNoLink': 'handleNoClick',\n            'click #interceptCloseLink': 'handleCloseClick'\n        },\n\n        initialize: function () {\n            BasePreviewPopupView.prototype.initialize.apply(this, arguments);\n        },\n\n        render: function () {\n            BasePreviewPopupView.prototype.render.apply(this, arguments);\n\n            this.$el.find('.popup-contents').html(\n                TemplateUtil.createTemplate(InterceptBinaryTemplate)\n            );\n\n            var $yesLink = this.$el.find('#interceptYesLink'),\n                $noLink = this.$el.find('#interceptNoLink');\n            $yesLink.html(deps.translate('Yes'));\n            $yesLink.hover(this.highlightLabel, this.unhighlightLabel);\n\n            $noLink.html(deps.translate('No'));\n            $noLink.hover(this.highlightLabel, this.unhighlightLabel);\n\n            return this;\n        },\n\n        //------------------------------------------------\n        // Handlers\n        //------------------------------------------------\n        handleYesClick: function (event) {\n            this.tryHandler(event, 'yes');\n        },\n\n        handleNoClick: function (event) {\n            this.tryHandler(event, 'no');\n        },\n\n        handleCloseClick: function (event) {\n            this.tryHandler(event, 'close');\n        },\n\n        tryHandler: function (event, handlerName) {\n            event.stopPropagation();\n            if (this.handlers && this.handlers[handlerName]) {\n                this.handlers[handlerName]();\n            }\n            this.closePopup();\n            this.remove();\n        },\n\n        setHandlers: function (callbacks) {\n            this.handlers = callbacks;\n        }\n\n    });\n\n    return InterceptPopupView;\n});\n\n//# sourceURL=/lib/graphite-api/public/js/ccweb.files.extract/views/popup/InterceptPopupView.js"),eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4, bitwise: true */\n/*global define: true, graphite: true, olark: true */\n\ndefine('ccweb.files.extract/models/InterceptModel',[\n    'jquery',\n    'underscore',\n    'backbone',\n    'ccweb.files.extract/views/popup/InterceptPopupView',\n    'ccweb.files.extract/models/UserSettingsModel'\n], function ($, _, Backbone, InterceptPopupView, UserSettingsModel) {\n    'use strict';\n    var InterceptModel = Backbone.Model.extend({\n\n        defaults: {\n        },\n\n        configurations: [\n            {\n                segment     : 'layer-comp-binary',  // We use this to segment our metrics. Each one should be unique\n                behavior    : function () {\n                    var that = this,\n                        intercepts = UserSettingsModel.get('shownIntercepts');\n\n                    if (intercepts[that.segment]) {\n                        return;\n                    }\n\n                    function yesHandler() {\n                        window.graphite.events.trigger('catchIntercept', {segment: that.segment, result: 'yes'});\n                    }\n\n                    function noHandler() {\n                        window.graphite.events.trigger('catchIntercept', {segment: that.segment, result: 'no'});\n                        window.olark('api.box.expand');\n                    }\n\n                    function closeHandler() {\n                        window.graphite.events.trigger('catchIntercept', {segment: that.segment, result: 'close'});\n                    }\n\n                    window.graphite.events.on('layerCompChanged', function () {\n                        var intercepts = _.clone(UserSettingsModel.get('shownIntercepts'));\n\n                        if (!intercepts[that.segment]) {\n                            window.graphite.events.trigger('load-intercept-binary', {style: 'top: 33px', handlers: {yes: yesHandler, no: noHandler, close: closeHandler}});\n                            intercepts[that.segment] = true;\n                            UserSettingsModel.set('shownIntercepts', intercepts);\n                        }\n                    });\n                }\n            }\n        ],\n\n        attachListeners: function () {\n            window.graphite.events.on('load-intercept-binary', function (params) {\n                _.delay(function () {\n                    var interceptPopup = new InterceptPopupView();\n                    interceptPopup.setHandlers(params.handlers);\n                    $(interceptPopup.el).addClass('bottom');\n                    if (params.style) {\n                        $(interceptPopup.el).attr('style', params.style);\n                    }\n                    $('#results').find('.layer-comp-controls').append(interceptPopup.el);\n                    $(interceptPopup.el).show();\n                }, 500);\n            }, this);\n        },\n\n        applyBehaviors: function () {\n            this.attachListeners();\n            var intercepts = UserSettingsModel.get('shownIntercepts'),\n                i;\n\n            for (i in this.configurations) {\n                if (this.configurations.hasOwnProperty(i) && !intercepts[this.configurations[i].segment]) {\n                    this.configurations[i].behavior();\n                }\n            }\n        }\n\n\n    });\n\n    return new InterceptModel();\n});\n\n//# sourceURL=/lib/graphite-api/public/js/ccweb.files.extract/models/InterceptModel.js"),eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4, bitwise: true */\n/*global define: true, graphite: true*/\n\ndefine('ccweb.files.extract/controllers/InterceptController',[\n    'underscore',\n    'backbone',\n    'ccweb.files.extract/models/InterceptModel'\n], function (_, Backbone, InterceptModel) {\n    'use strict';\n    var InterceptController = Backbone.Model.extend({\n        defaults: {\n            applied: false\n        },\n\n        initialize: function () {\n        },\n\n        applyBehaviors: function () {\n            if (!this.applied) {\n                InterceptModel.applyBehaviors();\n                this.applied = true;\n            }\n        }\n    });\n\n    return new InterceptController();\n});\n\n//# sourceURL=/lib/graphite-api/public/js/ccweb.files.extract/controllers/InterceptController.js"),eval("/*\r\n * This file contains code derived from two different open-source libraries under different licenses,\r\n * plus modifications by Adobe to add functionality, wrap as a Require module, and glue the two libs\r\n * together.\r\n * \r\n * \r\n * Code from multipart_parser.js (https://github.com/felixge/node-formidable/blob/master/lib/multipart_parser.js):\r\n * \r\n * Copyright (C) 2011 Felix Geisendrfer\r\n * \r\n * Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the \"Software\"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:\r\n * \r\n * The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.\r\n * \r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\r\n * \r\n * \r\n * Code from jquery.mxhr.js (https://github.com/dfltr/jQuery-MXHR):\r\n * \r\n * Copyright 2011 Micah Snyder <micah.snyder@gmail.com>. All rights reserved.\r\n * Redistribution and use in source and binary forms, with or without modification, are\r\n * permitted provided that the following conditions are met:\r\n *    1. Redistributions of source code must retain the above copyright notice, this list of\r\n *       conditions and the following disclaimer.\r\n *    2. Redistributions in binary form must reproduce the above copyright notice, this list\r\n *       of conditions and the following disclaimer in the documentation and/or other materials\r\n *       provided with the distribution.\r\n * THIS SOFTWARE IS PROVIDED BY MICAH SNYDER \"AS IS\" AND ANY EXPRESS OR IMPLIED\r\n * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND\r\n * FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL <COPYRIGHT HOLDER> OR\r\n * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR\r\n * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\r\n * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON\r\n * ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING\r\n * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF\r\n * ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n */\r\n\r\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4, bitwise: true, es5: true */\r\n/*global define, XMLHttpRequest, Uint8Array */\r\n\r\n(function ($) {\r\n    \"use strict\";\r\n    $.multipart = function (options) {\r\n        \r\n        function Part() {\r\n            this.headers  = {};\r\n            this.header = '';\r\n            this.body = null;\r\n        }\r\n    \r\n        var s = 0,\r\n            S = {\r\n                PARSER_UNINITIALIZED: s++,\r\n                START: s++,\r\n                START_BOUNDARY: s++,\r\n                HEADER_FIELD_START: s++,\r\n                HEADER_FIELD: s++,\r\n                HEADER_VALUE_START: s++,\r\n                HEADER_VALUE: s++,\r\n                HEADER_VALUE_ALMOST_DONE: s++,\r\n                HEADERS_ALMOST_DONE: s++,\r\n                PART_DATA_START: s++,\r\n                PART_DATA: s++,\r\n                PART_END: s++,\r\n                END: s++\r\n            },\r\n\r\n            f = 1,\r\n            F = {\r\n                PART_BOUNDARY: f,\r\n                LAST_BOUNDARY: f *= 2\r\n            },\r\n\r\n            LF = 10,\r\n            CR = 13,\r\n            SPACE = 32,\r\n            HYPHEN = 45,\r\n            COLON = 58,\r\n            A = 97,\r\n            Z = 122,\r\n\r\n            lower = function (c) {\r\n                return c | 0x20;\r\n            };\r\n\r\n        function MultipartParser() {\r\n            this.boundary = null;\r\n            this.boundaryChars = null;\r\n            this.lookbehind = null;\r\n            this.state = S.PARSER_UNINITIALIZED;\r\n            \r\n            this.index = null;\r\n            this.flags = 0;\r\n            this._part   = new Part();\r\n        }\r\n        \r\n        MultipartParser.prototype.Uint8Concat = function (first, second) {\r\n            var firstLength = first.length,\r\n                result = new Uint8Array(firstLength + second.length);\r\n        \r\n            result.set(first);\r\n            result.set(second, firstLength);\r\n        \r\n            return result;\r\n        };\r\n                \r\n        MultipartParser.prototype.unpackString = function (str) {\r\n            var buffer = new Uint8Array(str.length),\r\n                length = str.length,\r\n                i = 0;\r\n            \r\n            for (i = 0; i < length; i++) {\r\n                if (str.charCodeAt(i)) {\r\n                    buffer[i] = str.charCodeAt(i);\r\n                }\r\n            }\r\n            \r\n            return buffer;\r\n        };\r\n        \r\n        MultipartParser.prototype.initWithBoundary = function (str) {\r\n            var  i = 0;\r\n            this.boundary =  new Uint8Array(str.length + 4);\r\n            this.boundary = this.unpackString('\\r\\n' + str);\r\n            this.lookbehind =  new Uint8Array(this.boundary.length + 8);\r\n            this.state = S.START;\r\n            \r\n            this.boundaryChars = {};\r\n            for (i = 0; i < this.boundary.length; i++) {\r\n                this.boundaryChars[this.boundary[i]] = true;\r\n            }\r\n        };\r\n        \r\n        MultipartParser.prototype.write = function (dataBuffer) {\r\n            var self = this,\r\n                buffer = new Uint8Array(dataBuffer),\r\n                i = 0,\r\n                len = buffer.length,\r\n                prevIndex = this.index,\r\n                index = this.index,\r\n                state = this.state,\r\n                flags = this.flags,\r\n                lookbehind = this.lookbehind,\r\n                boundary = this.boundary,\r\n                boundaryChars = this.boundaryChars,\r\n                boundaryLength = this.boundary.length,\r\n                boundaryEnd = boundaryLength - 1,\r\n                bufferLength = buffer.length,\r\n                c,\r\n                cl,\r\n        \r\n                mark = function (name) {\r\n                    self[name + 'Mark'] = i;\r\n                },\r\n                \r\n                clear = function (name) {\r\n                    delete self[name + 'Mark'];\r\n                },\r\n                \r\n                callback = function (name, buffer, start, end) {\r\n                    if (start !== undefined && start === end) {\r\n                        return;\r\n                    }\r\n                    \r\n                    var callbackSymbol = 'on' + name.substr(0, 1).toUpperCase() + name.substr(1);\r\n                    if (callbackSymbol in self) {\r\n                        self[callbackSymbol](buffer, start, end);\r\n                    }\r\n                },\r\n                \r\n                dataCallback = function (name, clear) {\r\n                    var markSymbol = name + 'Mark';\r\n                    if (!(markSymbol in self)) {\r\n                        return;\r\n                    }\r\n                    \r\n                    if (!clear) {\r\n                        callback(name, buffer, self[markSymbol], buffer.length);\r\n                        self[markSymbol] = 0;\r\n                    } else {\r\n                        callback(name, buffer, self[markSymbol], i);\r\n                        delete self[markSymbol];\r\n                    }\r\n                };\r\n        \r\n            for (i = 0; i < len; i++) {\r\n                c = buffer[i];\r\n                switch (state) {\r\n                case S.PARSER_UNINITIALIZED:\r\n                    return i;\r\n                        \r\n                case S.START:\r\n                    index = 0;\r\n                    state = S.START_BOUNDARY;\r\n                        \r\n                case S.START_BOUNDARY:\r\n                    if (index === boundary.length - 2) {\r\n                        if (c === HYPHEN) {\r\n                            flags |= F.LAST_BOUNDARY;\r\n                        } else if (c !== CR) {\r\n                            return i;\r\n                        }\r\n                        index++;\r\n                        break;\r\n                    } else if (index - 1 === boundary.length - 2) {\r\n                        if (flags & F.LAST_BOUNDARY && c === HYPHEN) {\r\n                            callback('end');\r\n                            state = S.END;\r\n                            flags = 0;\r\n                        } else if (!(flags & F.LAST_BOUNDARY) && c === LF) {\r\n                            index = 0;\r\n                            callback('partBegin');\r\n                            state = S.HEADER_FIELD_START;\r\n                        } else {\r\n                            return i;\r\n                        }\r\n                        break;\r\n                    }\r\n                \r\n                    if (c !== boundary[index + 2]) {\r\n                        index = -2;\r\n                    }\r\n                    if (c === boundary[index + 2]) {\r\n                        index++;\r\n                    }\r\n                    break;\r\n\r\n                case S.HEADER_FIELD_START:\r\n                    state = S.HEADER_FIELD;\r\n                    mark('headerField');\r\n                    index = 0;\r\n                \r\n                case S.HEADER_FIELD:\r\n                    if (c === CR) {\r\n                        clear('headerField');\r\n                        state = S.HEADERS_ALMOST_DONE;\r\n                        break;\r\n                    }\r\n                \r\n                    index++;\r\n                    if (c === HYPHEN) {\r\n                        break;\r\n                    }\r\n                \r\n                    if (c === COLON) {\r\n                        if (index === 1) {\r\n                            // empty header field\r\n                            return i;\r\n                        }\r\n                        dataCallback('headerField', true);\r\n                        state = S.HEADER_VALUE_START;\r\n                        break;\r\n                    }\r\n                    \r\n                    cl = lower(c);\r\n                    if (cl < A || cl > Z) {\r\n                        return i;\r\n                    }\r\n                    break;\r\n                        \r\n                case S.HEADER_VALUE_START:\r\n                    if (c === SPACE) {\r\n                        break;\r\n                    }\r\n                \r\n                    mark('headerValue');\r\n                    state = S.HEADER_VALUE;\r\n                \r\n                case S.HEADER_VALUE:\r\n                    if (c === CR) {\r\n                        dataCallback('headerValue', true);\r\n                        callback('headerEnd');\r\n                        state = S.HEADER_VALUE_ALMOST_DONE;\r\n                    }\r\n                    break;\r\n                \r\n                case S.HEADER_VALUE_ALMOST_DONE:\r\n                    if (c !== LF) {\r\n                        return i;\r\n                    }\r\n                    state = S.HEADER_FIELD_START;\r\n                    break;\r\n                \r\n                case S.HEADERS_ALMOST_DONE:\r\n                    if (c !== LF) {\r\n                        return i;\r\n                    }\r\n                \r\n                    callback('headersEnd');\r\n                    state = S.PART_DATA_START;\r\n                    break;\r\n                \r\n                case S.PART_DATA_START:\r\n                    state = S.PART_DATA;\r\n                    mark('partData');\r\n                \r\n                case S.PART_DATA:\r\n                    prevIndex = index;\r\n                \r\n                    if (index === 0) {\r\n                      // boyer-moore derrived algorithm to safely skip non-boundary data\r\n                        i += boundaryEnd;\r\n                        while (i < bufferLength && !(buffer[i] in boundaryChars)) {\r\n                            i += boundaryLength;\r\n                        }\r\n                        i -= boundaryEnd;\r\n                        c = buffer[i];\r\n                    }\r\n                \r\n                    if (index < boundary.length) {\r\n                        if (boundary[index] === c) {\r\n                            if (index === 0) {\r\n                                dataCallback('partData', true);\r\n                            }\r\n                            index++;\r\n                        } else {\r\n                            index = 0;\r\n                        }\r\n                    } else if (index === boundary.length) {\r\n                        index++;\r\n                        if (c === CR) {\r\n                            // CR = part boundary\r\n                            flags |= F.PART_BOUNDARY;\r\n                        } else if (c === HYPHEN) {\r\n                            // HYPHEN = end boundary\r\n                            flags |= F.LAST_BOUNDARY;\r\n                        } else {\r\n                            index = 0;\r\n                        }\r\n                    } else if (index - 1 === boundary.length) {\r\n                        if (flags & F.PART_BOUNDARY) {\r\n                            index = 0;\r\n                            if (c === LF) {\r\n                                // unset the PART_BOUNDARY flag\r\n                                flags &= ~F.PART_BOUNDARY;\r\n                                callback('partEnd');\r\n                                callback('partBegin');\r\n                                state = S.HEADER_FIELD_START;\r\n                                break;\r\n                            }\r\n                        } else if (flags & F.LAST_BOUNDARY) {\r\n                            if (c === HYPHEN) {\r\n                                callback('partEnd');\r\n                                callback('end');\r\n                                state = S.END;\r\n                                flags = 0;\r\n                            } else {\r\n                                index = 0;\r\n                            }\r\n                        } else {\r\n                            index = 0;\r\n                        }\r\n                    }\r\n                \r\n                    if (index > 0) {\r\n                        // when matching a possible boundary, keep a lookbehind reference\r\n                        // in case it turns out to be a false lead\r\n                        lookbehind[index - 1] = c;\r\n                    } else if (prevIndex > 0) {\r\n                        // if our boundary turned out to be rubbish, the captured lookbehind\r\n                        // belongs to partData\r\n                        callback('partData', lookbehind, 0, prevIndex);\r\n                        prevIndex = 0;\r\n                        mark('partData');\r\n                \r\n                        // reconsider the current character even so it interrupted the sequence\r\n                        // it could be the beginning of a new sequence\r\n                        i--;\r\n                    }\r\n                \r\n                    break;\r\n                \r\n                case S.END:\r\n                    break;\r\n                \r\n                default:\r\n                    return i;\r\n                }\r\n            }\r\n                \r\n            dataCallback('headerField');\r\n            dataCallback('headerValue');\r\n            dataCallback('partData');\r\n                \r\n            this.index = index;\r\n            this.state = state;\r\n            this.flags = flags;\r\n                \r\n            return len;\r\n        };\r\n\r\n        MultipartParser.prototype.onHeaderField = function (buffer, start, end) {\r\n            var data = String.fromCharCode.apply(null, buffer.subarray(start, end));\r\n            this._part.header = data;\r\n        };\r\n        \r\n        MultipartParser.prototype.onHeaderValue = function (buffer, start, end) {\r\n            this._part.headers[this._part.header] = String.fromCharCode.apply(null, buffer.subarray(start, end));\r\n        };\r\n        \r\n        MultipartParser.prototype.onPartData = function (buffer, start, end) {\r\n            var data = buffer.subarray(start, end),\r\n                mime = this._part.headers['Content-Type'];\r\n            \r\n            if (this._part.body) {\r\n                this._part.body = this.Uint8Concat(this._part.body, buffer.subarray(start, end));\r\n            } else {\r\n                this._part.body = buffer.subarray(start, end);\r\n            }\r\n        };\r\n\r\n        MultipartParser.prototype.onPartEnd = function () {\r\n            var  mime = this._part.headers['Content-Type'];\r\n            \r\n            if (options[mime] && this._part.body) {\r\n                options[mime].call(this._part.body, this._part.headers['Content-ID']);\r\n                this._part.body = null;\r\n                this._part.headers = {};\r\n                this._part.header = '';\r\n            }\r\n        };\r\n        \r\n        MultipartParser.prototype.onEnd = function () {\r\n            if (options.hasOwnProperty('onSuccess')) {\r\n                options.onSuccess.call(this);\r\n            }\r\n        };\r\n        \r\n        MultipartParser.prototype.end = function () {\r\n            var callback = function (self, name) {\r\n                var callbackSymbol = 'on' + name.substr(0, 1).toUpperCase() + name.substr(1);\r\n                if (callbackSymbol in self) {\r\n                    self[callbackSymbol]();\r\n                }\r\n            };\r\n            if ((this.state === S.HEADER_FIELD_START && this.index === 0) ||\r\n                    (this.state === S.PART_DATA && this.index === this.boundary.length)) {\r\n                callback(this, 'partEnd');\r\n                callback(this, 'end');\r\n            } else if (this.state !== S.END) {\r\n                return new Error('MultipartParser.end(): stream ended unexpectedly: ' + this.state);\r\n            }\r\n        };\r\n\r\n        \r\n        var url = options.url,\r\n            req,\r\n            boundary,\r\n            type = options.type || 'GET',\r\n            data = options.data || false,\r\n            csrfToken = $(\"meta[name='csrf-token']\").attr(\"content\"),\r\n            headers = options.headers;\r\n\r\n        var readyStateNanny = function () {\r\n            if (req.readyState === 3) {\r\n                var contentTypeHeader = req.getResponseHeader(\"Content-Type\");\r\n\r\n                //No HTTP error, just a bad response\r\n                if (contentTypeHeader.indexOf(\"multipart\") === -1) {\r\n                    req.onreadystatechange = function () {\r\n                        req.onreadystatechange = function () {};\r\n                        if (options.hasOwnProperty('onError')) {\r\n                            options.onError.call(req.status);\r\n                        } \r\n                    };\r\n\r\n                } else {\r\n                    boundary = '--' + /boundary=([^\\x3B]+)/.exec(contentTypeHeader)[1];\r\n                }\r\n            }\r\n\r\n            if(req.readyState === 4 && req.status === 200) {\r\n                var response = req.response;\r\n                var parser = new MultipartParser();\r\n                parser.initWithBoundary(boundary);\r\n                parser.write(response);\r\n            } else if (req.readyState === 4 && req.status !== 200) {\r\n                if (options.hasOwnProperty('onError')) {\r\n                    options.onError.call(req.status);\r\n                }                \r\n            }\r\n        };\r\n        \r\n        //These versions of XHR are known to work with MXHR\r\n        try { req = new ActiveXObject('MSXML2.XMLHTTP.6.0'); } catch(nope) {\r\n            try { req = new ActiveXObject('MSXML3.XMLHTTP'); } catch(nuhuh) {\r\n                try { req = new XMLHttpRequest(); } catch(noway) {\r\n                    throw new Error('Could not find supported version of XMLHttpRequest.');\r\n                }\r\n            }\r\n        }\r\n        \r\n        req.responseType = 'arraybuffer';\r\n        req.open(type, url, true);\r\n        req.onreadystatechange = readyStateNanny;\r\n\r\n        if(csrfToken) {\r\n            req.setRequestHeader(\"X-CSRF-Token\", csrfToken);\r\n        }\r\n        if(headers) {\r\n            $.each( headers, function( key, value ) {\r\n                req.setRequestHeader(key, value);\r\n            });\r\n        }\r\n    \r\n        req.send(data ? data : null);\r\n    };\r\n})(jQuery);\r\n\n//# sourceURL=/lib/graphite-api/public/js/libs/jquery/jquery.mxhr.js"),
define("mpAjax",function(){}),eval('/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4, maxerr: 50, regexp: true, sub: true  */\n/*global define, graphite, XMLHttpRequest, FileReader*/\n\ndefine(\'cceco/CCEcoUtils\',[\n    "jquery",\n    "config/environment",\n    "controllers/AuthController"\n], function ($, environment, AuthController) {\n    "use strict";\n    \n    var CCEcoUtils = {\n        getAjaxHeaders: function (isAuthless) {\n            var headers = {\n                "x-api-key": environment.API_KEY\n            };\n\n            if (isAuthless) {\n                return new $.Deferred().resolve(headers).promise();\n            }\n\n            return AuthController.getAuthModel().getAccessToken().then(function (accessToken) {\n                headers["Authorization"] = "Bearer " + accessToken;\n                \n                return headers;\n            });\n        }\n    };\n    \n    return CCEcoUtils;\n});\n//# sourceURL=/lib/graphite-api/public/js/cceco/CCEcoUtils.js'),eval('/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4, maxerr: 50, regexp: true  */\n/*global define, graphite, window, XMLHttpRequest */\n\ndefine(\'cceco/ImageServiceAPI\',[\n    "jquery",\n    "underscore",\n    "mpAjax",\n    "cceco/CCEcoUtils",\n    "config/environment",\n    "controllers/AuthController",\n    "ccweb.files.extract/Constants"\n], function ($, _, mpAjax, CCEcoUtils, environment, AuthController, Constants) {\n    "use strict";\n    \n    var INTROSPECT_RESOURCE = "/introspect",\n        SPRITESHEET_RESOURCE = "/spritesheet",\n        CREATE_WEBASSET_RESOURCE = "/createwebasset",\n        IMAGE_OPERATION_CONTENT_TYPE = "application/vnd.adobe.image-operation+json",\n        BASE64_PREFIX = "data:image/png;base64,",\n        AUTHLESS_API_PREFIX = "/public/extract";\n    \n    var _authlessRenditionCache = {};\n    \n    function _packStringFromUint8Array(arraybuffer) {\n        var str = \'\',\n            i = 0;\n        for (i = 0; i < arraybuffer.byteLength; i++) {\n            str += String.fromCharCode(arraybuffer[i]);\n        }\n        return str;\n    }\n        \n    function _unit8ArrayBufferToBase64(arrayBuffer) {\n        var str = _packStringFromUint8Array(arrayBuffer);\n        return window.btoa(str);\n    }\n        \n    function _toDataUrl(data) {\n        return BASE64_PREFIX + _unit8ArrayBufferToBase64(data);\n    }\n\n    function _initRequestParams(psdModel, headers, postData, hasOutputs) {\n        var ccPath = psdModel.get("path"),\n            isAuthless = psdModel.get("authless");\n\n        // initialize post data structure\n        postData.inputs = {};\n        postData.inputs.image = {};\n\n        headers["Content-Type"] = IMAGE_OPERATION_CONTENT_TYPE;\n\n        if (isAuthless) {\n            headers["x-creativeurl-share"] = psdModel.get("id");\n            postData.inputs.image.href = ccPath;\n        } else {\n            postData.inputs.image.href = "/" + encodeURIComponent(ccPath);\n        }\n\n        if (hasOutputs) {\n            postData.outputs = {};\n        }\n    }\n    \n    function _handleIntrospectJson(jsonData, layerCompId, ccPath) {\n        /* Result corresponding to content type \'application/json\' in our multipart response. */\n        var data = _packStringFromUint8Array(jsonData);\n        data = JSON.parse(data);\n\n        if (data.imgdata) {\n            data.imgdata.originalFile = ccPath.split(\'/\').pop();\n            data.imgdata.psdPath = ccPath;\n            if (layerCompId) {\n                data.imgdata.appliedLayerCompId = parseInt(layerCompId, 10);\n            }\n        }\n        return data;\n    }\n    \n        \n    function _handleSpritesheetJson(jsonData) {\n        var data = _packStringFromUint8Array(jsonData),\n            sheetJSON = JSON.parse(data),\n            pngLocations  = [];\n\n        /* Result corresponding to content type contentType in our multipart response. */\n        var i = 1;\n        while (sheetJSON.outputs && sheetJSON.outputs.hasOwnProperty("sheet" + i)) {\n            pngLocations.push(sheetJSON.outputs["sheet" + i].location);\n            i++;\n        }\n\n        return {pngLocations: pngLocations, sheetJSON: sheetJSON};\n    }\n    \n        \n    function _findKey(obj, cid) {\n        return _.find(_.keys(obj), function (k) {\n            if (obj[k].href === cid) {\n                return k;\n            }\n        });\n    }\n        \n    function _handleSpritesheetImage(data, contentId, sheetJSON, psdModel) {\n        var cid = \'cid:\' + contentId.substring(1, contentId.length - 1),\n            sheetID = _findKey(sheetJSON.outputs, cid);\n\n        var id = psdModel.get("id"),\n            image = BASE64_PREFIX + _unit8ArrayBufferToBase64(data);\n\n        return {\n            image: image,\n            sheetID: sheetID\n        };\n    }\n    \n    /* Image Service utility to fetch Introspect and SpriteSheet Data. */\n    var ImageServiceAPI = {\n        \n        /**\n         * Image Service utility to fetch Introspect data.\n         * @param {PSDModel} psdModel\n         * @param {Object} headers Includes required AJAX headers (API key and Bearer token for authorized calls)\n         * @return {$.Promise}\n         */\n        _introspect: function (psdModel, headers) {\n            var deferred = new $.Deferred(),\n                isAuthless = psdModel.get("authless"),\n                layerCompId = psdModel.get("layerCompId") && psdModel.get("layerCompId").toString(),\n                postData = {},\n                url;\n\n            _initRequestParams(psdModel, headers, postData, !isAuthless);\n\n            if (layerCompId) {\n                postData.options = { layerCompId: layerCompId };\n            }\n\n            if (isAuthless) {\n                url = environment.COLLAB_IMAGE_SERVICE_HOST +  AUTHLESS_API_PREFIX + INTROSPECT_RESOURCE;\n            } else {\n                url = environment.url(INTROSPECT_RESOURCE, environment.IMAGE_SERVICE_HOST);\n\n                postData.outputs.output = {\n                    accept: IMAGE_OPERATION_CONTENT_TYPE\n                };\n            }\n\n            var ajaxOptions = {\n                headers: headers,\n                url: url,\n                type: \'POST\',\n                data: JSON.stringify(postData),\n                port: environment.IMAGE_SERVICE_PORT,\n                \'application/vnd.adobe.image-operation+json\': function (contentId) {\n                    /* Result corresponding to content type contentType in our multipart response. */\n                    // need to consume this part other wise the applicatpn/json handler will consume it and fail.\n                },\n\n                \'application/json\': function (contentId) {\n                    // need to pass this, as it holds the data to be parsed. That\'s just the way our multipart parser works\n                    var data = _handleIntrospectJson(this, layerCompId, psdModel.get("path"));\n                    \n                    deferred.resolve(data);\n                },\n\n                \'onError\': function () {\n                    deferred.reject(this);\n                }\n            };\n            \n            // enable clients integrating this module to provide an array of custom headers\n            if (!isAuthless && this.introspectCustomHeader) {\n                _.each(this.introspectCustomHeader, function (value, key) {\n                    ajaxOptions.headers[key] = value;\n                });\n            }\n\n            /* Make AJAX request and parse the multipart response */\n            $.multipart(ajaxOptions);\n\n            return deferred.promise();\n            \n        },\n\n        /**\n         * Image Service utility to fetch Introspect data.\n         * @param {PSDModel} psdModel\n         * @return {$.Promise}\n         */\n        introspect: function (psdModel) {\n            var self = this,\n                accessTokenPromise = CCEcoUtils.getAjaxHeaders(psdModel.get("authless"));\n\n            return accessTokenPromise.then(function (headers) {\n                return self._introspect(psdModel, headers);\n            });\n        },\n\n        /**\n         * Image Service utility to fetch sprite sheet data.\n         * @param {PSDModel} psdModel\n         * @param {Object} headers Includes required AJAX headers (API key and Bearer token for authorized calls)\n         * @return {$.Promise}         \n         */\n        _spritesheet: function (psdModel, headers) {\n            var deferred = new $.Deferred(),\n                isAuthless = psdModel.get("authless"),\n                layerCompId = psdModel.get("layerCompId") && psdModel.get("layerCompId").toString(),\n                sheetJSON,\n                pngLocations = [],\n                postData = {},\n                url,\n                spritesheetJSON = \'\',\n                spritesheets = [];\n\n            _initRequestParams(psdModel, headers, postData, true);\n\n            postData.options = {\n                includeDrawable: false,\n                minSheets: 6,\n                clipLayers: true,\n                flattenLayers: true,\n                layerCompId: layerCompId\n            };\n\n            postData.outputs.spriteInfo = {\n                accept: IMAGE_OPERATION_CONTENT_TYPE\n            };\n            postData.outputs.sheets = {\n                // Only use disposition for authorized requests\n                disposition: isAuthless ? undefined : "location",\n                accept: "image/png"\n            };\n\n            if (isAuthless) {\n                url = environment.url(AUTHLESS_API_PREFIX + SPRITESHEET_RESOURCE, environment.COLLAB_IMAGE_SERVICE_HOST);\n            } else {\n                url = environment.url(SPRITESHEET_RESOURCE, environment.IMAGE_SERVICE_HOST);\n            }\n\n            var ajaxOptions = {\n                headers: headers,\n                url: url,\n                type: \'POST\',\n                data: JSON.stringify(postData),\n                port: environment.IMAGE_SERVICE_PORT,\n                \'application/vnd.adobe.image-operation+json\': function (contentId) {\n                    var parsedData = _handleSpritesheetJson(this);\n                    \n                    pngLocations = _.union(pngLocations, parsedData.pngLocations);\n                    sheetJSON = parsedData.sheetJSON;\n                    \n                    if (sheetJSON.imgdata) {\n                        sheetJSON.imgdata.originalFile = psdModel.get("path").split(\'/\').pop();\n                    }\n                    \n                    if (pngLocations) {\n                        sheetJSON.pngLocations = pngLocations;\n                        spritesheetJSON = sheetJSON;\n                    }\n                },\n                               \n                \'application/json\': function (contentId) {\n                    var data = _packStringFromUint8Array(this);\n                    /* Result corresponding to content type \'application/json\' in our multipart response. */\n                    spritesheetJSON = JSON.parse(data);\n                },\n                               \n                \'image/png\': function (contentId) {\n                    var imageData = _handleSpritesheetImage(this, contentId, sheetJSON, psdModel);\n\n                    spritesheets.push({id: imageData.sheetID, dataUrl: imageData.image});\n                },\n                               \n                \'onSuccess\': function () {\n                    deferred.resolve({"spritesheetJSON": spritesheetJSON, "spritesheets": spritesheets});\n                },\n                \'onError\': function () {\n                    deferred.reject(this);\n                }\n            };\n            \n            // enable clients integrating this module to provide an array of custom headers            \n            if (!isAuthless && this.spritesheetCustomHeader) {\n                _.each(this.spritesheetCustomHeader, function (value, key) {\n                    ajaxOptions.headers[key] = value;\n                });\n            }\n\n            /* Make AJAX request and parse the multipart response */\n            $.multipart(ajaxOptions);\n\n            return deferred.promise();\n        },\n\n        /**\n         * Image Service utility to fetch sprite sheet data.\n         * @param {PSDModel} psdModel\n         * @return {$.Promise}         \n         */\n        spritesheet: function (psdModel) {\n            var self = this,\n                accessTokenPromise = CCEcoUtils.getAjaxHeaders(psdModel.get("authless"));\n\n            return accessTokenPromise.then(function (headers) {\n                return self._spritesheet(psdModel, headers);\n            });\n        },\n        \n        /**\n         * Image Service utility to request derived assets from a PSD\n         * @param {PSDModel} psdModel\n         * @param {Array.<LayerModel>} layerModels\n         * @param {string} imageFormat Valid file formats: svg, jpeg/jpg, png-32/png32\n         * @param {Object} options Options for createwebasset endpoint\n         * @param {Object} headers Includes required AJAX headers (API key and Bearer token for authorized calls)\n         * @return {$.Promise}\n         */\n        _createWebAsset: function (psdModel, layerModels, imageFormat, options, headers) {\n            var deferred = new $.Deferred(),\n                url,\n                layerIds = [],\n                layerCompId = psdModel.get("layerCompId") && psdModel.get("layerCompId").toString(),\n                ccPath = psdModel.get("path"),\n                isAuthless = psdModel.get("authless"),\n                iImageQuality,\n                postData = {},\n                accept,\n                useCache = isAuthless && !layerModels,\n                cachedRendition = useCache && _authlessRenditionCache[ccPath];\n            \n            // Use cached rendition for authless requests only\n            if (cachedRendition) {\n                // Self-destruct cache for this PSD on first use\n                delete _authlessRenditionCache[ccPath];\n                \n                deferred.resolve(cachedRendition);\n                return deferred.promise();\n            }\n\n            _initRequestParams(psdModel, headers, postData, true);\n\n            options = options || {};\n\n            // TODO White-list options\n            // https://wiki.corp.adobe.com/display/coretech/Image+Service+Requests#ImageServiceRequests-CreateWebAsset\n            iImageQuality = (typeof options.q === "number") ? options.q : 1.0;\n            options.q = undefined;\n\n            // Set layerIds\n            if (layerModels) {\n                _.each(layerModels, function (layerModel) {\n                    layerIds.push(layerModel.get("layerId"));\n                });\n                options.layerIds = layerIds;\n            }\n            \n            if (layerCompId) {\n                options.layerCompId = layerCompId;\n            }\n\n            postData.options = options;\n\n            // Set image output\n            if (imageFormat === "svg") {\n                accept = \'image/svg+xml\';\n            } else if (imageFormat === "jpeg" || imageFormat === "jpg") {\n                accept = \'image/jpeg; q=\' + iImageQuality;\n            } else if (imageFormat === "png-32" || imageFormat === "png32" || !imageFormat) {\n                accept = \'image/png\'; //Special case: png-32 doesn\'t require x-format parameter.\n            } else {\n                accept = \'image/png; x-format=\' + imageFormat;\n            }\n\n            postData.outputs.output = {\n                accept: accept\n            };\n\n            if (isAuthless) {\n                url = environment.url(AUTHLESS_API_PREFIX + CREATE_WEBASSET_RESOURCE, environment.COLLAB_IMAGE_SERVICE_HOST);\n            } else {\n                url = environment.url(CREATE_WEBASSET_RESOURCE, environment.IMAGE_SERVICE_HOST);\n            }\n\n            var successCallback = function () {\n                var data = _toDataUrl(this);\n                \n                // Cache authless renditions for one-time use in PSDPreviewView\n                if (useCache) {\n                    _authlessRenditionCache[ccPath] = data;\n                }\n                \n                deferred.resolve(data);\n            };\n\n            var ajaxOptions = {\n                headers: headers,\n                url: url,\n                type: \'POST\',\n                data: JSON.stringify(postData),\n                port: environment.IMAGE_SERVICE_PORT,\n                onError: function () {\n                    deferred.reject(this);\n                },\n                \'application/vnd.adobe.image-operation+json\': function (contentId) {\n                    //dummy function required to consume the json data and prevent it from bleeding into other parts                      \n                },\n                \'application/json\': function () {\n                    //dummy function required to consume the json data and prevent it from bleeding into other parts\n                },\n                \'image/png\': successCallback,\n                \'image/jpeg\': successCallback,\n                \'image/svg+xml\': successCallback\n            };\n            \n            $.multipart(ajaxOptions);\n\n            return deferred.promise();\n        },\n\n        /**\n         * Image Service utility to request derived assets from a PSD\n         * @param {PSDModel} psdModel\n         * @param {Array.<LayerModel>} layerModels\n         * @param {string} imageFormat Valid file formats: svg, jpeg/jpg, png-32/png32\n         * @param {Object} options Options for createwebasset endpoint\n         * @return {$.Promise}\n         */\n\n        createWebAsset: function (psdModel, layerModels, imageFormat, options) {\n            var self = this,\n                accessTokenPromise = CCEcoUtils.getAjaxHeaders(psdModel.get("authless"));\n\n            return accessTokenPromise.then(function (headers) {\n                return self._createWebAsset(psdModel, layerModels, imageFormat, options, headers);\n            });\n        }\n    };\n\n    return ImageServiceAPI;\n});\n//# sourceURL=/lib/graphite-api/public/js/cceco/ImageServiceAPI.js'),eval('/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4, maxerr: 50 */\n/*global define */\n\ndefine(\'override/cceco/BracketsImageServiceAPI\',[\n    "jquery",\n    "underscore",\n    "cceco/ImageServiceAPI"\n], function ($, _, ImageServiceAPI) {\n    "use strict";\n\n        \n    ImageServiceAPI.introspectCustomHeader = {};\n    ImageServiceAPI.spritesheetCustomHeader = {};\n        \n    ImageServiceAPI._getCachePath = function (psdModel) {\n        var ccPath = psdModel.get("path"),\n            layerCompId = psdModel.get("layerCompId");\n\n        if (layerCompId) {\n            return ccPath + "/" + layerCompId;\n        } else {\n            return ccPath;\n        }\n    };\n\n    var introspect = ImageServiceAPI.introspect;\n    ImageServiceAPI.introspect = function (psdModel) {\n        // add cache directive as custom header. The cache will use this header to determin where to save requests to \n        ImageServiceAPI.introspectCustomHeader = {\'e4b-cache-path\': this._getCachePath(psdModel)};\n        return introspect.apply(ImageServiceAPI, arguments);\n    };\n\n    var spritesheet = ImageServiceAPI.spritesheet;\n    ImageServiceAPI.spritesheet = function (psdModel) {\n        // add cache directive as custom header. The cache will use this header to determin where to save requests to \n        ImageServiceAPI.spritesheetCustomHeader = {\'e4b-cache-path\': this._getCachePath(psdModel)};\n        return spritesheet.apply(ImageServiceAPI, arguments);\n    };\n\n    return ImageServiceAPI;\n});\n//# sourceURL=/./cceco/BracketsImageServiceAPI.js'),eval('/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4, maxerr: 50, regexp: true, sub: true  */\n/*global define, graphite, XMLHttpRequest, FileReader*/\n\ndefine(\'cceco/StorageServiceAPI\',[\n    "jquery",\n    "cceco/CCEcoUtils",\n    "config/environment",\n    "controllers/AuthController"\n], function ($, CCEcoUtils, environment, AuthController) {\n    "use strict";\n    \n\n    function getAssetThumbnailUrl(ccPath, size) {\n        size = size || 230;\n        ccPath = ccPath.replace(/\\/?files\\/?/, "");\n        // TODO select size in a smarter way so that we can fetch smaller thumbnails for PSD that don\'t have an extreme height to width ratio\n        var url = environment.url("/files/" + ccPath + "/:rendition;size=" + size, environment.FILESTORAGE_HOST);\n        return url;\n    }\n    \n    /* \n     * Storage Service utility to fetch data such as image files from Storage Service\n     * @param {string} storagePath CC path to asset to fetch\n     * @callback callback         \n     */\n    var StorageServiceAPI = {\n        _rendition: function (storagePath, size, headers, callback) {\n            var self = this,\n                pathStr = "",\n                oReq = new XMLHttpRequest(),\n                parfaitUrl = getAssetThumbnailUrl(storagePath, size);\n            \n            oReq.open("get", parfaitUrl, true);\n            oReq.responseType = "blob";\n            oReq.setRequestHeader("Authorization", headers["Authorization"]);\n            oReq.setRequestHeader("x-api-key", headers["x-api-key"]);\n            oReq.setRequestHeader("Accept", \'image/jpeg, image/jpg, */*;q=0.1\');\n            oReq.onload = function (oEvent) {\n                if (oReq.status === 200) {\n                    var blob = oReq.response,\n                        reader = new FileReader();\n\n                    reader.addEventListener("loadend", function () {\n                        if (callback) {\n                            callback(null, [reader.result]);\n                        }\n                    });\n                    reader.readAsDataURL(blob);\n                } else {\n                    callback(oReq.status, null);\n                }\n            };\n\n            oReq.send(null);\n        },\n\n        rendition: function (storagePath, size, callback) {\n            var self = this;\n\n            CCEcoUtils.getAjaxHeaders().done(function (headers) {\n                self._rendition(storagePath, size, headers, callback);\n            });\n        },\n\n        metadata: function (storagePath) {\n            return CCEcoUtils.getAjaxHeaders().then(function (headers) {\n                var endpoint = "/" + storagePath + "/:metadata";\n\n                var ajaxPromise = $.ajax({\n                    headers: headers,\n                    url: environment.url(endpoint, environment.FILESTORAGE_HOST),\n                    dataType: "json"\n                });\n\n                ajaxPromise.fail(function (jqXHR, textStatus, errorThrown) {\n                    graphite.events.trigger("image-service-error", encodeURI(storagePath), textStatus);\n                });\n\n                return ajaxPromise;\n            });\n        },\n        \n        upload: function (entry, url, loadHandler, errorHandler, progressHandler) {\n            var xhr = new XMLHttpRequest(),\n                ajaxOptions = graphite.serverAPI.createAjaxOptions(\'PUT\', url);\n\n            xhr.open(\'put\', ajaxOptions.url);\n\n            xhr.setRequestHeader(\'Content-Type\', \'application/octet-stream\');\n            xhr.setRequestHeader(\'Content-Disposition\', \'attachment; filename="\' +\n                                 encodeURIComponent(entry.asset.get(\'name\')) + \'"\');\n            xhr.setRequestHeader(\'Authorization\', ajaxOptions.headers.Authorization);\n            xhr.setRequestHeader(\'X-api-key\', ajaxOptions.headers[\'X-api-key\']);\n            \n            xhr.onload = function () {\n                loadHandler(this);\n            };\n            xhr.onerror = errorHandler;\n            xhr.upload.onprogress = function (progress) {\n                progressHandler(progress);\n            };\n\n            xhr.send(entry.file);\n        },\n        \n        archive: function (ccPath, successCallback, errorHandler) {\n            var xhr = new XMLHttpRequest(),\n                fileName = ccPath.substring(ccPath.lastIndexOf("/") + 1, ccPath.length),\n                ajaxOptions = graphite.serverAPI.createAjaxOptions(\'PUT\', "/archive/" + encodeURI(fileName));\n            \n            xhr.open(\'put\', ajaxOptions.url);\n            xhr.setRequestHeader(\'Authorization\', ajaxOptions.headers.Authorization);\n            xhr.setRequestHeader(\'X-api-key\', ajaxOptions.headers[\'X-api-key\']);\n            xhr.setRequestHeader(\'Link\', "<" + ccPath + ">;rel=self");\n            xhr.setRequestHeader(\'Accept\', \'application/vnd.adobe.file+json, application/vnd.adobe.directory+json\');\n\n            xhr.onload = function () {\n                successCallback(this);\n            };\n            xhr.onerror = errorHandler;\n\n            xhr.send();\n        }\n    };\n\n    \n    return StorageServiceAPI;\n});\n//# sourceURL=/lib/graphite-api/public/js/cceco/StorageServiceAPI.js'),eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4 */\n/*global define, graphite, mixpanel, FileReader, escape */\n\ndefine('lib/graphite-api/public/js/serverAPI',[\n    \"jquery\",\n    \"underscore\",\n    \"controllers/AuthController\",\n    \"config/environment\",\n    \"cceco/ImageServiceAPI\",\n    \"cceco/StorageServiceAPI\",\n    \"ccweb.files.extract/Constants\"\n], function ($, _, AuthController, environment, ImageServiceAPI, StorageServiceAPI, Constants) {\n    \"use strict\";\n    \n    var acceptHeader;\n\n    function beforeSend(xhr, headers) {\n        var myAccessToken = AuthController.getAuthModel().attributes.access_token;\n        xhr.setRequestHeader('Authorization', \"Bearer \" + myAccessToken);\n        xhr.setRequestHeader('x-api-key', environment.API_KEY);\n        \n        if (acceptHeader) {\n            xhr.setRequestHeader('Accept', acceptHeader);\n        }\n    }\n    \n    function setFetchCallbacks(fetchOptions, successCallback, errorCallback, context) {\n        if (successCallback) {\n            fetchOptions.success = function (model, response) {\n                successCallback.apply(context, [response]);\n            };\n        }\n\n        if (errorCallback) {\n            fetchOptions.error = function (model, response) {\n                errorCallback.apply(context, [response]);\n            };\n        }\n        \n        fetchOptions.beforeSend = beforeSend;\n\n        return fetchOptions;\n    }\n\n    function setAJAXCallbacks(options, successCallback, errorCallback, context) {\n        if (successCallback) {\n            options.success = function (data, textStatus, response) {\n                successCallback.apply(context, [response]);\n            };\n        }\n\n        if (errorCallback) {\n            options.error = function (response) {\n                errorCallback.apply(context, [response]);\n            };\n        }\n    }\n    \n    function _isApiEndpoint(url) {\n        return url.match(/https:\\/\\/cc-api/);\n    }\n    \n    function _isStorageRequest(url) {\n        return url.match(/files|archive/);\n    }\n    \n    function constructProxyURL(url, args) {\n        if (_isApiEndpoint(url)) {\n            return environment.url(url + (args ? '?' + args : ''));\n        }\n        \n        if (_isStorageRequest(url)) {\n            return environment.url(url + (args ? '?' + args : ''), environment.FILESTORAGE_HOST);\n        }\n            \n        return url + (args ? '?' + args : '');\n    }\n        \n    function _customFilter(object, key, spriteSheet, flattenedSprite) {\n        if (object.hasOwnProperty('layerId') && object.layerId === key) {\n            object.spriteSheet = spriteSheet;\n            object.flattenedSprite = flattenedSprite;\n            return;\n        }\n\n        var i;\n        for (i = 0; i < Object.keys(object).length; i++) {\n            if (typeof object[Object.keys(object)[i]] === \"object\") {\n                _customFilter(object[Object.keys(object)[i]], key, spriteSheet, flattenedSprite);\n            }\n        }\n        return;\n    }\n\n    function _mergeIntroAndLayerSpriteSheets(introspectData, spriteData) {\n        _.each(spriteData.layers, function (layer) {\n            _customFilter(introspectData, layer.layerId, layer.spriteSheet, layer.flattenedSprite);\n        });\n        \n        return introspectData;\n    }\n\n    function _parseModel(introspectData, spritesheetResult, model) {\n        var spritesheetData = spritesheetResult.spritesheetJSON,\n            spritesheets = spritesheetResult.spritesheets,\n            mergeData = _mergeIntroAndLayerSpriteSheets(introspectData, spritesheetData);\n\n        if (spritesheetData.pngLocations) {\n            model.set(\"pngLocations\", spritesheetData.pngLocations);\n        }\n\n        _.each(spritesheets, function (sheet) {\n            model.set(sheet.id, sheet.dataUrl);\n        });\n\n        model.parse(mergeData);\n        \n        return model;\n    }\n\n    var serverAPI = {\n        \n        createAjaxOptions: function (type, location) {\n            var authorization = \"Bearer \" + AuthController.getAuthModel().attributes.access_token,\n                options = {\n                    'type': type,\n                    'url': constructProxyURL(location),\n                    'headers': {\n                        'Authorization': authorization,\n                        'Accept': '*/*',\n                        'X-api-key': environment.API_KEY\n                    }\n                };\n\n            return options;\n        },\n        \n        // APIs used by AssetController\n        // Load an AssetCollection object, shouldn't need this for ccweb but added the API for AssetController\n        loadAssetCollection: function (assetCollection, successCallback, errorCallback, context, inPath, xChildrenNextStart) {\n            var ccfilesRoot = \"/files\",\n                path = inPath ?  ccfilesRoot + \"/\" + inPath : ccfilesRoot,\n                fetchOptions;\n\n            acceptHeader = \"application/vnd.adobe.directory+json\";\n            path = encodeURI(path);\n            fetchOptions = {\n                url: environment.url(path, environment.FILESTORAGE_HOST)\n            };\n            \n            setFetchCallbacks(fetchOptions, successCallback, errorCallback, context);\n                        \n            if (xChildrenNextStart) {\n                fetchOptions.url = fetchOptions.url + '?start=' + xChildrenNextStart;\n                fetchOptions.remove = false; //Append the newly fetch data to collection\n            }\n            \n            var jqXHR = assetCollection.fetch(fetchOptions);\n            jqXHR.done(function () {\n                var xChildrenNextStart = jqXHR.getResponseHeader('X-Children-Next-Start');\n                if (xChildrenNextStart) {\n                    var incrementalFetchObj = {};\n                    incrementalFetchObj.path = inPath;\n                    incrementalFetchObj.xChildrenNextStart = xChildrenNextStart;\n                    window.graphite.events.trigger('loadMoreAssets', incrementalFetchObj);\n                }\n            });\n        },\n\n        loadAssetMetadata: function (storagePath) {\n            return StorageServiceAPI.metadata(storagePath);\n        },\n\n        loadPsdModelFromPath: function (psdModel, successCallback, errorCallback, context) {\n            var introspectPromise = ImageServiceAPI.introspect(psdModel),\n                spritesheetPromise = ImageServiceAPI.spritesheet(psdModel);\n            \n            $.when(introspectPromise, spritesheetPromise).then(function (introspectData, spritesheetResult) {\n                psdModel = _parseModel(introspectData, spritesheetResult, psdModel);\n                successCallback.apply(context);\n            }, function (err) {\n                graphite.events.trigger(\"image-service-error\", encodeURI(psdModel.get(\"path\")), false);\n                errorCallback.apply(context);\n            });\n        },\n        \n        getAssetFromUrl: function (url, callback) {\n            var options = {\n                url: url\n            };\n\n            var oReq = new XMLHttpRequest(),\n                accessToken = AuthController.getAuthModel().attributes.access_token;\n            \n            oReq.open(\"get\", options.url, true);\n            oReq.responseType = \"blob\";\n            oReq.setRequestHeader(\"Authorization\", \"Bearer \" + accessToken);\n            oReq.setRequestHeader(\"x-api-key\", environment.API_KEY);\n            oReq.setRequestHeader(\"Accept\", 'image/png, image/jpeg, image/jpg, application/pdf, text/html, text/plain, */*;q=0.1');\n            \n            // enable clients integrating this module to provide an array of custom headers\n            if (this.customHeader) {\n                _.each(this.customHeader, function (value, key) {\n                    oReq.setRequestHeader(key, value);\n                });\n            }\n            \n            oReq.onload = function (oEvent) {\n                if (oReq.status === 200) {\n                    var blob = oReq.response,\n                        reader = new FileReader();\n\n                    reader.addEventListener(\"loadend\", function () {\n                        if (callback) {\n                            callback.apply(null, [reader.result]);\n                        }\n                    });\n                    reader.readAsDataURL(blob);\n                }\n            };\n            oReq.onerror = function (data) {\n                // TBI\n            };\n            oReq.send(null);\n        },\n\n        // Load a local PSDModel object, only used for 1st launch content\n        loadLocalPsdModel: function (psdModel, inUrl, successCallback, errorCallback, context) {\n            var fetchOptions = {\n                    url: inUrl\n                },\n                self = this;\n\n            setFetchCallbacks(fetchOptions, successCallback, errorCallback, context);\n            psdModel.fetch(fetchOptions);\n\n        },\n\n        /**\n         *\n         * @param {PSDModel} psdModel\n         * @param {Array.<LayerModel>} layerModels\n         * @param {{layerCompID: string, scale: number, svgEncodingType: string, svgEncodingQuality: number, scaleX: number, scaleY: number}} options\n         */\n        getDerivedAsset: function (psdModel, layerModels, imageFormat, options) {\n            return ImageServiceAPI.createWebAsset(psdModel, layerModels, imageFormat, options);\n        },\n\n        // Archive an asset from the users collection\n        deleteAsset: function (ccPath, successCallback, errorCallback) {\n            StorageServiceAPI.archive(ccPath, successCallback, errorCallback);\n        },\n\n        // APIs used by DerivedAssetController\n        // PSD Lens currently has no use case for this , hence I'm leaving it as it may be required by other clients.\n        loadDerivedAssetCollection: function (derivedAssetCollection, psdModel,\n                                               successCallback, errorCallback, context) {\n            var post_data,\n                fetchOptions = {\n                    url: environment.url(\"/createwebasset\", environment.IMAGE_SERVICE_HOST),\n                    reset: true,\n                    post_data: post_data\n                };\n            setFetchCallbacks(fetchOptions, successCallback, errorCallback, context);\n            derivedAssetCollection.fetch(fetchOptions);\n        },\n        \n        // TODO fix this call\n        // PSD Lens currently has no use case for this , hence I'm leaving it as it may be required by other clients.        \n        createDerivedAsset: function (jsonPostObject, successCallback, errorCallback, context) {\n            var jsonPostData = JSON.stringify(jsonPostObject),\n                options = {\n                    type: 'POST',\n                    url: environment.url('/api/v1/psd/' + jsonPostObject.psdGuid + '/derived?nocache=' + $.now()),\n                    // The key needs to match your method's input parameter (case-sensitive).\n                    data: jsonPostData,\n                    dataType: \"json\"\n                };\n\n            setAJAXCallbacks(options, successCallback, errorCallback, context);\n            $.ajax(options);\n        },\n\n        getWorkerStatus: function (workerGuid, successCallback, errorCallback, context) {\n            var options = {\n                url: environment.url('/api/v1/worker/' + workerGuid)\n            };\n\n            setAJAXCallbacks(options, successCallback, errorCallback, context);\n            $.ajax(options);\n        },\n\n        getSpriteSheetURL: function (path) {\n            var location = environment.url(path, environment.FILESTORAGE_HOST);\n            return location;\n        },\n\n        // ___________ metrics_________\n        // called from MetricsProxyModel\n\n        registerPersistentParameters: function (params) {\n            mixpanel.register(params);\n        },\n        // ________end metrics_________\n\n        // APIs used by AssetView - probably don't need for ccweb\n        getAssetInfo: function (assetId, successCallback, errorCallback, context) {\n            var options = this.createAjaxOptions('GET', '/api/v1/psd/' + assetId + '/info');\n\n            setAJAXCallbacks(options, successCallback, errorCallback, context);\n            $.ajax(options);\n        },\n\n        // API used by InspectStyleOverlayView\n        getLayerURL: function (psdGuid, layerId) {\n            return environment.url('/api/v1/psd/' + psdGuid + '/layer/' + layerId);\n        },\n\n        // Effectively replaces getDefaultRenditionURL but returns image as\n        // dataURI\n        getRendition: function (storagePathOrModel, size, callback) {\n            var isPathString = typeof storagePathOrModel === \"string\",\n                path = isPathString ? storagePathOrModel : (storagePathOrModel.get && storagePathOrModel.get(\"path\")),\n                isAuthless = (storagePathOrModel.get && storagePathOrModel.get(\"authless\")) || false,\n                layerCompId = (storagePathOrModel.get && storagePathOrModel.get(\"layerCompId\"));\n\n            // StorageServiceAPI can only show authorized renditions that don't use layer comps\n            if (isAuthless || layerCompId) {\n                ImageServiceAPI.createWebAsset(storagePathOrModel, null, \"jpeg\", { q: 0.25 }).done(function (dataURI) {\n                    callback.call(null, null, dataURI);\n                }).fail(function (err) {\n                    callback.call(null, err, null);\n                });\n            } else if (path) {\n                StorageServiceAPI.rendition(path, size, callback);\n            } else {\n                callback(null, \"Invalid parameter in getRendition: \" + storagePathOrModel);\n            }\n        },\n\n        getDefaultRenditionURL: function (psdGuid) {\n            return environment.url('/api/v1/psd/' + psdGuid);\n        },\n\n        // APIs used by ViewTemplates.html\n        getDerivedRenditionURL: function (assetID) {\n            return environment.url('/api/v1/asset/' + assetID + '/thumbnail');\n        },\n\n        getDerivedDownloadURL: function (assetID, name) {\n            return environment.url('/api/v1/asset/' + assetID + '/download');\n        },\n\n        deleteDerivedAsset: function (derivedAssetId, successCallback, errorCallback, context) {\n            var options = {\n                url: environment.url('/api/v1/psd/' + derivedAssetId + '/derived/delete'),\n                type: 'DELETE'\n            };\n            setAJAXCallbacks(options, successCallback, errorCallback, context);\n\n            $.ajax(options);\n        },\n\n        getDerivedSpriteImage: function (psdModel, layers, successCallback, errorCallback, context) {\n            var image = new Image(),\n                options;\n\n            image.onload = function () {\n                successCallback.apply(context);\n            };\n            \n            image.onerror = function (result) {\n                errorCallback.apply(context, [result]);\n            };\n            \n            // Bypass LayerModels array param. `layers` input arg is passed as\n            // raw layer IDs.\n            options = {\n                layerIds: layers\n            };\n            \n            ImageServiceAPI.createWebAsset(psdModel, null, \"png32\", options).done(function (result) {\n                image.src = result;\n            }).fail(function () {\n                errorCallback.apply(context);\n            });\n\n            return image;\n        },\n        \n        upload: function (entry, url, loadHandler, errorHandler, progressHandler) {\n            StorageServiceAPI.upload(entry, url, loadHandler, errorHandler, progressHandler);\n        },\n\n        loadCrossDomainImage: function (image, src) {\n            image.src = src;\n        },\n        \n        applyCrossDomainPolicy: function (image) {\n            // NOOP\n        }\n    };\n\n    return serverAPI;\n\n});\n\n//# sourceURL=/lib/graphite-api/public/js/serverAPI.js"),
eval('/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4, bitwise: true, sub: true */\n/*global define, window, AppMeasurement*/\ndefine(\'ext/metrics/BaseMetricsWrapper\',[\n    "backbone",\n    "ext/models/BracketsPreferencesModel"\n], function (Backbone, BracketsPreferencesModel) {\n    "use strict";\n    \n    var prefs = BracketsPreferencesModel.get("preferenceSystem");\n\n    var BaseMetricsWrapper = Backbone.Model.extend({\n        \n        BUFFER_SIZE: 50, // Mixpanel max batch size\n        \n        initialize: function () {\n            var self = this;\n            \n            // Make sure we only send metrics when the EULA is accepted\n            prefs.getPreference(BracketsPreferencesModel.EULA_ACCEPTED).on("change", function () {\n                self.handleEulaAccepted(self.isEulaAccepted());\n            });\n            \n            // Check EULA on init\n            this.handleEulaAccepted(this.isEulaAccepted());\n        },\n        \n        getPrefs: function () {\n            return prefs;\n        },\n        \n        isEulaAccepted: function () {\n            return prefs.get(BracketsPreferencesModel.EULA_ACCEPTED);\n        },\n        \n        useBuffer: function () {\n            return prefs.get(BracketsPreferencesModel.USE_METRICS_BUFFER);\n        },\n        \n        handleEulaAccepted: function (accepted) {\n            // subclasses must override\n            throw new Error("Unimplemented method: handleEulaAccepted");\n        },\n        \n        flush: function (flushAsync) {\n            // base implementation\n        },\n        \n        track: function (eventName, params) {\n            // subclasses must override\n            throw new Error("Unimplemented method: track");\n        }\n\n    });\n    \n    return BaseMetricsWrapper;\n});\n//# sourceURL=/./metrics/BaseMetricsWrapper.js'),eval('/*\n ============== DO NOT ALTER ANYTHING BELOW THIS LINE ! ===============\n\n AppMeasurement for JavaScript version: 1.3.2\n Copyright 1996-2013 Adobe, Inc. All Rights Reserved\n More info available at http://www.omniture.com\n*/\nfunction AppMeasurement(){var s=this;s.version="1.3.2";var w=window;if(!w.s_c_in)w.s_c_il=[],w.s_c_in=0;s._il=w.s_c_il;s._in=w.s_c_in;s._il[s._in]=s;w.s_c_in++;s._c="s_c";var k=w.ob;k||(k=null);var j=w,g,o;try{g=j.parent;for(o=j.location;g&&g.location&&o&&""+g.location!=""+o&&j.location&&""+g.location!=""+j.location&&g.location.host==o.host;)j=g,g=j.parent}catch(p){}s.Za=function(s){try{console.log(s)}catch(a){}};s.oa=function(s){return""+parseInt(s)==""+s};s.replace=function(s,a,c){if(!s||s.indexOf(a)<\n0)return s;return s.split(a).join(c)};s.escape=function(b){var a,c;if(!b)return b;b=encodeURIComponent(b);for(a=0;a<7;a++)c="+~!*()\'".substring(a,a+1),b.indexOf(c)>=0&&(b=s.replace(b,c,"%"+c.charCodeAt(0).toString(16).toUpperCase()));return b};s.unescape=function(b){if(!b)return b;b=b.indexOf("+")>=0?s.replace(b,"+"," "):b;try{return decodeURIComponent(b)}catch(a){}return unescape(b)};s.Qa=function(){var b=w.location.hostname,a=s.fpCookieDomainPeriods,c;if(!a)a=s.cookieDomainPeriods;if(b&&!s.ha&&\n!/^[0-9.]+$/.test(b)&&(a=a?parseInt(a):2,a=a>2?a:2,c=b.lastIndexOf("."),c>=0)){for(;c>=0&&a>1;)c=b.lastIndexOf(".",c-1),a--;s.ha=c>0?b.substring(c):b}return s.ha};s.c_r=s.cookieRead=function(b){b=s.escape(b);var a=" "+s.d.cookie,c=a.indexOf(" "+b+"="),e=c<0?c:a.indexOf(";",c);b=c<0?"":s.unescape(a.substring(c+2+b.length,e<0?a.length:e));return b!="[[B]]"?b:""};s.c_w=s.cookieWrite=function(b,a,c){var e=s.Qa(),d=s.cookieLifetime,f;a=""+a;d=d?(""+d).toUpperCase():"";c&&d!="SESSION"&&d!="NONE"&&((f=a!=\n""?parseInt(d?d:0):-60)?(c=new Date,c.setTime(c.getTime()+f*1E3)):c==1&&(c=new Date,f=c.getYear(),c.setYear(f+5+(f<1900?1900:0))));if(b&&d!="NONE")return s.d.cookie=b+"="+s.escape(a!=""?a:"[[B]]")+"; path=/;"+(c&&d!="SESSION"?" expires="+c.toGMTString()+";":"")+(e?" domain="+e+";":""),s.cookieRead(b)==a;return 0};s.D=[];s.C=function(b,a,c){if(s.ia)return 0;if(!s.maxDelay)s.maxDelay=250;var e=0,d=(new Date).getTime()+s.maxDelay,f=s.d.mb,i=["webkitvisibilitychange","visibilitychange"];if(!f)f=s.d.nb;\nif(f&&f=="prerender"){if(!s.V){s.V=1;for(c=0;c<i.length;c++)s.d.addEventListener(i[c],function(){var b=s.d.mb;if(!b)b=s.d.nb;if(b=="visible")s.V=0,s.delayReady()})}e=1;d=0}else c||s.r("_d")&&(e=1);e&&(s.D.push({m:b,a:a,t:d}),s.V||setTimeout(s.delayReady,s.maxDelay));return e};s.delayReady=function(){var b=(new Date).getTime(),a=0,c;for(s.r("_d")&&(a=1);s.D.length>0;){c=s.D.shift();if(a&&!c.t&&c.t>b){s.D.unshift(c);setTimeout(s.delayReady,parseInt(s.maxDelay/2));break}s.ia=1;s[c.m].apply(s,c.a);s.ia=\n0}};s.setAccount=s.sa=function(b){var a,c;if(!s.C("setAccount",arguments))if(s.account=b,s.allAccounts){a=s.allAccounts.concat(b.split(","));s.allAccounts=[];a.sort();for(c=0;c<a.length;c++)(c==0||a[c-1]!=a[c])&&s.allAccounts.push(a[c])}else s.allAccounts=b.split(",")};s.foreachVar=function(b,a){var c,e,d,f,i="";d=e="";if(s.lightProfileID)c=s.H,(i=s.lightTrackVars)&&(i=","+i+","+s.Y.join(",")+",");else{c=s.c;if(s.pe||s.linkType)if(i=s.linkTrackVars,e=s.linkTrackEvents,s.pe&&(d=s.pe.substring(0,1).toUpperCase()+\ns.pe.substring(1),s[d]))i=s[d].lb,e=s[d].kb;i&&(i=","+i+","+s.A.join(",")+",");e&&i&&(i+=",events,")}a&&(a=","+a+",");for(e=0;e<c.length;e++)d=c[e],(f=s[d])&&(!i||i.indexOf(","+d+",")>=0)&&(!a||a.indexOf(","+d+",")>=0)&&b(d,f)};s.J=function(b,a,c,e,d){var f="",i,m,w,q,g=0;b=="contextData"&&(b="c");if(a){for(i in a)if(!Object.prototype[i]&&(!d||i.substring(0,d.length)==d)&&a[i]&&(!c||c.indexOf(","+(e?e+".":"")+i+",")>=0)){w=!1;if(g)for(m=0;m<g.length;m++)i.substring(0,g[m].length)==g[m]&&(w=!0);if(!w&&\n(f==""&&(f+="&"+b+"."),m=a[i],d&&(i=i.substring(d.length)),i.length>0))if(w=i.indexOf("."),w>0)m=i.substring(0,w),w=(d?d:"")+m+".",g||(g=[]),g.push(w),f+=s.J(m,a,c,e,w);else if(typeof m=="boolean"&&(m=m?"true":"false"),m){if(e=="retrieveLightData"&&d.indexOf(".contextData.")<0)switch(w=i.substring(0,4),q=i.substring(4),i){case "transactionID":i="xact";break;case "channel":i="ch";break;case "campaign":i="v0";break;default:s.oa(q)&&(w=="prop"?i="c"+q:w=="eVar"?i="v"+q:w=="list"?i="l"+q:w=="hier"&&(i=\n"h"+q,m=m.substring(0,255)))}f+="&"+s.escape(i)+"="+s.escape(m)}}f!=""&&(f+="&."+b)}return f};s.Sa=function(){var b="",a,c,e,d,f,i,m,w,g="",k="",j=c="";if(s.lightProfileID)a=s.H,(g=s.lightTrackVars)&&(g=","+g+","+s.Y.join(",")+",");else{a=s.c;if(s.pe||s.linkType)if(g=s.linkTrackVars,k=s.linkTrackEvents,s.pe&&(c=s.pe.substring(0,1).toUpperCase()+s.pe.substring(1),s[c]))g=s[c].lb,k=s[c].kb;g&&(g=","+g+","+s.A.join(",")+",");k&&(k=","+k+",",g&&(g+=",events,"));s.events2&&(j+=(j!=""?",":"")+s.events2)}s.AudienceManagement&&\ns.AudienceManagement.isReady()&&(b+=s.J("d",s.AudienceManagement.getEventCallConfigParams()));for(c=0;c<a.length;c++){d=a[c];f=s[d];e=d.substring(0,4);i=d.substring(4);!f&&d=="events"&&j&&(f=j,j="");if(f&&(!g||g.indexOf(","+d+",")>=0)){switch(d){case "supplementalDataID":d="sdid";break;case "timestamp":d="ts";break;case "dynamicVariablePrefix":d="D";break;case "visitorID":d="vid";break;case "marketingCloudVisitorID":d="mid";break;case "analyticsVisitorID":d="aid";break;case "audienceManagerLocationHint":d=\n"aamlh";break;case "audienceManagerBlob":d="aamb";break;case "pageURL":d="g";if(f.length>255)s.pageURLRest=f.substring(255),f=f.substring(0,255);break;case "pageURLRest":d="-g";break;case "referrer":d="r";break;case "vmk":case "visitorMigrationKey":d="vmt";break;case "visitorMigrationServer":d="vmf";s.ssl&&s.visitorMigrationServerSecure&&(f="");break;case "visitorMigrationServerSecure":d="vmf";!s.ssl&&s.visitorMigrationServer&&(f="");break;case "charSet":d="ce";break;case "visitorNamespace":d="ns";\nbreak;case "cookieDomainPeriods":d="cdp";break;case "cookieLifetime":d="cl";break;case "variableProvider":d="vvp";break;case "currencyCode":d="cc";break;case "channel":d="ch";break;case "transactionID":d="xact";break;case "campaign":d="v0";break;case "resolution":d="s";break;case "colorDepth":d="c";break;case "javascriptVersion":d="j";break;case "javaEnabled":d="v";break;case "cookiesEnabled":d="k";break;case "browserWidth":d="bw";break;case "browserHeight":d="bh";break;case "connectionType":d="ct";\nbreak;case "homepage":d="hp";break;case "plugins":d="p";break;case "events":j&&(f+=(f!=""?",":"")+j);if(k){i=f.split(",");f="";for(e=0;e<i.length;e++)m=i[e],w=m.indexOf("="),w>=0&&(m=m.substring(0,w)),w=m.indexOf(":"),w>=0&&(m=m.substring(0,w)),k.indexOf(","+m+",")>=0&&(f+=(f?",":"")+i[e])}break;case "events2":f="";break;case "contextData":b+=s.J("c",s[d],g,d);f="";break;case "lightProfileID":d="mtp";break;case "lightStoreForSeconds":d="mtss";s.lightProfileID||(f="");break;case "lightIncrementBy":d=\n"mti";s.lightProfileID||(f="");break;case "retrieveLightProfiles":d="mtsr";break;case "deleteLightProfiles":d="mtsd";break;case "retrieveLightData":s.retrieveLightProfiles&&(b+=s.J("mts",s[d],g,d));f="";break;default:s.oa(i)&&(e=="prop"?d="c"+i:e=="eVar"?d="v"+i:e=="list"?d="l"+i:e=="hier"&&(d="h"+i,f=f.substring(0,255)))}f&&(b+="&"+d+"="+(d.substring(0,3)!="pev"?s.escape(f):f))}d=="pev3"&&s.g&&(b+=s.g)}return b};s.v=function(s){var a=s.tagName;if(""+s.sb!="undefined"||""+s.eb!="undefined"&&(""+s.eb).toUpperCase()!=\n"HTML")return"";a=a&&a.toUpperCase?a.toUpperCase():"";a=="SHAPE"&&(a="");a&&((a=="INPUT"||a=="BUTTON")&&s.type&&s.type.toUpperCase?a=s.type.toUpperCase():!a&&s.href&&(a="A"));return a};s.ka=function(s){var a=s.href?s.href:"",c,e,d;c=a.indexOf(":");e=a.indexOf("?");d=a.indexOf("/");if(a&&(c<0||e>=0&&c>e||d>=0&&c>d))e=s.protocol&&s.protocol.length>1?s.protocol:l.protocol?l.protocol:"",c=l.pathname.lastIndexOf("/"),a=(e?e+"//":"")+(s.host?s.host:l.host?l.host:"")+(h.substring(0,1)!="/"?l.pathname.substring(0,\nc<0?0:c)+"/":"")+a;return a};s.F=function(b){var a=s.v(b),c,e,d="",f=0;if(a){c=b.protocol;e=b.onclick;if(b.href&&(a=="A"||a=="AREA")&&(!e||!c||c.toLowerCase().indexOf("javascript")<0))d=s.ka(b);else if(e)d=s.replace(s.replace(s.replace(s.replace(""+e,"\\r",""),"\\n",""),"\\t","")," ",""),f=2;else if(a=="INPUT"||a=="SUBMIT"){if(b.value)d=b.value;else if(b.innerText)d=b.innerText;else if(b.textContent)d=b.textContent;f=3}else if(b.src&&a=="IMAGE")d=b.src;if(d)return{id:d.substring(0,100),type:f}}return 0};\ns.pb=function(b){for(var a=s.v(b),c=s.F(b);b&&!c&&a!="BODY";)if(b=b.parentElement?b.parentElement:b.parentNode)a=s.v(b),c=s.F(b);if(!c||a=="BODY")b=0;if(b&&(a=b.onclick?""+b.onclick:"",a.indexOf(".tl(")>=0||a.indexOf(".trackLink(")>=0))b=0;return b};s.bb=function(){var b,a,c=s.linkObject,e=s.linkType,d=s.linkURL,f,i;s.Z=1;if(!c)s.Z=0,c=s.j;if(c){b=s.v(c);for(a=s.F(c);c&&!a&&b!="BODY";)if(c=c.parentElement?c.parentElement:c.parentNode)b=s.v(c),a=s.F(c);if(!a||b=="BODY")c=0;if(c){var m=c.onclick?""+\nc.onclick:"";if(m.indexOf(".tl(")>=0||m.indexOf(".trackLink(")>=0)c=0}}else s.Z=1;!d&&c&&(d=s.ka(c));d&&!s.linkLeaveQueryString&&(f=d.indexOf("?"),f>=0&&(d=d.substring(0,f)));if(!e&&d){var g=0,k=0,j;if(s.trackDownloadLinks&&s.linkDownloadFileTypes){m=d.toLowerCase();f=m.indexOf("?");i=m.indexOf("#");f>=0?i>=0&&i<f&&(f=i):f=i;f>=0&&(m=m.substring(0,f));f=s.linkDownloadFileTypes.toLowerCase().split(",");for(i=0;i<f.length;i++)(j=f[i])&&m.substring(m.length-(j.length+1))=="."+j&&(e="d")}if(s.trackExternalLinks&&\n!e&&(m=d.toLowerCase(),s.na(m))){if(!s.linkInternalFilters)s.linkInternalFilters=w.location.hostname;f=0;s.linkExternalFilters?(f=s.linkExternalFilters.toLowerCase().split(","),g=1):s.linkInternalFilters&&(f=s.linkInternalFilters.toLowerCase().split(","));if(f){for(i=0;i<f.length;i++)j=f[i],m.indexOf(j)>=0&&(k=1);k?g&&(e="e"):g||(e="e")}}}s.linkObject=c;s.linkURL=d;s.linkType=e;if(s.trackClickMap||s.trackInlineStats)if(s.g="",c){e=s.pageName;d=1;c=c.sourceIndex;if(!e)e=s.pageURL,d=0;if(w.s_objectID)a.id=\nw.s_objectID,c=a.type=1;if(e&&a&&a.id&&b)s.g="&pid="+s.escape(e.substring(0,255))+(d?"&pidt="+d:"")+"&oid="+s.escape(a.id.substring(0,100))+(a.type?"&oidt="+a.type:"")+"&ot="+b+(c?"&oi="+c:"")}};s.Ta=function(){var b=s.Z,a=s.linkType,c=s.linkURL,e=s.linkName;if(a&&(c||e))a=a.toLowerCase(),a!="d"&&a!="e"&&(a="o"),s.pe="lnk_"+a,s.pev1=c?s.escape(c):"",s.pev2=e?s.escape(e):"",b=1;s.abort&&(b=0);if(s.trackClickMap||s.trackInlineStats){a={};c=0;var d=s.cookieRead("s_sq"),f=d?d.split("&"):0,i,w,g;d=0;if(f)for(i=\n0;i<f.length;i++)w=f[i].split("="),e=s.unescape(w[0]).split(","),w=s.unescape(w[1]),a[w]=e;e=s.account.split(",");if(b||s.g){b&&!s.g&&(d=1);for(w in a)if(!Object.prototype[w])for(i=0;i<e.length;i++){d&&(g=a[w].join(","),g==s.account&&(s.g+=(w.charAt(0)!="&"?"&":"")+w,a[w]=[],c=1));for(f=0;f<a[w].length;f++)g=a[w][f],g==e[i]&&(d&&(s.g+="&u="+s.escape(g)+(w.charAt(0)!="&"?"&":"")+w+"&u=0"),a[w].splice(f,1),c=1)}b||(c=1);if(c){d="";i=2;!b&&s.g&&(d=s.escape(e.join(","))+"="+s.escape(s.g),i=1);for(w in a)!Object.prototype[w]&&\ni>0&&a[w].length>0&&(d+=(d?"&":"")+s.escape(a[w].join(","))+"="+s.escape(w),i--);s.cookieWrite("s_sq",d)}}}return b};s.Ua=function(){if(!s.jb){var b=new Date,a=j.location,c,e,d,f=d=e=c="",i="",w="",g="1.2",k=s.cookieWrite("s_cc","true",0)?"Y":"N",o="",p="",n=0;if(b.setUTCDate&&(g="1.3",n.toPrecision&&(g="1.5",c=[],c.forEach))){g="1.6";d=0;e={};try{d=new Iterator(e),d.next&&(g="1.7",c.reduce&&(g="1.8",g.trim&&(g="1.8.1",Date.parse&&(g="1.8.2",Object.create&&(g="1.8.5")))))}catch(r){}}c=screen.width+\n"x"+screen.height;d=navigator.javaEnabled()?"Y":"N";e=screen.pixelDepth?screen.pixelDepth:screen.colorDepth;i=s.w.innerWidth?s.w.innerWidth:s.d.documentElement.offsetWidth;w=s.w.innerHeight?s.w.innerHeight:s.d.documentElement.offsetHeight;b=navigator.plugins;try{s.b.addBehavior("#default#homePage"),o=s.b.qb(a)?"Y":"N"}catch(t){}try{s.b.addBehavior("#default#clientCaps"),p=s.b.connectionType}catch(u){}if(b)for(;n<b.length&&n<30;){if(a=b[n].name)a=a.substring(0,100)+";",f.indexOf(a)<0&&(f+=a);n++}s.resolution=\nc;s.colorDepth=e;s.javascriptVersion=g;s.javaEnabled=d;s.cookiesEnabled=k;s.browserWidth=i;s.browserHeight=w;s.connectionType=p;s.homepage=o;s.plugins=f;s.jb=1}};s.I={};s.loadModule=function(b,a){var c=s.I[b];if(!c){c=w["AppMeasurement_Module_"+b]?new w["AppMeasurement_Module_"+b](s):{};s.I[b]=s[b]=c;c.Ba=function(){return c.Ea};c.Fa=function(a){if(c.Ea=a)s[b+"_onLoad"]=a,s.C(b+"_onLoad",[s,c],1)||a(s,c)};try{Object.defineProperty?Object.defineProperty(c,"onLoad",{get:c.Ba,set:c.Fa}):c._olc=1}catch(e){c._olc=\n1}}a&&(s[b+"_onLoad"]=a,s.C(b+"_onLoad",[s,c],1)||a(s,c))};s.r=function(b){var a,c;for(a in s.I)if(!Object.prototype[a]&&(c=s.I[a])){if(c._olc&&c.onLoad)c._olc=0,c.onLoad(s,c);if(c[b]&&c[b]())return 1}return 0};s.Xa=function(){var b=Math.floor(Math.random()*1E13),a=s.visitorSampling,c=s.visitorSamplingGroup;c="s_vsn_"+(s.visitorNamespace?s.visitorNamespace:s.account)+(c?"_"+c:"");var e=s.cookieRead(c);if(a){e&&(e=parseInt(e));if(!e){if(!s.cookieWrite(c,b))return 0;e=b}if(e%1E4>v)return 0}return 1};\ns.K=function(b,a){var c,e,d,f,w,g;for(c=0;c<2;c++){e=c>0?s.ea:s.c;for(d=0;d<e.length;d++)if(f=e[d],(w=b[f])||b["!"+f]){if(!a&&(f=="contextData"||f=="retrieveLightData")&&s[f])for(g in s[f])w[g]||(w[g]=s[f][g]);s[f]=w}}};s.wa=function(b,a){var c,e,d,f;for(c=0;c<2;c++){e=c>0?s.ea:s.c;for(d=0;d<e.length;d++)f=e[d],b[f]=s[f],!a&&!b[f]&&(b["!"+f]=1)}};s.Pa=function(s){var a,c,e,d,f,w=0,g,k="",j="";if(s&&s.length>255&&(a=""+s,c=a.indexOf("?"),c>0&&(g=a.substring(c+1),a=a.substring(0,c),d=a.toLowerCase(),\ne=0,d.substring(0,7)=="http://"?e+=7:d.substring(0,8)=="https://"&&(e+=8),c=d.indexOf("/",e),c>0&&(d=d.substring(e,c),f=a.substring(c),a=a.substring(0,c),d.indexOf("google")>=0?w=",q,ie,start,search_key,word,kw,cd,":d.indexOf("yahoo.co")>=0&&(w=",p,ei,"),w&&g)))){if((s=g.split("&"))&&s.length>1){for(e=0;e<s.length;e++)d=s[e],c=d.indexOf("="),c>0&&w.indexOf(","+d.substring(0,c)+",")>=0?k+=(k?"&":"")+d:j+=(j?"&":"")+d;k&&j?g=k+"&"+j:j=""}c=253-(g.length-j.length)-a.length;s=a+(c>0?f.substring(0,c):\n"")+"?"+g}return s};s.S=!1;s.O=!1;s.Da=function(b){s.marketingCloudVisitorID=b;s.O=!0;s.l()};s.P=!1;s.L=!1;s.ya=function(b){s.analyticsVisitorID=b;s.L=!0;s.l()};s.R=!1;s.N=!1;s.Aa=function(b){s.audienceManagerLocationHint=b;s.N=!0;s.l()};s.Q=!1;s.M=!1;s.za=function(b){s.audienceManagerBlob=b;s.M=!0;s.l()};s.isReadyToTrack=function(){var b=!0,a=s.visitor;if(a&&a.isAllowed()){if(!s.S&&!s.marketingCloudVisitorID&&a.getMarketingCloudVisitorID&&(s.S=!0,s.marketingCloudVisitorID=a.getMarketingCloudVisitorID([s,\ns.Da]),s.marketingCloudVisitorID))s.O=!0;if(!s.P&&!s.analyticsVisitorID&&a.getAnalyticsVisitorID&&(s.P=!0,s.analyticsVisitorID=a.getAnalyticsVisitorID([s,s.ya]),s.analyticsVisitorID))s.L=!0;if(!s.R&&!s.audienceManagerLocationHint&&a.getAudienceManagerLocationHint&&(s.R=!0,s.audienceManagerLocationHint=a.getAudienceManagerLocationHint([s,s.Aa]),s.audienceManagerLocationHint))s.N=!0;if(!s.Q&&!s.audienceManagerBlob&&a.getAudienceManagerBlob&&(s.Q=!0,s.audienceManagerBlob=a.getAudienceManagerBlob([s,\ns.za]),s.audienceManagerBlob))s.M=!0;if(s.S&&!s.O&&!s.marketingCloudVisitorID||s.P&&!s.L&&!s.analyticsVisitorID||s.R&&!s.N&&!s.audienceManagerLocationHint||s.Q&&!s.M&&!s.audienceManagerBlob)b=!1}return b};s.k=k;s.o=0;s.callbackWhenReadyToTrack=function(b,a,c){var e;e={};e.Ja=b;e.Ia=a;e.Ga=c;if(s.k==k)s.k=[];s.k.push(e);if(s.o==0)s.o=setInterval(s.l,100)};s.l=function(){var b;if(s.isReadyToTrack()){if(s.o)clearInterval(s.o),s.o=0;if(s.k!=k)for(;s.k.length>0;)b=s.k.shift(),b.Ia.apply(b.Ja,b.Ga)}};s.Ca=\nfunction(b){var a,c,e=k,d=k;if(!s.isReadyToTrack()){a=[];if(b!=k)for(c in e={},b)e[c]=b[c];d={};s.wa(d,!0);a.push(e);a.push(d);s.callbackWhenReadyToTrack(s,s.track,a);return!0}return!1};s.Ra=function(){var b=s.cookieRead("s_fid"),a="",c="",e;e=8;var d=4;if(!b||b.indexOf("-")<0){for(b=0;b<16;b++)e=Math.floor(Math.random()*e),a+="0123456789ABCDEF".substring(e,e+1),e=Math.floor(Math.random()*d),c+="0123456789ABCDEF".substring(e,e+1),e=d=16;b=a+"-"+c}s.cookieWrite("s_fid",b,1)||(b=0);return b};s.t=s.track=\nfunction(b,a){var c,e=new Date,d="s"+Math.floor(e.getTime()/108E5)%10+Math.floor(Math.random()*1E13),f=e.getYear();f="t="+s.escape(e.getDate()+"/"+e.getMonth()+"/"+(f<1900?f+1900:f)+" "+e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()+" "+e.getDay()+" "+e.getTimezoneOffset());if(!s.supplementalDataID&&s.visitor&&s.visitor.getSupplementalDataID)s.supplementalDataID=s.visitor.getSupplementalDataID("AppMeasurement:"+s._in,s.expectSupplementalData?!1:!0);s.r("_s");if(!s.C("track",arguments)){if(!s.Ca(b)){a&&\ns.K(a);b&&(c={},s.wa(c,0),s.K(b));if(s.Xa()){if(!s.analyticsVisitorID&&!s.marketingCloudVisitorID)s.fid=s.Ra();s.bb();s.usePlugins&&s.doPlugins&&s.doPlugins(s);if(s.account){if(!s.abort){if(s.trackOffline&&!s.timestamp)s.timestamp=Math.floor(e.getTime()/1E3);e=w.location;if(!s.pageURL)s.pageURL=e.href?e.href:e;if(!s.referrer&&!s.xa)s.referrer=j.document.referrer,s.xa=1;s.referrer=s.Pa(s.referrer);s.r("_g")}if(s.Ta()&&!s.abort)s.Ua(),f+=s.Sa(),s.ab(d,f),s.r("_t"),s.referrer=""}}b&&s.K(c,1)}s.abort=\ns.supplementalDataID=s.timestamp=s.pageURLRest=s.linkObject=s.j=s.linkURL=s.linkName=s.linkType=w.rb=s.pe=s.pev1=s.pev2=s.pev3=s.g=0}};s.tl=s.trackLink=function(b,a,c,e,d){s.linkObject=b;s.linkType=a;s.linkName=c;if(d)s.i=b,s.q=d;return s.track(e)};s.trackLight=function(b,a,c,e){s.lightProfileID=b;s.lightStoreForSeconds=a;s.lightIncrementBy=c;return s.track(e)};s.clearVars=function(){var b,a;for(b=0;b<s.c.length;b++)if(a=s.c[b],a.substring(0,4)=="prop"||a.substring(0,4)=="eVar"||a.substring(0,4)==\n"hier"||a.substring(0,4)=="list"||a=="channel"||a=="events"||a=="eventList"||a=="products"||a=="productList"||a=="purchaseID"||a=="transactionID"||a=="state"||a=="zip"||a=="campaign")s[a]=void 0};s.ab=function(b,a){var c,e=s.trackingServer;c="";var d=s.dc,f="sc.",w=s.visitorNamespace;if(e){if(s.trackingServerSecure&&s.ssl)e=s.trackingServerSecure}else{if(!w)w=s.account,e=w.indexOf(","),e>=0&&(w=w.substring(0,e)),w=w.replace(/[^A-Za-z0-9]/g,"");c||(c="2o7.net");d=d?(""+d).toLowerCase():"d1";c=="2o7.net"&&\n(d=="d1"?d="112":d=="d2"&&(d="122"),f="");e=w+"."+d+"."+f+c}c=s.ssl?"https://":"http://";d=s.AudienceManagement&&s.AudienceManagement.isReady();c+=e+"/b/ss/"+s.account+"/"+(s.mobile?"5.":"")+(d?"10":"1")+"/JS-"+s.version+(s.ib?"T":"")+"/"+b+"?AQB=1&ndh=1&"+(d?"callback=s_c_il["+s._in+"].AudienceManagement.passData&":"")+a+"&AQE=1";s.Wa&&(c=c.substring(0,2047));s.Na(c);s.W()};s.Na=function(b){s.e||s.Va();s.e.push(b);s.X=s.u();s.va()};s.Va=function(){s.e=s.Ya();if(!s.e)s.e=[]};s.Ya=function(){var b,\na;if(s.ba()){try{(a=w.localStorage.getItem(s.$()))&&(b=w.JSON.parse(a))}catch(c){}return b}};s.ba=function(){var b=!0;if(!s.trackOffline||!s.offlineFilename||!w.localStorage||!w.JSON)b=!1;return b};s.la=function(){var b=0;if(s.e)b=s.e.length;s.z&&b++;return b};s.W=function(){if(!s.z)if(s.ma=k,s.aa)s.X>s.G&&s.ta(s.e),s.da(500);else{var b=s.Ha();if(b>0)s.da(b);else if(b=s.ja())s.z=1,s.$a(b),s.fb(b)}};s.da=function(b){if(!s.ma)b||(b=0),s.ma=setTimeout(s.W,b)};s.Ha=function(){var b;if(!s.trackOffline||\ns.offlineThrottleDelay<=0)return 0;b=s.u()-s.ra;if(s.offlineThrottleDelay<b)return 0;return s.offlineThrottleDelay-b};s.ja=function(){if(s.e.length>0)return s.e.shift()};s.$a=function(b){if(s.debugTracking){var a="AppMeasurement Debug: "+b;b=b.split("&");var c;for(c=0;c<b.length;c++)a+="\\n\\t"+s.unescape(b[c]);s.Za(a)}};s.fb=function(b){var a,c,e;if(!a&&s.d.createElement&&s.AudienceManagement&&s.AudienceManagement.isReady()&&(a=s.d.createElement("SCRIPT"))&&"async"in a)(e=(e=s.d.getElementsByTagName("HEAD"))&&\ne[0]?e[0]:s.d.body)?(a.type="text/javascript",a.setAttribute("async","async"),c=3):a=0;if(!a)a=new Image,a.alt="";a.ga=function(){try{if(s.ca)clearTimeout(s.ca),s.ca=0;if(a.timeout)clearTimeout(a.timeout),a.timeout=0}catch(b){}};a.onload=a.hb=function(){a.ga();s.Ma();s.T();s.z=0;s.W()};a.onabort=a.onerror=a.Oa=function(){a.ga();(s.trackOffline||s.aa)&&s.z&&s.e.unshift(s.La);s.z=0;s.X>s.G&&s.ta(s.e);s.T();s.da(500)};a.onreadystatechange=function(){a.readyState==4&&(a.status==200?a.hb():a.Oa())};s.ra=\ns.u();if(c==1)a.open("GET",b,!0),a.send();else if(c==2)a.open("GET",b),a.send();else if(a.src=b,c==3){if(s.pa)try{e.removeChild(s.pa)}catch(d){}e.firstChild?e.insertBefore(a,e.firstChild):e.appendChild(a);s.pa=s.Ka}if(a.abort)s.ca=setTimeout(a.abort,5E3);s.La=b;s.Ka=w["s_i_"+s.replace(s.account,",","_")]=a;if(s.useForcedLinkTracking&&s.B||s.q){if(!s.forcedLinkTrackingTimeout)s.forcedLinkTrackingTimeout=250;s.U=setTimeout(s.T,s.forcedLinkTrackingTimeout)}};s.Ma=function(){if(s.ba()&&!(s.qa>s.G))try{w.localStorage.removeItem(s.$()),\ns.qa=s.u()}catch(b){}};s.ta=function(b){if(s.ba()){s.va();try{w.localStorage.setItem(s.$(),w.JSON.stringify(b)),s.G=s.u()}catch(a){}}};s.va=function(){if(s.trackOffline){if(!s.offlineLimit||s.offlineLimit<=0)s.offlineLimit=10;for(;s.e.length>s.offlineLimit;)s.ja()}};s.forceOffline=function(){s.aa=!0};s.forceOnline=function(){s.aa=!1};s.$=function(){return s.offlineFilename+"-"+s.visitorNamespace+s.account};s.u=function(){return(new Date).getTime()};s.na=function(s){s=s.toLowerCase();if(s.indexOf("#")!=\n0&&s.indexOf("about:")!=0&&s.indexOf("opera:")!=0&&s.indexOf("javascript:")!=0)return!0;return!1};s.setTagContainer=function(b){var a,c,e;s.ib=b;for(a=0;a<s._il.length;a++)if((c=s._il[a])&&c._c=="s_l"&&c.tagContainerName==b){s.K(c);if(c.lmq)for(a=0;a<c.lmq.length;a++)e=c.lmq[a],s.loadModule(e.n);if(c.ml)for(e in c.ml)if(s[e])for(a in b=s[e],e=c.ml[e],e)if(!Object.prototype[a]&&(typeof e[a]!="function"||(""+e[a]).indexOf("s_c_il")<0))b[a]=e[a];if(c.mmq)for(a=0;a<c.mmq.length;a++)e=c.mmq[a],s[e.m]&&\n(b=s[e.m],b[e.f]&&typeof b[e.f]=="function"&&(e.a?b[e.f].apply(b,e.a):b[e.f].apply(b)));if(c.tq)for(a=0;a<c.tq.length;a++)s.track(c.tq[a]);c.s=s;break}};s.Util={urlEncode:s.escape,urlDecode:s.unescape,cookieRead:s.cookieRead,cookieWrite:s.cookieWrite,getQueryParam:function(b,a,c){var e;a||(a=s.pageURL?s.pageURL:w.location);c||(c="&");if(b&&a&&(a=""+a,e=a.indexOf("?"),e>=0&&(a=c+a.substring(e+1)+c,e=a.indexOf(c+b+"="),e>=0&&(a=a.substring(e+c.length+b.length+1),e=a.indexOf(c),e>=0&&(a=a.substring(0,\ne)),a.length>0))))return s.unescape(a);return""}};s.A=["supplementalDataID","timestamp","dynamicVariablePrefix","visitorID","marketingCloudVisitorID","analyticsVisitorID","audienceManagerLocationHint","fid","vmk","visitorMigrationKey","visitorMigrationServer","visitorMigrationServerSecure","charSet","visitorNamespace","cookieDomainPeriods","fpCookieDomainPeriods","cookieLifetime","pageName","pageURL","referrer","contextData","currencyCode","lightProfileID","lightStoreForSeconds","lightIncrementBy",\n"retrieveLightProfiles","deleteLightProfiles","retrieveLightData","pe","pev1","pev2","pev3","pageURLRest"];s.c=s.A.concat(["purchaseID","variableProvider","channel","server","pageType","transactionID","campaign","state","zip","events","events2","products","audienceManagerBlob","tnt"]);s.Y=["timestamp","charSet","visitorNamespace","cookieDomainPeriods","cookieLifetime","contextData","lightProfileID","lightStoreForSeconds","lightIncrementBy"];s.H=s.Y.slice(0);s.ea=["account","allAccounts","debugTracking",\n"visitor","trackOffline","offlineLimit","offlineThrottleDelay","offlineFilename","usePlugins","doPlugins","configURL","visitorSampling","visitorSamplingGroup","linkObject","linkURL","linkName","linkType","trackDownloadLinks","trackExternalLinks","trackClickMap","trackInlineStats","linkLeaveQueryString","linkTrackVars","linkTrackEvents","linkDownloadFileTypes","linkExternalFilters","linkInternalFilters","useForcedLinkTracking","forcedLinkTrackingTimeout","trackingServer","trackingServerSecure","ssl",\n"abort","mobile","dc","lightTrackVars","maxDelay","expectSupplementalData","AudienceManagement"];for(g=0;g<=75;g++)s.c.push("prop"+g),s.H.push("prop"+g),s.c.push("eVar"+g),s.H.push("eVar"+g),g<6&&s.c.push("hier"+g),g<4&&s.c.push("list"+g);g=["resolution","colorDepth","javascriptVersion","javaEnabled","cookiesEnabled","browserWidth","browserHeight","connectionType","homepage","plugins"];s.c=s.c.concat(g);s.A=s.A.concat(g);s.ssl=w.location.protocol.toLowerCase().indexOf("https")>=0;s.charSet="UTF-8";\ns.contextData={};s.offlineThrottleDelay=0;s.offlineFilename="AppMeasurement.offline";s.ra=0;s.X=0;s.G=0;s.qa=0;s.linkDownloadFileTypes="exe,zip,wav,mp3,mov,mpg,avi,wmv,pdf,doc,docx,xls,xlsx,ppt,pptx";s.w=w;s.d=w.document;try{s.Wa=navigator.appName=="Microsoft Internet Explorer"}catch(n){}s.T=function(){if(s.U)w.clearTimeout(s.U),s.U=k;s.i&&s.B&&s.i.dispatchEvent(s.B);if(s.q)if(typeof s.q=="function")s.q();else if(s.i&&s.i.href)s.d.location=s.i.href;s.i=s.B=s.q=0};s.ua=function(){s.b=s.d.body;if(s.b)if(s.p=\nfunction(b){var a,c,e,d,f;if(!(s.d&&s.d.getElementById("cppXYctnr")||b&&b.cb)){if(s.fa)if(s.useForcedLinkTracking)s.b.removeEventListener("click",s.p,!1);else{s.b.removeEventListener("click",s.p,!0);s.fa=s.useForcedLinkTracking=0;return}else s.useForcedLinkTracking=0;s.j=b.srcElement?b.srcElement:b.target;try{if(s.j&&(s.j.tagName||s.j.parentElement||s.j.parentNode))if(e=s.la(),s.track(),e<s.la()&&s.useForcedLinkTracking&&b.target){for(d=b.target;d&&d!=s.b&&d.tagName.toUpperCase()!="A"&&d.tagName.toUpperCase()!=\n"AREA";)d=d.parentNode;if(d&&(f=d.href,s.na(f)||(f=0),c=d.target,b.target.dispatchEvent&&f&&(!c||c=="_self"||c=="_top"||c=="_parent"||w.name&&c==w.name))){try{a=s.d.createEvent("MouseEvents")}catch(g){a=new w.MouseEvent}if(a){try{a.initMouseEvent("click",b.bubbles,b.cancelable,b.view,b.detail,b.screenX,b.screenY,b.clientX,b.clientY,b.ctrlKey,b.altKey,b.shiftKey,b.metaKey,b.button,b.relatedTarget)}catch(j){a=0}if(a)a.cb=1,b.stopPropagation(),b.gb&&b.gb(),b.preventDefault(),s.i=b.target,s.B=a}}}}catch(k){}s.j=\n0}},s.b&&s.b.attachEvent)s.b.attachEvent("onclick",s.p);else{if(s.b&&s.b.addEventListener){if(navigator&&(navigator.userAgent.indexOf("WebKit")>=0&&s.d.createEvent||navigator.userAgent.indexOf("Firefox/2")>=0&&w.MouseEvent))s.fa=1,s.useForcedLinkTracking=1,s.b.addEventListener("click",s.p,!0);s.b.addEventListener("click",s.p,!1)}}else setTimeout(s.ua,30)};s.ua()}\nfunction s_gi(s){var w,k=window.s_c_il,j,g,o=s.split(","),p,n,b=0;if(k)for(j=0;!b&&j<k.length;){w=k[j];if(w._c=="s_c"&&(w.account||w.oun))if(w.account&&w.account==s)b=1;else{g=w.account?w.account:w.oun;g=w.allAccounts?w.allAccounts:g.split(",");for(p=0;p<o.length;p++)for(n=0;n<g.length;n++)o[p]==g[n]&&(b=1)}j++}b||(w=new AppMeasurement);w.setAccount?w.setAccount(s):w.sa&&w.sa(s);return w}AppMeasurement.getInstance=s_gi;window.s_objectID||(window.s_objectID=0);\nfunction s_pgicq(){var s=window,w=s.s_giq,k,j,g;if(w)for(k=0;k<w.length;k++)j=w[k],g=s_gi(j.oun),g.setAccount(j.un),g.setTagContainer(j.tagContainerName);s.s_giq=0}s_pgicq();\n\n//# sourceURL=/lib/adobe-analytics/AppMeasurement.js'),define("lib/adobe-analytics/AppMeasurement",function(){}),eval('/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4, bitwise: true, sub: true */\n/*global define, window, brackets, AppMeasurement*/\ndefine(\'ext/metrics/AnalyticsWrapper\',[\n    "underscore",\n    "backbone",\n    "config/environment",\n    "ext/models/BracketsPreferencesModel",\n    "ext/models/ExtensionMetadata",\n    "ext/metrics/BaseMetricsWrapper",\n    "lib/adobe-analytics/AppMeasurement"\n], function (_, Backbone, Environment, BracketsPreferencesModel, ExtensionMetadata,\n    BaseMetricsWrapper, AdobeAnalytics) {\n    "use strict";\n\n    var APPTYPE = "desktop",\n        NAMESPACE = "ext4b",\n        DESCRIPTION = "description",\n        COUNT = "count",\n        EVENT = "event",\n        AUTH_STEP = "Auth Step",\n        ACTION_DESCRIPTION = [APPTYPE, NAMESPACE, DESCRIPTION].join("."),\n        ACTION_COUNT = [APPTYPE, NAMESPACE, COUNT].join("."),\n        ACTION_EVENT = [APPTYPE, NAMESPACE, EVENT].join("."),\n        SUBEVENT_MAP;\n    \n    // Mapping of IMS legacy subevents to Analytics values for adb.event.eventInfo.eventAction\n    SUBEVENT_MAP = {\n        "LOGIN_START":          { "eventName": AUTH_STEP, eventAction: "Login Start" },\n        "VALID_ACCESS_TOKEN":   { "eventName": AUTH_STEP, eventAction: "Valid Authentication Token" },\n        "EXPIRED_ACCESS_TOKEN": { "eventName": AUTH_STEP, eventAction: "Expired Authentication Token" },\n        "MISSING_ACCESS_TOKEN": { "eventName": AUTH_STEP, eventAction: "Missing Authentication Token" },\n        "LOGIN_ATTEMPT":        { "eventName": AUTH_STEP, eventAction: "Login Attempt" }, /* IMS reporting only */\n        "LOGIN_SUCCESS":        { "eventName": AUTH_STEP, eventAction: "Login Success" },\n        "LOGIN_CANCEL":         { "eventName": AUTH_STEP, eventAction: "Login Cancel" },\n        "LOGIN_FAILURE":        { "eventName": AUTH_STEP, eventAction: "Login Failure" }, /* IMS reporting only */\n        "LOGOUT_ATTEMPTED":     { "eventName": AUTH_STEP, eventAction: "Logout Attempted" },\n        "LOGOUT_SUCCESS":       { "eventName": AUTH_STEP, eventAction: "Logout Success" },\n        "LOGOUT_CANCEL":        { "eventName": AUTH_STEP, eventAction: "Logout Cancel" }, /* IMS reporting only...or impossible? */\n        "LOGOUT_FAILURE":       { "eventName": AUTH_STEP, eventAction: "Logout Failure" } /* IMS reporting only */\n    };\n    \n    var s = new AppMeasurement();\n    \n    // Shim code from @bbythewa\n    // ---------------\n    s._plugin_trackAction = s.trackAction = function (action, contextData) {\n        var s = this,\n            contextDataKey = \'\',\n            contextDataBackup = {},\n            linkTrackVars = [];\n\n        // backup\n        for (contextDataKey in s.contextData) {\n            if (s.contextData.hasOwnProperty(contextDataKey)) {\n                contextDataBackup[contextDataKey] = s.contextData[contextDataKey];\n            }\n        }\n\n        // reset\n        s.contextData = {};\n\n        // actionName special context data\n        s.contextData[\'a.action\'] = action;\n        linkTrackVars.push(\'contextData.a.action\');\n\n        // set the new contextData\n        for (contextDataKey in contextData) {\n            if (contextData.hasOwnProperty(contextDataKey)) {\n                linkTrackVars.push(\'contextData.\' + contextDataKey);\n                s.contextData[contextDataKey] = contextData[contextDataKey];\n            }\n        }\n\n        // whitelist\n        s.linkTrackVars = linkTrackVars.join(\',\');\n\n        // send\n        s.tl(true, \'o\', action);\n\n        // restore\n        for (contextDataKey in contextDataBackup) {\n            if (contextDataBackup.hasOwnProperty(contextDataKey)) {\n                s.contextData[contextDataKey] = contextDataBackup[contextDataKey];\n            }\n        }\n    };\n\n    s._plugin_trackAction.version = s.trackAction.version = \'1.1\';\n    // ---------------\n\n    // Original s.Ha() implementation for reference:\n    /*\n    s.Ha = function() {\n        var b;\n        if (!s.trackOffline ||\n            s.offlineThrottleDelay <= 0) return 0;\n        b = s.u() - s.ra;  // s.u() has no side effect. s.ra is the timestamp of the last attempted request.\n        if (s.offlineThrottleDelay < b) return 0;\n        return s.offlineThrottleDelay - b\n    };\n    */\n\n    // HACK: Patch s.Ha() method that computes timeout used to determine when\n    // to send the next event (uses offlineThrottleDelay)\n    var prevAction;\n    s.Ha = function () {\n        var nextAction = (s.e && s.e.length && s.e[0]) || false,\n            doForceOffline = false;\n\n        // Check for a non-empty buffer\n        if (nextAction) {\n            // If the prevAction still on the buffer, go offline\n            if (nextAction === prevAction) {\n                doForceOffline = true;\n            }\n            \n            prevAction = nextAction;\n        } else {\n            // Buffer is empty, let it fill up again\n            doForceOffline = true;\n        }\n\n        if (doForceOffline) {\n            s.forceOffline();\n        }\n\n        // If the buffer is non-empty send immediately, otherwise ignored\n        return 0;\n    };\n\n    // HACK: Patch s.da() method that sets up async sending of events\n    var _da = s.da;\n    s.da = function (b) {\n        // Only allow immediate send requests\n        if (b !== 0) {\n            return;\n        }\n\n        _da.call(s, b);\n    };\n    \n    s.account = Environment.ADOBE_ANALYTICS_ACCOUNT;\n    s.ssl = true;\n\n    // Always start offline and save events to the localStorage buffer\n    s.trackOffline = true;\n    s.forceOffline();\n    \n    // Copy value from input to output, then delete from input\n    function _setParam(input, output, originalKey, newKey, value) {\n        output[newKey] = value || input[originalKey];\n        delete input[originalKey];\n    }\n\n    var AnalyticsWrapper = BaseMetricsWrapper.extend({\n        \n        _objectMapping: function (eventName, input) {\n            var output = {},\n                subevent = input["subevent"],\n                eventNameActionPair = SUBEVENT_MAP[subevent],\n                date = new Date(input["timestamp"]);\n            \n            // Map legacy properties to Adobe Analytics required names\n            _setParam(input, output, "subevent",                   ACTION_EVENT,                       eventName + ":" + subevent);\n            _setParam(input, output, "extractExtensionVersion",    "adb.page.pageInfo.productVersion");\n\n            // Mapped subevents define an eventName and eventAction, fallback to subevent\n            if (eventNameActionPair) {\n                output["adb.event.eventInfo.eventName"] = eventNameActionPair.eventName;\n                output["adb.event.eventInfo.eventAction"] = eventNameActionPair.eventAction;\n            } else {\n                output["adb.event.eventInfo.eventName"] = subevent;\n            }\n            \n            // Auth Status: Use persistent properties `isLoggedIn` (true|false) and `isOffline` (true|false|"unknown")\n            var isLoggedIn = input["isLoggedIn"],\n                isPaidAccount = input["isPaidAccount"],\n                imsStatus = input["isLoggedIn"] ? "Logged In : " : "Logged Out : ",\n                isOffline = input["isOffline"] === true,\n                onlineStatus = isOffline ? "Offline" : "Online",\n                registrationStatus = "Not Registered";\n            \n            if (isLoggedIn) {\n                registrationStatus = isPaidAccount ? "Adobe Account (Paid)" : "Adobe Account (Free)";\n            }\n            \n            output["adb.user.profile.attributes.regStatus"] = registrationStatus;\n            output["adb.user.profile.attributes.authStatus"] = imsStatus + onlineStatus;\n            delete input["isLoggedIn"];\n            delete input["isOffline"];\n            delete input["isPaidAccount"];\n\n            // Add Adobe Analytics-only properties\n            output["adb.page.pageInfo.productCategory"] = APPTYPE;\n            output["adb.page.pageInfo.namespace"] = NAMESPACE;\n            output["adb.page.pageInfo.language"] = brackets.app.language;\n            output["adb.page.pageInfo.category.primaryCategory"] = input["state"];\n            output["adb.user.profile.attributes.clientId"] = Environment.IMS_CLIENT_ID;\n            \n            // TODO states are only for states...?\n            output["adb.page.pageInfo.pageName"] = input["state"];\n            delete input["state"];\n            \n            // TODO verify format, preview label\n            output["a.AppID"] = ExtensionMetadata.get("title") + " " + ExtensionMetadata.get("version");\n            \n            output["a.DayOfWeek"] = date.getDay() + 1;\n            output["a.HourOfDay"] = date.getHours() + 1;\n            \n            return output;\n        },\n        \n        _handleLifecycle: function (eventName, params) {\n            var prefs = this.getPrefs(),\n                lifecycle = prefs.get(BracketsPreferencesModel.METRICS_ANALYTICS_LIFECYCLE),\n                subevent = params["subevent"],\n                isInstall = subevent === "INSTALL_COMPLETE",\n                isUpdate = subevent === "UPDATE_COMPLETE",\n                isLaunch = subevent === "LAUNCH",\n                retval = {},\n                dateString = new Date(params.timestamp).toLocaleDateString("en-US");\n\n            // Require firstLaunchDate\n            if (lifecycle.all["adb.user.profile.attributes.firstLaunchDate"] === undefined) {\n                lifecycle.all["adb.user.profile.attributes.firstLaunchDate"] = dateString;\n            }\n\n            // Require InstallDate\n            if (lifecycle.all["a.InstallDate"] === undefined) {\n                lifecycle.all["a.InstallDate"] = dateString;\n            }\n            \n            // Note: lifecycle.all is merged into retval for all states and all actions\n            if (isInstall) {\n                // Only send a.InstallEvent in context data for this event instance\n                retval["a.InstallEvent"] = 1;\n            } else if (isUpdate) {\n                if (lifecycle.all["adb.user.profile.attributes.firstUpgradeDate"] === undefined) {\n                    lifecycle.all["adb.user.profile.attributes.firstUpgradeDate"] = dateString;\n                }\n                \n                lifecycle.all["adb.user.profile.attributes.lastUpgradeDate"] = dateString;\n                \n                // Only send a.UpgradeEvent in context data for this event instance\n                retval["a.UpgradeEvent"] = 1;\n            } else if (isLaunch) {\n                var launches = lifecycle.launch["a.Launches"] + 1;\n                lifecycle.launch["a.Launches"] = launches;\n                \n                // Only send a.LaunchEvent and a.Launches for this event instance\n                if (isLaunch) {\n                    retval["a.LaunchEvent"] = 1;\n                    retval["a.Launches"] = launches;\n                }\n            }\n            \n            // Save all persistent context data\n            prefs.set(BracketsPreferencesModel.METRICS_ANALYTICS_LIFECYCLE, lifecycle);\n            \n            // Merge event-specific retval with properties for all states/all actions\n            retval = _.extend(retval, lifecycle.all);\n            \n            return retval;\n        },\n        \n        _customContextData: function (eventName, params) {\n            // Add prefix desktop.ext4b.description.key\n            var retval = {},\n                actionName;\n\n            _.each(params, function (value, key) {\n                // Numbers: desktop.ext4b.count\n                // Strings: desktop.ext4b.description\n                actionName = (typeof value === "number") ? ACTION_COUNT : ACTION_DESCRIPTION;\n                retval[actionName + "." + key] = value;\n            });\n            \n            return retval;\n        },\n        \n        handleEulaAccepted: function (accepted) {\n            if (accepted) {\n                this.flush();\n            }\n        },\n\n        _getBufferSize: function () {\n            return (s.e && s.e.length) || 0;\n        },\n\n        flush: function () {\n            if (this.isEulaAccepted() && this._getBufferSize()) {\n                // Go online\n                s.forceOnline();\n\n                // Pop next event off the buffer\n                s.W();\n            }\n        },\n        \n        track: function (eventName, params) {\n            // If the buffer is full, flush the buffer before sending the next event\n            if (this._getBufferSize() >= s.offlineLimit) {\n                this.flush();\n            }\n\n            var subevent = params["subevent"];\n            \n            params = _.clone(params);\n            \n            // Add properties for all actions\n            // Note final _objectMapping() deletes original keys that are\n            // mapped for analytics e.g. extractExtensionVersion is deleted\n            // and adb.page.pageInfo.productVersion is used instead\n            var lifecycle = this._handleLifecycle(eventName, params),\n                contextData = this._customContextData(eventName, params),\n                globalSdr = this._objectMapping(eventName, params);\n            \n            // Merge it all into aaParams\n            _.extend(contextData, globalSdr, lifecycle);\n            \n            s.trackAction(subevent, contextData);\n        }\n\n    });\n\n    var aaWrapper = new AnalyticsWrapper();\n\n    // Initialize offline buffer size\n    s.offlineLimit = aaWrapper.BUFFER_SIZE;\n\n    return aaWrapper;\n});\n//# sourceURL=/./metrics/AnalyticsWrapper.js'),
eval('/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4 */\n/*global define*/\n\ndefine(\'override/BracketsServerAPI\',[\n    "serverAPI",\n    "ext/ims/IMSLibWrapper",\n    "ext/metrics/AnalyticsWrapper"\n], function (serverAPI, IMSLibWrapper, AnalyticsWrapper) {\n    "use strict";\n    \n    var metricsServices = [AnalyticsWrapper];\n    \n    serverAPI.flushMetrics = function (flushAsync) {\n        metricsServices.forEach(function (service) {\n            service.flush(flushAsync);\n        });\n    };\n\n    serverAPI.trackEvent = function (params, successCallback, errorCallback, context) {\n        //console.log("trackEvent: ", params.eventname, params.subevent, params.timestamp);\n        \n        metricsServices.forEach(function (service) {\n            try {\n                service.track(params.eventname, params);\n            } catch (err) {\n                console.error(err);\n            }\n        });\n    };\n    \n    serverAPI.customHeader = {};\n\n    var getAssetFromUrl = serverAPI.getAssetFromUrl.bind(serverAPI);\n    serverAPI.getAssetFromUrl = function (url, callback, model) {\n        if (model) {\n            serverAPI.customHeader = {\'e4b-cache-path\': model.get("path")};\n        }\n\n        return getAssetFromUrl(url, callback);\n    };\n\n    // https://git.corp.adobe.com/jhagenst/brackets-parfait-extension/issues/628\n    // White-list of methods that require authorization. vanilla_extract\n    // doesn\'t account for async auth yet. The methods here must be async and\n    // either expect these methods to return a promise or pass a callback.\n    var AUTHORIZED_CALLS = [\n        "loadAssetMetadata",\n        "loadAssetCollection",\n        /*"loadPsdModelFromPath",*/ // ImageServiceAPIs introspect and spritesheets can be authless\n        "getAssetFromUrl",\n        /*"getDerivedAsset",*/ // ImageServiceAPI.createWebAsset can be authless\n        "deleteAsset",\n        "loadDerivedAssetCollection",\n        /*"getRendition",*/ // ImageServiceAPI.createWebAsset can be authless\n        /*"getDerivedSpriteImage",*/ // synchronous return of an Image node\n        "upload"\n    ];\n\n    AUTHORIZED_CALLS.forEach(function (methodName) {\n        var fn = serverAPI[methodName];\n\n        serverAPI[methodName] = function () {\n            var args = Array.prototype.slice.call(arguments, 0);\n            return IMSLibWrapper.getAccessToken().then(function () {\n                return fn.apply(serverAPI, args);\n            });\n        };\n    });\n\n    return serverAPI;\n\n});\n\n//# sourceURL=/./BracketsServerAPI.js'),eval("/*\n * css.normalize.js\n *\n * CSS Normalization\n *\n * CSS paths are normalized based on an optional basePath and the RequireJS config\n *\n * Usage:\n *   normalize(css, fromBasePath, toBasePath);\n *\n * css: the stylesheet content to normalize\n * fromBasePath: the absolute base path of the css relative to any root (but without ../ backtracking)\n * toBasePath: the absolute new base path of the css relative to the same root\n * \n * Absolute dependencies are left untouched.\n *\n * Urls in the CSS are picked up by regular expressions.\n * These will catch all statements of the form:\n *\n * url(*)\n * url('*')\n * url(\"*\")\n * \n * @import '*'\n * @import \"*\"\n *\n * (and so also @import url(*) variations)\n *\n * For urls needing normalization\n *\n */\n\ndefine('lib/graphite-api/public/js/libs/require/css/normalize',['require', 'module'], function(require, module) {\n  \n  // regular expression for removing double slashes\n  // eg http://www.example.com//my///url/here -> http://www.example.com/my/url/here\n  var slashes = /([^:])\\/+/g\n  var removeDoubleSlashes = function(uri) {\n    return uri.replace(slashes, '$1/');\n  }\n\n  // given a relative URI, and two absolute base URIs, convert it from one base to another\n  var protocolRegEx = /[^\\:\\/]*:\\/\\/([^\\/])*/\n  function convertURIBase(uri, fromBase, toBase) {\n    if(uri.indexOf(\"data:\") === 0)\n      return uri;\n    uri = removeDoubleSlashes(uri);\n    // absolute urls are left in tact\n    if (uri.match(/^\\//) || uri.match(protocolRegEx))\n      return uri;\n    // if toBase specifies a protocol path, ensure this is the same protocol as fromBase, if not\n    // use absolute path at fromBase\n    var toBaseProtocol = toBase.match(protocolRegEx);\n    var fromBaseProtocol = fromBase.match(protocolRegEx);\n    if (fromBaseProtocol && (!toBaseProtocol || toBaseProtocol[1] != fromBaseProtocol[1] || toBaseProtocol[2] != fromBaseProtocol[2]))\n      return absoluteURI(uri, fromBase);\n    \n    else {\n      return relativeURI(absoluteURI(uri, fromBase), toBase);\n    }\n  };\n  \n  // given a relative URI, calculate the absolute URI\n  function absoluteURI(uri, base) {\n    if (uri.substr(0, 2) == './')\n      uri = uri.substr(2);    \n    \n    var baseParts = base.split('/');\n    var uriParts = uri.split('/');\n    \n    baseParts.pop();\n    \n    while (curPart = uriParts.shift())\n      if (curPart == '..')\n        baseParts.pop();\n      else\n        baseParts.push(curPart);\n    \n    return baseParts.join('/');\n  };\n\n\n  // given an absolute URI, calculate the relative URI\n  function relativeURI(uri, base) {\n    \n    // reduce base and uri strings to just their difference string\n    var baseParts = base.split('/');\n    baseParts.pop();\n    base = baseParts.join('/') + '/';\n    i = 0;\n    while (base.substr(i, 1) == uri.substr(i, 1))\n      i++;\n    while (base.substr(i, 1) != '/')\n      i--;\n    base = base.substr(i + 1);\n    uri = uri.substr(i + 1);\n\n    // each base folder difference is thus a backtrack\n    baseParts = base.split('/');\n    var uriParts = uri.split('/');\n    out = '';\n    while (baseParts.shift())\n      out += '../';\n    \n    // finally add uri parts\n    while (curPart = uriParts.shift())\n      out += curPart + '/';\n    \n    return out.substr(0, out.length - 1);\n  };\n  \n  var normalizeCSS = function(source, fromBase, toBase, cssBase) {\n\n    fromBase = removeDoubleSlashes(fromBase);\n    toBase = removeDoubleSlashes(toBase);\n\n    var urlRegEx = /@import\\s*(\"([^\"]*)\"|'([^']*)')|url\\s*\\(\\s*(\\s*\"([^\"]*)\"|'([^']*)'|[^\\)]*\\s*)\\s*\\)/ig;\n    var result, url, source;\n\n    while (result = urlRegEx.exec(source)) {\n      url = result[3] || result[2] || result[5] || result[6] || result[4];\n      var newUrl;\n      if (cssBase && url.substr(0, 1) == '/')\n        newUrl = cssBase + url;\n      else\n        newUrl = convertURIBase(url, fromBase, toBase);\n      var quoteLen = result[5] || result[6] ? 1 : 0;\n      source = source.substr(0, urlRegEx.lastIndex - url.length - quoteLen - 1) + newUrl + source.substr(urlRegEx.lastIndex - quoteLen - 1);\n      urlRegEx.lastIndex = urlRegEx.lastIndex + (newUrl.length - url.length);\n    }\n    \n    return source;\n  };\n  \n  normalizeCSS.convertURIBase = convertURIBase;\n  \n  return normalizeCSS;\n});\n\n//# sourceURL=/lib/graphite-api/public/js/libs/require/css/normalize.js"),eval("/*\n * Require-CSS RequireJS css! loader plugin\n * Guy Bedford 2013\n * MIT\n */\n\n/*\n *\n * Usage:\n *  require(['css!./mycssFile']);\n *\n * NB leave out the '.css' extension.\n *\n * - Fully supports cross origin CSS loading\n * - Works with builds\n *\n * Tested and working in (up to latest versions as of March 2013):\n * Android\n * iOS 6\n * IE 6 - 10\n * Chome 3 - 26\n * Firefox 3.5 - 19\n * Opera 10 - 12\n * \n * browserling.com used for virtual testing environment\n *\n * Credit to B Cavalier & J Hann for the elegant IE 6 - 9 hack.\n * \n * Sources that helped along the way:\n * - https://developer.mozilla.org/en-US/docs/Browser_detection_using_the_user_agent\n * - http://www.phpied.com/when-is-a-stylesheet-really-loaded/\n * - https://github.com/cujojs/curl/blob/master/src/curl/plugin/css.js\n *\n */\n\ndefine('lib/graphite-api/public/js/libs/require/css/css',['./normalize'], function(normalize) {\n  function indexOf(a, e) { for (var i=0, l=a.length; i < l; i++) if (a[i] === e) return i; return -1 }\n\n  if (typeof window == 'undefined')\n    return { load: function(n, r, load){ load() } };\n\n  // set to true to enable test prompts for device testing\n  var testing = false;\n  \n  var head = document.getElementsByTagName('head')[0];\n\n  var engine = window.navigator.userAgent.match(/Trident\\/([^ ;]*)|AppleWebKit\\/([^ ;]*)|Opera\\/([^ ;]*)|rv\\:([^ ;]*)(.*?)Gecko\\/([^ ;]*)|MSIE\\s([^ ;]*)/);\n  var hackLinks = false;\n\n  if (!engine) {}\n  else if (engine[1] || engine[7]) {\n    hackLinks = parseInt(engine[1]) < 6 || parseInt(engine[7]) <= 9;\n    engine = 'trident';\n  }\n  else if (engine[2]) {\n    // unfortunately style querying still doesnt work with onload callback in webkit\n    hackLinks = true;\n    engine = 'webkit';\n  }\n  else if (engine[3]) {\n    // engine = 'opera';\n  }\n  else if (engine[4]) {\n    hackLinks = parseInt(engine[4]) < 18;\n    engine = 'gecko';\n  }\n  else if (testing)\n    alert('Engine detection failed');\n  \n  //main api object\n  var cssAPI = {};\n\n  var absUrlRegEx = /^\\/|([^\\:\\/]*:)/;\n  \n  cssAPI.pluginBuilder = './css-builder';\n\n  // used by layer builds to register their css buffers\n  \n  // the current layer buffer items (from addBuffer)\n  var curBuffer = [];\n\n  // the callbacks for buffer loads\n  var onBufferLoad = {};\n\n  // the full list of resources in the buffer\n  var bufferResources = [];\n\n  cssAPI.addBuffer = function(resourceId) {\n    // just in case layer scripts are included twice, also check\n    // against the previous buffers\n    if (indexOf(curBuffer, resourceId) != -1)\n      return;\n    if (indexOf(bufferResources, resourceId) != -1)\n      return;\n    curBuffer.push(resourceId);\n    bufferResources.push(resourceId);\n  }\n  cssAPI.setBuffer = function(css, isLess) {\n    var pathname = window.location.pathname.split('/');\n    pathname.pop();\n    pathname = pathname.join('/') + '/';\n\n    var baseParts = require.toUrl('base_url').split('/');\n    baseParts.pop();\n    var baseUrl = baseParts.join('/') + '/';\n    baseUrl = normalize.convertURIBase(baseUrl, pathname, '/');\n    if (!baseUrl.match(absUrlRegEx))\n      baseUrl = '/' + baseUrl;\n    if (baseUrl.substr(baseUrl.length - 1, 1) != '/')\n      baseUrl = baseUrl + '/';\n\n    cssAPI.inject(normalize(css, baseUrl, pathname));\n\n    // set up attach callback if registered\n    // clear the current buffer for the next layer\n    // (just the less or css part as we have two buffers in one effectively)\n    for (var i = 0; i < curBuffer.length; i++) {\n      // find the resources in the less or css buffer dependening which one this is\n      if ((isLess && curBuffer[i].substr(curBuffer[i].length - 5, 5) == '.less') ||\n        (!isLess && curBuffer[i].substr(curBuffer[i].length - 4, 4) == '.css')) {\n        (function(resourceId) {\n          // mark that the onBufferLoad is about to be called (set to true if not already a callback function)\n          onBufferLoad[resourceId] = onBufferLoad[resourceId] || true;\n\n          // set a short timeout (as injection isn't instant in Chrome), then call the load\n          setTimeout(function() {\n            if (typeof onBufferLoad[resourceId] == 'function')\n              onBufferLoad[resourceId]();\n            // remove from onBufferLoad to indicate loaded\n            delete onBufferLoad[resourceId];\n          }, 7);\n        })(curBuffer[i]);\n\n        // remove the current resource from the buffer\n        curBuffer.splice(i--, 1);\n      }\n    }\n  }\n  cssAPI.attachBuffer = function(resourceId, load) {\n    // attach can happen during buffer collecting, or between injection and callback\n    // we assume it is not possible to attach multiple callbacks\n    // requirejs plugin load function ensures this by queueing duplicate calls\n\n    // check if the resourceId is in the current buffer\n    for (var i = 0; i < curBuffer.length; i++)\n      if (curBuffer[i] == resourceId) {\n        onBufferLoad[resourceId] = load;\n        return true;\n      }\n\n    // check if the resourceId is waiting for injection callback\n    // (onBufferLoad === true is a shortcut indicator for this)\n    if (onBufferLoad[resourceId] === true) {\n      onBufferLoad[resourceId] = load;\n      return true;\n    }\n\n    // if it's in the full buffer list and not either of the above, its loaded already\n    if (indexOf(bufferResources, resourceId) != -1) {\n      load();\n      return true;\n    }\n  }\n\n  var webkitLoadCheck = function(link, callback) {\n    setTimeout(function() {\n      for (var i = 0; i < document.styleSheets.length; i++) {\n        var sheet = document.styleSheets[i];\n        if (sheet.href == link.href)\n          return callback();\n      }\n      webkitLoadCheck(link, callback);\n    }, 10);\n  }\n\n  var mozillaLoadCheck = function(style, callback) {\n    setTimeout(function() {\n      try {\n        style.sheet.cssRules;\n        return callback();\n      } catch (e){}\n      mozillaLoadCheck(style, callback);\n    }, 10);\n  }\n\n  // ie link detection, as adapted from https://github.com/cujojs/curl/blob/master/src/curl/plugin/css.js\n  if (engine == 'trident' && hackLinks) {\n    var ieStyles = [],\n      ieQueue = [],\n      ieStyleCnt = 0;\n    var ieLoad = function(url, callback) {\n      var style;\n      ieQueue.push({\n        url: url,\n        cb: callback\n      });\n      style = ieStyles.shift();\n      if (!style && ieStyleCnt++ < 12) {\n        style = document.createElement('style');\n        head.appendChild(style);\n      }\n      if (style){\n        ieLoadNextImport(style); \n      }\n    }\n    var ieLoadNextImport = function(style) {\n      var curImport = ieQueue.shift();\n      if (!curImport) {\n        style.onload = noop;\n        ieStyles.push(style);\n        return;  \n      }\n      style.onload = function() {\n        curImport.cb(curImport.ss);\n        ieLoadNextImport(style);\n      };\n      var curSheet = style.styleSheet;\n      curImport.ss = curSheet.imports[curSheet.addImport(curImport.url)];\n    }\n  }\n\n  // uses the <link> load method\n  var createLink = function(url) {\n    var link = document.createElement('link');\n    link.type = 'text/css';\n    link.rel = 'stylesheet';\n    link.href = url;\n    return link;\n  }\n\n  var noop = function(){}\n\n  cssAPI.linkLoad = function(url, callback) {\n    var timeout = setTimeout(function() {\n      if (testing) alert('timeout');\n      callback();\n    }, waitSeconds * 1000 - 100);\n    var _callback = function() {\n      clearTimeout(timeout);\n      if (link)\n        link.onload = noop;\n      // for style querying, a short delay still seems necessary\n      setTimeout(callback, 7);\n    }\n    if (!hackLinks) {\n      var link = createLink(url);\n      link.onload = _callback;\n      head.appendChild(link);\n    }\n    // hacks\n    else {\n      if (engine == 'webkit') {\n        var link = createLink(url);\n        webkitLoadCheck(link, _callback);\n        head.appendChild(link);\n      }\n      else if (engine == 'gecko') {\n        var style = document.createElement('style');\n        style.textContent = '@import \"' + url + '\"';\n        mozillaLoadCheck(style, _callback);\n        head.appendChild(style);\n      }\n      else if (engine == 'trident')\n        ieLoad(url, _callback);\n    }\n  }\n\n  /* injection api */\n  var progIds = ['Msxml2.XMLHTTP', 'Microsoft.XMLHTTP', 'Msxml2.XMLHTTP.4.0'];\n  var fileCache = {};\n  var get = function(url, callback, errback) {\n    if (fileCache[url]) {\n      callback(fileCache[url]);\n      return;\n    }\n\n    var xhr, i, progId;\n    if (typeof XMLHttpRequest !== 'undefined')\n      xhr = new XMLHttpRequest();\n    else if (typeof ActiveXObject !== 'undefined')\n      for (i = 0; i < 3; i += 1) {\n        progId = progIds[i];\n        try {\n          xhr = new ActiveXObject(progId);\n        }\n        catch (e) {}\n  \n        if (xhr) {\n          progIds = [progId];  // so faster next time\n          break;\n        }\n      }\n    \n    xhr.open('GET', url, requirejs.inlineRequire ? false : true);\n  \n    xhr.onreadystatechange = function (evt) {\n      var status, err;\n      //Do not explicitly handle errors, those should be\n      //visible via console output in the browser.\n      if (xhr.readyState === 4) {\n        status = xhr.status;\n        if (status > 399 && status < 600) {\n          //An http 4xx or 5xx error. Signal an error.\n          err = new Error(url + ' HTTP status: ' + status);\n          err.xhr = xhr;\n          errback(err);\n        }\n        else {\n          fileCache[url] = xhr.responseText;\n          callback(xhr.responseText);\n        }\n      }\n    };\n    \n    xhr.send(null);\n  }\n  //uses the <style> load method\n  var styleCnt = 0;\n  var curStyle;\n  cssAPI.inject = function(css) {\n    if (styleCnt < 31) {\n      curStyle = document.createElement('style');\n      curStyle.type = 'text/css';\n      head.appendChild(curStyle);\n      styleCnt++;\n    }\n    if (curStyle.styleSheet)\n      curStyle.styleSheet.cssText += css;\n    else\n      curStyle.appendChild(document.createTextNode(css));\n  }\n  \n  // NB add @media query support for media imports\n  var importRegEx = /@import\\s*(url)?\\s*(('([^']*)'|\"([^\"]*)\")|\\(('([^']*)'|\"([^\"]*)\"|([^\\)]*))\\))\\s*;?/g;\n\n  var pathname = window.location.pathname.split('/');\n  pathname.pop();\n  pathname = pathname.join('/') + '/';\n\n  var loadCSS = function(fileUrl, callback, errback) {\n\n    //make file url absolute\n    if (!fileUrl.match(absUrlRegEx))\n      fileUrl = '/' + normalize.convertURIBase(fileUrl, pathname, '/');\n\n    get(fileUrl, function(css) {\n\n      // normalize the css (except import statements)\n      css = normalize(css, fileUrl, pathname);\n\n      // detect all import statements in the css and normalize\n      var importUrls = [];\n      var importIndex = [];\n      var importLength = [];\n      var match;\n      while (match = importRegEx.exec(css)) {\n        var importUrl = match[4] || match[5] || match[7] || match[8] || match[9];\n\n        importUrls.push(importUrl);\n        importIndex.push(importRegEx.lastIndex - match[0].length);\n        importLength.push(match[0].length);\n      }\n\n      // load the import stylesheets and substitute into the css\n      var completeCnt = 0;\n      for (var i = 0; i < importUrls.length; i++)\n        (function(i) {\n          loadCSS(importUrls[i], function(importCSS) {\n            css = css.substr(0, importIndex[i]) + importCSS + css.substr(importIndex[i] + importLength[i]);\n            var lenDiff = importCSS.length - importLength[i];\n            for (var j = i + 1; j < importUrls.length; j++)\n              importIndex[j] += lenDiff;\n            completeCnt++;\n            if (completeCnt == importUrls.length) {\n              callback(css);\n            }\n          }, errback);\n        })(i);\n\n      if (importUrls.length == 0)\n        callback(css);\n    }, errback);\n  }\n\n  \n  cssAPI.normalize = function(name, normalize) {\n    if (name.substr(name.length - 4, 4) == '.css')\n      name = name.substr(0, name.length - 4);\n    \n    return normalize(name);\n  }\n  \n  var waitSeconds;\n  var alerted = false;\n  cssAPI.load = function(cssId, req, load, config, parse) {\n    \n    waitSeconds = waitSeconds || config.waitSeconds || 7;\n\n    var resourceId = cssId + (!parse ? '.css' : '.less');\n\n    // attach the load function to a buffer if there is one in registration\n    // if not, we do a full injection load\n    if (cssAPI.attachBuffer(resourceId, load))\n      return;\n\n    fileUrl = req.toUrl(resourceId);\n    \n    if (!alerted && testing) {\n      alert(hackLinks ? 'hacking links' : 'not hacking');\n      alerted = true;\n    }\n\n    if (!parse) {\n      cssAPI.linkLoad(fileUrl, load);\n    }\n    else {\n      loadCSS(fileUrl, function(css) {\n        // run parsing after normalization - since less is a CSS subset this works fine\n        if (parse)\n          css = parse(css, function(css) {\n            cssAPI.inject(css);\n            setTimeout(load, 7);\n          });\n      });\n    }\n  }\n\n  if (testing)\n    cssAPI.inspect = function() {\n      if (stylesheet.styleSheet)\n        return stylesheet.styleSheet.cssText;\n      else if (stylesheet.innerHTML)\n        return stylesheet.innerHTML;\n    }\n  \n  return cssAPI;\n});\n\n//# sourceURL=/lib/graphite-api/public/js/libs/require/css/css.js"),eval("define('lib/graphite-api/public/js/libs/require/css/css!override/styles/topcoat',[],function(){})\n//# sourceURL=/lib/graphite-api/public/js/libs/require/css/css!override/styles/topcoat"),eval("define('lib/graphite-api/public/js/libs/require/css/css!ccweb.files.extract/css/firstUserExp',[],function(){})\n//# sourceURL=/lib/graphite-api/public/js/libs/require/css/css!ccweb.files.extract/css/firstUserExp"),eval("define('lib/graphite-api/public/js/libs/require/css/css!ccweb.files.extract/css/jobListing',[],function(){})\n//# sourceURL=/lib/graphite-api/public/js/libs/require/css/css!ccweb.files.extract/css/jobListing"),eval("define('lib/graphite-api/public/js/libs/require/css/css!ccweb.files.extract/css/inspect',[],function(){})\n//# sourceURL=/lib/graphite-api/public/js/libs/require/css/css!ccweb.files.extract/css/inspect"),eval("define('lib/graphite-api/public/js/libs/require/css/css!ccweb.files.extract/css/layers',[],function(){})\n//# sourceURL=/lib/graphite-api/public/js/libs/require/css/css!ccweb.files.extract/css/layers"),eval("define('lib/graphite-api/public/js/libs/require/css/css!ccweb.files.extract/css/main',[],function(){})\n//# sourceURL=/lib/graphite-api/public/js/libs/require/css/css!ccweb.files.extract/css/main"),eval("define('lib/graphite-api/public/js/libs/require/css/css!ccweb.files.extract/css/popup',[],function(){})\n//# sourceURL=/lib/graphite-api/public/js/libs/require/css/css!ccweb.files.extract/css/popup"),eval("define('lib/graphite-api/public/js/libs/require/css/css!ccweb.files.extract/css/preview',[],function(){})\n//# sourceURL=/lib/graphite-api/public/js/libs/require/css/css!ccweb.files.extract/css/preview"),eval("define('lib/graphite-api/public/js/libs/require/css/css!ccweb.files.extract/css/zIndex',[],function(){})\n//# sourceURL=/lib/graphite-api/public/js/libs/require/css/css!ccweb.files.extract/css/zIndex"),eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4 */\n/*global define: true, graphite: true, window: true */\ndefine(\n    'ccweb.files.extract/main',[\n        'jquery',\n        'underscore',\n        'backbone',\n        'plugin-dependencies',              // plugin dependencies from ccweb\n        'ccweb.files.extract/models/PluginConfigModel',\n        'ccweb.files.extract/models/PluginAuthModel',\n        'ccweb.files.extract/models/MetricsProxyModel',\n        'ccweb.files.extract/models/UserSettingsModel',\n        'ccweb.files.extract/views/detail/PSDDetailsView',    // main view file\n        'ccweb.files.extract/controllers/InterceptController',\n        'ccweb.files.extract/controllers/AssetController',    // controller to populate a PSDModel with graphite JSON\n        'ccweb.files.extract/serverAPI',\n        'css!./css/topcoat.css',\n        'css!./css/firstUserExp.css',\n        'css!./css/jobListing.css',\n        'css!./css/inspect.css',\n        'css!./css/layers.css',\n        'css!./css/main.css',\n        'css!./css/popup.css',\n        'css!./css/preview.css',\n        'css!./css/zIndex.css'\n    ],\n\n    function ($, _, Backbone, deps, PluginConfigModel, PluginAuthModel, MetricsProxyModel, UserSettingsModel,\n              PSDDetailsView, InterceptController, AssetController, serverAPI) {\n        'use strict';\n\n        // Make sure we have a global graphite object and that it has the serverAPI\n        window.graphite = window.graphite || {};\n        window.graphite.events = window.graphite.events || _.extend({}, Backbone.Events);\n\n        window.graphite.serverAPI = serverAPI;\n        //set Feature Enabled\n        window.graphite.fflags = window.graphite.fflags || {};\n        window.graphite.setFeatureEnabled = function (aFeatureName, bFeatureEnabled) {\n            if (aFeatureName !== null) {\n                window.graphite.fflags[aFeatureName] = bFeatureEnabled;\n            }\n        };\n        \n        window.graphite.configModel = new PluginConfigModel();\n        window.graphite.authModel = new PluginAuthModel();\n        window.graphite.metricsProxyModel = new MetricsProxyModel();\n\n        if (window.graphite.metricsProxyModel) {\n            window.graphite.metricsProxyModel.setAuthModel(window.graphite.authModel);\n            window.graphite.metricsProxyModel.setConfigModel(window.graphite.configModel);\n        }\n\n        graphite.events.trigger('register-defaults');\n\n        //isFeatureEnabled\n        window.graphite.isFeatureEnabled = function (aFeatureName) {\n            var bFeatureEnabled = false;\n            if (aFeatureName !== null) {\n                if (window.graphite.fflags[aFeatureName]) {\n                    bFeatureEnabled = true;\n                }\n            }\n            return bFeatureEnabled;\n        };\n\n        window.graphite.inPublicOneUp = function () {\n            return deps.utils.getCurrentBasePath() === 'link';\n        };\n\n        return function (model) {\n            var modelId = model.get('id'),\n                assetGuid = modelId.substr(modelId.lastIndexOf('/') + 1),\n                layerCompId = model.get(\"layerCompId\"),\n                path = model.get(\"path\"),\n                extractPSDModel;\n\n            window.graphite.urlBase = modelId.substr(0, modelId.indexOf('/api/'));\n            window.graphite.ownerId = model.get('ownerId');\n            window.graphite.linkId = model.get('linkId');\n\n            if (this) {\n                this.localContent = model.get('localContent') || false;\n            }\n\n\n            extractPSDModel = AssetController.getAsset(assetGuid,\n                layerCompId,\n                function () {\n                    if (window.graphite.metricsProxyModel.authModel.isAnalyticsOptIn()) {\n                        InterceptController.applyBehaviors();\n                    }\n                    var graphiteInfo = extractPSDModel.get(\"info\"),\n                        graphiteVersion = graphiteInfo.version || \"\";\n                    \n                    if (!extractPSDModel.get('localContent') && extractPSDModel.get(\"path\")) {\n                        graphite.events.trigger(\"asset-data-loaded\", {\n                            path: extractPSDModel.get(\"path\"),\n                            graphiteVersion: graphiteVersion\n                        });\n                    }\n                },\n                function (response) {\n                    if (response.status === 401) {\n                        graphite.events.trigger('reauthenticate');\n                    }\n                },\n                this,\n                path);\n\n            // Propagate a few additional attributes of the asset model\n            // we received from our plugin host (if applicable).\n            extractPSDModel.set('modified', model.get('modified'));\n            extractPSDModel.set('assetId', model.get('id'));\n            extractPSDModel.set('fileName', model.get('name'));\n            extractPSDModel.set('type', model.get('type'));\n            extractPSDModel.set('height', model.get('height'));\n            extractPSDModel.set('width', model.get('width'));\n            extractPSDModel.set('size', model.get('size'));\n\n            var INTERFACE = {\n                $el: $('<div>').addClass('extract-plugin'),\n\n                show: function () {\n                    if (window.graphite.inPublicOneUp()) {\n                        this.$el.addClass('public');\n                    }\n                    this.psdDetailsView = new PSDDetailsView({model: extractPSDModel});\n                    this.$el.html(this.psdDetailsView.$el);\n                    this.addHandlers();\n                },\n\n                hide: function () {\n                    if (this.psdDetailsView) {\n                        this.psdDetailsView.remove();\n                        this.psdDetailsView = null;\n                    }\n                    this.removeHandlers();\n                    extractPSDModel.reset();\n                },\n\n                addHandlers: function () {\n                    graphite.events.on('layerCompChanged', this.layerCompChanged, this);\n                },\n\n                removeHandlers: function () {\n                    graphite.events.off('layerCompChanged', this.layerCompChanged, this);\n                },\n\n                layerCompChanged: function (model) {\n                    this.hide();\n                    extractPSDModel = model;\n                    this.show();\n                    this.trigger('added-to-dom');\n                },\n\n                trigger: function (event) {\n                    if (event === 'added-to-dom') {\n                        if (this.psdDetailsView.previewView) {\n                            this.psdDetailsView.previewView.attached();\n                        }\n                    }\n                },\n\n                sizeChange: function () {\n\n                }\n            };\n\n\n            return INTERFACE;\n        };\n    }\n);\n\n//# sourceURL=/lib/graphite-api/public/js/ccweb.files.extract/main.js"),eval('/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4 */\n/*global define: true, graphite: true, brackets: true, PathUtils: true*/\n\ndefine(\'override/utils/TemplateUtil\',[\n    "module",\n    "jquery",\n    "underscore",\n    "plugin-dependencies"\n], function (module, $, _, deps) {\n    "use strict";\n\n    var ExtensionUtils = brackets.getModule("utils/ExtensionUtils");\n\n    var modulePath = ExtensionUtils.getModulePath(module),\n        imagePath = "file://" + PathUtils.makePathAbsolute("../lib/graphite-api/public/images/", modulePath);\n\n    var TemplateUtil = {\n\n        createTemplate: function (srcHTML, data) {\n            var normalizedHTML = srcHTML.replace(/(\\"(\\/)?)images\\//g, \'"\' + imagePath),\n                context = _.extend({translate: deps.translate}, data),\n                template = _.template(normalizedHTML);\n\n            return $(template(context).trim()).filter("*");\n        }\n\n    };\n\n    return TemplateUtil;\n});\n\n//# sourceURL=/./utils/TemplateUtil.js'),
eval('/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4, regexp: true */\n/*global define, brackets*/\ndefine(\'Constants\',["module"], function (module) {\n    "use strict";\n    var ExtensionUtils = brackets.getModule("utils/ExtensionUtils");\n    \n    var Constants = {\n        CACHE_LOCATION: brackets.app.getApplicationSupportDirectory() + "/psd-lens/",\n        STATIC_CONTENT_LOCATION: ExtensionUtils.getModulePath(module) + "static-content/",\n\n        Routes: {\n            ASSET: "handleAsset",\n            AUTHLESS_ASSET: "handleAuthlessAsset",\n            FIRST_LAUNCH: "firstLaunch",\n            HIDE: "hidePanel",\n            FOLDER: "handleFolder"\n        },\n\n        States: {\n            STATIC_COMP: "static comp",\n            FILE_BROWSER: "file browser",\n            USER_COMP: "user comp",\n            CREATIVE_URL: "creative url"\n        },\n\n        Hint: {\n            COLOR: "color",\n            IMAGE: "image",\n            GRADIENT: "gradient",\n            OTHER: "other",\n            TEXT: "text",\n            SIZE: "size",\n            POSITION: "position"\n        },\n\n        RegExp: {\n            FILE_EXT: /\\.([a-z]+)$/i,\n            STRIP_VENDOR_PREFIX: /^(-[a-z]+-)?(.+)$/\n        },\n\n        GroupLayerExcludedProps: {"top" : 1, "left" : 1, "right" : 1,\n                                  "bottom" : 1, "width" : 1, "height" : 1,\n                                  "max-height" : 1, "max-width" : 1, "min-width" : 1,\n                                  "min-height" : 1},\n        \n        ThumbnailWidth: 230\n    };\n\n    return Constants;\n\n});\n\n//# sourceURL=/Constants.js'),eval('/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4, bitwise: true */\n/*global define: true, graphite: true, Image: true*/\n\ndefine(\'controllers/ThumbnailController\',[\n    \'backbone\',\n    \'config/environment\',\n    \'Constants\'\n], function (Backbone, environment, Constants) {\n    "use strict";\n\n    var ThumbnailController = {\n        drawThumbnail: function (model, htmlElem) {\n            var assetID = model.get("id"),\n                md5 = model.get("md5"),\n                image = this[assetID],\n                self = this;\n\n            if (image && image.image.complete && image.md5 === md5) {\n                this.makeDrawFunc(image.image, htmlElem)();\n            } else {\n                image = {\n                    md5 : md5,\n                    image: new Image()\n                };\n\n                if (model.get(\'type\') === "application/vnd.adobe.directory+json") {\n                    image.image.addEventListener("load", self.makeDrawFunc(image.image, htmlElem));\n                    self[assetID] = image;\n                } else {\n                    var pathSeparator  = \'/\',\n                        ccpath = decodeURI(Backbone.history.fragment) || "files",\n                        ccAssetID = model.get("id"),\n                        name = model.get("name"),\n                        storagePath,\n                        size = Constants.ThumbnailWidth,\n                        height = model.get("height"),\n                        width = model.get("width");\n\n                    if (width < height) {\n                        size = Math.round(height / width * size);\n                    }\n                    \n                    // The upload tile\'s model doesn\'t have a name. Do not fetch thumbnail in this case.\n                    if (name) {\n                        storagePath = ccpath + pathSeparator + name;\n\n                        graphite.serverAPI.getRendition(storagePath, size, function (err, imgurl) {\n                            if (imgurl) {\n                                image.image.addEventListener("load", self.makeDrawFunc(image.image, htmlElem));\n                                image.image.src = imgurl;\n                                self[ccAssetID] = image;\n                            }\n                        });\n                    }\n                }\n            }\n        },\n\n        makeDrawFunc: function (image, htmlElem) {\n            var theImage = image,\n                theElem = htmlElem;\n\n            return function () {\n                theElem.width = image.width;\n                theElem.height = image.height;\n                var context = theElem.getContext(\'2d\');\n                context.drawImage(theImage, 0, 0);\n            };\n        }\n    };\n\n    return ThumbnailController;\n});\n\n//# sourceURL=/lib/graphite-api/public/js/controllers/ThumbnailController.js'),eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4, bitwise: true */\n/*global define: true, graphite: true*/\n\ndefine('controllers/ErrorMessageController',[\n    'jquery',\n    'underscore',\n    'backbone',\n    'ccweb.files.extract/Constants',\n    'plugin-dependencies'\n], function ($, _, Backbone, Constants, deps) {\n    'use strict';\n\n    var ErrorMessageController = Backbone.Model.extend({\n\n        getErrorMessageForWorkerResult: function (inJSONResultsData, inAssetName) {\n\n            var errCode = inJSONResultsData.errorCode,\n                errMsg = inJSONResultsData.errorMessage;\n\n            if (errCode === null || errCode === undefined) {\n                return deps.translate('Unknown error generating Parfait data.');\n            }\n\n            if (errCode === Constants.WorkerErrorCodes.UNSUPPORTED_INPUTFMT) {\n                return deps.translate('Could not process file {0}: unsupported image format', inAssetName);\n            }\n\n            if (errCode === Constants.WorkerErrorCodes.NOINPUTFILE) {\n                return deps.translate('No files specified for processing');\n            }\n\n            if (errCode === Constants.WorkerErrorCodes.GRAPHITE_PROCESSING) {\n                switch (errMsg) {\n                case Constants.WorkerErrorMsgs.GR_JSONGENERATION:\n                    return deps.translate('Error generating Parfait data for {0}', inAssetName);\n                case Constants.WorkerErrorMsgs.GR_THUMBNAIL:\n                    return deps.translate('Error generating thumbnail for {0}', inAssetName);\n                case Constants.WorkerErrorMsgs.GR_SPRITESHEET:\n                    return deps.translate('Error generating Parfait sprites for {0}', inAssetName);\n                case Constants.WorkerErrorMsgs.GR_UNKNOWNENCODING:\n                    return deps.translate('Error creating asset: unknown encoding');\n                case Constants.WorkerErrorMsgs.GR_MISSINGLAYERSPEC:\n                    return deps.translate('Error creating asset: missing layer specification');\n                case Constants.WorkerErrorMsgs.GR_CREATINGASSET:\n                    return deps.translate('Error creating asset: error encoding asset');\n                default:\n                    // fall through, but make lint happy\n                }\n            }\n\n            if (errCode === Constants.WorkerErrorCodes.GRAPHITE_REJECTED) {\n                var matches = errMsg.match(/File rejected - too many layers \\((\\d+)\\/(\\d+)\\)/);\n                if (matches) {\n                    var layerCount = matches[1];\n                    var layerLimit = matches[2];\n                    return deps.translate('Currently, processing is limited to files with {0} layers or less. {1} contains {2} layers. Please reduce the numbers of layers in your file.', layerLimit, inAssetName, layerCount);\n                }\n\n                // fail of some sort. Be generic.\n                return deps.translate('Your file exceeds the maximum number of layers supported. Please reduce the number of layers in your file and try again.');\n            }\n\n            return deps.translate('Unknown error generating Parfait data for {0}', inAssetName);\n        }\n    });\n\n    return new ErrorMessageController();\n});\n\n//# sourceURL=/lib/graphite-api/public/js/controllers/ErrorMessageController.js"),eval('define(\'text!views/templates/assetViewLoadingTemplate.html\',[],function () { return \'<div class="image-wrapper-progress asset-uploading">\\n    <div id="stepContainer">\\n        <span id="uploadStep"><%-translate("Uploading")%></span>\\n        <span id="nextStep"><%-translate("processing step next")%></span>\\n    </div>\\n    <div id="progressbar" class="progressbar-uploading"></div>\\n    <div class="asset-label folder">\\n        <div class="name"><%= fileToLoad.name %></div>  \\n    </div> \\n</div>\\n\';});\n\n//# sourceURL=/text!views/templates/assetViewLoadingTemplate.html'),eval('define(\'text!views/templates/assetViewTemplate.html\',[],function () { return \'<div class="files-list-item" draggable="true" title="<%= name %>">\\n    <div class="frame">\\n        <div class="imgwrapframe">\\n            <div class="imgwrap">\\n                <canvas id="assetThumbnail"></canvas>\\n            </div>\\n        </div>\\n        <div class="asset-label file">\\n            <div class="name"><%= name %></div>\\n            <!--div class="del-button" title=<%-translate("Archive")%>></div-->\\n        </div>\\n    </div>\\n</div>\';});\n\n//# sourceURL=/text!views/templates/assetViewTemplate.html'),eval('define(\'text!views/templates/assetFolderViewTemplate.html\',[],function () { return \'<div class="files-list-item" title="<%= name %>">\\n    <div class="frame frame-folder">\\n        <div class="folder-tab"></div>\\n        <div class="folder-body"/>\\n    </div>\\n    <div class="asset-label folder">\\n        <div class="name"><%= name %></div>\\n    </div>\\n</div>\';});\n\n//# sourceURL=/text!views/templates/assetFolderViewTemplate.html'),eval("\n/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013-2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4 */\n/*global define: true, graphite: true, window: true, setTimeout: true, XMLHttpRequest: true*/\n\ndefine('views/landing/AssetView',[\n    'jquery',\n    'underscore',\n    'backbone',\n    'plugin-dependencies',\n    'controllers/AuthController',\n    'utils/TemplateUtil',\n    'controllers/ThumbnailController',\n    'controllers/ErrorMessageController',\n    'text!views/templates/assetViewLoadingTemplate.html',\n    'text!views/templates/assetViewTemplate.html',\n    'text!views/templates/assetFolderViewTemplate.html'\n], function ($, _, Backbone, deps, AuthController, TemplateUtil, ThumbnailController, ErrorMessageController,\n             AssetViewLoadingTemplate, AssetViewTemplate, AssetFolderViewTemplate) {\n    \"use strict\";\n\n    var AssetView = Backbone.View.extend({\n\n        tagName: 'article',\n        className: 'card-asset',\n\n        initialize: function () {\n            if (this.model.get(\"fileToLoad\") === undefined) {\n                var date = new Date(this.model.attributes.created);\n                this.model.attributes.date = date.getMonth() + 1 + \"/\" + date.getDate() + \"/\" + date.getFullYear() + \" \" + date.getHours() + \":\" + date.getMinutes();\n            }\n\n            this.listenTo(this.model, 'change:uploadProgress', this.updateProgress);\n            this.listenTo(this.model, 'destroy', this.remove);\n            this.render();\n            this.addHandlers();\n        },\n\n        render: function () {\n            try {\n                var tmplId;\n\n                if (this.model.get(\"fileToLoad\") !== undefined) {\n                    if (this.model.get('type') === 'application/vnd.adobe.directory+json') {\n                        tmplId = AssetFolderViewTemplate;\n                    } else {\n                        tmplId = AssetViewLoadingTemplate;\n                    }\n                } else {\n                    if (this.model.get('type') === 'application/vnd.adobe.directory+json') {\n                        tmplId = AssetFolderViewTemplate;\n                    } else {\n                        tmplId = AssetViewTemplate;\n                        //Call out to see if this file is still processing. This can happen if the UI is refreshed\n                        //while one or more PSDs are being processed.\n                        //this.checkStatus();\n                    }\n                }\n                var el = this.$el;\n                el.html(TemplateUtil.createTemplate(tmplId, this.model.toJSON()));\n\n                var elem = el.find('#assetThumbnail');\n                if (elem[0]) {\n                    ThumbnailController.drawThumbnail(this.model, elem[0]);\n                }\n            } catch (err) {\n                console.log(\"Failed to render thumb for:\" + this.model.attributes.name);\n            }\n            return this;\n        },\n        \n        getAssetCCPath: function (model) {\n            var path = Backbone.history.fragment || \"files\",\n                unencoded;\n            \n            path = path.replace(/\\/$/, \"\");\n            unencoded = decodeURI(path);\n            return unencoded + \"/\" + model.get(\"name\");\n        },\n        \n        addHandlers : function () {\n            graphite.events.on(\"uploaded\", this.showUploadedAssetPreview, this);\n            \n            var that = this;\n            this.$el.mouseenter(function () {\n                $(that.el).find('.del-button, .download-button').css('opacity', '1');\n                $(that.el).find('.del-button').click(function (event) {\n                    $(this).closest('.frame').css('opacity', 0.2);\n                    graphite.serverAPI.deleteAsset(that.getAssetCCPath(that.model),\n                        that.handleDeleteSuccess.bind(that),\n                        that.handleDeleteError.bind(that));\n                    event.stopImmediatePropagation();\n                });\n                $(that.el).find('.download-button').click(function (event) {\n                    // Download asset\n                    that.downloadPSD();\n                    event.stopImmediatePropagation();\n                });\n            });\n\n            this.$el.mouseleave(function () {\n                $(that.el).find('.del-button, .download-button').css('opacity', '0');\n            });\n\n            this.$el.click(function () {\n                if (AuthController.isLoggedIn()) {\n                    if (!that.model.get(\"uploadProgress\")) {\n                        var url;\n\n                        if (that.model.attributes.type === \"application/vnd.adobe.directory+json\") {\n                            url = that.getAssetCCPath(that.model);\n\n                            Backbone.history.navigate(encodeURI(url), true);\n                        } else if (that.model.attributes.type === \"image/vnd.adobe.photoshop\") {\n                            url = \"asset/psd/\" + that.model.get(\"id\").replace(/\\//, \"_\") + \"/\" +\n                                        that.getAssetCCPath(that.model);\n\n                            Backbone.history.navigate(encodeURI(url), true);\n                        }\n                    }\n                } else {\n                    // DPO - I can't work out when or how this method gets fired.\n                    // There was an alert here before. This would never get shown, because it's not an alert.\n                    deps.notifyUser(deps.translate('You are no longer logged in.  Please log in again'));\n                    window.location.href = window.location;\n                }\n            });\n        },\n\n        handleDeleteSuccess: function () {\n            this.remove();\n            graphite.events.trigger('update-asset-list-view');\n        },\n\n\n        handleDeleteError: function (xhr) {\n            if (xhr.status === 401) {\n                graphite.events.trigger('reauthenticate');\n            }\n        },\n\n        updateProgress : function () {\n            this.callCount++;\n            //console.log('AssetView.updateProgress(): ' + this.model.id);\n            var progress = this.model.get('uploadProgress');\n            if (progress) {\n                if (progress.status === deps.translate('PROCESSING')) {\n                    //remove the uploading class , replace it with processing class\n                    //console.log('PROGRESS_PROCESSING ***********************');\n                    this.$('.image-wrapper-progress').removeClass('asset-uploading').addClass('asset-processing');\n                    this.$('#progressbar').removeClass('progressbar-uploading').addClass('progressbar-processing');\n                    this.model.unset('uploadProgress');\n                }\n                var perc = '';\n                if (progress.percentage) {\n                    perc = Math.floor(progress.percentage) + \"%\";\n                    this.$('#progressbar').width(perc);\n                }\n                \n                this.$('#uploadStep').text(progress.status + \" \" + perc);\n                \n                if (progress.nextStep) {\n                    this.$('#nextStep').text(progress.nextStep);\n                }\n                //console.log(\"updateProgress(), workerId = \" + progress.workerID);\n                if (progress.workerID) {\n                    graphite.serverAPI.setWorkerOnAsset(progress.workerID, progress.assetID);\n                    this.checkWorkerProgress(progress.workerID, progress.assetID);\n                }\n            }\n        },\n\n\n        checkWorkerProgress: function (workerId, assetId) {\n            var that = this,\n                thatWorker = workerId,\n                thatAsset = assetId;\n\n            function successCallback(response) {\n                var json = JSON.parse(JSON.parse(response.responseText)),\n                    progress = json.progress || 0,\n                    status = null,\n                    params,\n                    statusText = \"\";\n\n                if (json.results) {\n                    status = json.results.status;\n                }\n\n                status = status || json.status || \"Unknown\";\n\n                //console.log(\"worker status = \" + status);\n                //console.log(\"worker progress = \" + progress);\n\n                // TODO needs LOC\n                if (status === \"success\") {\n                    that.model.set(\"processFinished\", Date.now());\n\n                    //send the processed event\n                    params = {};\n                    params.filesize = that.model.get(\"fileSize\");\n                    params.processDuration = that.model.get(\"processFinished\") - that.model.get(\"processStarted\");\n                    params.totalDuration = that.model.get(\"processFinished\") - that.model.get(\"uploadStarted\");\n                    graphite.events.trigger('processed', params);\n\n                    statusText = deps.translate(\"PROCESSING\");\n                    that.getModelData(thatAsset);\n\n                } else if (status === \"queued\") {\n                    statusText = deps.translate(\"QUEUED\");\n                    setTimeout(function () { that.checkWorkerProgress(thatWorker, thatAsset); }, 1000); // Ping the server for the status again\n                } else if (status === \"failed\") {\n                    //send the proccessedFailed event\n                    params = {};\n                    params.fileSize = that.model.get(\"fileSize\");\n                    params.errorCode = json.errorCode;\n                    params.errorMessage = json.errorMessage;\n                    graphite.events.trigger('processing-failed', params);\n\n                    graphite.events.trigger('load-alert', ErrorMessageController.getErrorMessageForWorkerResult(json, that.model.get(\"fileToLoad\").name));\n                    that.model.id = thatAsset;\n\n                    // Go ahead and delete it. It's not going to get better.\n                    graphite.serverAPI.deleteAsset(that.model.id,\n                        that.handleDeleteSuccess,\n                        that.handleDeleteError,\n                        that);\n\n                    that.model.destroy();\n                } else {\n                    statusText = deps.translate(\"PROCESSING\");\n                    setTimeout(function () { that.checkWorkerProgress(thatWorker, thatAsset); }, 1000); // Ping the server for the status again\n                }\n                that.setProcessingProgressPercent(progress, statusText);\n            }\n\n            function errorCallback(resp) {\n                that.getModelData(thatAsset);\n            }\n            graphite.serverAPI.getWorkerStatus(workerId, successCallback, errorCallback, this);\n        },\n\n        getModelData: function (assetId) {\n            var that = this,\n                thatAssetId = assetId;\n\n            function successCallback(response) {\n                var data = JSON.parse(response.responseText);\n                // remove the graphite worker so we don't try to get the progress again\n                graphite.serverAPI.setWorkerOnAsset(null, thatAssetId);\n\n                if (data.hasOwnProperty('custom') && data.custom.hasOwnProperty('graphiteWorker')) {\n                    delete data.custom.graphiteWorker;\n                }\n                var modelData = { 'id' : thatAssetId,\n                                  'updated' : data.asset.created,\n                                  'created' : data.asset.created,\n                                  'mimeType' : data.asset.mimeType,\n                                  'metadata' : data };\n\n                that.model.clear();\n                that.model.set(modelData);\n                that.initialize();\n            }\n\n            graphite.serverAPI.getAssetInfo(assetId, successCallback, null, this);\n        },\n\n\n        setProcessingProgressPercent: function (progress, statusText) {\n            var perc = Math.floor(progress) + '%';\n            //console.log('setProcessingProgressPercent: ' + statusText + ' ' + perc);\n            this.$('#uploadStep').text(statusText + ' ' + perc);\n            this.$('#progressbar').width(perc);\n        },\n\n        showUploadedAssetPreview: function (params) {\n            var self = this;\n            if (this.model.get('name') === params.fileName) {\n                var path = params.path || '';\n                path = encodeURI(path);\n                var fetchOptions = graphite.serverAPI.createAjaxOptions('GET',  path + \"/:metadata\");\n                $.ajax({\n                    type: \"GET\",\n                    url: fetchOptions.url,\n                    headers: fetchOptions.headers\n                }).done(function (msg) {\n                    if (_.contains(this.dataTypes, \"json\")) {\n                        self.model.set(msg);\n                    } else {\n                        self.model.set(JSON.parse(msg));\n                    }\n\n                    self.model.unset('fileToLoad');\n                    var date = new Date(self.model.attributes.created);\n                    self.model.attributes.date = date.getMonth() + 1 + \"/\" + date.getDate() + \"/\" + date.getFullYear() + \" \" + date.getHours() + \":\" + date.getMinutes();\n                    self.render();\n                });\n            }\n        },\n        \n\n        setProcessingView: function () {\n            var el = this.$el;\n            if (this.model.get('fileToLoad') === undefined) {\n                this.model.set('fileToLoad', {name: this.model.get('metadata').asset.fileName});\n            }\n\n            var tmpl = TemplateUtil.createTemplate(AssetViewLoadingTemplate, this.model.toJSON());\n            el.html(tmpl);\n\n            this.$('.image-wrapper-progress').removeClass('asset-uploading').addClass('asset-processing');\n            this.$('#progressbar').removeClass('progressbar-uploading').addClass('progressbar-processing');\n        },\n\n        downloadPSD: function () {\n            var self = this;\n            graphite.events.trigger('downloading-psd');\n\n            if (!self.$downloadFrame) {\n                self.$downloadFrame = $('<iframe class=\"download-frame\"/>');\n                self.$el.append(self.$downloadFrame);\n            }\n\n            // Ensure resource is accessible before ultimately downloading.\n            var assetURL = graphite.serverAPI.getDerivedDownloadURL(self.model.get('id'));\n            graphite.serverAPI.getAssetETag(self.model.get('id'),\n                function (response) {\n                    self.$downloadFrame.attr('src', assetURL);\n                },\n                function (response) {\n                    if (response.status === 401) {\n                        graphite.events.trigger('reauthenticate');\n                    }\n                },\n                this);\n        }\n    });\n    return AssetView;\n});\n\n//# sourceURL=/lib/graphite-api/public/js/views/landing/AssetView.js"),eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4, bitwise: true */\n/*global define: true, graphite: true*/\n\ndefine('models/AssetModel',['underscore', 'backbone'], function (_, Backbone) {\n    'use strict';\n    var AssetModel = Backbone.Model.extend({\n\n        defaults: {\n            id: null,\n            etag: '',\n            type: '',\n            url: '',\n            updated: '',\n            created: '',\n            md5: '',\n            width: '',\n            height: '',\n            //fileName: '',\n            mimeType: '',\n            collaboration: ''\n        },\n\n        initialize: function () {\n        }\n\n    });\n\n    return AssetModel;\n});\n\n//# sourceURL=/lib/graphite-api/public/js/models/AssetModel.js"),eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4, bitwise: true */\n/*global define: true, XMLHttpRequest: true, FormData: true, console: true, graphite: true, window: true, setTimeout: true, Backbone */\n\nvar max_concurrent_uploads = 2;\n\ndefine('controllers/UploadController',[\n    'jquery',\n    'models/AssetModel',\n    'plugin-dependencies',\n    'config/environment'\n], function ($, AssetModel, deps, environment) {\n    'use strict';\n\n    // serverAPI\n    var UploadController = {\n\n        uploadQueue : [],   // Queue of files to upload\n        uploadList : [],    // list of files being uploaded\n        fakeArray: [],      // list of files that have been uploaded but the response has not been returned\n\n        upload : function (file, fileNameToLoad) {\n            var item = new AssetModel();\n            \n            fileNameToLoad = fileNameToLoad || file.name;\n            \n            item.set(\"fileToLoad\", file);\n            item.set(\"name\", fileNameToLoad);\n            \n            var currentCCPath = Backbone.history.fragment || \"files\";\n            item.set('ccPath', currentCCPath);\n            \n            this.uploadQueue.push({'file': file, 'asset': item});\n            this.processQueue();\n            return item;\n        },\n\n        restoreUploads : function (assetCollection) {\n\n            this.uploadList.forEach(function (entry) {\n                assetCollection.add(entry.asset);\n            });\n\n            this.uploadQueue.forEach(function (entry) {\n                assetCollection.add(entry.asset);\n            });\n        },\n\n        hasActiveUploads : function () {\n            // if we are actively uploading either we have something in the queue or uploading\n            return (this.uploadQueue.length > 0 || this.uploadList.length > 0);\n        },\n\n        buildQueryString: function () {\n            var queryString = '',\n                joiner = '?';\n\n            if (environment.hasOwnProperty('ssCount')) {\n                queryString = queryString + joiner + 'sheetCount=' + environment.ssCount;\n                joiner = '&';\n            }\n\n            if (environment.hasOwnProperty('ssFormat')) {\n                queryString = queryString + joiner + 'format=' + environment.ssFormat;\n                joiner = '&';\n            }\n\n            if (environment.hasOwnProperty('ssScale')) {\n                queryString = queryString + joiner + 'scale=' + environment.ssScale;\n                joiner = '&';\n            }\n\n            return queryString;\n        },\n\n        processQueue : function () {\n            // Limit the number of file POST to no more than 5 concurrent requests.  This way\n            // we have less of a chance of hitting the browsers active connection limit\n            var that = this,\n                entry,\n                url = decodeURI(Backbone.history.fragment),\n                pathSeparator = '/';\n            \n            function loadHandler(response) {\n                //set the upload-finished property on the model class\n                entry.asset.set('uploadFinished', Date.now());\n\n\n                that.uploadList.splice(that.uploadList.indexOf(entry), 1);\n\n                if (response.status === 200 || response.status === 201) {\n                    //start processing since we have a valid workerID\n                    var prog = {'status' : deps.translate(\"UPLOADING\"),\n                        'percentage' : 100\n                        };\n\n                    entry.asset.set(\"uploadProgress\", prog);\n\n                    entry.asset.set(\"processStarted\", Date.now());\n\n                    var res = JSON.parse(response.responseText),\n                        uploadDuration = entry.asset.get(\"uploadFinished\") - entry.asset.get(\"uploadStarted\"),\n                        params = {};\n\n                    prog = {'status' : deps.translate(\"PROCESSING\"),\n                                'nextStep' : deps.translate(\"Almost ready\"),\n                                'assetID' : res.assetID,\n                                'workerID' : res.workerID};\n\n                    entry.asset.set(\"uploadProgress\", prog);\n\n                    //set the assetId (guid) on the model class\n                    entry.asset.set('assetId', res.assetID);\n\n                    //trigger uploaded event for metrics\n                    params.fileSize = entry.asset.get('fileSize');\n                    params.uploadDuration = uploadDuration;\n                    params.path = url;\n                    params.fileName = entry.asset.get('name');\n                    //uploaded complete event\n                    graphite.events.trigger('uploaded', params);\n\n                } else if (response.status === 401) {\n                    graphite.events.trigger('reauthenticate');\n                } else if (response.status === 409) {\n                    /* File Conflict error! Uploaded file is already present in user's CC location.  */\n                    that.failedToUpload(entry.asset, entry.file, 'duplicateFileUploadError');\n                } else {\n                    that.failedToUpload(entry.asset, entry.file, 'validFileUploadError');\n                }\n                that.processQueue();\n            }\n            \n            function errorHandler() {\n                that.uploadCount = that.uploadCount - 1;\n                that.uploadList.splice(that.uploadList.indexOf(entry), 1);\n                that.failedToUpload(entry.asset, entry.file, 'validFileUploadError');\n                that.processQueue();\n            }\n            \n            function progressHandler(progress) {\n                //set the percentage on upload step.\n                var perc,\n                    prog;\n                \n                if (progress.lengthComputable) {\n                    //firefox                    \n                    perc = Math.floor((progress.loaded / progress.total) * 90);\n                } else if (progress.hasOwnProperty('position')) {\n                    //chrome\n                    perc = Math.floor((progress.position / progress.totalSize) * 90);\n                }\n                prog = {'status' : deps.translate(\"UPLOADING\"),\n                        'percentage' : perc\n                       };\n\n                entry.asset.set(\"uploadProgress\", prog);\n            }\n\n            if (that.uploadList.length < max_concurrent_uploads && that.uploadQueue.length > 0) {\n                entry = that.uploadQueue.shift();\n                if (url === '') {\n                    url = '/files/' + url;\n                }\n\n                url = pathSeparator + url + pathSeparator + entry.asset.get('name');\n                url = url.replace(/\\/\\//, \"/\"); // remove dupe slashes                  \n\n                that.uploadList.push(entry);\n               \n                graphite.serverAPI.upload(entry, url, loadHandler, errorHandler, progressHandler);\n                \n                //set the name,filesize for metrics\n                if (!entry.asset.get('name')) {\n                    entry.asset.set(\"name\", entry.file.name);\n                }\n                entry.asset.set(\"fileSize\", entry.file.size);\n\n                //set the upload-started property on the model class    \n                entry.asset.set(\"uploadStarted\", Date.now());\n            }\n        },\n\n        failedToUpload : function (model, file, failure) {\n            var params = {};\n            if (failure === 'validFileUploadError') {\n                window.graphite.events.trigger(\"valid-file-upload-error\", 'validFileUploadError', model.get('name'));\n            } else if (failure === 'duplicateFileUploadError') {\n                window.graphite.events.trigger(\"duplicate-file-upload-error\", 'duplicateFileUploadError', model.get('name'));\n            }\n            params.filesize = model.get(\"fileSize\");\n            graphite.events.trigger('upload-failed', params);\n            model.destroy();\n        }\n    };\n    return UploadController;\n});\n\n//# sourceURL=/lib/graphite-api/public/js/controllers/UploadController.js"),
eval('/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4, bitwise: true */\n/*global define: true, graphite: true*/\n\ndefine(\'collections/AssetCollection\',[\n    \'backbone\',\n    \'models/AssetModel\'\n], function (Backbone, AssetModel) {\n    \'use strict\';\n    \n    var PATH_SEPARATOR = "/";\n    \n    var AssetCollection = Backbone.Collection.extend({\n        model: AssetModel,\n\n        initialize: function (models, options) {\n            this.path = options && options.path;\n\n            if (!this.path) {\n                // Backwards compatibility with parfait\n                var collectionPath = Backbone.history.fragment || "files";\n\n                collectionPath = collectionPath.slice(-1) === PATH_SEPARATOR ?\n                        collectionPath.substring(0, collectionPath.length - 1) : collectionPath;\n\n                this.path = collectionPath;\n            } else {\n                // TODO cleanup use of Backbone.history.fragment and app router routes\n                // Prepend "files/" for consistency in CacheManager\n                this.path = "files/" + this.path;\n            }\n        },\n\n        parse: function (response) {\n            var self = this,\n                pathMD5Map = {},\n                ccPsds = "";\n            \n            function filterPSDandFolders(asset) {\n                // We need only PSD and folders to be rendered for the user\n                if (asset.md5) {\n                    // test the ending of the path wether it has a trailing slash\n                    // Don\'t create paths with dupe slashes. It breaks the cache.\n                    var key = self.path.substr(self.path.length - 1) === PATH_SEPARATOR ?\n                            self.path + asset.name :\n                            self.path + PATH_SEPARATOR + asset.name;\n                    \n                    pathMD5Map[key] = asset.md5;\n                }\n                \n                return asset.type === "application/vnd.adobe.directory+json" ||\n                    asset.type === "application/x-photoshop" ||\n                    asset.type === "image/vnd.adobe.photoshop" ||\n                    asset.type === "image/x-photoshop" ||\n                    asset.type === "image/photoshop" ||\n                    asset.type === "application/psd" ||\n                    asset.type === "application/photoshop";\n            }\n            \n            if (response.total_children && response.total_children > 0 && response.children) {\n                ccPsds = response.children.filter(filterPSDandFolders);\n            }\n            \n            graphite.events.trigger("cc-directory-load", {\n                pathMD5Map: pathMD5Map,\n                path: this.path\n            });\n            \n            return ccPsds;\n        }\n\n    });\n    return AssetCollection;\n\n});\n\n//# sourceURL=/lib/graphite-api/public/js/collections/AssetCollection.js'),eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4, bitwise: true */\n/*global define: true, graphite: true*/\n\ndefine('controllers/AssetListController',[\n    'jquery',\n    'underscore',\n    'backbone',\n    'collections/AssetCollection'\n], function ($, _, Backbone, AssetCollection) {\n    'use strict';\n    var AssetController = Backbone.Model.extend({\n        assetCollection: null,\n\n        getAssetList: function (successCallback, errorCallback, context, path, xChildrenNextStart) {\n            if (typeof xChildrenNextStart === 'undefined') {\n                // Always create a new AssetCollection\n                this.assetCollection = new AssetCollection([], { path: path });\n            }\n\n            graphite.serverAPI.loadAssetCollection(this.assetCollection, successCallback, errorCallback, context, path, xChildrenNextStart);\n\n            return this.assetCollection;\n        }\n    });\n\n    return new AssetController();\n});\n\n//# sourceURL=/lib/graphite-api/public/js/controllers/AssetListController.js"),eval('define(\'text!views/templates/assetListViewTemplate.html\',[],function () { return \'<div class="asset-list-title">\\n</div>\\n<div class="asset-list-container">\\n    <div class="grid" id="gridContainer">\\n        <div class="asset_list_view_error">\\n            <div class="asset_list_view_error_frame">\\n                <div class="asset_list_view_error_text"></div>\\n            </div>\\n        </div>\\n        <img class="centeredWaitImg" id="loadingSpinner" src="/images/files-item-spinner.gif" />\\n    </div>\\n</div>\';});\n\n//# sourceURL=/text!views/templates/assetListViewTemplate.html'),eval('define(\'text!views/templates/uploadFilesHereTemplate.html\',[],function () { return \'<div id="upload_files_here" class="upload_files_here">\\n    <div class="upload_files_here_frame">\\n        <div class="upload_files_here_guidance_text"><img src="images/upload_scrim.png" /><%=translate("Drag and Drop a PSD here")%></div>\\n    </div>\\n</div>\';});\n\n//# sourceURL=/text!views/templates/uploadFilesHereTemplate.html'),eval('define(\'text!views/templates/dragDropFileCaptureTemplate.html\',[],function () { return \'<div id="drag_drop_file_capture" class="drag_drop_file_capture">\\n    <div class="drag_drop_file_capture_frame">\\n        <div class="drag_drop_file_guidance_text"><img src="images/upload_scrim.png" /><%-translate("Upload PSD")%></div>\\n    </div>\\n</div>\';});\n\n//# sourceURL=/text!views/templates/dragDropFileCaptureTemplate.html'),eval('define(\'text!views/templates/uploadTileTemplate.html\',[],function () { return \'<article id="upload_tile" class="card-asset">\\n    <div>\\n        <div class="frame upload_tile_frame">\\n            <div class="upload_tile_inner_frame">\\n                <div id="upload-icon"/>\\n                <div class="upload_tile_guidance_text"><%=translate("Drag and Drop a PSD here")%></div>\\n            </div>\\n        </div>\\n    </div>\\n</article>\';});\n\n//# sourceURL=/text!views/templates/uploadTileTemplate.html'),eval("/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013-2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4, bitwise: true */\n/*global define: true, graphite: true, Modernizr: true, window: true, clearTimeout: true, setTimeout: true, FileReader: true*/\n\ndefine('views/landing/AssetListView',[\n    'jquery',\n    'underscore',\n    'backbone',\n    'plugin-dependencies',\n    'views/landing/AssetView',\n    'controllers/UploadController',\n    'controllers/AuthController',\n    'controllers/AssetListController',\n    'utils/TemplateUtil',\n    'text!views/templates/assetListViewTemplate.html',\n    'text!views/templates/uploadFilesHereTemplate.html',\n    'text!views/templates/dragDropFileCaptureTemplate.html',\n    'text!views/templates/uploadTileTemplate.html'\n], function ($, _, Backbone, deps, AssetView, UploadController,\n    AuthController, AssetListController, TemplateUtil, AssetListViewTemplate,\n    UploadFilesHereTemplate, DragDropFileCaptureTemplate, UploadTileTemplate) {\n\n    'use strict';\n    \n    function navigateTo(route) {\n        Backbone.history.navigate(route, true);\n    }\n\n    var AssetListView = Backbone.View.extend({\n\n        el: '#results',\n        collection: null,\n        loading: true,\n        childViews: [],\n        path: null,\n\n        tagName: 'section',\n\n        initialize: function (authModel, path) {\n            this.scErrorText = null;\n            // get Asset List\n            this.collection = this.getAssetList(\n                this.onAssetCollectionSuccess,\n                this.onAssetCollectionError,\n                this,\n                path\n            );\n            this.path = path;\n            \n            graphite.events.on('update-asset-list-view', function () {\n                this.showUploadGuidance();\n            }, this);\n            this.addHandlers();\n            this.render();\n        },\n\n\n        addHandlers: function () {\n            this.collection.on('add', this.renderNewAsset, this);\n            this.collection.on('reset', this.onReset, this);\n\n            var viewThis = this,\n                clickHandler = function (e) {\n                    viewThis.childViews.forEach(function (view) {\n                        view.stopListening();\n                    });\n                    viewThis.childViews.length = 0;\n                    viewThis.collection.fetch();\n                };\n\n            graphite.events.on('upload-init', this.uploadFiles, this);\n            $('.logo').on('click', clickHandler);\n\n            graphite.events.on('route-change', function (newRoute) {\n                // clean up\n                if (newRoute === 'handleAsset') {\n                    graphite.events.off('upload-init', viewThis.uploadFiles);\n                    $('.logo').off('click', clickHandler);\n\n                    viewThis.childViews.forEach(function (view) {\n                        view.stopListening();\n                    });\n                    viewThis.childViews.length = 0;\n                }\n            });\n            graphite.events.on('loadMoreAssets', this.loadMoreAssets, this);\n        },\n        \n        loadMoreAssets: function (incrementalFetchObj) {\n            this.collection = this.getAssetList(\n                this.onAssetCollectionSuccess,\n                this.onAssetCollectionError,\n                this,\n                incrementalFetchObj.path,\n                incrementalFetchObj.xChildrenNextStart\n            );\n        },\n\n        removeEventListeners: function () {\n            this.collection.off(null, null, this);\n            graphite.events.off(null, null, this);\n        },\n\n        //------------------------------------------------\n        // Handlers\n        //------------------------------------------------\n        onAssetCollectionSuccess: function () {\n            if (this.loading) {\n                this.onReset();\n            }\n        },\n\n        onAssetCollectionError: function (response) {\n            if (response.status === 401) {\n                graphite.events.trigger('reauthenticate');\n            }\n\n            if ((null === this.scErrorText || undefined === this.scErrorText || '' === this.scErrorText) && response.status >= 500) {\n                this.scErrorText = '<em>SharedCloud Services currently unavailable.  Please try again</em>';\n                this.scErrorText = this.scErrorText + '<br/><br/>(HTTP status code: \" + response.status + \")';\n            }\n            if (this.loading) {\n                this.onReset();\n            }\n        },\n\n\n        onReset: function () {\n            this.loading = false;\n            this.render();\n            UploadController.restoreUploads(this.collection);\n        },\n\n        reRender: function () {\n            this.loading = true;\n            this.collection = this.getAssetList(this.onAssetCollectionSuccess, this.onAssetCollectionError, this, this.path);\n        },\n        \n        getAssetList: function (onAssetCollectionSuccess, onAssetCollectionError, context, path, xChildrenNextStart) {\n            return AssetListController.getAssetList(\n                onAssetCollectionSuccess,\n                onAssetCollectionError,\n                context,\n                path,\n                xChildrenNextStart\n            );\n        },\n        \n        render: function () {\n            var tmpl = TemplateUtil.createTemplate(AssetListViewTemplate),\n                noFiles = TemplateUtil.createTemplate(UploadFilesHereTemplate),\n                dragDrop = TemplateUtil.createTemplate(DragDropFileCaptureTemplate),\n                uploadTile = TemplateUtil.createTemplate(UploadTileTemplate),\n                self = this;\n            \n            var doShowUploadTile = this.collection.models.length > 0;\n\n            if (!this.$el[0]) {\n                this.setElement('#results');\n            }\n            this.$el.html(tmpl);\n                    \n            var $assetListContainer = this.$el.find(\".asset-list-container\");\n            $assetListContainer.append(noFiles);\n            $assetListContainer.append(dragDrop);\n            \n            // prepend upload tile if there is at least one other tile.\n            if (doShowUploadTile) {\n                this.$el.find('#gridContainer').prepend(uploadTile);\n            }\n\n            // draw title\n            if (this.loading === false) {\n                $('#loadingSpinner').hide();\n\n                if (this.scErrorText) {\n                    this.$el.find('.asset_list_view_error_text').html(this.scErrorText);\n                    this.$el.find('.asset_list_view_error').show();\n                } else {\n                    this.showUploadGuidance();\n                }\n            }\n            \n            var CREATIVE_CLOUD_ASSETS = deps.translate(\"Creative Cloud Assets\"),\n                FILES = \"files\",\n                title = this.path ? FILES + \"/\" + this.path : FILES,\n                pathSegments = title.split(\"/\"),\n                link = \"\",\n                $assetListTitle = this.$el.find('.asset-list-title');\n            \n            _.each(pathSegments, function (segment) {\n                if (segment) {\n                    var $titleSegment = $(\"<span>\"),\n                        myLink;\n                    \n                    link = link + segment + \"/\";\n                    myLink = link;\n                    $titleSegment.addClass(\"path-segment\");\n                    $titleSegment.text(segment.replace(/^files/i, CREATIVE_CLOUD_ASSETS));\n                    $assetListTitle.append($titleSegment);\n                    $titleSegment.click(function (event) {\n                        navigateTo(myLink);\n                    });\n                }\n            });\n\n            if (this.collection.models.length === 1 && this.collection.models[0].id === undefined) {\n                return this;\n            }\n\n            var that = this;\n            \n            this.$el.find('input[name=\"uploadPSD\"]').on('change', function (e) {\n                e.preventDefault();\n\n                var files = this.files,\n                    filesToUpload = [],\n                    i,\n                    headersLoaded = 0,\n                    thisContext = this;\n\n                _.each(files, function (file) {\n                    var blob = file.slice(0, 4, 'UTF-8');\n                    var reader = new FileReader();\n                    var mimetype = file.type;\n                    var currFile = file;\n                    var ext = file.name.substr((~-file.name.lastIndexOf(\".\") >>> 0) + 2).toLowerCase();\n\n                    reader.addEventListener(\"loadend\", function () {\n                        if (this.result === \"8BPS\") { // http://www.adobe.com/devnet-apps/photoshop/fileformatashtml/#50577409_pgfId-1055726\n                            filesToUpload.push(currFile);\n                        }\n\n                        headersLoaded = headersLoaded + 1;\n                        if (headersLoaded === files.length) {\n                            if (filesToUpload.length > 0) {\n                                graphite.events.trigger(\"upload-init\", { files: filesToUpload });\n                            }\n                            if (filesToUpload.length !== files.length) {\n                                graphite.events.trigger('load-alert', deps.translate(\"You can only upload PSD files. \" + (files.length - filesToUpload.length) + \" of \" + files.length + \" files were not uploaded.\"));\n                                graphite.events.trigger('bad-file-type-dragdrop', {extension: ext, type: mimetype});\n                                window.graphite.events.trigger(\"bad-file-type-upload\", 'badFileUpload', (files.length - filesToUpload.length), files.length);\n                            }\n                            $(thisContext).val('');\n                        }\n                    });\n                    reader.readAsText(blob, 'UTF-8');\n                });\n                \n                return false;\n            });\n            \n            _.each(this.collection.models, function (assetModel) {\n                that.renderAsset(assetModel);\n            }, this);\n            \n\n            var dropzone = $('#dropzone');\n\n            if (Modernizr.draganddrop) {\n                var $dropTarget = $('#drag_drop_file_capture'),\n                    $uploadFiles = $('#upload_files_here');\n                $assetListContainer[0].ondragover = function (e) {\n                    if (!$.contains($assetListContainer[0], $dropTarget)) {\n                        $dropTarget.show();\n                        $('#upload_files_here').hide();\n                    }\n                    return false;\n                };\n\n                $dropTarget[0].ondragleave = function (e) {\n                    if ($.contains($assetListContainer[0], $dropTarget[0])) {\n                        $dropTarget.hide();\n                        that.showUploadGuidance();\n                    }\n                };\n                $dropTarget[0].ondragend = function (e) {\n                    if ($.contains($assetListContainer[0], $dropTarget[0])) {\n                        $dropTarget.hide();\n                        that.showUploadGuidance();\n                    }\n                };\n                $dropTarget[0].ondrop = function (e) {\n                    if ($.contains($assetListContainer[0], $dropTarget[0])) {\n                        $dropTarget.hide();\n                        that.showUploadGuidance();\n                    }\n                    e.preventDefault();\n\n                    var files = e.dataTransfer.files,\n                        filesToUpload = [],\n                        i,\n                        headersLoaded = 0;\n\n                    _.each(files, function (file) {\n                        var blob = file.slice(0, 4, 'UTF-8');\n                        var reader = new FileReader();\n                        var mimetype = file.type;\n                        var currFile = file;\n                        var ext = file.name.substr((~-file.name.lastIndexOf('.') >>> 0) + 2).toLowerCase();\n\n                        reader.addEventListener('loadend', function () {\n                            if (this.result === '8BPS') { // http://www.adobe.com/devnet-apps/photoshop/fileformatashtml/#50577409_pgfId-1055726\n\n                                filesToUpload.push(currFile);\n                            }\n\n                            headersLoaded = headersLoaded + 1;\n                            if (headersLoaded === files.length) {\n                                if (filesToUpload.length > 0) {\n                                    graphite.events.trigger('upload-init', { files: filesToUpload });\n                                }\n                                if (filesToUpload.length !== files.length) {\n                                    graphite.events.trigger('load-alert', deps.translate('You can only upload PSD files. ' + (files.length - filesToUpload.length) + ' of ' + files.length + ' files were not uploaded.'));\n                                    graphite.events.trigger('bad-file-type-dragdrop', {extension: ext, type: mimetype});\n                                }\n                            }\n                        });\n                        reader.readAsText(blob, 'UTF-8');\n                    });\n\n                    return false;\n                };\n            } else {\n                dropzone.hide();\n            }\n            return this;\n        },\n\n        renderAsset: function (item) {\n            var view = new AssetView({\n                model: item\n            });\n\n            $('#gridContainer').append(view.el);\n\n            this.childViews.push(view);\n            $('#upload_files_here').hide();\n        },\n\n        renderNewAsset: function (item) {\n            //metadata is empty on new uploads, so we need to skip mimetype checks on those\n            var mimeType = item ? item.attributes.type : null,\n                view;\n\n            if (!mimeType ||\n                    mimeType === \"application/x-photoshop\" ||\n                    mimeType === \"image/vnd.adobe.photoshop\" ||\n                    mimeType === \"image/x-photoshop\" ||\n                    mimeType === \"image/photoshop\" ||\n                    mimeType === \"application/psd\" ||\n                    mimeType === \"application/photoshop\" ||\n                    mimeType === \"application/vnd.adobe.directory+json\") {\n\n                view = new AssetView({\n                    model: item\n                });\n\n                $('#gridContainer').prepend(view.render().el);\n                this.childViews.push(view);\n            }\n        },\n\n        remove: function () {\n            this.removeEventListeners();\n            this.$el.empty();\n            this.stopListening();\n            return this;\n        },\n\n        showUploadGuidance: function () {\n            if ($('#gridContainer .card-asset').length === 0) {\n                $('#upload_files_here').show();\n            } else {\n                $('#upload_files_here').hide();\n                $('#upload_tile').show();\n            }\n        },\n\n        //------------------------------------------------\n        // Upload\n        //------------------------------------------------\n\n        uploadFiles: function (data) {\n            if (AuthController.isLoggedIn()) {\n                var files = data.files,\n                    i;\n                for (i = 0; i < files.length; i++) {\n                    var item = UploadController.upload(files[i]);\n\n                    this.collection.add(item);\n                    $('#upload_files_here').hide();\n                    // keep upload tile in front after adding new asset tile\n                    var $uploadTile = $('#gridContainer').find('#upload_tile');\n                    if ($uploadTile.length === 0) {\n                        // create new upload tile if the view started with an empty folder\n                        $uploadTile = TemplateUtil.createTemplate(UploadTileTemplate);\n                    } else {\n                        $uploadTile.detach();\n                    }\n                    $('#gridContainer').prepend($uploadTile);\n                }\n            } else {\n                // DPO - I can't work out when or how this method gets fired.\n                // There was an alert here before. This would never get shown, because it's not an alert.\n                deps.notifyUser(deps.translate('You are no longer logged in.  Please log in again'));\n                window.location.href = window.location;\n            }\n        }\n    });\n\n    return AssetListView;\n});\n\n//# sourceURL=/lib/graphite-api/public/js/views/landing/AssetListView.js"),eval('/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013-2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4 */\n/*global define, graphite, brackets, window*/\n\ndefine(\'override/views/landing/BracketsAssetListView\',[\n    "jquery",\n    "views/landing/AssetListView",\n    "ext/strings"\n], function ($, AssetListView, Strings) {\n\n    "use strict";\n\n    var StringUtils         = brackets.getModule("utils/StringUtils");\n\n    var BracketsAssetListView = AssetListView.extend({\n        \n        $placeholder: undefined,\n        \n        initialize: function (authModel, path) {\n            this.$placeholder = $("#e4b-main-panel .e4b-selectionbar-placeholder");\n            \n            AssetListView.prototype.initialize.call(this, authModel, path);\n        },\n\n        render: function () {\n            var retVal = AssetListView.prototype.render.call(this);\n\n            // HACK AssetListView doesn\'t call stopPropagation()\n            var dropTarget = $("#drag_drop_file_capture")[0],\n                _onDropHandler = dropTarget.ondrop;\n\n            dropTarget.ondrop = function (event) {\n                event.stopPropagation();\n                _onDropHandler.call(dropTarget, event);\n            };\n\n            // HACK Parfait doesn\'t distinguish metrics here where the view\n            // shows the user\'s files vs. showing the upload drop target\n            if (!this.loading) {\n                if (this.collection.models.length) {\n                    graphite.events.trigger("browse");\n                } else {\n                    graphite.events.trigger("browse-show-upload-files");\n                }\n            }\n            \n            var self = this;\n            if (this.$placeholder.find("#al-refresh-button").length === 0) {\n                var $refreshButton = $(\'<div id="al-refresh-button"/>\');\n                $refreshButton.click(function () {\n                    $refreshButton.addClass("spinning");\n                    self.reRender();\n                });\n                this.$placeholder.prepend($refreshButton);\n            }\n\n            return retVal;\n        },\n\n        onAssetCollectionError: function (response) {\n            this.scErrorText = StringUtils.format(\n                Strings.ERROR_ASSET_LIST_MESSAGE,\n                StringUtils.breakableUrl(this.collection.path)\n            );\n\n            AssetListView.prototype.onAssetCollectionError.call(this, response);\n        },\n        \n        onReset: function () {\n            this.$placeholder.find("#al-refresh-button").removeClass("spinning");\n            \n            AssetListView.prototype.onReset.call(this);\n        },\n        \n        remove: function () {\n            this.$placeholder.find("#al-refresh-button").remove();\n            \n            return AssetListView.prototype.remove.call(this);\n        }\n    });\n\n    return BracketsAssetListView;\n});\n\n//# sourceURL=/./views/landing/BracketsAssetListView.js'),eval('/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4, maxerr: 50, regexp: true  */\n/*global define, window, graphite */\n\ndefine(\'cceco/CollabServiceAPI\',[\n    "jquery",\n    "config/environment",\n    "ccweb.files.extract/Constants"\n], function ($, environment, Constants) {\n    "use strict";\n\n    var ASSETS_HOST = environment.ASSETS_HOST.replace(/\\./g, "\\\\."), // escape dot\n        RE_CREATIVE_LINK = new RegExp("^https://" + ASSETS_HOST + "/link/(\\\\S+)"),\n        RE_RESOURCE = /^https:\\/\\/[^.]+.adobesc.com\\/api\\/v1\\/assets\\/(.+)$/;\n    \n    var CollabServiceAPI = {\n\n        ERROR_INVALID_SHARE_LINK: 1,\n        ERROR_LOAD: 2,\n\n        /**\n         * TODO\n         * https://wiki.corp.adobe.com/display/parfait/Imaging+Service+Extension#ImagingServiceExtension-ShareLinkAssetHandling\n         */\n        urlToShareLinkGUID: function (url, successCallback, errorCallback) {\n            var aboutBlankLoaded = false;\n\n            // Validate share link host\n            // This is CRITICAL so that we only load trusted adobe.ly URLs\n            // so that other, untrusted URLs aren\'t loaded in an iframe.\n            if (!url.match(Constants.RE_SHORT_URL)) {\n                // Log metric when creative URL input is an untrusted URL\n                graphite.events.trigger("creative-url-failure", {\n                    reason: "ERROR_INVALID_SHARE_LINK"\n                });\n\n                errorCallback(CollabServiceAPI.ERROR_INVALID_SHARE_LINK);\n                return;\n            }\n\n            // HACK\n            // XMLHttpRequest silently follows redirects from the short URL\n            // and there\'s no way to access the final destination. Use an\n            // iframe here as a workaround.\n            var iframe = window.document.createElement("iframe");\n\n            function always() {\n                window.document.body.removeChild(iframe);\n            }\n\n            function reject() {\n                always();\n\n                // Log metric when creative URL fails to load\n                graphite.events.trigger("creative-url-failure", {\n                    reason: "ERROR_LOAD"\n                });\n\n                errorCallback(CollabServiceAPI.ERROR_LOAD);\n            }\n\n            // Hide the iframe\n            iframe.style.display = "none";\n\n            // Setup load and error event handlers\n            iframe.onload = function () {\n                // Parse redirect URL\n                var href = iframe.contentWindow.location.href,\n                    location = href === "about:blank" ? null : href,\n                    exec = location && RE_CREATIVE_LINK.exec(location);\n\n                if (exec) {\n                    // Resolved to expected URL https://assets-stage.adobecc.com/link/GUID\n                    always();\n\n                    // Log metric when creative URL resolves successfully\n                    graphite.events.trigger("creative-url-success");\n\n                    successCallback(exec[1]);\n                } else if (href && !location) {\n                    // Ignore initial about:blank and wait for next load event\n                    aboutBlankLoaded = true;\n                } else {\n                    // Unexpected URL\n                    reject();\n                }\n            };\n            \n            iframe.onerror = reject;\n\n            // Load the short URL\n            iframe.src = url;\n\n            // Expected error on redirect:\n            // Refused to display \'<short url>\' in a frame because it set \'X-Frame-Options\' to \'DENY\'. \n            try {\n                window.document.body.appendChild(iframe);\n            } catch (err) {\n                // do nothing\n            }\n        },\n        \n        /**\n         * TODO\n         * https://git.corp.adobe.com/Stormcloud/docs/blob/master/features/public_plugins/acl.md\n         */\n        links: function (shareLinkId, successCallback, errorCallback) {\n            var url = environment.url("/links/" + shareLinkId, environment.COLLAB_SERVICE_HOST);\n\n            $.ajax(url).then(function (data, textStatus, jqXHR) {\n                var exec = RE_RESOURCE.exec(data.resource);\n                successCallback(data.id);\n            }, function (data, textStatus, errorThrown) {\n                errorCallback(CollabServiceAPI.ERROR_LOAD);\n            });\n        }\n    };\n\n    return CollabServiceAPI;\n});\n//# sourceURL=/lib/graphite-api/public/js/cceco/CollabServiceAPI.js'),
eval('/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4, regexp: true */\n/*global define: true, graphite: true, brackets, Image*/\n\ndefine(\'override/routes/BracketsAppRouter\',[\n    \'jquery\',\n    \'underscore\',\n    \'backbone\',\n    \'models/AuthModel\',\n    \'views/landing/AssetListView\',\n    \'ccweb.files.extract/views/detail/PSDDetailsView\',\n    \'controllers/AuthController\',\n    \'ext/Constants\',\n    \'ext/CacheManager\',\n    \'ext/models/BracketsPreferencesModel\',\n    \'ccweb.files.extract/main\',\n    \'cceco/CollabServiceAPI\'\n], function ($, _, Backbone, AuthModel, AssetListView, BracketsPSDDetailsView,\n    AuthController, PSDLensConstants, CacheManager, BracketsPreferencesModel,\n    ExtractPlugin, CollabServiceAPI) {\n    "use strict";\n\n    var FileSystem        = brackets.getModule("filesystem/FileSystem");\n\n    var prefs = BracketsPreferencesModel.get("preferenceSystem");\n    \n    function _getStaticContentFolder(basepath) {\n        var deferred    = new $.Deferred(),\n            lang        = brackets.getLocale(),\n            shortLang   = lang.split("-")[0],\n            locpath     = basepath,\n            folder;\n        \n        if (shortLang !== "en") {\n            locpath += \'/\' + shortLang + \'/\';\n            folder = FileSystem.getDirectoryForPath(locpath);\n            folder.exists(function (err, exists) {\n                if (!err && exists) {\n                    // localized content does exist, so return the new path\n                    deferred.resolve(locpath);\n                } else {\n                    // localized content does not exist, so return the original path\n                    deferred.resolve(basepath);\n                }\n            });\n            \n            return deferred.promise();\n        }\n        \n        // English content lives at the root path always\n        return deferred.resolve(basepath);\n    }\n        \n    var ApplicationRouter = Backbone.Router.extend({\n        authModel : null,\n        routes: {\n            "asset/psd/:id/*route": PSDLensConstants.Routes.ASSET,\n            "authless/:url": PSDLensConstants.Routes.AUTHLESS_ASSET,\n            "first_launch": PSDLensConstants.Routes.FIRST_LAUNCH,\n            "hide": PSDLensConstants.Routes.HIDE,\n            "files/*route": PSDLensConstants.Routes.FOLDER\n        },\n\n        initialize: function () {\n            this.authModel = new AuthModel();\n            AuthController.setAuthModel(this.authModel);\n\n            // Listen for re-auth requests\n            graphite.events.on("reauthenticate", this.handleAuthorize, this);\n            graphite.events.on("load-login-page", this.handleLoadLoginPage, this);\n            \n            // Listen for first route-change\n            graphite.events.once("route-change", function () {\n                graphite.events.trigger("launch");\n            });\n\n            // Convert "route" events on the router to "route-change" events\n            this.on("route", function (page) {\n                graphite.events.trigger(\'route-change\', page);\n\n                // Set persistent param only for routes that render a PSD\n                var authless,\n                    psdCountProperty;\n\n                if (page === PSDLensConstants.Routes.AUTHLESS_ASSET) {\n                    authless = true;\n                    psdCountProperty = "psdViews.creativeUrlCount";\n                } else if (page === PSDLensConstants.Routes.ASSET) {\n                    authless = false;\n                    psdCountProperty = "psdViews.userCount";\n                } else if (page === PSDLensConstants.Routes.FIRST_LAUNCH) {\n                    psdCountProperty = "psdViews.gettingStartedCount";\n                }\n\n                graphite.metricsProxyModel.setDefaultParam("authless", authless);\n\n                // Update PSD view count\n                if (psdCountProperty) {\n                    var defaultParams = prefs.get(BracketsPreferencesModel.METRICS_DEFAULT_PARAMS),\n                        count = defaultParams[psdCountProperty] + 1;\n\n                    defaultParams[psdCountProperty] = count;\n\n                    // Save prefs\n                    prefs.set(BracketsPreferencesModel.METRICS_DEFAULT_PARAMS, defaultParams);\n                }\n            });\n        },\n\n        handleAuthorize: function () {\n            AuthController.reauthenticate();\n        },\n\n        handleLoadLoginPage: function () {\n            this.authModel.configure();\n        },\n\n        hidePanel: function () {\n            this.destroyViews(["extractPlugin", "assetListView"]);\n        },\n        \n        firstLaunch: function () {\n            var config = {\n                segment     : \'psd-lens-first\',  // We use this to segment our metrics. Each one should be unique\n                directory   : PSDLensConstants.STATIC_CONTENT_LOCATION + \'marketing/marketing_psd\',\n                guid        : \'marketing-psd\'\n            };\n            \n            var _show = function (path) {\n                this.destroyViews(["assetListView"]);\n                config.directory = path;\n                this.showExtractPlugin(path, null, config, "");\n            }.bind(this);\n\n            _getStaticContentFolder(config.directory).then(_show);\n        },\n\n        showExtractPlugin: function (assetId, layerCompId, localContent, path) {\n            this.authModel = AuthController.getAuthModel();\n            if (this.extractPlugin) {\n                this.extractPlugin.hide();\n            }\n\n            var self = this,\n                deferred = new $.Deferred(),\n                promise = deferred.promise();\n\n            if (localContent) {\n                // No metadata for first launch content\n                deferred.resolve({});\n            } else if (assetId) {\n                // Get metadata from storage service\n                graphite.serverAPI.loadAssetMetadata(path).then(function (data) {\n                    CacheManager.validateCacheForPath(data.md5, path);\n                    deferred.resolve(data);\n                }, deferred.reject);\n            } else {\n                // If assetID is not passed we are in an authless environment\n                // Use CollabServiceAPI to validate URL\n                CollabServiceAPI.urlToShareLinkGUID(path, function (shareLinkGuid) {\n                    // Create a model with required properties\n                    var renditionData = {\n                        id: shareLinkGuid,\n                        shareLinkGuid: shareLinkGuid,\n                        authless: true,\n                        path: path\n                    };\n\n                    var renditionPSDModel = new Backbone.Model(renditionData);\n\n                    // Use ImageServiceAPI to get bounds\n                    graphite.serverAPI.getRendition(renditionPSDModel, null, function (err, dataURI) {\n                        if (err) {\n                            graphite.events.trigger("image-service-error", encodeURI(path), false);\n                            deferred.reject(err);\n                        } else if (dataURI) {\n                            var img = new Image();\n\n                            img.src = dataURI;\n                            renditionData.width = img.width;\n                            renditionData.height = img.height;\n                            deferred.resolve(renditionData);\n                        }\n\n                        \n                    });\n                }, function () {\n                    deferred.reject();\n                });\n            }\n\n            promise.done(function (metadata) {\n                // create a shim that looks like ccweb\'s asset_model.js with an id attribute.\n                var modelData = {\n                    id: "/" + assetId,\n                    assetId: assetId,\n                    localContent: localContent,\n                    layerCompId: layerCompId,\n                    path: path,\n                    name: path.replace(/^.*(\\/)/, \'\'),\n                    size: metadata.size,\n                    width: metadata.width,\n                    height: metadata.height,\n                    shareLinkGuid: metadata.shareLinkGuid\n                };\n                \n                modelData.assetId = modelData.assetId || metadata.shareLinkGuid;\n                modelData.id = "/" + modelData.assetId;\n                \n                var asset_model = new Backbone.Model(_.extend(metadata, modelData));\n                self.extractPlugin = new ExtractPlugin(asset_model);\n                var $results = $(\'#results\');\n                $results.html(self.extractPlugin.$el);\n                self.extractPlugin.show();\n                self.extractPlugin.trigger(\'added-to-dom\');\n            });\n        },\n\n        handleAsset: function (assetId, path) {\n            var self = this;\n\n            // Validate access token before viewing a file\n            AuthController.getAuthModel().getAccessToken().then(function () {\n                self.destroyViews(["assetListView"]);\n                self.showExtractPlugin(assetId, null, false, path);\n            });\n        },\n        \n        handleAuthlessAsset: function (url) {\n            this.destroyViews(["assetListView"]);\n            this.showExtractPlugin(null, null, false, url);\n        },\n\n        handleFolder: function (path) {\n            var self = this;\n\n            // Validate access token before viewing a folder\n            AuthController.getAuthModel().getAccessToken().then(function () {\n                self.destroyViews(["extractPlugin", "assetListView"]);\n                $("body").removeClass("not-logged-in");\n                self.assetListView = new AssetListView(AuthController.getAuthModel(), path);\n            });\n        },\n\n        destroyViews: function (views) {\n            var self = this;\n            _.each(views, function (view) {\n                if (self.hasOwnProperty(view)) {\n                    if (self[view].remove) {\n                        self[view].remove();\n                    } else if (self[view].hide) {\n                        // in case the view is extractPlugin\n                        // we have to call hide instead of remove.\n                        // TODO: merge change upstream to add function named remove\n                        // that calls hide.\n                        self[view].hide();\n                    }\n                    delete self[view];\n                }\n            });\n        }\n\n    });\n\n    return ApplicationRouter;\n});\n\n//# sourceURL=/./routes/BracketsAppRouter.js'),eval('/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4*/\n/*global define: true*/\n\ndefine(\'ext/controllers/BaseHintProvider\',[\n    "backbone",\n    "ccweb.files.extract/controllers/SelectionController",\n    "Constants"\n], function (Backbone, SelectionController, Constants) {\n    "use strict";\n\n    function _sortString(a, b) {\n        if ((a < b) || (a && !b)) {\n            return -1;\n        } else if ((a > b) || (!a && b)) {\n            return 1;\n        }\n\n        return 0;\n    }\n    \n    var BaseHintProvider = Backbone.Model.extend({\n        \n        hasHints: function (editor, implicitChar) {\n            return (SelectionController.getSelectedLayers().length > 0);\n        },\n\n        hintModelCompare: function (a, b) {\n            var aIsMerge = a.isMergeLayers(),\n                bIsMerge = b.isMergeLayers();\n\n            if (aIsMerge && !bIsMerge) {\n                return -1;\n            } else if (!aIsMerge && bIsMerge) {\n                return 1;\n            }\n\n            var aDisplayName = a.get("displayName"),\n                bDisplayName = b.get("displayName"),\n                displayNameCompare = _sortString(aDisplayName, bDisplayName);\n\n            if (displayNameCompare !== 0) {\n                return displayNameCompare;\n            }\n\n            var aIsText = a.get("type") === Constants.Hint.TEXT,\n                bIsText = b.get("type") === Constants.Hint.TEXT;\n\n            if (aIsText && !bIsText) {\n                return -1;\n            } else if (!aIsText && bIsText) {\n                return 1;\n            }\n            \n            // TODO better sorting to address:\n            // - vendor prefixes\n            // - units\n            var aProp = a.get("property"),\n                bProp = b.get("property"),\n                aVal = a.get("value"),\n                bVal = b.get("value"),\n                propCompare = _sortString(aProp, bProp);\n\n            if (propCompare === 0) {\n                return _sortString(aVal, bVal);\n            }\n\n            return propCompare;\n        }\n        \n    });\n    \n    return BaseHintProvider;\n});\n//# sourceURL=/./controllers/BaseHintProvider.js'),eval('/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4 */\n/*global define: true, graphite: true, brackets: true, PathUtils: true*/\n\ndefine(\'ext/utils/HintUtil\',[\n    "ccweb.files.extract/Constants"\n], function (ParfaitConstants) {\n    "use strict";\n\n    var HintUtil = {\n    \n        _getVisibleLayers: function (layers, anyVisibleLayer) {\n            var visibleLayers = [],\n                currentLayer,\n                isVisible,\n                isGroup;\n\n            layers = Array.isArray(layers) ? layers : [layers];\n            \n            // Traverse layer selection for visible, non-group layers\n            while (layers.length > 0) {\n                currentLayer = layers.shift();\n                isVisible = currentLayer.get("visible");\n                isGroup = currentLayer.attributes.properties.layerType === ParfaitConstants.Type.LAYER_GROUP;\n\n                if (isVisible) {\n                    if (isGroup) {\n                        // For layer groups, add child layers to queue\n                        Array.prototype.push.apply(layers, currentLayer.attributes.layerCollection.models);\n                    } else if (anyVisibleLayer) {\n                        return true;\n                    } else {\n                        // Add non-group layers only\n                        visibleLayers.push(currentLayer);\n                    }\n                }\n            }\n\n            if (anyVisibleLayer) {\n                return false;\n            }\n            \n            return visibleLayers;\n        },\n\n        hasVisibleLayers: function (layers) {\n            return this._getVisibleLayers(layers, true);\n        },\n    \n        getVisibleLayers: function (layers) {\n            return this._getVisibleLayers(layers);\n        }\n\n    };\n\n    return HintUtil;\n});\n\n//# sourceURL=/./utils/HintUtil.js'),eval('/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4 */\n/*global define, brackets, graphite*/\n\ndefine(\'ext/models/CSSHintModel\',[\n    "jquery",\n    "backbone",\n    "ext/Constants",\n    "serverAPI",\n    "ccweb.files.extract/Constants",\n    "ccweb.files.extract/controllers/SelectionController",\n    "ext/utils/HintUtil",\n    "ext/strings"\n], function ($, Backbone, Constants, serverAPI, ParfaitConstants, SelectionController, HintUtil, Strings) {\n    "use strict";\n\n    var CSSUtils        = brackets.getModule("language/CSSUtils"),\n        EditorManager   = brackets.getModule("editor/EditorManager"),\n        HTMLUtils       = brackets.getModule("language/HTMLUtils");\n\n    var FILE_EXT_TO_FORMAT_MAP = {\n        "png": "png32",\n        "png8": "png8",\n        "png32": "png32",\n        "svg": "svg",\n        "jpg": "jpeg",\n        "jpeg": "jpeg"\n    };\n\n    var FILE_EXT_TO_CANVAS_MAP = {\n        "png": "png",\n        "jpg": "jpeg",\n        "jpeg": "jpeg",\n        "webp": "webp"\n    };\n    \n    var CSSHintModel = Backbone.Model.extend({\n        \n        defaults: {\n            providerType: "css",\n            layerModel: null,\n            displayName: null,\n            displayDescription: null,\n            property: null,\n            value: "",\n            displayValue: "",\n            type: Constants.Hint.OTHER\n        },\n\n        initialize: function () {\n            var property = this.get("property"),\n                displayName = this.get("displayName"),\n                displayDescription = this.get("displayDescription"),\n                isMergeLayers = this.isMergeLayers();\n\n            // property is not set for bulk hints\n            if (!property && displayName && displayDescription) {\n                this.set("property", displayName + " " + displayDescription);\n            }\n\n            this.set("isMergeLayers", isMergeLayers);\n        },\n        \n        isBulkHint: function () {\n            var value = this.get("value");\n            return Array.isArray(value) && value.length > 1;\n        },\n\n        toHint: function (context) {\n            var property = this.get("property"),\n                value = this.get("value"),\n                hint;\n\n            if (Array.isArray(value)) {\n                var hints = [];\n\n                value.forEach(function (cssData) {\n                    hints.push(cssData.property + ": " + cssData.value + ";");\n                });\n\n                hint = hints.join("\\n");\n            } else if (context === CSSUtils.PROP_NAME) {\n                hint =  property + ": " + value + ";";\n            } else if (context === HTMLUtils.ATTR_NAME) {\n                hint =  property + "=\\"" + value + "\\"";\n            } else {\n                hint = value;\n            }\n\n            return hint;\n        },\n\n        getLayers: function () {\n            var layerModel = this.get("layerModel");\n            \n            return this.isMergeLayers() ? layerModel : [layerModel];\n        },\n\n        isMergeLayers: function () {\n            return Array.isArray(this.get("layerModel"));\n        },\n\n        isExportableAsSVG: function () {\n            var layers = this.getLayers();\n            \n            return layers.every(function (layerModel) {\n                if ((layerModel.get("type") !== "contentLayer") && (layerModel.get("type") !== "textLayer")) {\n                    return false;\n                }\n\n                return true;\n            });\n        },\n        \n        toDataURL: function (requestedType) {\n            var self = this,\n                type = requestedType.toLowerCase(),\n                isMergeLayers = this.isMergeLayers(),\n                layers = this.getLayers(),\n                layerType = isMergeLayers ? ParfaitConstants.Type.LAYER_GROUP : layers[0].attributes.properties.layerType,\n                isGroup = layerType === ParfaitConstants.Type.LAYER_GROUP,\n                format = FILE_EXT_TO_FORMAT_MAP[type],\n                canvasFormat = FILE_EXT_TO_CANVAS_MAP[type],\n                psdModel = SelectionController.getPSDModel(),\n                isLocalContent = !!psdModel.get("localContent"),\n                deferred = new $.Deferred(),\n                visibleLayers = isGroup ? HintUtil.getVisibleLayers(layers) : layers,\n                numLayers = visibleLayers.length,\n                editor = EditorManager.getActiveEditor();\n\n            function toCanvasFallback() {\n                deferred.resolve(self.get("canvas").toDataURL("image/" + canvasFormat));\n            }\n            \n            if (!numLayers) {\n                // If no visible layers are selected, fallback to all layers\n                deferred.reject(Strings.NO_VISIBLE_LAYERS_ERROR);\n            } else if (type === "svg" && (isLocalContent || !this.isExportableAsSVG())) {\n                var svgError = isLocalContent ? Strings.STATIC_CONTENT_SVG_NOT_AVAILABLE : Strings.SVG_NOT_AVAILABLE;\n\n                // Error handling if SVG can\'t be derived\n                deferred.reject(svgError);\n            } else if (format && !isLocalContent) {\n                graphite.events.trigger("extract-asset-downloading", {\n                    format: format,\n                    numLayers: numLayers\n                });\n\n                // Attempt service call to extract asset\n                serverAPI.getDerivedAsset(psdModel, visibleLayers, format)\n                    .done(function (result) {\n                        graphite.events.trigger("extract-asset-downloaded", {\n                            format: format,\n                            numLayers: numLayers\n                        });\n\n                        deferred.resolve(result);\n                    })\n                    .fail(function (err) {\n                        var errString = isLocalContent ? Strings.STATIC_CONTENT_SERVICE_ERROR : Strings.SERVICE_ERROR;\n\n                        graphite.events.trigger("extract-asset-error", {\n                            format: format,\n                            numLayers: numLayers,\n                            err: err,\n                            errString: errString\n                        });\n\n                        // Service call failed\n                        if (canvasFormat && !isGroup) {\n                            graphite.events.trigger("extract-asset-canvas-fallback", {\n                                format: format,\n                                numLayers: numLayers\n                            });\n\n                            // fallback to canvas for single-layers (non-groups)\n                            toCanvasFallback();\n                        } else {\n                            // reject with service call error\n                            deferred.reject(errString, err);\n                        }\n                    });\n            } else if (!isGroup && canvasFormat && isLocalContent) {\n                graphite.events.trigger("extract-asset-canvas", {\n                    format: format,\n                    numLayers: numLayers\n                });\n\n                // Enable image extraction via canvas for local content, i.e.\n                // 1st launch help content.\n                toCanvasFallback();\n            } else {\n                var errString;\n                \n                if (isGroup && isLocalContent) {\n                    // Show useful error in case not logged in users try to extract\n                    // images from group layers while using 1st launch help content.\n                    errString = Strings.STATIC_CONTENT_SERVICE_ERROR;\n                } else {\n                    // Unsupported file format\n                    errString = Strings.FILE_FORMAT_ERROR;\n                }\n                \n                graphite.events.trigger("extracted-asset-error", {\n                    format: type,\n                    numLayers: numLayers,\n                    errString: errString\n                });\n\n                deferred.reject(errString, type);\n            }\n            \n            return deferred.promise();\n        }\n        \n    });\n    \n    return CSSHintModel;\n});\n//# sourceURL=/./models/CSSHintModel.js'),eval('define(\'text!ext/controllers/font-shorthand.txt\',[],function () { return \'<%= properties["font-style"] && properties["font-style"].value %>\\n<%= properties["font-weight"] && properties["font-weight"].value %>\\n<%= properties["font-size"] && properties["font-size"].value %>\\n<% if (properties["line-height"]) { %>/ <%= properties["line-height"].value %><% } %>\\n<%= properties["font-family"] && properties["font-family"].value %>\';});\n\n//# sourceURL=/text!ext/controllers/font-shorthand.txt'),eval('/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4, sub: true*/\n/*global define: true*/\n\ndefine(\'ext/controllers/CSSHintController\',[\n    "underscore",\n    "backbone",\n    "ccweb.files.extract/Constants",\n    "ccweb.files.extract/utils/CSSUtil",\n    "ccweb.files.extract/models/LayerModel",\n    "ccweb.files.extract/controllers/SelectionController",\n    "ccweb.files.extract/utils/UTF8",\n    "ccweb.files.extract/models/UserSettingsModel",\n    "ccweb.files.extract/controllers/DetailsController",\n    "ccweb.files.extract/utils/MeasurementUtil",\n    "ext/Constants",\n    "ext/models/CSSHintModel",\n    "ext/utils/HintUtil",\n    "text!ext/controllers/font-shorthand.txt",\n    "ext/strings"\n], function (_, Backbone, ParfaitConstants, CSSUtil, LayerModel,\n    SelectionController, UTF8, UserSettingsModel, DetailsController,\n    MeasurementUtil, Constants, CSSHintModel, HintUtil,\n    FontShorthandTemplate, Strings) {\n    "use strict";\n\n    var fontShorthandTemplate = _.template(FontShorthandTemplate);\n    \n    // Helper function for _.uniq\n    function _toCSSString(data) {\n        var valueString = data.value;\n\n        // Handle bulk hints (a flat array)\n        if (Array.isArray(data.value)) {\n            var values = data.value.map(function (val) {\n                return val.value;\n            });\n\n            valueString = values.join(",");\n        }\n\n        return data.property + ": " + valueString;\n    }\n    \n    function _toValue(data) {\n        return data.value;\n    }\n\n    function _toMeasurementValue(num) {\n        return num.toString(10);\n    }\n    \n    function _getLayers(args) {\n        var layers;\n\n        if (args instanceof LayerModel.constructor) {\n            layers = [args];\n        } else if (Array.isArray(args)) {\n            layers = args;\n        } else {\n            layers = SelectionController.getSelectedLayers();\n        }\n        \n        // Filter top level layers for visibility\n        return layers.filter(function (layer) {\n            return HintUtil.hasVisibleLayers(layer);\n        });\n    }\n    \n    function _toURLValue(path) {\n        return "url(" + path + ")";\n    }\n\n    function _mergedLayerSize(layers) {\n        var overallBounds = {\n                top: Number.MAX_VALUE,\n                left: Number.MAX_VALUE,\n                bottom: Number.MIN_VALUE,\n                right: Number.MIN_VALUE\n            },\n            layerBounds;\n            \n        if (Array.isArray(layers)) {\n            layers.forEach(function (layerModel) {\n                // Use rawBounds for document relative position, use bounds for LAYER_GROUP\n                layerBounds = layerModel.get("rawBounds") || layerModel.get("bounds");\n                overallBounds.top = Math.min(overallBounds.top, layerBounds.top);\n                overallBounds.left = Math.min(overallBounds.left, layerBounds.left);\n                overallBounds.bottom = Math.max(overallBounds.bottom, layerBounds.bottom);\n                overallBounds.right = Math.max(overallBounds.right, layerBounds.right);\n            });\n        } else {\n            overallBounds = layers.get("bounds");\n        }\n\n        return {\n            width: overallBounds.right - overallBounds.left,\n            height: overallBounds.bottom - overallBounds.top\n        };\n    }\n    \n    var CSSHintController = Backbone.Model.extend({\n\n        relPath: "images/",\n        \n        getImgSrcValues: function (args) {\n            var self = this,\n                layers = _getLayers(args),\n                hints = [],\n                options = { property: "src" },\n                merged = this.getMergeLayers(layers, options);\n                \n            if (merged) {\n                hints.push(merged);\n            }\n\n            layers.forEach(function (layerModel) {\n                // Return each layer rendering as an image hint\n                hints.push(new CSSHintModel(self._layerToImageData(layerModel, options)));\n            });\n\n            return hints;\n        },\n        \n        getImgSrcNameAndValues: function (args) {\n            return this.getImgSrcValues(args);\n        },\n        \n        getTextValues: function (args, isAttrValue) {\n            var self = this,\n                layers = _getLayers(args),\n                hints = [],\n                text;\n            \n            _.each(layers, function (layer) {\n                text = layer.get("properties").get("rawText");\n                \n                if (text) {\n                    text = UTF8.decodeCharacters(text).trim();\n\n                    // For attribute values, replace line breaks with space\n                    if (isAttrValue) {\n                        text = text.replace(/[ ]?[\\r\\n][ ]?/g, " ");\n                    }\n\n                    hints.push(text);\n                }\n            });\n            \n            // Remove duplicate values\n            hints = _.uniq(hints);\n            \n            // Create models\n            hints = _.map(hints, function (text) {\n                return new CSSHintModel({\n                    type: Constants.Hint.TEXT,\n                    value: text\n                });\n            });\n\n            return hints;\n        },\n        \n        getStyles: function (args) {\n            var self = this,\n                layers = _getLayers(args),\n                hints = [],\n                mergedBackground = this.getMergeLayers(layers, { property: "background", toValue: _toURLValue }),\n                mergedSize = _mergedLayerSize(layers);\n            \n            _.each(layers, function (layer) {\n                hints = hints.concat(self._getStylesForLayer(layer));\n            });\n\n            // Add merged sizes first to include in unique check\n            if (mergedBackground) {\n                hints.push({\n                    type: Constants.Hint.SIZE,\n                    property: "width",\n                    value: mergedSize.width + "px",\n                    layerModel: layers\n                });\n\n                hints.push({\n                    type: Constants.Hint.SIZE,\n                    property: "height",\n                    value: mergedSize.height + "px",\n                    layerModel: layers\n                });\n            }\n            \n            // Remove duplicate styles\n            hints = _.uniq(hints, function (hint) {\n                return _toCSSString(hint) + (Array.isArray(hint.layerModel) ? "merged" : "");\n            });\n            \n            // Create models\n            hints = _.map(hints, function (style) {\n                return new CSSHintModel(style);\n            });\n\n            // Add merged layer hint model last\n            if (mergedBackground) {\n                hints.push(mergedBackground);\n            }\n\n            return hints;\n        },\n\n        getMergeLayers: function (args, options) {\n            var layers = _getLayers(args);\n\n            // Insert a Merge Layers option\n            if (layers.length > 1) {\n                return new CSSHintModel(this._layerToImageData(layers, options));\n            }\n\n            return null;\n        },\n        \n        getImageValues: function (args) {\n            var self = this,\n                layers = _getLayers(args),\n                hints = [],\n                gradients = [],\n                merged = this.getMergeLayers(layers, { toValue: _toURLValue }),\n                showVendorPrefixes = true; // include vendor prefixed hints;\n\n            // Insert a Merge Layers option\n            if (merged) {\n                hints.push(merged);\n            }\n\n            layers.forEach(function (layerModel) {\n                // Return each layer rendering as an image hint\n                hints.push(new CSSHintModel(self._layerToImageData(layerModel, { toValue: _toURLValue })));\n\n                // Return each background value (with or without prefix) as it\'s own separate value hint\n                _.each(layerModel.get("properties").getGradients(), function (gradientModel) {\n                    _.each(gradientModel.getCSS(showVendorPrefixes), function (style) {\n                        gradients.push({\n                            type: Constants.Hint.GRADIENT,\n                            value: style.background,\n                            layerModel: layerModel\n                        });\n                    });\n                });\n            });\n            \n            // Remove duplicate gradients\n            gradients = _.uniq(gradients, _toValue);\n            \n            // Create models\n            _.each(gradients, function (gradient) {\n                hints.push(new CSSHintModel(gradient));\n            });\n\n            return hints;\n        },\n        \n        getColorValues: function (args) {\n            var layers = _getLayers(args),\n                colors = [],\n                colorString,\n                properties;\n\n            layers.forEach(function (layerModel) {\n                properties = layerModel.get("properties");\n                _.each(properties.getColors(), function (color) {\n                    colorString = CSSUtil.getDefaultColorString(\n                        color.get("red"),\n                        color.get("green"),\n                        color.get("blue"),\n                        color.get("alpha")\n                    );\n\n                    colors.push({\n                        type: Constants.Hint.COLOR,\n                        property: (properties.layerType === ParfaitConstants.Type.LAYER_CONTENT) ? "background-color" : "color",\n                        value: colorString,\n                        layerModel: layerModel\n                    });\n                });\n            });\n            \n            // Remove duplicate colors\n            colors = _.uniq(colors, _toValue);\n            \n            // Create models\n            colors = _.map(colors, function (color) {\n                return new CSSHintModel(color);\n            });\n\n            return colors;\n        },\n        \n        getMeasurementValues: function (args, options) {\n            options = options || {};\n\n            var layers = _getLayers(args),\n                size,\n                allSizes,\n                hints = [],\n                measurmentType = options.measurmentType,\n                width = !measurmentType  || (measurmentType === "width"),\n                height = !measurmentType  || (measurmentType === "height"),\n                mergedSize = layers.length > 1 ? _mergedLayerSize(layers) : null;\n\n            allSizes = layers.map(function (layerModel) {\n                var bounds = layerModel.get("bounds");\n\n                return {\n                    width: bounds.right - bounds.left,\n                    height: bounds.bottom - bounds.top,\n                    layerModel: layerModel\n                };\n            });\n\n            // Include merged layer size\n            if (mergedSize) {\n                mergedSize.layerModel = layers;\n                allSizes.push(mergedSize);\n            }\n\n            var uniqHeights = {},\n                uniqWidths = {};\n\n            allSizes.forEach(function (size) {\n                var value;\n                if (height && !uniqHeights[size.height]) {\n                    hints.push({\n                        property: "height",\n                        type: Constants.Hint.SIZE,\n                        value: _toMeasurementValue(size.height),\n                        layerModel: size.layerModel\n                    });\n\n                    uniqHeights[size.height] = true;\n                }\n                if (width && !uniqWidths[size.width]) {\n                    hints.push({\n                        property: "width",\n                        type: Constants.Hint.SIZE,\n                        value: _toMeasurementValue(size.width),\n                        layerModel: size.layerModel\n                    });\n\n                    uniqHeights[size.width] = true;\n                }\n            });\n            \n            // Create models\n            hints = _.map(hints, function (measurement) {\n                return new CSSHintModel(measurement);\n            });\n\n            return hints;\n        },\n    \n        _layerToImageData: function (layerModel, options) {\n            var isArray = Array.isArray(layerModel),\n                layerName = isArray ? "MergedLayers" : layerModel.get("layerName");\n\n            // Create a dummy layer name in case it\'s empty\n            if (!layerName) {\n                layerName = "layer" + layerModel.get("layerId");\n            } else {\n                layerName = layerName.replace(/[\\\'\\"]/g, "");\n            }\n            \n            // Add default PNG file extension at the end of the layer name\n            if (!Constants.RegExp.FILE_EXT.exec(layerName)) {\n                layerName = layerName + ".png";\n            }\n            \n            var valueString = this.relPath + layerName.replace(/ /g, "-"),\n                displayValue = Strings.EXTRACT_ASSET;\n            \n            if (options && options.toValue) {\n                valueString = options.toValue(valueString, layerModel);\n                displayValue = options.toValue(displayValue, layerModel);\n            }\n\n            // Return each layer rendering as an image hint\n            return {\n                type: Constants.Hint.IMAGE,\n                layerModel: layerModel,\n                property: options && options.property,\n                value: valueString,\n                displayValue: displayValue\n            };\n        },\n\n        _getStylesForTextLayer: function (layerModel) {\n            // Modified from LayerModel.getCSSArray()\n            // - Account for shorthand and bulk hints\n            // - Add code hint type (color or text)\n            // - Add font-weight: normal if none specified\n            var cssArray = [],\n                keys,\n                properties = layerModel.get(\'properties\'),\n                usageModels = layerModel.get(\'usageModels\'),\n                stylesForRangeArray,\n                stylesForRangeContext,\n                textRanges = properties.get(\'textStyleRange\'),\n                textFragment,\n                decodedText = UTF8.decodeCharacters(properties.get(\'rawText\')),\n                textStyle,\n                isDup,\n                fontInfo,\n                blendOptions,\n                color,\n                fontSize,\n                leading,\n                emittedStyles = [],\n                displayDescription = null,\n                hasMultipleRanges = false;\n\n            if (!textRanges || textRanges.length === 0) {\n                return cssArray;\n            }\n\n            textRanges = textRanges.filter(function (textRange) {\n                textStyle = textRange.textStyle;\n                textFragment = decodedText.substring(textRange.from, textRange.to);\n\n                // Only emit if we haven\'t already done so. We are only\n                // interesting in highlighting unique style combinations.\n                isDup = _.some(emittedStyles, function (style) {\n                    return _.isEqual(textStyle, style);\n                });\n\n                if (layerModel.isWhitespace(textFragment) || isDup) {\n                    return false;\n                }\n\n                return true;\n            });\n\n            hasMultipleRanges = textRanges.length > 1;\n\n            textRanges.forEach(function (textRange) {\n                textStyle = textRange.textStyle;\n                textFragment = decodedText.substring(textRange.from, textRange.to);\n                displayDescription = hasMultipleRanges ? \'"<span class="parfait-hint-description-text">\' + _.escape(textFragment) + \'</span>"\' : null;\n\n                stylesForRangeArray = [];\n                fontInfo = CSSUtil.getFontInfo(textStyle);\n\n                stylesForRangeArray.push({\n                    type: Constants.Hint.TEXT,\n                    property: \'font-family\',\n                    value: CSSUtil.formatCSSValue(\'font-family\', fontInfo.fontName),\n                    displayDescription: displayDescription\n                });\n                blendOptions = properties.get(\'blendOptions\');\n                var clr;\n                if (usageModels.colors.length === 1) {\n                    color = usageModels.colors[0].get(\'style\');\n                    color = {\n                        red: color.get(\'red\'),\n                        green: color.get(\'green\'),\n                        blue: color.get(\'blue\'),\n                        alpha: color.get(\'alpha\')\n                    };\n                } else {\n                    color = textStyle.color;\n                }\n                if (blendOptions && blendOptions.hasOwnProperty(\'fillOpacity\')) {\n                    color.alpha *= blendOptions.fillOpacity / 100;\n                }\n                stylesForRangeArray.push({\n                    type: Constants.Hint.COLOR,\n                    property: \'color\',\n                    value: CSSUtil.getDefaultColorString(color.red, color.green, color.blue, color.alpha),\n                    displayDescription: displayDescription\n                });\n                fontSize = CSSUtil.parseCSSMeasure(fontInfo.size);\n                stylesForRangeArray.push({\n                    type: Constants.Hint.TEXT,\n                    property: \'font-size\',\n                    value: CSSUtil.convertPSDUnitsToPreferredUnits(fontSize, true),\n                    comment: fontInfo.coolTypeResolved ? undefined : layerModel.cssComments.FONT_SUB,\n                    displayDescription: displayDescription\n                });\n                if (fontInfo.fontFace) {\n                    stylesForRangeArray = stylesForRangeArray.concat(CSSUtil.fontStyleNameToCSS(fontInfo.fontFace));\n                }\n                if (textStyle.leading) {\n                    leading = CSSUtil.parseCSSMeasure(textStyle.leading);\n                    var units = UserSettingsModel.get(\'preferredFontUnits\'),\n                        value;\n                    if (units === ParfaitConstants.FontUnitType.PX) {\n                        value = +(+leading.val).toFixed(3) + units;\n                    } else {\n                        value = +(leading.val / fontSize.val).toFixed(3);\n                    }\n                    stylesForRangeArray.push({\n                        type: Constants.Hint.TEXT,\n                        property: \'line-height\',\n                        value: value,\n                        comment: fontInfo.coolTypeResolved ? undefined : layerModel.cssComments.FONT_SUB,\n                        displayDescription: displayDescription\n                    });\n                }\n                if (textStyle.textAlign) {\n                    stylesForRangeArray.push({\n                        type: Constants.Hint.TEXT,\n                        property: \'text-align\',\n                        value: textStyle.textAlign,\n                        displayDescription: displayDescription\n                    });\n                }\n                if (properties.get(\'dropShadow\')) {\n                    stylesForRangeArray.push({\n                        type: Constants.Hint.TEXT,\n                        property: \'text-shadow\',\n                        value: properties.get(\'dropShadow\'),\n                        displayDescription: displayDescription\n                    });\n                }\n                emittedStyles.push(textStyle);\n\n                // Create a context to use in the font shorthand template\n                stylesForRangeContext = {};\n                stylesForRangeArray.forEach(function (style) {\n                    stylesForRangeContext[style.property] = style;\n                });\n\n                // insert font-weight normal\n                if (!stylesForRangeContext["font-weight"]) {\n                    stylesForRangeArray.push({\n                        type: Constants.Hint.TEXT,\n                        value: "normal",\n                        property: "font-weight",\n                        displayDescription: displayDescription\n                    });\n                }\n\n                // Insert font shorthand for each range\n                var shorthand = {\n                    type: Constants.Hint.TEXT,\n                    value: fontShorthandTemplate({ properties: stylesForRangeContext }).replace(/(\\r|\\n)+/g, " ").trim(),\n                    property: "font",\n                    displayDescription: displayDescription\n                };\n\n                stylesForRangeArray.push(shorthand);\n\n                // Insert bulk hints\n                // TODO preference for using shorthand in bulk hints?\n                var fontBulkHints = [stylesForRangeContext["color"], shorthand],\n                    textShadow = stylesForRangeContext["text-shadow"],\n                    textAlign = stylesForRangeContext["text-align"],\n                    description = [];\n\n                if (textShadow) {\n                    fontBulkHints.push(textShadow);\n                }\n\n                if (textAlign) {\n                    fontBulkHints.push(textAlign);\n                }\n\n                fontBulkHints.forEach(function (style) {\n                    description.push(style.property);\n                });\n\n                // insert [color, font, text-shadow, text-align] bulk hint\n                stylesForRangeArray.push({\n                    type: Constants.Hint.TEXT,\n                    value: fontBulkHints,\n                    displayName: Strings.CSS_ALL_FONT_STYLES,\n                    displayDescription: displayDescription || description.join(", ")\n                });\n\n                // Concat styles for this range\n                cssArray = cssArray.concat(stylesForRangeArray);\n            });\n\n            return cssArray;\n        },\n\n        _getStylesForContentLayer: function (layerModel) {\n            // Modified from LayerModel.getCSSArray()\n            // - Handle bulk hints for vendor prefixes\n            var cssArray = [],\n                properties = layerModel.get(\'properties\'),\n                usageModels = layerModel.get(\'usageModels\'),\n                shape,\n                blendOptions;\n\n            // TODO: create test file for the case with multiple gradients (would that ever happen?)\n            shape = properties.get(\'shape\');\n            blendOptions = properties.get(\'blendOptions\');\n            var isOpacity = blendOptions && blendOptions.hasOwnProperty(\'opacity\'),\n                isFillOpacity = blendOptions && blendOptions.hasOwnProperty(\'fillOpacity\'),\n                globalOpacity = isOpacity ? blendOptions.opacity / 100 : 1,\n                fillOpacity = isFillOpacity ? blendOptions.fillOpacity / 100 : 1,\n                gradientUsage = usageModels.gradients[0],\n                colorUsage = usageModels.colors[0],\n                skipBackground = shape && !shape.fillEnabled,\n                notCSSShape = shape && shape.type === ParfaitConstants.Shape.PATH,\n                isFill = (colorUsage || gradientUsage) && !skipBackground,\n                isStroke = shape && shape.stroke,\n                cssObj,\n                alpha,\n                color;\n\n            if (shape) {\n                if (shape.type === ParfaitConstants.Shape.ELLIPSE) {\n                    cssArray.push({property: \'border-radius\', value: \'50%\'});\n                }\n                if (shape.type === ParfaitConstants.Shape.RECTANGLE) {\n                    cssObj = CSSUtil.getBorderRadiusCSS(shape.bottomLeftRadius, shape.bottomRightRadius, shape.topLeftRadius, shape.topRightRadius);\n                    if (cssObj) {\n                        cssArray = cssArray.concat(cssObj);\n                    }\n                }\n            }\n            if (!notCSSShape) {\n                if (isStroke) {\n                    cssArray = cssArray.concat(CSSUtil.strokeToCSS(shape, isFill ? null : +(globalOpacity * fillOpacity).toFixed(2)));\n                }\n                if (!skipBackground) {\n                    alpha = (isStroke ? 1 : globalOpacity) * fillOpacity;\n                    alpha = +alpha.toFixed(2);\n                    if (colorUsage) {\n                        color = properties.get(\'color\');\n                        cssArray.push({\n                            type: Constants.Hint.COLOR,\n                            property: \'background-color\',\n                            value: CSSUtil.getDefaultColorString(color.red, color.green, color.blue, alpha)\n                        });\n                    }\n                    if (gradientUsage) {\n                        var gradientModel = gradientUsage.get("style"),\n                            noPrefix = gradientModel.getCSS(false, alpha),\n                            withPrefix = gradientModel.getCSS(true, alpha),\n                            w3c = noPrefix[0],\n                            gradientBulkHints = [];\n                        \n                        // insert w3c value\n                        cssArray.push({\n                            type: Constants.Hint.GRADIENT,\n                            property: w3c.property,\n                            value: w3c.value\n                        });\n                        \n                        // insert vendor prefixed values\n                        _.each(withPrefix, function (style) {\n                            gradientBulkHints.push({\n                                type: Constants.Hint.GRADIENT,\n                                property: style.property,\n                                value: style.value\n                            });\n                        });\n\n                        cssArray.push({\n                            type: Constants.Hint.GRADIENT,\n                            property: w3c.property,\n                            value: gradientBulkHints,\n                            displayValue: "[-vendor-]" + w3c.value,\n                            displayDescription: "-webkit, -moz, -o, -ms, W3C"\n                        });\n                    }\n                }\n                if (isOpacity && isStroke && isFill) {\n                    cssArray.push({\n                        property: \'opacity\',\n                        value: +globalOpacity.toFixed(2)\n                    });\n                }\n            }\n\n            return cssArray;\n        },\n\n        _getStylesForGroupLayer: function (layerModel, context) {\n            var self = this,\n                cssArray = [],\n                uniqueStyles,\n                uniqueGradients,\n                hintContext;\n\n            // initialize maps unless they have been passed in as an argument\n            // in case we got here via recursion.\n            hintContext = context || {};\n            \n            // Get existing or assign new\n            hintContext.layerRoot = hintContext.layerRoot || ParfaitConstants.Type.LAYER_GROUP;\n            \n            hintContext.uniqueStyles = hintContext.uniqueStyles || {};\n            uniqueStyles = hintContext.uniqueStyles;\n            \n            hintContext.uniqueGradients = hintContext.uniqueGradients || {};\n            uniqueGradients = hintContext.uniqueGradients;\n            \n            // iterate over layer models - get styles for each.\n            _.each(layerModel.attributes.layerCollection.models, function (sublayerModel) {\n                // recurse\n                var sublayerStyles = self._getStylesForLayer(sublayerModel, hintContext);\n                \n                // find unique styles.\n                // parse all styles and track styles or gradients\n                // *only if* there\'s only one unique value for a given property across the entire group.\n                // Exception: Allow multiple background values to enable gradients, \n                // but limit to unique gradient types\n                _.each(sublayerStyles, function (style) {\n                    if (!uniqueStyles[style.property]) {\n                        uniqueStyles[style.property] = style;\n                    } else if (uniqueStyles[style.property].value !== style.value) {\n                        uniqueStyles[style.property] = -1;\n                    }\n                    if (typeof style.value === "string" && style.value.match(/gradient/)) {\n                        var gradientKey = style.value.slice(0, style.value.indexOf("(")),\n                            gradientVal = style.value.slice(style.value.indexOf("("));\n                        \n                        if (!uniqueGradients[gradientKey]) {\n                            uniqueGradients[gradientKey] = style;\n                        } else if (uniqueGradients[gradientKey] !== -1 &&\n                                   uniqueGradients[gradientKey].value\n                                   .slice(uniqueGradients[gradientKey].value.indexOf("(")) !== gradientVal) {\n                            uniqueGradients[gradientKey] = -1;\n                        }\n                    }\n                });\n            });\n\n            // merge unique styles found in this layer and its children layers        \n            function includeInGroupLayerHint(style) {\n                return !(Constants.GroupLayerExcludedProps.hasOwnProperty(style.property));\n            }\n            \n            _.each(uniqueStyles, function (style) {\n                if (style !== -1 && includeInGroupLayerHint(style)) {\n                    cssArray.push(style);\n                }\n            });\n            _.each(uniqueGradients, function (style) {\n                if (style !== -1) {\n                    cssArray.push(style);\n                }\n            });\n\n            return cssArray;\n        },\n        \n        _getStylesForLayer: function (layerModel, context) {\n            var originalCssArray = layerModel.getCSSArray(true),\n                filteredCssArray,\n                resultCssArray = [],\n                layerTypeHints,\n                shape,\n                properties = layerModel.get(\'properties\'),\n                psdBounds = DetailsController.getPSDModel().get(\'imgdata\').bounds,\n                bounds = MeasurementUtil.getMeasurementsOfLayerAgainstPSDBounds(layerModel),\n                layerEffects = properties.get(\'layerEffects\');\n\n            // LayerModel includes blank lines, ignore them\n            filteredCssArray = originalCssArray.filter(function (cssPair) {\n                return !(cssPair.property === undefined ||\n                    cssPair.property === null ||\n                    cssPair.value === undefined ||\n                    cssPair.value === null);\n            });\n\n            if (properties.layerType === ParfaitConstants.Type.LAYER_TEXT) {\n                layerTypeHints = this._getStylesForTextLayer(layerModel);\n            } else if (properties.layerType === ParfaitConstants.Type.LAYER_CONTENT) {\n                shape = properties.get(\'shape\');\n                layerTypeHints = this._getStylesForContentLayer(layerModel);\n            } else if (properties.layerType === ParfaitConstants.Type.LAYER_GROUP) {\n                layerTypeHints = this._getStylesForGroupLayer(layerModel, context);\n            }\n\n            if (layerTypeHints) {\n                resultCssArray = resultCssArray.concat(layerTypeHints);\n            }\n\n            if (layerEffects) {\n                if (layerEffects.dropShadow && layerEffects.dropShadow.enabled) {\n                    CSSUtil.addCSS(resultCssArray, CSSUtil.getShadowCSS(properties.layerType, layerEffects.dropShadow));\n                }\n            }\n\n            if (properties.get(\'dropShadow\') && properties.layerType !== ParfaitConstants.Type.LAYER_TEXT) {\n                resultCssArray.push({\n                    property: \'box-shadow\',\n                    value: properties.get(\'dropShadow\')\n                });\n            }\n            if (properties.get(\'borderRadius\')) {\n                resultCssArray.push({\n                    property: \'border-radius\',\n                    value: properties.get(\'borderRadius\')\n                });\n            }\n            \n            if (properties.get(\'transform\')) {\n                var cssTransform = CSSUtil.getCSSTransform(properties.get(\'transform\'));\n                if (cssTransform && cssTransform !== \'\') {\n                    resultCssArray.push({\n                        property: \'transform\',\n                        value: cssTransform\n                    });\n                }\n            }\n\n            //CSS Width doesn\'t calculate correctly if using inside or path borders.  Bug 1035. Subtract border, if appropriate\n            if (shape && (shape.type === ParfaitConstants.Shape.RECTANGLE || shape.type === ParfaitConstants.Shape.ELLIPSE)) {\n                if (shape.stroke && shape.stroke.strokeStyleLineAlignment) {\n                    if (shape.stroke.strokeStyleLineAlignment) {\n                        // Subtract twice the border thickness\n                        bounds.right -= (parseInt(shape.stroke.strokeStyleLineWidth, 10) * 2);\n                        bounds.bottom -= (parseInt(shape.stroke.strokeStyleLineWidth, 10) * 2);\n                        //Call getMeasurements to recalc the display values\n                        bounds = MeasurementUtil.getMeasurementsOfRectInsideRect(bounds, psdBounds);\n                    }\n                }\n            }\n\n            // Parfait\'s layerModel.getVisibleBounds() top/bottom/left/right\n            // return values are ALL relative to the top-left origin of the \n            // document. For our use in CSS absolute positioning,\n            // bottom/right should be relative to the bottom-right.\n            bounds.bottom = psdBounds.bottom - bounds.bottom;\n            bounds.right = psdBounds.right - bounds.right;\n\n            // Position and Size\n            var layoutProps = [\n                { type: Constants.Hint.POSITION,    property: "top",    value: bounds.top + "px" },\n                { type: Constants.Hint.POSITION,    property: "left",   value: bounds.left + "px" },\n                { type: Constants.Hint.POSITION,    property: "right",  value: bounds.right + "px" },\n                { type: Constants.Hint.POSITION,    property: "bottom", value: bounds.bottom + "px" },\n                { type: Constants.Hint.SIZE,        property: "width",  value: bounds.displayWidth },\n                { type: Constants.Hint.SIZE,        property: "height", value: bounds.displayHeight }\n            ];\n\n            resultCssArray = resultCssArray.concat(layoutProps);\n            \n            // Remove duplicates\n            resultCssArray = _.uniq(resultCssArray, _toCSSString);\n            \n            // Add LayerModel (used in CodeHintItemView to render thumbnail)\n            _.each(resultCssArray, function (data) {\n                data.layerModel = layerModel;\n            });\n            \n            // Add image hint\n            // TODO fix: image extraction for group layers\n            if (!context) {\n                resultCssArray.push(this._layerToImageData(layerModel, { property: "background", toValue: _toURLValue }));\n            }\n\n            return resultCssArray;\n        },\n\n        setImagePath: function (relPath) {\n            this.relPath = relPath;\n        }\n\n    });\n    \n    return new CSSHintController();\n});\n//# sourceURL=/./controllers/CSSHintController.js'),
eval('/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4, maxerr: 50, regexp: true  */\n/*global define, brackets, graphite, Mustache, window, XMLHttpRequest, FileReader*/\n\ndefine(\'ext/ParfaitAPI\',[\n    "exports",\n    "jquery",\n    "config/environment",\n    "controllers/AuthController",\n    "Constants",\n    "ext/NodeAPI",\n    "ext/ims/IMSLibWrapper",\n    \'ext/ims/IMSLib\'\n], function (exports, $, environment, AuthController, Constants, NodeAPI, IMSLibWrapper, IMSLib) {\n    "use strict";\n\n    var FileSystem = brackets.getModule("filesystem/FileSystem");\n\n    // TODO use serverAPI and remove these duplicate URLs\n    var AUTH_HEADER = "Bearer {{accesstoken}}",\n        nodeDomain = NodeAPI.nodeDomain,\n        configurePromise;\n\n    var RE_DATA_URL = /data:([^;\\s]+)?(;base64)?,(.*)/;\n\n    /**\n     * Map PSD GUIDs to map of layers to derived sprite img path\n     * @type\n     * {Object.<string, Object.<string, string>}\n     */\n    var derivedSpriteMap = {};\n    \n    function writeBase64File(file, data) {\n        return nodeDomain.exec("writeBase64", file.fullPath, data);\n    }\n    \n    function writeDataURLFile(file, dataURL) {\n        // TODO sanity check dataURL\n        var exec = RE_DATA_URL.exec(dataURL);\n        return writeBase64File(file, exec[3]);\n    }\n\n    function _getAccessToken() {\n        return IMSLibWrapper.getAccessToken();\n    }\n    \n    function _wrapXHRPromise(promise) {\n        return promise.then(function (data) {\n            return data;\n        }, function (jqXHR, textStatus, errorThrown) {\n            return new $.Deferred().reject(errorThrown).promise();\n        });\n    }\n    \n    function updateAccessToken() {\n        return _getAccessToken().then(function (accessToken) {\n            // FIXME https://git.corp.adobe.com/jhagenst/brackets-parfait-extension/issues/628\n            // to remove this copy of the access token,\n            // change vanilla extract serverAPI calls to fetch access token asynch or use cookie.\n            AuthController.getAuthModel().attributes.access_token = accessToken;\n        });\n    }\n    \n    function _handleLoggedOut() {\n        // temp workaround to enable current server API\'s integration of access token\n        AuthController.getAuthModel().attributes.access_token = "";\n        graphite.events.trigger("logged-out");\n    }\n\n    function configureCCProxies() {\n        if (!configurePromise) {\n            var hosts = [environment.FILESTORAGE_HOST, environment.IMAGE_SERVICE_HOST],\n                promises = [];\n            \n            hosts.forEach(function (host) {\n                var promise = nodeDomain.exec("configureProxy", host, Constants.CACHE_LOCATION).then(function (res) {\n                    environment.setProxyURL("http://127.0.0.1:" + res.port, host);\n                });\n                \n                promises.push(promise);\n            });\n            \n            configurePromise = $.when.apply(null, promises);\n        }\n\n        return configurePromise;\n    }\n    \n    function clearProxyCache() {\n        nodeDomain.exec("clearProxyCache", Constants.CACHE_LOCATION);\n    }\n\n    function _handleProxyRequestComplete(event, url) {\n        graphite.events.trigger("proxy-request-complete", { url: url });\n    }\n\n    function _handleProxyRequestError(event, url) {\n        graphite.events.trigger("proxy-request-error", { url: url });\n    }\n\n    function _handleCacheFallbackComplete(event, url) {\n        graphite.events.trigger("cache-fallback-complete", { url: url });\n    }\n\n    // Listen for authentication events\n    $(IMSLib).on("signInAuto", updateAccessToken);\n    $(IMSLibWrapper).on("signIn", updateAccessToken);\n    $(IMSLibWrapper).on("signOut", _handleLoggedOut);\n    $(IMSLib).on("signOut", _handleLoggedOut);\n\n    // Listen to proxy events\n    $(nodeDomain).on("proxyRequestComplete", _handleProxyRequestComplete);\n    $(nodeDomain).on("proxyRequestError", _handleProxyRequestError);\n    $(nodeDomain).on("cacheFallbackComplete", _handleCacheFallbackComplete);\n\n    // Public API\n    exports.configureCCProxies      = configureCCProxies;\n    exports.clearProxyCache         = clearProxyCache;\n    exports.writeBase64File         = writeBase64File;\n    exports.writeDataURLFile        = writeDataURLFile;\n    exports.writeBase64File         = writeBase64File;\n    exports.updateAccessToken       = updateAccessToken;\n});\n\n//# sourceURL=/./ParfaitAPI.js'),eval('define(\'text!ext/views/editor-callout-view.html\',[],function () { return \'<script type="text/html" id="callout">\\n    <div class="editor-callout-message"><%= message %></div>\\n    <% if (dismiss) { %>\\n        <div class="dismiss-button"><%- dismiss %></div>\\n    <% } %>\\n    <div class="notch"></div>\\n</script>\';});\n\n//# sourceURL=/text!ext/views/editor-callout-view.html'),eval('/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4 */\n/*global define: true, brackets: true*/\n\ndefine(\'ext/views/EditorCalloutView\',[\n    \'jquery\',\n    \'underscore\',\n    \'backbone\',\n    \'text!ext/views/editor-callout-view.html\',\n    \'ext/strings\'\n], function ($, _, Backbone, EditorCalloutViewTemplate, Strings) {\n    "use strict";\n\n    var AnimationUtils  = brackets.getModule("utils/AnimationUtils"),\n        KeyEvent        = brackets.getModule("utils/KeyEvent");\n\n    var EditorCalloutView = Backbone.View.extend({\n\n        codeMirror: null,\n        pos: null,\n        templateId: null,\n        message: "",\n        dismiss: null,\n        disableRemoveAnimation: false,\n\n        /**\n         * click .dismiss-button: trigger "dismiss" event\n         * click: remove callout from DOM\n         */\n        events: {\n            "click .dismiss-button": "_handleDismiss",\n            "click": "remove"\n        },\n\n        initialize: function (options) {\n            this.codeMirror = options.codeMirror;\n            this.pos = options.pos;\n            this.templateId = options.templateId;\n            this.message = options.message;\n            this.dismiss = options.dismiss || Strings.GOT_IT;\n            this.disableRemoveAnimation = options.disableRemoveAnimation || false;\n\n            this._onKeyDown = this._onKeyDown.bind(this);\n            this.codeMirror.on("keydown", this._onKeyDown);\n\n            this.render();\n        },\n\n        _onKeyDown: function (cm, event) {\n            if (event.keyCode === KeyEvent.DOM_VK_ESCAPE) {\n                this.remove();\n            }\n        },\n\n        createTemplate: function () {\n            var srcHTML = $(EditorCalloutViewTemplate).filter(this.templateId).html(),\n                template = _.template(srcHTML);\n\n            return template(this).trim();\n        },\n\n        render: function () {\n            this.$el.html(this.createTemplate());\n            this.$el.addClass("editor-callout top");\n\n            return this;\n        },\n\n        updatePosition: function () {\n            // Open the callout to get correct offsets and size\n            this.$el.addClass("open");\n\n            var self = this,\n                calloutCoords = this.$el.offset(),\n                posCharBounds = this.codeMirror.charCoords(this.pos, "local"),\n                calloutBottom = calloutCoords.top + this.$el.outerHeight();\n\n            this.$el.removeClass("open").addClass("visible");\n\n            // Adjust vertical position if callout is\n            // (a) above viewport or \n            // (b) covers the editor position\n            if (calloutCoords.top < 0 || posCharBounds.bottom < calloutBottom) {\n                var notchHeight = this.$el.find(".notch").height();\n\n                this.$el.removeClass("top").addClass("bottom");\n                this.$el.css("top", posCharBounds.bottom + notchHeight);\n            }\n            \n            AnimationUtils.animateUsingClass(this.el, "animateOpen").done(function () {\n                self.$el.addClass("open");\n            });\n        },\n\n        /**\n         * @private\n         * Triggered when .dismiss-button is clicked. Note that callout is\n         * removed from DOM via click handler for $el.\n         */\n        _handleDismiss: function () {\n            this.trigger("dismiss");\n        },\n\n        remove: function () {\n            var self = this,\n                doRemove = function () { Backbone.View.prototype.remove.call(self); };\n\n            this.codeMirror.off("keydown", this._onKeyDown);\n\n            if (this.disableRemoveAnimation) {\n                doRemove();\n            } else {\n                AnimationUtils.animateUsingClass(self.el, "animateClose").always(doRemove);\n            }\n\n            this.codeMirror.focus();\n        }\n    });\n\n    return EditorCalloutView;\n\n});\n\n//# sourceURL=/./views/EditorCalloutView.js'),eval('/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4 */\n/*global define: true, graphite: true, brackets: true, PathUtils: true*/\n\ndefine(\'ext/utils/StatusBarUtil\',[\n    "jquery"\n], function ($) {\n    "use strict";\n    \n    var StringUtils     = brackets.getModule("utils/StringUtils"),\n        StatusBar       = brackets.getModule("widgets/StatusBar");\n    \n    var STATUS_INDICATOR_ID = "psdlens-status-indicator";\n\n    var StatusBarUtil = {\n        \n        $statusIndicator: null,\n        \n        showBusyStatus: function (statusText) {\n            StatusBar.showBusyIndicator();\n            if (!this.$statusIndicator) {\n                this.$statusIndicator = $("<div/>");\n                StatusBar.addIndicator(STATUS_INDICATOR_ID, this.$statusIndicator, false);\n            }\n            this.$statusIndicator.text(statusText);\n            StatusBar.updateIndicator(STATUS_INDICATOR_ID, true);\n        },\n        hideBusyStatus: function () {\n            StatusBar.hideBusyIndicator();\n            StatusBar.updateIndicator(STATUS_INDICATOR_ID, false);\n        }\n        \n\n    };\n\n    return StatusBarUtil;\n});\n\n//# sourceURL=/./utils/StatusBarUtil.js'),eval('/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4, maxerr: 50, regexp: true */\n/*global define, brackets, graphite*/\n\n\ndefine(\'ext/controllers/LinkedRenameController\',[\n    "jquery",\n    "underscore",\n    "backbone",\n    "ext/ParfaitAPI",\n    "ext/Constants",\n    "ext/controllers/CSSHintController",\n    "ext/views/EditorCalloutView",\n    "ext/models/BracketsPreferencesModel",\n    "ext/utils/StatusBarUtil",\n    "ext/strings"\n], function ($, _, Backbone, ParfaitAPI, Constants, CSSHintController, EditorCalloutView, BracketsPreferencesModel, StatusBarUtil, Strings) {\n    "use strict";\n\n    var MainViewManager     = brackets.getModule("view/MainViewManager"),\n        CodeMirror          = brackets.getModule("thirdparty/CodeMirror2/lib/codemirror"),\n        DefaultDialogs      = brackets.getModule("widgets/DefaultDialogs"),\n        Dialogs             = brackets.getModule("widgets/Dialogs"),\n        FileUtils           = brackets.getModule("file/FileUtils"),\n        FileSystem          = brackets.getModule("filesystem/FileSystem"),\n        FileSystemError     = brackets.getModule("filesystem/FileSystemError"),\n        ProjectManager      = brackets.getModule("project/ProjectManager"),\n        BracketsStrings     = brackets.getModule("strings"),\n        StringUtils         = brackets.getModule("utils/StringUtils");\n    \n    var RE_URL_QUOTED = /^[\'"]?([^\'"]+)[\'"]?$/,\n        prefs = BracketsPreferencesModel.get("preferenceSystem");\n\n    function _isExitHandlerPass(linkedMode, marker) {\n        return !marker || linkedMode.exitPosition.marker === marker;\n    }\n    \n    // TODO: submit Brackets pull request to surface this functionality to all Brackets extensions\n    /**\n     * @private\n     * A string containing all invalid characters for a specific platform.\n     * This will be used to construct a regular expression for checking invalid filenames.\n     * When a filename with one of these invalid characters are detected, then it is \n     * also used to substitute the place holder of the error message.\n     */\n    var _invalidChars;\n\n    /**\n     * @private\n     * RegEx to validate if a filename is not allowed even if the system allows it.\n     * This is done to prevent cross-platform issues.\n     */\n    var _illegalFilenamesRegEx = /^(\\.+|com[1-9]|lpt[1-9]|nul|con|prn|aux|)$|\\.+$|\\/\\//i;\n    \n    var LinkedRenameController = Backbone.Model.extend({\n\n        $statusIndicator: null,\n\n        /**\n         * @private\n         * Confirms that a given filename is both valid and overwritable.\n         *   If there are invalid characters in the filename, prompts user to rename.\n         *   If the file already exists, prompts user to rename or overwrite.\n         *\n         * @param {!Editor} editor   A non-null editor object for the active window.\n         * @param {String} relPath\n         * @return {jQuery.Deferred} Resolved when the filename is ok to (over)write.\n         *   Rejected true when we\'re allowing the user to type another filename.\n         *   Rejected false when we should just stop and not write anything.\n         */\n        _confirmValidAndWriteableFilename: function (editor, relPath) {\n            var deferred = new $.Deferred(),\n                dialog,\n                body,\n                buttons;\n\n            // Check for invalid characters in the filename\n            if ((relPath.search(new RegExp("[" + _invalidChars + "]+")) !== -1) ||\n                    (relPath.match(_illegalFilenamesRegEx))) {\n                // Prompt the user to either rename or cancel\n                body = StringUtils.format(\n                    Strings.EXTRACT_INVALID_CHARS,\n                    StringUtils.breakableUrl(relPath),\n                    _invalidChars\n                );\n\n                buttons = [\n                    {\n                        // Cleanup linked mode\n                        className : Dialogs.DIALOG_BTN_CLASS_NORMAL,\n                        id        : Dialogs.DIALOG_BTN_DONTSAVE,\n                        text      : BracketsStrings.CANCEL\n                    },\n                    {\n                        // Re-enter linked mode\n                        className : Dialogs.DIALOG_BTN_CLASS_PRIMARY,\n                        id        : Dialogs.DIALOG_BTN_CANCEL,\n                        text      : BracketsStrings.CMD_FILE_RENAME\n                    }\n                ];\n\n                dialog = Dialogs.showModalDialog(DefaultDialogs.DIALOG_ID_ERROR,\n                    BracketsStrings.ERROR_SAVING_FILE_TITLE, body, buttons);\n\n                dialog.getPromise().done(function (id) {\n                    if (id === Dialogs.DIALOG_BTN_CANCEL) {\n                        deferred.reject(true);  // allow user to type another filename\n                    } else {\n                        deferred.reject(false); // cancel -- don\'t download\n                    }\n                });\n            } else {\n                // Check if the file already exists\n                var isServerRoot = (relPath.charAt(0) === "/"),\n                    parentPath = isServerRoot ? ProjectManager.getProjectRoot().fullPath : editor.document.file.parentPath,\n                    path = parentPath + (isServerRoot ? relPath.substr(1) : relPath);\n\n                FileSystem.resolve(path, function (err, entry) {\n                    if (err !== FileSystemError.NOT_FOUND) {\n                        // A file with that filename already exists.  Prompt the user to either overwrite, rename, or cancel\n\n                        // String change in Brackets Release 0.40\n                        // See https://git.corp.adobe.com/jhagenst/brackets-parfait-extension/issues/195\n                        body = StringUtils.format(\n                            Strings.EXTRACT_ALREADY_EXISTS,\n                            (entry.isFile) ? BracketsStrings.FILE : BracketsStrings.DIRECTORY,\n                            StringUtils.breakableUrl(relPath)\n                        );\n\n                        if (entry.isFile) {\n                            // same name as an existing file.  Rename, overwrite, or cancel.\n                            buttons = [\n                                {\n                                    // Cleanup linked mode\n                                    className : Dialogs.DIALOG_BTN_CLASS_LEFT,\n                                    id        : Dialogs.DIALOG_BTN_DONTSAVE,\n                                    text      : BracketsStrings.DONT_SAVE\n                                },\n                                {\n                                    // Re-enter linked mode and rename\n                                    className : Dialogs.DIALOG_BTN_CLASS_NORMAL,\n                                    id        : Dialogs.DIALOG_BTN_CANCEL,\n                                    text      : BracketsStrings.CMD_FILE_RENAME\n                                },\n                                {\n                                    // Overwrite file and cleanup\n                                    className : Dialogs.DIALOG_BTN_CLASS_PRIMARY,\n                                    id        : Dialogs.DIALOG_BTN_OK,\n                                    text      : BracketsStrings.SAVE_AND_OVERWRITE\n                                }\n                            ];\n                        } else {\n                            // same name as an existing folder.  Rename or cancel.\n                            buttons = [\n                                {\n                                    // Cleanup linked mode\n                                    className : Dialogs.DIALOG_BTN_CLASS_NORMAL,\n                                    id        : Dialogs.DIALOG_BTN_DONTSAVE,\n                                    text      : BracketsStrings.CANCEL\n                                },\n                                {\n                                    // Re-enter linked mode\n                                    className : Dialogs.DIALOG_BTN_CLASS_PRIMARY,\n                                    id        : Dialogs.DIALOG_BTN_CANCEL,\n                                    text      : BracketsStrings.CMD_FILE_RENAME\n                                }\n                            ];\n                        }\n\n                        dialog = Dialogs.showModalDialog(DefaultDialogs.DIALOG_ID_ERROR,\n                            BracketsStrings.SAVE_AS, body, buttons);\n\n                        dialog.getPromise().done(function (id) {\n                            if (id === Dialogs.DIALOG_BTN_CANCEL) {\n                                deferred.reject(true);  // allow user to type another filename\n                            } else if (id === Dialogs.DIALOG_BTN_OK) {\n                                deferred.resolve(entry); // overwrite existing file\n                            } else { // id === DIALOG_BTN_DONTSAVE\n                                deferred.reject(false); // cancel -- don\'t download\n                            }\n                        });\n                    } else {\n                        // The filename is both valid and not already existing, so go ahead and allow the write\n                        deferred.resolve();\n                    }\n                });\n            }\n\n            return deferred.promise();\n        },\n        \n        /**\n         * @private\n         * Write image data to file path.\n         *\n         * @param {string} relPath\n         * @param {string} dataURL base64 image data\n         * @param {?File} entry FileSystemEntry for existing file; `undefined` otherwise\n         *\n         * @return {jQuery.Deferred} Resolved when file writes successfully.\n         *   Rejected if FileSystem returns an error (e.g. FileSystemError.ALREADY_EXISTS)\n         */\n        _writeFile: function (editor, relPath, dataURL, entry) {\n            var isServerRoot = (relPath.charAt(0) === "/"),\n                parentPath = isServerRoot ? ProjectManager.getProjectRoot().fullPath : editor.document.file.parentPath,\n                path = parentPath + (isServerRoot ? relPath.substr(1) : relPath),\n                file = entry || FileSystem.getFileForPath(path),\n                deferred = new $.Deferred();\n\n            // Save new file, overwriting if necessary\n            ParfaitAPI.writeDataURLFile(file, dataURL).then(\n                function () {\n                    deferred.resolve(file, dataURL);\n                },\n                function (nodeDomainErr) {\n                    // TODO convert nodeDomainErr to a FileSystemError?\n                    // unable to write the given file, even if asked to overwrite.\n                    deferred.reject(FileSystemError.NOT_WRITABLE, file.isFile);\n                }\n            );\n\n            return deferred.promise();\n        },\n\n        /**\n         * @private\n         * Show error dialog when _writeFile fails\n         *\n         * @param {string} err\n         * @param {boolean} isFile\n         * @param {string} relPath\n         *\n         * @return {jQuery.Deferred} Resolved when neither a rename or write\n         *   should be attempted. Rejected if another rename attempt is required.\n         */\n        _showWriteFileErrorDialog: function (err, isFile, relPath) {\n            var deferred = new $.Deferred(),\n                dialog,\n                buttons,\n                body;\n\n            body = StringUtils.format(\n                Strings.EXTRACT_UNABLE_TO_WRITE,\n                (isFile) ? BracketsStrings.FILE : BracketsStrings.DIRECTORY,\n                StringUtils.breakableUrl(relPath),\n                FileUtils.getFileErrorString(err)\n            );\n\n            buttons = [\n                {\n                    // Cleanup linked mode\n                    className : Dialogs.DIALOG_BTN_CLASS_NORMAL,\n                    id        : Dialogs.DIALOG_BTN_DONTSAVE,\n                    text      : BracketsStrings.CANCEL\n                },\n                {\n                    // Re-enter linked mode\n                    className : Dialogs.DIALOG_BTN_CLASS_PRIMARY,\n                    id        : Dialogs.DIALOG_BTN_CANCEL,\n                    text      : BracketsStrings.CMD_FILE_RENAME\n                }\n            ];\n\n            dialog = Dialogs.showModalDialog(\n                DefaultDialogs.DIALOG_ID_ERROR,\n                BracketsStrings.ERROR_SAVING_FILE_TITLE,\n                body,\n                buttons\n            );\n\n            dialog.getPromise().done(function (id) {\n                if (id === Dialogs.DIALOG_BTN_CANCEL) {\n                    // Re-enter linked mode with the up-to-date model\n                    deferred.reject();\n                } else { // id === DIALOG_BTN_DONTSAVE\n                    // Cleanup and skip writing\n                    deferred.resolve();\n                }\n\n                MainViewManager.focusActivePane();\n            });\n\n            return deferred.promise();\n        },\n\n        _showCallout: function (cm, pos, messageStr, prefKey, disableRemoveAnimation) {\n            var callout = new EditorCalloutView({\n                codeMirror: cm,\n                templateId: "#callout",\n                message: messageStr,\n                pos: pos,\n                disableRemoveAnimation: !!disableRemoveAnimation\n            });\n        \n            // Click handler for beforeRenameCallout button\n            callout.once("dismiss", function () {\n                if (prefKey) {\n                    prefs.set(prefKey, true);\n                }\n            });\n\n            cm.addWidget(pos, callout.el, null, "above");\n            callout.updatePosition();\n\n            return callout;\n        },\n\n        /**\n         * Enter Linked Mode UI to rename image hints\n         * \n         * @param {Editor} editor\n         * @param {string} pathText\n         * @param {function} toDataURL\n         * @param {from:CodeMirror.Pos, to:CodeMirror.Pos} pathRange\n         * @param {CodeMirror.Pos} exitPos\n         * @param {Object} keyMap\n         */\n        enterLinkedMode: function (editor, pathText, toDataURL, pathRange, exitPos, keyMap) {\n            var self            = this,\n                cm              = editor._codeMirror,\n                exitLinkedPos   = new CodeMirror.LinkedPosition(cm.doc, exitPos),\n                linkedPos       = new CodeMirror.LinkedPosition(cm.doc, pathRange.from, pathRange.to),\n                linkedGroup     = new CodeMirror.LinkedPositionGroup([linkedPos]),\n                linkedModel     = new CodeMirror.LinkedModeModel([linkedGroup]),\n                exitHandler,\n                deferred        = new $.Deferred(),\n                beforeRenameCallout,\n                afterRenameCallout,\n                hideBeforeRenameMessage = prefs.get(BracketsPreferencesModel.HIDE_BEFORE_RENAME_MESSAGE),\n                hideAfterRenameMessage = prefs.get(BracketsPreferencesModel.HIDE_AFTER_RENAME_MESSAGE);\n\n            function _enterLinkedMode(text, options) {\n                options = options || {};\n                cm.enterLinkedMode(linkedModel);\n\n                // linked mode selects the full first group by default, select just the path text instead\n                var pathSepIndex    = text.lastIndexOf("/"),\n                    fileExtIndex    = text.lastIndexOf("."),\n                    startOffset     = options.startOffset || (pathSepIndex >= 0 ? pathSepIndex + 1 : 0),\n                    endOffset       = options.endOffset || (fileExtIndex >= 0 ? fileExtIndex : text.length),\n                    selStart        = new CodeMirror.Pos(linkedPos.from.line, linkedPos.from.ch + startOffset),\n                    selEnd          = new CodeMirror.Pos(linkedPos.to.line, linkedPos.from.ch + endOffset);\n\n                editor.setSelection(selStart, selEnd);\n\n                // Show first run message in a callout\n                if (!hideBeforeRenameMessage) {\n                    beforeRenameCallout = self._showCallout(\n                        cm,\n                        pathRange.from,\n                        Strings.EXTRACT_BEFORE_RENAME,\n                        BracketsPreferencesModel.HIDE_BEFORE_RENAME_MESSAGE,\n                        !hideAfterRenameMessage\n                    );\n                }\n            }\n\n            function cleanUp(file, dataURL) {\n                linkedGroup.off("exit", exitHandler);\n\n                if (keyMap) {\n                    linkedModel.removeKeyMap(keyMap);\n                }\n                \n                if (file) {\n                    deferred.resolve(file, dataURL);\n                } else {\n                    deferred.reject();\n                }\n            }\n\n            function attemptWriteFile(relPath, dataURL, entry) {\n                return self._writeFile(editor, relPath, dataURL, entry).then(function (file, dataURL) {\n                    // Update callout to indicate completed download\n                    if (afterRenameCallout) {\n                        afterRenameCallout.$el.find(".callout-download-status").text(Strings.EXTRACT_DOWNLOAD_COMPLETE);\n                    }\n                  \n                    cleanUp(file, dataURL);\n                }, function (err, isFile) {\n                    if (afterRenameCallout) {\n                        afterRenameCallout.remove();\n                    }\n\n                    var errorPromise = self._showWriteFileErrorDialog(err, isFile, relPath);\n\n                    return errorPromise.then(function () {\n                        // DIALOG_BTN_DONTSAVE Don\'t Save button\n                        // DIALOG_BTN_DONTSAVE Cancel button (in case of unhandled error)\n                        // Exit linked mode and do not write file\n                        cleanUp();\n                    }, function () {\n                        // DIALOG_BTN_CANCEL Rename button\n                        // Re-enter linked mode with the up-to-date model\n                        // Use encodeURI in case it was re-written before async call\n                        // was fired.\n                        _enterLinkedMode(encodeURI(relPath));\n                    });\n                });\n            }\n\n            function requestAndWriteFile(relPath, fileExt) {\n                var decoded = decodeURI(relPath),\n                    encoded = encodeURI(decoded);\n\n                // Rewrite url(...) with URI encoded value\n                cm.replaceRange(encoded, linkedPos.from, linkedPos.to);\n\n                // Update LinkedPosition ranges manually\n                // TODO use text marker, see next comment\n                linkedPos.to.ch = linkedPos.from.ch + encoded.length;\n                exitLinkedPos.from.ch += (encoded.length - decoded.length);\n                \n                // check whether the filename is valid and/or whether the file already exists\n                self._confirmValidAndWriteableFilename(editor, relPath).done(function (entry) {\n                    // Request dataURL from service\n                    // FIXME this is a long running async call. The user may continue\n                    // editing the file during this window until the file write\n                    // completes. If an error occurs, we try to re-enter linked mode\n                    // with possibly invalid position data. Need to address this\n                    // race condition eventually. Blocking the UI isn\'t necessary if\n                    // we can maintain some temporary markers in the text and reset\n                    // the LinkedPosition(s) based on the markers.\n                    // FIXME do not make repeat request if file extension does not change\n                    var dataURLPromise = toDataURL(fileExt);\n\n                    // Do not show after-rename callout if promise was rejected synchronously\n                    if (dataURLPromise.state() !== "rejected") {\n                        // Show callout to explain workflow for rename/regenerate\n                        if (!hideAfterRenameMessage) {\n                            afterRenameCallout = self._showCallout(\n                                cm,\n                                pathRange.from,\n                                Strings.EXTRACT_AFTER_RENAME,\n                                BracketsPreferencesModel.HIDE_AFTER_RENAME_MESSAGE\n                            );\n\n                            // Dismiss this callout after any editor change\n                            // Add this event handler async to avoid the immediate change event\n                            // that happens via the replaceRange above\n                            window.setTimeout(function () {\n                                $(editor).one("change", function () {\n                                    afterRenameCallout.remove();\n                                });\n                            }, 0);\n                        }\n\n                        // Update status bar indicator\n                        var statusText = StringUtils.format(Strings.EXTRACT_DOWNLOADING_STATUS, relPath);\n                        StatusBarUtil.showBusyStatus(statusText);\n                    }\n\n                    // Clear status bar indicator after download attempt\n                    dataURLPromise.fail(function () {\n                        if (afterRenameCallout) {\n                            afterRenameCallout.remove();\n                        }\n                    }).always(function () {\n                        StatusBarUtil.hideBusyStatus();\n                    });\n\n                    dataURLPromise.then(function (dataURL) {\n                        // dataURL request succeeded, attempt write to disk\n                        return attemptWriteFile(decoded, dataURL, entry);\n                    }, function (err, detail) {\n                        // dataURL request failed, rename or retry\n                        var buttons,\n                            doRetryRequest = false;\n\n                        if (err === Strings.SERVICE_ERROR) {\n                            // Show service failed dialog...Try again?\n                            // Buttons: OK and Cancel\n                            buttons = [\n                                {\n                                    // Cleanup linked mode\n                                    className : Dialogs.DIALOG_BTN_CLASS_NORMAL,\n                                    id        : Dialogs.DIALOG_BTN_CANCEL,\n                                    text      : BracketsStrings.CANCEL\n                                },\n                                {\n                                    // Retry download\n                                    className : Dialogs.DIALOG_BTN_CLASS_PRIMARY,\n                                    id        : Dialogs.DIALOG_BTN_OK,\n                                    text      : BracketsStrings.OK\n                                }\n                            ];\n\n                            doRetryRequest = true;\n                        } else if (err === Strings.STATIC_CONTENT_SERVICE_ERROR) {\n                            // Tried to extract unsupported layer(s) from a static PSD\n                            // Buttons: OK\n                            buttons = [\n                                {\n                                    // Exit linked mode\n                                    className : Dialogs.DIALOG_BTN_CLASS_PRIMARY,\n                                    id        : Dialogs.DIALOG_BTN_CANCEL,\n                                    text      : BracketsStrings.OK\n                                }\n                            ];\n                        } else {\n                            // SVG or unsupported file format for this layer\n                            // Buttons: Rename and Cancel\n                            buttons = [\n                                {\n                                    // Cleanup linked mode\n                                    className : Dialogs.DIALOG_BTN_CLASS_NORMAL,\n                                    id        : Dialogs.DIALOG_BTN_CANCEL,\n                                    text      : BracketsStrings.CANCEL\n                                },\n                                {\n                                    // Re-enter linked mode\n                                    className : Dialogs.DIALOG_BTN_CLASS_PRIMARY,\n                                    id        : Dialogs.DIALOG_BTN_OK,\n                                    text      : BracketsStrings.CMD_FILE_RENAME\n                                }\n                            ];\n                        }\n\n                        var retryDialog = Dialogs.showModalDialog(\n                            DefaultDialogs.DIALOG_ID_ERROR,\n                            BracketsStrings.ERROR_SAVING_FILE_TITLE,\n                            StringUtils.format(err, detail),\n                            buttons\n                        );\n\n                        retryDialog.getPromise().done(function (id) {\n                            if (id === Dialogs.DIALOG_BTN_OK) {\n                                if (doRetryRequest) {\n                                    // OK button, retry download\n                                    requestAndWriteFile(decoded, fileExt);\n                                } else {\n                                    // SVG Rename button, re-enter linked mode\n                                    // Set editor selection to file extension\n                                    var options = {\n                                        startOffset: encoded.lastIndexOf(".") + 1,\n                                        endOffset: encoded.length\n                                    };\n\n                                    _enterLinkedMode(encoded, options);\n                                }\n                            } else {\n                                // Exit linked mode\n                                cleanUp();\n                            }\n                        });\n                    });\n                }).fail(function (tryAgain) {\n                    if (tryAgain) {\n                        // not a valid filename, re-enter linked mode to try again\n                        _enterLinkedMode(relPath);\n                        MainViewManager.focusActivePane();\n                    } else {\n                        // Exit linked mode\n                        cleanUp();\n                    }\n                });\n            }\n\n            // linked mode "exit" event handler\n            exitHandler = function (group, doIt, res) {\n                if (beforeRenameCallout) {\n                    beforeRenameCallout.remove();\n                }\n                \n                // Do not attempt to save file if doIt is false (e.g. ESC key)\n                // or if the linked group has no text\n                if (!doIt || !res.text) {\n                    cleanUp();\n                    return;\n                }\n\n                // Strip leading/trailing quotes from url\n                var exec = Constants.RegExp.FILE_EXT.exec(res.text),\n                    fileExt = (exec && exec[1]) || "png",\n                    matches = res.text.match(RE_URL_QUOTED),\n                    relPath = (matches && matches[1]) || res.text,\n                    pathSepIndex = relPath.lastIndexOf("/"),\n                    imagePath = pathSepIndex >= 0 ? relPath.substr(0, pathSepIndex + 1) : "";\n\n                // Save image path prefix\n                CSSHintController.setImagePath(imagePath);\n\n                requestAndWriteFile(relPath, fileExt);\n            };\n\n            linkedGroup.on("exit", exitHandler);\n            linkedModel.setExit(exitLinkedPos);\n\n            _enterLinkedMode(pathText);\n\n            if (keyMap) {\n                // Wrap key map callbacks to CodeMirror.Pass when not at a\n                // marker or when at the exit marker\n                Object.keys(keyMap).forEach(function (key) {\n                    var mapFn = keyMap[key];\n\n                    if (typeof mapFn === "function") {\n                        keyMap[key] = function (cm, linkedMode, marker) {\n                            if (_isExitHandlerPass(linkedMode, marker)) {\n                                return CodeMirror.Pass;\n                            }\n\n                            return mapFn(cm, linkedMode, marker);\n                        };\n                    }\n                });\n\n                linkedModel.addKeyMap(keyMap);\n            }\n            \n            return deferred.promise();\n        }\n\n    });\n    \n    // TODO: submit Brackets pull request to surface this functionality to all Brackets extensions\n    // Init invalid characters string\n    if (brackets.platform === "mac") {\n        _invalidChars = "?*|:";\n    } else if (brackets.platform === "linux") {\n        _invalidChars = "?*|";\n    } else {\n        _invalidChars = "?*:<>\\\\|\\"";\n    }\n\n    return new LinkedRenameController();\n});\n//# sourceURL=/./controllers/LinkedRenameController.js'),
eval('define(\'text!ext/views/templates/code-hint-item-view.html\',[],function () { return \'<script type="text/html" id="hint-view">\\n    <div>\\n        <div class="parfait-hint-helper"></div>\\n        <div class="parfait-hint-icon<% if (type === \\\'image-merged\\\') { %> merged<% } %>"></div>\\n        <% if (displayName) { %>\\n            <div class="parfait-hint-display-name"><%- displayName %></div>\\n        <% } else if (providerType === "css") { %>\\n            <div class="parfait-hint-property"><%- property %>: </div>\\n            <% if (type === "color") { %>\\n                <div class="parfait-hint-color-chip"></div>\\n            <% } else if (type === "gradient") { %>\\n                <div class="parfait-hint-gradient-chip"></div>\\n            <% } %>\\n            <div class="parfait-hint-value" title="<%- value %>"><%- displayValue || value %></div><div class="parfait-hint-property">;</div>\\n        <% } else if (type === "text") { %>\\n            <div class="parfait-hint-value" title="<%- value %>"><%- value %></div>\\n        <% } else { %>\\n            <div class="parfait-hint-property"><%- property %>=&quot;</div><div class="parfait-hint-value" title="<%- value %>"><%- displayValue || value %></div><div class="parfait-hint-property">&quot;</div>\\n        <% } %>\\n        <div class="parfait-hint-value-description"><%= displayDescription %></div>\\n        <% if (displayDescription === null) { %>\\n            <div class="parfait-hint-value-description fallback"><%- property %></div>\\n        <% } %>\\n    </div>\\n    <% if (type === "image" || type === "image-merged") { %>\\n        <div class="parfait-hint-thumbnail-wrapper">\\n            <div class="parfait-hint-thumbnail">\\n                <% if (isMergeLayers) { %>\\n                    <div class="parfait-hint-helper"></div>\\n                    <div class="spinner spin large"></div>\\n                <% } else { %>\\n                    <canvas class="sprite_preview preview" width="120" height="90"></canvas>\\n                <% } %>\\n            </div>\\n            <div class="parfait-hint-error"></div>\\n        </div>\\n    <% } %>\\n</script>\';});\n\n//# sourceURL=/text!ext/views/templates/code-hint-item-view.html'),eval('/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4 */\n/*global define: true, graphite: true, clearTimeout: true, setTimeout: true, clearTimeout: true*/\n\ndefine(\'ext/views/CSSHintView\',[\n    "jquery",\n    "underscore",\n    "backbone",\n    "serverAPI",\n    "ccweb.files.extract/utils/SpriteSheetUtils",\n    "ccweb.files.extract/models/LayerModelMap",\n    "ccweb.files.extract/utils/MeasurementUtil",\n    "ccweb.files.extract/controllers/SelectionController",\n    "ext/Constants",\n    "text!ext/views/templates/code-hint-item-view.html",\n    "ext/strings"\n], function ($, _, Backbone, serverAPI, SpriteSheetUtils, LayerModelMap,\n        MeasurementUtil, SelectionController, Constants, CodeHintItemViewTemplate,\n        Strings) {\n    "use strict";\n\n    var CSSHintView = Backbone.View.extend({\n\n        createTemplate: function (templateId, data) {\n            var srcHTML = $(CodeHintItemViewTemplate).filter(templateId).html(),\n                template = _.template(srcHTML);\n\n            return template(data).trim();\n        },\n\n        initialize: function () {\n            var self = this,\n                type = this.model.get("type");\n\n            this.$el.data("type", type);\n            this.$el.data("hint", this.model.get("hint"));\n            this.$el.data("property", this.model.get("property"));\n            this.$el.data("toHint", function (context) {\n                return self.model.toHint(context);\n            });\n            this.$el.data("isBulkHint", this.model.isBulkHint());\n            \n            this.render();\n\n            if (type === Constants.Hint.IMAGE) {\n                var layerModel = this.model.getLayers()[0],\n                    elem = LayerModelMap.getLayerInfoForId(layerModel.get("layerId")).item,\n                    canvas = elem[0];\n                \n                this.model.set("canvas", canvas);\n                \n                // FIXME can\'t access view or model from PSDCodeHints, embed\n                // toDataURL as jQuery data property\n                this.$el.data("toDataURL", function (type) {\n                    return self.model.toDataURL(type);\n                });\n            }\n        },\n\n        render: function () {\n            var self = this,\n                type = this.model.get("type"),\n                json = this.model.toJSON(),\n                merged = this.model.isMergeLayers();\n\n            this.$el.html(this.createTemplate("#hint-view", json)).addClass("parfait-hint-item");\n\n            if (merged) {\n                this.$el.find(".parfait-hint-icon").addClass("merged");\n            }\n\n            if (type === Constants.Hint.COLOR) {\n                this.$el.find(".parfait-hint-color-chip").css("background-color", json.value);\n            } else if (type === Constants.Hint.GRADIENT) {\n                var gradientValue = json.value;\n\n                // Find the w3c, unprefixed value\n                if (Array.isArray(json.value)) {\n                    // Use the last value by default\n                    gradientValue = gradientValue[gradientValue.length - 1].value;\n\n                    json.value.some(function (elem) {\n                        if (elem.value.indexOf("-") < 0) {\n                            gradientValue = elem.value;\n                            return true;\n                        }\n                    });\n                }\n\n                var gradient = Constants.RegExp.STRIP_VENDOR_PREFIX.exec(gradientValue)[2];\n                this.$el.find(".parfait-hint-gradient-chip").css("background-image", gradient);\n            } else if (type === Constants.Hint.IMAGE) {\n                // Draw async to compute width. This can\'t be done for a DOM\n                // fragment without a parent.\n                window.setTimeout(function () {\n                    self.drawSpriteSheet();\n                });\n            }\n\n            return this;\n        },\n\n        _finishMergedThumbnail: function (data, className, err) {\n            var $spinner = this.$el.find(".spinner");\n\n            // Add checker board\n            this.$el.find(".parfait-hint-thumbnail").addClass("sprite_preview");\n\n            // Remove spinner, add merged thumbnail\n            $spinner.removeClass("spinner spin large")\n                .addClass("parfait-hint-thumbnail-merged");\n\n            if (data) {\n                $spinner.css("background-image", "url(" + data + ")");\n            } else if (className) {\n                $spinner.addClass(className);\n            }\n            \n            var $error = this.$el.find(".parfait-hint-error");\n            $error.text(err);\n            $error.addClass("show");\n        },\n\n        drawSpriteSheet: function () {\n            var self = this;\n            \n            if (this.model.isMergeLayers()) {\n                var psdModel = SelectionController.getPSDModel(),\n                    isLocal = !!psdModel.get("localContent"),\n                    layers = this.model.getLayers(),\n                    $spinner = this.$el.find(".spinner");\n\n                if (isLocal) {\n                    this._finishMergedThumbnail(null, "parfait-hint-offline", Strings.STATIC_CONTENT_SERVICE_ERROR);\n                } else {\n                    // .parfait-hint-thumbnail { width: 120px; height: 90px; }\n                    var options = { scale: 1.0 },\n                        bounds = MeasurementUtil.calcLayerGroupBounds(layers, psdModel),\n                        width = bounds.right - bounds.left,\n                        height = bounds.bottom - bounds.top,\n                        size = Math.max(width, height),\n                        maxSize = (size === width) ? 120 : 90,\n                        scale = maxSize / size;\n\n                    // Cap scaling at 1.0\n                    options.scale = Math.min(scale, options.scale);\n\n                    serverAPI.getDerivedAsset(psdModel, layers, "png-8", options).done(function (data) {\n                        self._finishMergedThumbnail(data);\n                    }).fail(function (err) {\n                        self._finishMergedThumbnail(null, "parfait-hint-offline", Strings.OFFLINE_ERROR);\n                    });\n                }\n            } else {\n                SpriteSheetUtils.renderSpriteModel(this, this.model.get("layerModel"), ".parfait-hint-thumbnail", \'.sprite_preview\', false);\n            }\n        }\n    });\n\n    return CSSHintView;\n\n});\n\n//# sourceURL=/./views/CSSHintView.js'),eval('define(\'text!ext/CSSProperties.json\',[],function () { return \'{\\n    "align-content":               {"values": ["center", "flex-end", "flex-start", "space-around", "space-between", "stretch"]},\\n    "align-items":                 {"values": ["baseline", "center", "flex-end", "flex-start", "stretch"]},\\n    "align-self":                  {"values": ["auto", "baseline", "center", "flex-end", "flex-start", "stretch"]},\\n    "animation":                   {"values": []},\\n    "animation-delay":             {"values": []},\\n    "animation-direction":         {"values": ["alternate", "alternate-reverse", "normal", "reverse"]},\\n    "animation-duration":          {"values": []},\\n    "animation-fill-mode":         {"values": ["backwards", "both", "forwards", "none"]},\\n    "animation-iteration-count":   {"values": ["infinite"]},\\n    "animation-name":              {"values": ["none"]},\\n    "animation-play-state":        {"values": ["paused", "running"]},\\n    "animation-timing-function":   {"values": ["cubic-bezier(.42, 0, .58, 1)", "ease", "ease-in", "ease-in-out", "ease-out", "linear", "step-end", "step-start", "steps()"]},\\n    "backface-visibility":         {"values": ["hidden", "visible"]},\\n    "background":                  {"types": ["image","color"], "values": []},\\n    "background-attachment":       {"values": ["fixed", "local", "scroll", "inherit"]},\\n    "background-clip":             {"values": ["border-box", "content-box", "padding-box", "inherit"]},\\n    "background-color":            {"types": ["color"], "values": ["currentColor", "transparent", "inherit"]},\\n    "background-image":            {"types": ["image"], "values": ["image()", "linear-gradient()", "radial-gradient()", "repeating-linear-gradient()", "repeating-radial-gradient()", "url()"]},\\n    "background-origin":           {"values": ["border-box", "content-box", "padding-box", "inherit"]},\\n    "background-position":         {"values": ["left", "center", "right", "bottom", "top"]},\\n    "background-repeat":           {"values": ["no-repeat", "repeat", "repeat-x", "repeat-y", "round", "space"]},\\n    "background-size":             {"values": ["auto", "contain", "cover"]},\\n    "border":                      {"types": ["color"], "values": []},\\n    "border-collapse":             {"values": ["collapse", "separate", "inherit"]},\\n    "border-color":                {"types": ["color"], "values": ["currentColor", "transparent", "inherit"]},\\n    "border-spacing":              {"values": ["inherit"]},\\n    "border-style":                {"values": ["dashed", "dotted", "double", "groove", "hidden", "inset", "none", "outset", "ridge", "solid", "inherit"]},\\n    "border-bottom":               {"types": ["color"], "values": []},\\n    "border-bottom-color":         {"types": ["color"], "values": ["current", "transparent", "inherit"]},\\n    "border-bottom-left-radius":   {"values": []},\\n    "border-bottom-right-radius":  {"values": []},\\n    "border-bottom-style":         {"values": ["dashed", "dotted", "double", "groove", "hidden", "inset", "none", "outset", "ridge", "solid", "inherit"]},\\n    "border-bottom-width":         {"values": ["medium", "thin", "thick", "inherit"]},\\n    "border-image":                {"types": ["image"], "values": [ "url()" ]},\\n    "border-image-outset":         {"values": []},\\n    "border-image-slice":          {"values": []},\\n    "border-image-source":         {"values": []},\\n    "border-image-repeat":         {"values": ["repeat", "round", "space", "stretch"]},\\n    "border-image-width":          {"values": ["auto"]},    \\n    "border-left":                 {"types": ["color"], "values": []},\\n    "border-left-color":           {"types": ["color"], "values": ["currentColor", "transparent", "inherit"]},\\n    "border-left-style":           {"values": ["dashed", "dotted", "double", "groove", "hidden", "inset", "none", "outset", "ridge", "solid", "inherit"]},\\n    "border-left-width":           {"values": ["medium", "thin", "thick", "inherit"]},\\n    "border-radius":               {"values": []},\\n    "border-right":                {"types": ["color"], "values": []},\\n    "border-right-color":          {"types": ["color"], "values": ["currentColor", "transparent", "inherit"]},\\n    "border-right-style":          {"values": ["dashed", "dotted", "double", "groove", "hidden", "inset", "none", "outset", "ridge", "solid", "inherit"]},\\n    "border-right-width":          {"values": ["medium", "thin", "thick", "inherit"]},\\n    "border-top":                  {"types": ["color"], "values": []},\\n    "border-top-color":            {"types": ["color"], "values": ["currentColor", "transparent", "inherit"]},\\n    "border-top-left-radius":      {"values": []},\\n    "border-top-right-radius":     {"values": []},\\n    "border-top-style":            {"values": ["dashed", "dotted", "double", "groove", "hidden", "inset", "none", "outset", "ridge", "solid", "inherit"]},\\n    "border-top-width":            {"values": ["medium", "thin", "thick", "inherit"]},\\n    "border-width":                {"values": ["medium", "thin", "thick", "inherit"]},\\n    "box-decoration-break":        {"values": []},\\n    "box-shadow":                  {"values": []},\\n    "box-sizing":                  {"values": ["border-box", "content-box", "padding-box", "inherit"]},\\n    "bottom":                      {"values": ["auto", "inherit"]},\\n    "break-after":                 {"values": ["always", "auto", "avoid", "avoid-column", "avoid-page", "avoid-region", "column", "left", "page", "region", "right"]},\\n    "break-before":                {"values": ["always", "auto", "avoid", "avoid-column", "avoid-page", "avoid-region", "column", "left", "page", "region", "right"]},\\n    "break-inside":                {"values": ["auto", "avoid", "avoid-column", "avoid-page", "avoid-region"]},\\n    "caption-side":                {"values": ["bottom", "top", "inherit"]},\\n    "clear":                       {"values": ["both", "left", "none", "right", "inherit"]},\\n    "clip":                        {"values": ["auto", "inherit"]},\\n    "color":                       {"types": ["color"], "values": ["inherit"]},\\n    "columns":                     {"values": []},\\n    "column-count":                {"values": []},\\n    "column-fill":                 {"values": ["auto", "balance"]},\\n    "column-gap":                  {"values": ["normal"]},\\n    "column-rule":                 {"types": ["color"], "values": []},\\n    "column-rule-color":           {"types": ["color"], "values": ["currentColor"]},\\n    "column-rule-style":           {"values": ["dashed", "dotted", "double", "groove", "hidden", "inset", "none", "outset", "ridge", "solid", "inherit"]},\\n    "column-rule-width":           {"values": ["medium", "thin", "thick", "inherit"]},\\n    "column-span":                 {"values": ["all", "none"]},\\n    "column-width":                {"values": ["auto", "inherit"]},\\n    "content":                     {"values": ["attr()", "close-quote", "no-close-quote", "no-open-quote", "normal", "none", "open-quote", "inherit"]},\\n    "counter-increment":           {"values": ["none", "inherit"]},\\n    "counter-reset":               {"values": ["none", "inherit"]},\\n    "cursor":                      {"values": ["auto", "crosshair", "e-resize", "default", "help", "move", "n-resize", "ne-resize", "nw-resize", "pointer", "progress", "s-resize", "se-resize", "sw-resize", "text", "w-resize", "wait", "inherit"]},\\n    "direction":                   {"values": ["ltr", "rtl", "inherit"]},\\n    "display":                     {"values": ["block", "flex", "grid", "inline", "inline-block", "inline-flex", "inline-grid", "inline-table", "list-item", "none", "run-in", "table", "table-caption", "table-cell", "table-column", "table-column-group", "table-footer-group", "table-header-group", "table-row", "table-row-group", "inherit"]},\\n    "empty-cells":                 {"values": ["hide", "show", "inherit"]},\\n    "filter":                      {"values": ["blur()", "brightness()", "contrast()", "custom()", "drop-shadow()", "grayscale()", "hue-rotate()", "invert()", "none", "opacity()", "sepia()", "saturate()", "url()"]},\\n    "flex":                        {"values": ["auto", "initial", "none"]},\\n    "flex-basis":                  {"values": ["auto"]},\\n    "flex-direction":              {"values": ["column", "column-reverse", "row", "row-reverse"]},\\n    "flex-flow":                   {"values": ["column", "column-reverse", "nowrap", "row", "row-reverse", "wrap", "wrap-reverse"]},\\n    "flex-grow":                   {"values": []},\\n    "flex-shrink":                 {"values": []},\\n    "flex-wrap":                   {"values": ["nowrap", "wrap", "wrap-reverse"]},\\n    "float":                       {"values": ["left", "right", "none", "inherit"]},\\n    "flow-into":                   {"types": ["named-flow"], "values": ["none"]},\\n    "flow-from":                   {"types": ["named-flow"], "values": ["none", "inherit"]},\\n    "font":                        {"values": []},\\n    "font-family":                 {"values": ["cursive", "fantasy", "inherit", "monospace", "sans-serif", "serif"]},\\n    "font-feature-settings":       {"values": ["normal"]},\\n    "font-kerning":                {"values": ["auto", "none", "normal"]},\\n    "font-language-override":      {"values": ["normal"]},\\n    "font-size":                   {"values": []},\\n    "font-size-adjust":            {"values": ["auto", "none"]},\\n    "font-stretch":                {"values": ["condensed", "expanded", "extra-condensed", "extra-expanded", "normal", "semi-condensed", "semi-expanded", "ultra-condensed", "ultra-expanded"]},\\n    "font-style":                  {"values": ["italic", "normal", "oblique"]},\\n    "font-synthesis":              {"values": ["none", "style", "weight"]},\\n    "font-variant":                {"values": ["normal", "small-caps", "inherit"]},\\n    "font-variant-alternates":     {"values": ["normal"]},\\n    "font-variant-caps":           {"values": ["normal", "small-caps", "all-small-caps", "petite-caps", "all-petite-caps", "unicase", "titling-caps"]},\\n    "font-variant-east-asian":     {"values": ["normal"]},\\n    "font-variant-ligatures":      {"values": ["normal", "none"]},\\n    "font-variant-numeric":        {"values": ["normal"]},\\n    "font-variant-position":       {"values": ["normal", "sub", "super"]},\\n    "font-weight":                 {"values": ["bold", "bolder", "lighter", "normal", "100", "200", "300", "400", "500", "600", "700", "800", "900", "inherit"]},\\n    "height":                      {"values": ["auto", "inherit"]},\\n    "hyphens":                     {"values": ["auto", "manual", "none"]},\\n    "image-orientation":           {"values": []},\\n    "image-resolution":            {"values": ["from-image", "snap"]},\\n    "justify-content":             {"values": ["center", "flex-end", "flex-start", "space-around", "space-between"]},\\n    "left":                        {"values": ["auto", "inherit"]},\\n    "letter-spacing":              {"values": ["normal", "inherit"]},\\n    "line-height":                 {"values": ["normal", "inherit"]},\\n    "list-style":                  {"types": ["image"], "values": ["armenian", "circle", "decimal", "decimal-leading-zero", "disc", "georgian", "inherit", "inside", "lower-alpha", "lower-greek", "lower-latin", "lower-roman", "none", "outside", "square", "upper-alpha", "upper-latin", "upper-roman", "url()"]},\\n    "list-style-image":            {"types": ["image"], "values": ["none", "url()", "inherit"]},\\n    "list-style-position":         {"values": ["inside", "outside", "inherit"]},\\n    "list-style-type":             {"values": ["armenian", "circle", "decimal", "decimal-leading-zero", "disc", "georgian", "lower-alpha", "lower-greek", "lower-latin", "lower-roman", "none", "square", "upper-alpha", "upper-latin", "upper-roman", "inherit"]},\\n    "margin":                      {"values": ["auto", "inherit"]},\\n    "margin-bottom":               {"values": ["auto", "inherit"]},\\n    "margin-left":                 {"values": ["auto", "inherit"]},\\n    "margin-right":                {"values": ["auto", "inherit"]},\\n    "margin-top":                  {"values": ["auto", "inherit"]},\\n    "max-height":                  {"types": ["height"], "values": ["none", "inherit"]},\\n    "max-width":                   {"types": ["width"], "values": ["none", "inherit"]},\\n    "min-height":                  {"types": ["height"], "values": ["inherit"]},\\n    "min-width":                   {"types": ["width"], "values": ["inherit"]},\\n    "object-fit":                  {"values": ["contain", "cover", "fill", "none", "scale-down"]},\\n    "object-position":             {"values": ["left", "center", "right", "bottom", "top"]},\\n    "opacity":                     {"values": ["inherit"]},\\n    "order":                       {"values": []},\\n    "orphans":                     {"values": ["inherit"]},\\n    "outline":                     {"types": ["color"], "values": ["inherit"]},\\n    "outline-color":               {"types": ["color"], "values": ["invert", "inherit"]},\\n    "outline-offset":              {"values": ["inherit"]},\\n    "outline-style":               {"values": ["dashed", "dotted", "double", "groove", "hidden", "inset", "none", "outset", "ridge", "solid", "inherit"]},\\n    "outline-width":               {"values": ["medium", "thin", "thick", "inherit"]},\\n    "overflow":                    {"values": ["auto", "hidden", "scroll", "visible", "inherit"]},\\n    "overflow-x":                  {"values": ["auto", "hidden", "scroll", "visible", "inherit"]},\\n    "overflow-y":                  {"values": ["auto", "hidden", "scroll", "visible", "inherit"]},\\n    "padding":                     {"values": ["inherit"]},\\n    "padding-bottom":              {"values": []},\\n    "padding-left":                {"values": []},\\n    "padding-right":               {"values": []},\\n    "padding-top":                 {"values": []},\\n    "page-break-after":            {"values": ["always", "auto", "avoid", "left", "right", "inherit"]},\\n    "page-break-before":           {"values": ["always", "auto", "avoid", "left", "right", "inherit"]},\\n    "page-break-inside":           {"values": ["auto", "avoid", "inherit"]},\\n    "perspective":                 {"values": ["none"]},\\n    "perspective-origin":          {"values": ["bottom", "center", "left", "right", "top"]},\\n    "pointer-events":              {"values": ["all", "auto", "fill", "inherit", "none", "painted", "stroke", "visible", "visibleFill", "visiblePainted", "visibleStroke"]},\\n    "position":                    {"values": ["absolute", "fixed", "relative", "static", "sticky", "inherit"]},\\n    "quotes":                      {"values": ["none", "inherit"]},\\n    "region-break-after":          {"values": ["always", "auto", "avoid", "avoid-column", "avoid-page", "avoid-region", "column", "left", "page", "region", "right"]},\\n    "region-break-before":         {"values": ["always", "auto", "avoid", "avoid-column", "avoid-page", "avoid-region", "column", "left", "page", "region", "right"]},\\n    "region-break-inside":         {"values": ["auto", "avoid", "avoid-column", "avoid-page", "avoid-region"]},\\n    "region-fragment":             {"values": ["auto", "break"]},\\n    "resize":                      {"values": ["both", "horizontal", "none", "vertical", "inherit"]},\\n    "right":                       {"values": ["auto", "inherit"]},\\n    "src":                         {"values": [ "url()"]},\\n    "shape-inside":                {"values": ["auto", "circle()", "ellipse()", "inherit", "outside-shape", "polygon()", "rectangle()"]},\\n    "shape-outside":               {"values": ["auto", "circle()", "ellipse()", "inherit", "polygon()", "rectangle()"]},\\n    "table-layout":                {"values": ["auto", "fixed", "inherit"]},\\n    "text-align":                  {"values": ["center", "left", "justify", "right", "inherit"]},\\n    "text-align-last":             {"values": ["center", "left", "justify", "right", "inherit"]},\\n    "text-decoration":             {"types": ["color"], "values": ["line-through", "none", "overline", "underline", "inherit"]},\\n    "text-decoration-color":       {"types": ["color"], "values": ["currentColor"]},\\n    "text-decoration-line":        {"values": ["line-through", "none", "overline", "underline"]},\\n    "text-decoration-skip":        {"values": ["edges", "ink", "none", "objects", "spaces"]},\\n    "text-decoration-style":       {"values": ["dashed", "dotted", "double", "solid", "wavy"]},\\n    "text-emphasis":               {"types": ["color"], "values": []},\\n    "text-emphasis-color":         {"types": ["color"], "values": ["currentColor"]},\\n    "text-emphasis-position":      {"values": ["above", "below", "left", "right"]},\\n    "text-emphasis-style":         {"values": ["circle", "dot", "double-circle", "filled", "none", "open", "sesame", "triangle"]},\\n    "text-indent":                 {"values": ["inherit"]},\\n    "text-overflow":               {"values": ["clip", "ellipsis", "inherit"]},\\n    "text-shadow":                 {"values": []},\\n    "text-transform":              {"values": ["capitalize", "full-width", "lowercase", "none", "uppercase", "inherit"]},\\n    "text-underline-position":     {"values": ["alphabetic", "auto", "below", "left", "right"]},\\n    "top":                         {"values": ["auto", "inherit"]},\\n    "transform":                   {"values": ["matrix()", "matrix3d()", "none", "perspective()", "rotate()", "rotate3d()", "rotateX()", "rotateY()", "rotateZ()", "scale()", "scale3d()", "scaleX()", "scaleY()", "scaleZ()", "skewX()", "skewY()", "translate()", "translate3d()", "translateX()", "translateY()", "translateZ()"]},\\n    "transform-origin":            {"values": ["bottom", "center", "left", "right", "top"]},\\n    "transform-style":             {"values": ["flat", "preserve-3d"]},\\n    "transition":                  {"values": []},\\n    "transition-delay":            {"values": []},\\n    "transition-duration":         {"values": []},\\n    "transition-property":         {"values": ["all", "none"]},\\n    "transition-timing-function":  {"values": ["cubic-bezier(.42, 0, .58, 1)", "ease", "ease-in", "ease-in-out", "ease-out", "linear", "step-end", "step-start", "steps()"]},\\n    "unicode-bidi":                {"values": ["bidi-override", "embed", "normal", "inherit"]},\\n    "unicode-range":               {"values": []},\\n    "vertical-align":              {"values": ["baseline", "bottom", "middle", "sub", "super", "text-bottom", "text-top", "top", "inherit"]},\\n    "visibility":                  {"values": ["collapse", "hidden", "visible", "inherit"]},\\n    "white-space":                 {"values": ["normal", "nowrap", "pre", "pre-line", "pre-wrap", "inherit"]},\\n    "widows":                      {"values": ["inherit"]},\\n    "width":                       {"values": ["auto", "inherit"]},\\n    "word-break":                  {"values": ["normal", "break-all", "keep-all"]},\\n    "word-spacing":                {"values": ["normal", "inherit"]},\\n    "word-wrap":                   {"values": ["break-word", "normal"]},\\n    "z-index":                     {"values": ["auto", "inherit"]}\\n}\\n\\n\';});\n\n//# sourceURL=/text!ext/CSSProperties.json'),eval('/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4, maxerr: 50, regexp: true */\n/*global define, brackets, graphite*/\n\ndefine(\'ext/controllers/CSSHintProvider\',[\n    "jquery",\n    "ext/controllers/BaseHintProvider",\n    "ext/controllers/CSSHintController",\n    "ext/controllers/LinkedRenameController",\n    "ext/views/CSSHintView",\n    "text!ext/CSSProperties.json",\n    "ext/views/EditorCalloutView",\n    "ext/models/BracketsPreferencesModel",\n    "ext/Constants",\n    "ext/strings"\n], function ($, BaseHintProvider, CSSHintController, LinkedRenameController, CSSHintView, CSSPropertiesJSON,\n             EditorCalloutView, BracketsPreferencesModel, Constants, Strings) {\n    "use strict";\n\n    var _                   = brackets.getModule("thirdparty/lodash"),\n        CodeMirror          = brackets.getModule("thirdparty/CodeMirror2/lib/codemirror"),\n        AppInit             = brackets.getModule("utils/AppInit"),\n        ExtensionLoader     = brackets.getModule("utils/ExtensionLoader"),\n        CodeHintManager     = brackets.getModule("editor/CodeHintManager"),\n        CSSUtils            = brackets.getModule("language/CSSUtils"),\n        StringMatch         = brackets.getModule("utils/StringMatch"),\n        LiveDevelopment     = brackets.getModule("LiveDevelopment/LiveDevelopment"),\n        CSSDocument         = brackets.getModule("LiveDevelopment/Documents/CSSDocument"),\n        CSSCodeHints,       // this is loaded through a special hack below, in AppReady handler\n        cssPropertiesMap    = JSON.parse(CSSPropertiesJSON);\n\n    var prefs = BracketsPreferencesModel.get("preferenceSystem"),\n        RE_URL = /(url\\()(.+)(\\)(;)?)$/,\n        RE_PREPROCESSOR_TRIGGERS = /^[:\\(]$/,\n        PRIMARY_TRIGGER_KEYS = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ-()",\n        callout;    // show the callout at most once per hinting session;\n\n    function _getMarkerPos(marker) {\n        var markerFind = marker.find(),\n            pos = markerFind.to || markerFind;\n\n        return { line: pos.line, ch: pos.ch };\n    }\n\n    function shouldShowCallout(editor, cursor, implicitChar) {\n        var cm = editor._codeMirror,\n            currentToken = cm.getTokenAt(cursor),\n            state = currentToken.state || currentToken.state.localState,\n            context = state && state.context;\n        \n        // as far as I can tell context.top for a given cursor position in a CSS or SCSS file means that CM\n        // sees the currsor context at the top of it\'s parsing tree, \n        // thus outside of any CSS rule body or variable declaration\n        return !implicitChar && context && context.type === "top";\n    }\n\n    function _showCallout(cm, pos, messageStr, prefKey) {\n        var callout = new EditorCalloutView({\n            codeMirror: cm,\n            templateId: "#callout",\n            message: messageStr,\n            pos: pos\n        });\n\n        // Click handler for beforeRenameCallout button\n        callout.once("dismiss", function () {\n            if (prefKey) {\n                prefs.set(prefKey, true);\n            }\n        });\n\n        cm.addWidget(pos, callout.el, null, "above");\n        callout.updatePosition();\n\n        return callout;\n    }\n    \n    var CSSHintProvider = BaseHintProvider.extend({\n        \n        defaults: {\n            lastContext: null,\n            exclusion: null\n        },\n        \n        initialize: function () {\n            this._updateLivePreview = this._updateLivePreview.bind(this);\n            this._implicitChar = null;\n        },\n        \n        /** Refresh Live Preview CSS display in cases where text hasn\'t actually changed */\n        _updateLivePreview: function () {\n            if (!this.editor) {\n                return;\n            }\n\n            // Ask CSSAgent to reload the CSS, picking up the newly created image\n            var liveDoc = LiveDevelopment.getLiveDocForPath(this.editor.document.file.fullPath);\n            if (liveDoc && (liveDoc instanceof CSSDocument)) {\n                liveDoc.onChange();\n            }\n        },\n\n        /**\n         * Check whether the exclusion is still the same as text after the cursor. \n         * If not, reset it to null.\n         *\n         * @param {boolean} propNameOnly\n         * true to indicate that we update the exclusion only if the cursor is inside property name context.\n         * Otherwise, we also update exclusion for property value context.\n         */\n        updateExclusion: function (propNameOnly) {\n            var textAfterCursor,\n                exclusion = this.get("exclusion");\n            \n            if (exclusion && this.info) {\n                if (this.info.context === CSSUtils.PROP_NAME) {\n                    textAfterCursor = this.info.name.substr(this.info.offset);\n                } else if (!propNameOnly && this.info.context === CSSUtils.PROP_VALUE) {\n                    textAfterCursor = this.info.value.substr(this.info.offset);\n                }\n                \n                if (!CodeHintManager.hasValidExclusion(exclusion, textAfterCursor)) {\n                    this.set("exclusion", null);\n                }\n            }\n        },\n\n        _getQuery: function () {\n            var query = "",\n                offset = this.info.offset,\n                context = this.info.context;\n\n            if (context === CSSUtils.PROP_NAME) {\n                query = this.info.name;\n            } else if (context === CSSUtils.PROP_VALUE) {\n                if (!this.info.isNewItem && this.info.index !== -1) {\n                    // Cursor is in an existing property value or partially typed value\n                    query = this.info.values[this.info.index].trim();\n                }\n            } else {\n                // No context from CSSUtils implies invalid syntax (or unsupported preprocessor)\n                var token = this.editor._codeMirror.getTokenAt(this.cursor, true);\n                query = token.string;\n                offset = (this.cursor.ch - token.start);\n            }\n\n            // Get the query from the start of the token to the cursor position\n            query = query.substr(0, offset);\n\n            if (!context) {\n                // Invalid syntax, strip special characters to approximate a query token\n                query = query.replace(RE_PREPROCESSOR_TRIGGERS, "").trim();\n            }\n\n            return query;\n        },\n\n        _getValue: function () {\n            if (this.info.context !== CSSUtils.PROP_VALUE) {\n                return "";\n            }\n\n            // collect existing value\n            var i,\n                val = "";\n\n            for (i = 0; i <= this.info.index && i < this.info.values.length; i++) {\n                if (i < this.info.index) {\n                    val += this.info.values[i];\n                } else {\n                    val += this.info.values[i].substring(0, this.info.offset);\n                }\n            }\n\n            return val;\n        },\n\n        _isURLStartContext: function () {\n            return this._getValue().indexOf("url(") === 0;\n        },\n\n        /**\n         * @private\n         * Modified from CSSCodeHints CssPropHints.hasHints()\n         */\n        _hasHints: function (editor, implicitChar) {\n            // Initialize hint-session state for plain CSS code hints, which we\'ll include in our getHints() results below\n            CSSCodeHints.cssPropHintProvider.hasHints(editor, implicitChar);\n\n            this.set("lastContext", null);\n            this.editor = editor;\n            this.cursor = this.editor.getCursorPos();\n            this.info = CSSUtils.getInfoAtPos(editor, this.cursor);\n          \n            // check the editor context, show callout\n            // when hints are invoked outside of a CSS rule\n            var hideCssSyntaxMessage = prefs.get(BracketsPreferencesModel.HIDE_CSS_SYNTAX_MESSAGE),\n                cm = editor._codeMirror;\n            \n            if (callout) {\n                callout.remove();\n                callout = null;\n            }\n            \n            if (!hideCssSyntaxMessage && shouldShowCallout(editor, editor.getCursorPos(), implicitChar)) {\n                // show callout and return false, as there are no hints to show.\n                callout = _showCallout(\n                    cm,\n                    editor.getCursorPos(),\n                    Strings.HINTS_HEADSUP,\n                    BracketsPreferencesModel.HIDE_CSS_SYNTAX_MESSAGE\n                );\n                \n                return false;\n            }\n\n            var query = this._getQuery(),\n                isPropName = this.info.context === CSSUtils.PROP_NAME,\n                isValue = this.info.context === CSSUtils.PROP_VALUE,\n                hasHints = BaseHintProvider.prototype.hasHints.call(this, editor, implicitChar),\n                isUnknownProperty = (!hasHints && isPropName),\n                contextName;\n\n            if (isUnknownProperty || this._isURLStartContext()) {\n                return false;\n            }\n\n            // Only show implicit hints for property names\n            if (implicitChar) {\n                this.updateExclusion(false);\n                if (isPropName) {\n                    // Check if implicitChar is the first character typed before an existing property name.\n                    if (!this.get("exclusion") && this.info.offset === 1 && implicitChar === this.info.name[0]) {\n                        this.set("exclusion", this.info.name.substr(this.info.offset));\n                    }\n                }\n            }\n            \n            var allStyles = CSSHintController.getStyles();\n\n            if (!allStyles.length) {\n                // No styles for the current selection\n                return false;\n            } else if (query.length === 0) {\n                // Query is empty and any styles found for current selection.\n                // Return hints only when explicitly activated or when ":" activates\n                // value hints\n                return (implicitChar === null) || (implicitChar === ":");\n            }\n\n            if (isPropName) {\n                if (this.info.offset === 0) {\n                    this.set("exclusion", this.info.name);\n                } else {\n                    this.updateExclusion(true);\n                }\n\n                contextName = "property";\n            } else if (isValue) {\n                contextName = "value";\n            } else {\n                // Allow hinting for values when inside invalid syntax\n                // i.e. CSSUtils returned an unknown context\n                return RE_PREPROCESSOR_TRIGGERS.exec(implicitChar) !== null;\n            }\n\n            if (!contextName) {\n                return false;\n            }\n\n            // TODO StringMatcher\n            return allStyles.some(function (model) {\n                var data = model.get(contextName),\n                    hint = Array.isArray(data) ? data.join("") : data;\n\n                return hint.toLowerCase().indexOf(query) >= 0;\n            });\n        },\n\n        /**\n         * Determines whether CSS propertyname or -name hints are available in the current editor\n         * context.\n         * \n         * @param {Editor} editor \n         * A non-null editor object for the active window.\n         *\n         * @param {String} implicitChar \n         * Either null, if the hinting request was explicit, or a single character\n         * that represents the last insertion and that indicates an implicit\n         * hinting request.\n         *\n         * @return {Boolean} \n         * Determines whether the current provider is able to provide hints for\n         * the given editor context and, in case implicitChar is non- null,\n         * whether it is appropriate to do so.\n         */\n        hasHints: function (editor, implicitChar) {\n            var result = this._hasHints(editor, implicitChar);\n\n            if (result) {\n                // hasHints is only called once before a session begins\n                graphite.events.trigger("css-hint-show", {\n                    context: this.info.context || "undefined",\n                    implicitChar: implicitChar !== null\n                });\n            }\n\n            return result;\n        },\n\n        /**\n         * Returns a list of availble CSS property name or value hints if possible for the current\n         * editor context. \n         * \n         * @param {Editor} implicitChar \n         * Either null, if the hinting request was explicit, or a single character\n         * that represents the last insertion and that indicates an implicit\n         * hinting request.\n         *\n         * @return {jQuery.Deferred|{\n         *              hints: Array.<string|jQueryObject>,\n         *              selectInitial: boolean}}\n         * Null if the provider wishes to end the hinting session. Otherwise, a\n         * response object that provides:\n         * 1. a sorted array hints that consists of strings\n         * 2. a boolean that indicates whether the first result, if one exists,\n         *    should be selected by default in the hint list window.\n         */\n        getHints: function (implicitChar) {\n            this._implicitChar = implicitChar;\n            this.cursor = this.editor.getCursorPos();\n            this.info = CSSUtils.getInfoAtPos(this.editor, this.cursor);\n\n            var propertyName = this.info.name,\n                propertyInfo = cssPropertiesMap[propertyName],\n                query = this._getQuery(),\n                context = this.info.context || CSSUtils.PROP_VALUE,\n                contextName,\n                hints = [],\n                selectInitial = false,\n                showAllValues = false;\n\n            if (!propertyInfo) {\n                // Unknown property name, show all values\n                showAllValues = true;\n            }\n\n            // Clear the exclusion if the user moves the cursor with left/right arrow key.\n            this.updateExclusion(true);\n\n            // Disable hints for "url(" prefix\n            if (this._isURLStartContext()) {\n                context = null;\n            }\n\n            if (context === CSSUtils.PROP_VALUE) {\n                contextName = "value";\n\n                // Kill code hints when entering a close paren.\n                // Close parentheses appear in some value hitns like urls and\n                // gradients. Instead of filtering by this implicit character\n                // we force code hints to exit.\n                if (implicitChar === ")") {\n                    return false;\n                }\n\n                // Always select initial value\n                selectInitial = true;\n\n                // When switching from a NAME to a VALUE context, restart the session\n                // to give other more specialized providers a chance to intervene.\n                if (this.get("lastContext") === CSSUtils.PROP_NAME) {\n                    return true;\n                } else {\n                    this.set("lastContext", CSSUtils.PROP_VALUE);\n                }\n\n                if (propertyInfo) {\n                    // Add color hints\n                    if (propertyInfo.types.color) {\n                        hints = hints.concat(CSSHintController.getColorValues());\n                    }\n\n                    // Add image hints\n                    if (propertyInfo.types.image) {\n                        hints = hints.concat(CSSHintController.getImageValues());\n                    }\n\n                    // Add height\n                    if (propertyInfo.types.height) {\n                        hints = hints.concat(CSSHintController.getMeasurementValues(null, { measurmentType: "height" }));\n                    }\n\n                    // Add width\n                    if (propertyInfo.types.width) {\n                        hints = hints.concat(CSSHintController.getMeasurementValues(null, { measurmentType: "width" }));\n                    }\n                }\n\n                // Add values based on propertyName\n                var allStyles = CSSHintController.getStyles();\n                _.each(allStyles, function (model) {\n                    if (showAllValues || model.get("property") === propertyName) {\n                        hints.push(model);\n                    }\n                });\n\n                // Remove duplicates\n                hints = _.uniq(hints, function (model) {\n                    return model.get("value");\n                });\n            } else if (context === CSSUtils.PROP_NAME) {\n                contextName = "property";\n                this.set("lastContext", CSSUtils.PROP_NAME);\n\n                hints = CSSHintController.getStyles();\n\n                // Select initial property if anything has been typed\n                if (PRIMARY_TRIGGER_KEYS.indexOf(implicitChar) !== -1 || propertyName !== "") {\n                    selectInitial = true;\n                }\n            }\n\n            // Filter by query string (property or value)\n            if (contextName && hints.length) {\n                hints = _.filter(hints, function (model) {\n                    var hintValue = model.get(contextName),\n                        displayDescription = model.get("displayDescription");\n\n                    // Don\'t show value hints that are arrays\n                    if (Array.isArray(hintValue) && (context === CSSUtils.PROP_VALUE)) {\n                        return false;\n                    }\n\n                    var matchesHint = (hintValue && hintValue.toLowerCase().indexOf(query) >= 0),\n                        matchesDesc = (displayDescription && displayDescription.toLowerCase().indexOf(query) >= 0);\n\n                    return matchesHint || matchesDesc;\n                });\n            }\n\n            if (hints.length) {\n                // Sort\n                hints = hints.sort(this.hintModelCompare);\n\n                var className = (context === CSSUtils.PROP_VALUE) ? "parfait-hint-hide-property" : "";\n\n                // Convert to code hint view\n                hints = _.map(hints, function (model) {\n                    return new CSSHintView({ model: model, className: className }).$el;\n                });\n            }\n\n            // Mix in plain CSS code hints results as well\n            var plainCSSHints = CSSCodeHints.cssPropHintProvider.getHints(implicitChar);\n            if (plainCSSHints && plainCSSHints.hints) {\n                hints = hints.concat(plainCSSHints.hints.map(function (plainHint) {\n                    var $plainHint = plainHint.jquery ? plainHint : $(plainHint),\n                        indentWrapper = $("<span class=\'parfait-plain-hint\'></span>")\n                            .text(plainHint.text())\n                            .data("plainHint", true);\n                    return indentWrapper;\n                }));\n            }\n\n            if (hints.length) {\n                return {\n                    hints: hints,\n                    selectInitial: selectInitial\n                };\n            }\n            return null;\n        },\n\n        /**\n         * See CSSCodeHints/main.js CssPropHints\n         * Inserts a given CSS property name or value hint into the current editor context. \n         * \n         * @param {string} hint \n         * The hint to be inserted into the editor context.\n         * \n         * @return {boolean|{keepHints:boolean, from:Pos, to:Pos}} \n         */\n        _insertStringHint: function (hint) {\n            var offset = this.info.offset,\n                cursor = this.editor.getCursorPos(),\n                start = {line: -1, ch: -1},\n                end = {line: -1, ch: -1},\n                keepHints = false,\n                adjustCursor = false,\n                newCursor,\n                ctx;\n\n            start.line = end.line = cursor.line;\n            start.ch = cursor.ch - offset;\n\n            if (this.info.context === CSSUtils.PROP_NAME) {\n                var textAfterCursor = this.info.name.substr(this.info.offset),\n                    exclusion = this.get("exclusion");\n                \n                if (this.info.name.length === 0 || CodeHintManager.hasValidExclusion(exclusion, textAfterCursor)) {\n                    end.ch = start.ch + offset;\n\n                    if (exclusion) {\n                        adjustCursor = true;\n                        newCursor = { line: cursor.line,\n                                      ch: start.ch + hint.length - 1 };\n                        this.set("exclusion", null);\n                    }\n                } else {\n                    // It\'s a replacement of an existing one or just typed in property.\n                    // So we need to check whether there is an existing colon following \n                    // the current property name. If a colon already exists, then we also \n                    // adjust the cursor position and show code hints for property values.\n                    end.ch = start.ch + this.info.name.length;\n                }\n            } else {\n                if (!this.info.isNewItem && this.info.index !== -1) {\n                    // Replacing an existing property value or partially typed value\n                    end.ch = start.ch + this.info.values[this.info.index].length;\n                } else {\n                    // Inserting a new property value\n                    end.ch = start.ch;\n                }\n            }\n\n            // HACK (tracking adobe/brackets#1688): We talk to the private CodeMirror instance\n            // directly to replace the range instead of using the Document, as we should. The\n            // reason is due to a flaw in our current document synchronization architecture when\n            // inline editors are open.\n            var cm = this.editor._codeMirror,\n                splitLines = hint.split("\\n"),\n                lineCount = splitLines.length,\n                lastLine = start.line + lineCount - 1,\n                lastChar = splitLines[lineCount - 1].length,\n                iLine,\n                markerPos,\n                marker,\n                startLineOffset = 0;\n\n            // Skip indent of first line if on a partial token\n            if (this._getQuery()) {\n                startLineOffset = 1;\n            }\n\n            if (lineCount === 1) {\n                lastChar += start.ch;\n            }\n\n            cm.operation(function () {\n                cm.replaceRange(hint, start, end);\n\n                if (adjustCursor) {\n                    this.editor.setCursorPos(newCursor);\n                }\n\n                // CodeMirror.indentLine() does not return the new line range.\n                // Use a marker to track the end position after indenting.\n                markerPos = {\n                    line: lastLine,\n                    ch: lastChar\n                };\n                marker = cm.setBookmark(markerPos);\n\n                for (iLine = start.line + startLineOffset; iLine <= lastLine; iLine++) {\n                    cm.indentLine(iLine);\n                }\n\n                // get end position after indenting\n                markerPos = marker.find();\n                marker.clear();\n            });\n\n            return {\n                keepHints: keepHints,\n                from: start,\n                to: markerPos\n            };\n        },\n\n        /**\n         * @private\n         */\n        _insertExitChar: function (toInsert, pos) {\n            var offset = 0;\n\n            if (toInsert) {\n                // This operation triggers an exiting change event\n                this.editor.document.replaceRange(toInsert, pos, pos);\n                offset = toInsert.length;\n            }\n\n            // Move cursor after inserted char\n            this.editor.setCursorPos({ line: pos.line, ch: pos.ch + offset });\n        },\n\n        /**\n         * Inserts a given CSS property name or value hint into the current editor context. \n         * \n         * @param {String|jQuery} hint \n         * The hint to be inserted into the editor context.\n         * \n         * @return {Boolean} \n         * Indicates whether the manager should follow hint insertion with an\n         * additional explicit hint request.\n         */\n        insertHint: function ($hint) {\n            var self = this;\n\n            // If it\'s a plain CSS hint from Brackets core, delegate to that insertion code\n            if ($hint.data("plainHint")) {\n                return CSSCodeHints.cssPropHintProvider.insertHint($hint.text());\n            }\n\n            var isStringHint = !$hint.data,\n                toHint = (isStringHint) ? function () { return $hint; } : $hint.data("toHint"),\n                hintText = toHint(this.info.context),\n                insertResult = this._insertStringHint(hintText),\n                property = !isStringHint && $hint.data("property"),\n                hintType = !isStringHint && $hint.data("type"),\n                isBulkHint = $hint.data("isBulkHint"),\n                matches = hintText.match(RE_URL);\n\n            // In bare value hints e.g. `property: <hint here>`, we may not\n            // have a property in the hint data. Use property name from user\'s\n            // CSS code in this case\n            property = property || this.info.name;\n\n            graphite.events.trigger("css-hint-insert", {\n                property: property,\n                context: this.info.context || "undefined",\n                hintType: hintType,\n                isBulkHint: isBulkHint,\n                implicitChar: this._implicitChar !== null\n            });\n\n            // Enter linked mode when hint includes "url(...)"\n            if (matches) {\n                var range = {\n                    from: new CodeMirror.Pos(insertResult.from.line, insertResult.from.ch + matches.index + matches[1].length),\n                    to: new CodeMirror.Pos(insertResult.to.line, insertResult.to.ch - matches[3].length)\n                };\n\n                var keyMap = {\n                    name: "exitKeyMap",\n                    "\')\'": function (cm, linkedMode, marker) {\n                        // url([marker])[expcted cursor];\n                        var pos = _getMarkerPos(marker);\n\n                        // advance marker end character +1 to move past close paren\n                        pos.ch += 1;\n\n                        self._insertExitChar(null, pos);\n                        linkedMode.exit(false, true);\n                    },\n                    "\',\'": function (cm, linkedMode, marker) {\n                        // url([marker]),[expcted cursor];\n                        var pos = _getMarkerPos(marker);\n\n                        // advance marker end character +1 to move past close paren\n                        pos.ch += 1;\n\n                        self._insertExitChar(",", pos);\n                    },\n                    "\'}\'": function (cm, linkedMode, marker) {\n                        // url([marker]);\n                        // }[expcted cursor]\n                        var exitPos = _getMarkerPos(linkedMode.exitPosition.marker);\n\n                        // Move cursor to the exit pos before inserting char\n                        self.editor.setCursorPos({ line: exitPos.line, ch: exitPos.ch });\n\n                        // TODO (jasonsj): CSSUtil to get the rule range and\n                        // to find optional existing close curly brace\n                        self.editor.document.replaceRange("\\n}", exitPos, exitPos);\n\n                        // indent the new inserted line\n                        cm.indentLine(exitPos.line + 1);\n                    },\n                    "\';\'": function (cm, linkedMode, marker) {\n                        var endsWithSemicolon = (hintText.charAt(hintText.length - 1) === ";");\n\n                        if (endsWithSemicolon) {\n                            linkedMode.exit(true, true);\n                        } else {\n                            var targetMarker = linkedMode.exitPosition.marker,\n                                pos = _getMarkerPos(targetMarker);\n\n                            self._insertExitChar(";", pos);\n                        }\n                    }\n                };\n\n                // TODO correct exit position if semicolon is not on the current\n                // line nor inserted via the hint text\n                var renamePromise = LinkedRenameController.enterLinkedMode(this.editor, matches[2], $hint.data("toDataURL"), range, insertResult.to, keyMap);\n\n                renamePromise.done(function () {\n                    self._updateLivePreview();\n                });\n            }\n\n            return insertResult.keepHints;\n        },\n        \n        hintModelCompare: function (a, b) {\n            // Special case for vendor prefixes\n            if (a.get("type") === Constants.Hint.GRADIENT && b.get("type") === Constants.Hint.GRADIENT) {\n                var aValue = a.get("value"),\n                    bValue = b.get("value"),\n                    aIsArray = Array.isArray(aValue),\n                    bIsArray = Array.isArray(bValue);\n                \n                // Sort array gradient values (i.e. vendor prefixes) lower\n                // than singular values (w3c)\n                if (aIsArray && !bIsArray) {\n                    return 1;\n                } else if (!aIsArray && bIsArray) {\n                    return -1;\n                }\n            }\n            \n            return BaseHintProvider.prototype.hintModelCompare.call(this, a, b);\n        }\n\n    });\n    \n    // Populate data types for CSS properties\n    _.each(cssPropertiesMap, function (propertyData, propertyName) {\n        if (!propertyData.types) {\n            propertyData.types = {};\n            return;\n        }\n        \n        var typesSet = {};\n        \n        _.each(propertyData.types, function (type) {\n            typesSet[type] = true;\n        });\n        \n        propertyData.types = typesSet;\n    });\n\n    \n    // Get a reference to the default Brackets "plain CSS" code hints provider\n    AppInit.appReady(function () {\n        var r = ExtensionLoader.getRequireContextForExtension("CSSCodeHints");\n        CSSCodeHints = r("main");\n    });\n    \n    return CSSHintProvider;\n});\n\n//# sourceURL=/./controllers/CSSHintProvider.js'),
eval('/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4, maxerr: 50, regexp: true */\n/*global define, brackets, graphite*/\n\ndefine(\'ext/controllers/HTMLHintProvider\',[\n    "jquery",\n    "ccweb.files.extract/Constants",\n    "ext/controllers/BaseHintProvider",\n    "ext/controllers/CSSHintController",\n    "ext/controllers/LinkedRenameController",\n    "ext/views/CSSHintView",\n    "ccweb.files.extract/controllers/SelectionController"\n], function ($, ParfaitConstants, BaseHintProvider, CSSHintController, LinkedRenameController, CSSHintView, SelectionController) {\n    "use strict";\n    \n    var _                   = brackets.getModule("thirdparty/lodash"),\n        CodeMirror          = brackets.getModule("thirdparty/CodeMirror2/lib/codemirror"),\n        AppInit             = brackets.getModule("utils/AppInit"),\n        ExtensionLoader     = brackets.getModule("utils/ExtensionLoader"),\n        HTMLUtils           = brackets.getModule("language/HTMLUtils"),\n        HTMLCodeHints;      // this is loaded through a special hack below, in AppReady handler\n    \n    var RE_SRC = /(src=[\\"\\\']?)([^\\"\\\']+\\.[^\\"\\\']+)([\\"\\\'].*)?$/,\n\n        TEXT_ATTR_MAP = {\n            "alt": true,\n            "placeholder": true,\n            "title": true,\n            "value": true\n        };\n    \n    var HTMLHintProvider = BaseHintProvider.extend({\n\n        initialize: function () {\n            this._implicitChar = null;\n        },\n        \n        _getTextLayers: function (layers) {\n            layers = layers || SelectionController.getSelectedLayers();\n            \n            // Text hints appear for element textContent and for specific attributes\n            return layers.filter(function (layerModel) {\n                if (layerModel.get("properties").layerType === ParfaitConstants.Type.LAYER_TEXT) {\n                    return layerModel;\n                }\n            });\n        },\n        \n        _isTextHint: function (textLayers) {\n            var tokenType = this.tagInfo.position.tokenType,\n                attrName = this.tagInfo.attr && this.tagInfo.attr.name,\n                isTokenAttrValue = (tokenType === HTMLUtils.ATTR_VALUE),\n                isTextNode = false,\n                isTextAttribute = false;\n            \n            textLayers = textLayers || this._getTextLayers();\n            \n            if (textLayers.length) {\n                // tokenType is empty when cursor is inside textContent\n                isTextNode = !tokenType;\n\n                // Allow text hints as attribute values\n                isTextAttribute = isTokenAttrValue && TEXT_ATTR_MAP[attrName];\n            }\n            \n            return isTextNode || isTextAttribute;\n        },\n\n        _hasHints: function (editor, implicitChar) {\n            this.editor = editor;\n            \n            // TODO UrlHints\n            // Initialize hint-session state for plain HTML code hints, which we\'ll include in our getHints() results below\n            this._hasTagHints = HTMLCodeHints.tagHintProvider.hasHints(editor, implicitChar);\n            this._hasAttrHints = HTMLCodeHints.attrHintProvider.hasHints(editor, implicitChar);\n            \n            var hasSelectionHints = BaseHintProvider.prototype.hasHints.call(this, editor, implicitChar);\n            \n            if (!hasSelectionHints) {\n                return false;\n            }\n            \n            this.tagInfo = HTMLCodeHints.tagHintProvider.tagInfo;\n                                                   \n            var tokenType = this.tagInfo.position.tokenType,\n                attrName = this.tagInfo.attr && this.tagInfo.attr.name,\n                isTokenAttrValue = (tokenType === HTMLUtils.ATTR_VALUE),\n                isTextHint = this._isTextHint();\n            \n            if (isTextHint) {\n                return !implicitChar;\n            }\n            \n            // Image hints are provided in the following contexts:\n            // (1) Attribute name/value pair, e.g. [src="path/to/image.jpg"] (TODO? [width="x"] and [height="y"])\n            // (2) img "src" attribute value only, e.g. ["path/to/image.jpg"]\n            if (this.tagInfo.tagName === "img") {\n                if (isTokenAttrValue) {\n                    // Validate (2), [path/to/image.jpg] attribute value hinting\n                    return (attrName === "src") || (attrName === "width") || (attrName === "height");\n                } else {\n                    // Validate (1), [src="..."] attribute name and value hinting\n                    return !this.tagInfo.attr.name || "src".indexOf(this.tagInfo.attr.name) === 0;\n                }\n            }\n            \n            return false;\n        },\n        \n        /**\n         * Only returns true if this provider has unique hints (does not include merged hints)\n         *\n         * @param {Editor} editor \n         * A non-null editor object for the active window.\n         *\n         * @param {string} implicitChar \n         * Either null, if the hinting request was explicit, or a single character\n         * that represents the last insertion and that indicates an implicit\n         * hinting request.\n         *\n         * @return {boolean} \n         * Determines whether the current provider is able to provide hints for\n         * the given editor context and, in case implicitChar is non- null,\n         * whether it is appropriate to do so.\n         */\n        hasHints: function (editor, implicitChar) {\n            var result = this._hasHints(editor, implicitChar);\n\n            if (result) {\n                graphite.events.trigger("html-hint-show", {\n                    context: this.tagInfo.position.tokenType || "text",\n                    implicitChar: implicitChar !== null\n                });\n            }\n\n            return result;\n        },\n\n        _getQuery: function () {\n            var query;\n\n            if (this.tagInfo.position.tokenType === HTMLUtils.ATTR_NAME) {\n                query = this.tagInfo.attr.name;\n            } else if (this.tagInfo.position.tokenType === HTMLUtils.ATTR_VALUE) {\n                query = this.tagInfo.attr.value;\n            } else if (this.tagInfo.tagName) {\n                query = this.tagInfo.tagName;\n            } else {\n                return null;\n            }\n\n            return query.substr(0, this.tagInfo.offset);\n        },\n        \n        /**\n         * Returns a list of availble HTML tag (full tag), attribute (full attr=value) or text content\n         * hints if possible for the current editor context. \n         * \n         * @param {string} implicitChar \n         * Either null, if the hinting request was explicit, or a single character\n         * that represents the last insertion and that indicates an implicit\n         * hinting request.\n         *\n         * @return {jQuery.Deferred|{\n         *              hints: Array.<string|jQueryObject>,\n         *              selectInitial: boolean}}\n         * Null if the provider wishes to end the hinting session. Otherwise, a\n         * response object that provides:\n         * 1. a sorted array hints that consists of strings\n         * 2. a boolean that indicates whether the first result, if one exists,\n         *    should be selected by default in the hint list window.\n         */\n        getHints: function (implicitChar) {\n            this._implicitChar = implicitChar;\n            this.tagInfo = (provider && provider.tagInfo) || HTMLUtils.getTagInfo(this.editor, this.editor.getCursorPos());\n\n            var self = this,\n                hints = [],\n                provider,\n                providerHints,\n                convertedProviderHints,\n                layers = SelectionController.getSelectedLayers(),\n                textLayers = this._getTextLayers(layers),\n                imgAttrNameAndValueHint = false,\n                imgSrcValueHint = false,\n                tokenType = this.tagInfo.position.tokenType,\n                className = "parfait-hint-hide-description",\n                context = "property";\n\n            // Determine hint context\n            var query = this._getQuery(),\n                isAttrValue = tokenType === HTMLUtils.ATTR_VALUE,\n                isInsideImgTag = this.tagInfo.tagName === "img",\n                isImgSrcAttr = isInsideImgTag && this.tagInfo.attr && (this.tagInfo.attr.name === "src"),\n                isImgAttrNameAndValue = isInsideImgTag && tokenType === HTMLUtils.ATTR_NAME;\n            \n            // Select delegate provider\n            if (this._hasTagHints) {\n                provider = HTMLCodeHints.tagHintProvider;\n            } else if (this._hasAttrHints || isAttrValue) {\n                provider = HTMLCodeHints.attrHintProvider;\n\n                if (isAttrValue) {\n                    // filter by value\n                    context = "value";\n\n                    // hide property name for attr value hints\n                    className += " parfait-hint-hide-property";\n                }\n            }\n            \n            // Fetch hints from delagate provider\n            providerHints = provider && provider.getHints(implicitChar);\n            \n            // Fetch text hints if standard attribute hints are not available\n            if (!providerHints && this._isTextHint(textLayers) && !implicitChar) {\n                hints = hints.concat(CSSHintController.getTextValues(textLayers, isAttrValue));\n            }\n            \n            // Convert plain hints to DOM, use results as query flags for image hints\n            if (providerHints && providerHints.hints) {\n                convertedProviderHints = providerHints.hints.map(function (plainHint) {\n                    var indentWrapper = $("<span class=\'parfait-plain-hint\'></span>")\n                        .text(plainHint)\n                        .data({ provider: provider, plainHint: true });\n\n                    if (!imgAttrNameAndValueHint && isInsideImgTag && self._hasAttrHints) {\n                        // Flag to insert [src|width|hright="..."] if provider includes it\n                        imgAttrNameAndValueHint = isImgAttrNameAndValue &&\n                            (plainHint === "src" || plainHint === "width" || plainHint === "height");\n                    }\n\n                    return indentWrapper;\n                });\n            }\n            \n            // Flag to insert [path/to/image.jpg] for attribute value hinting\n            imgSrcValueHint = isImgSrcAttr && isAttrValue && this.tagInfo.attr;\n            \n            // Add image hints\n            if (imgAttrNameAndValueHint || imgSrcValueHint || isAttrValue) {\n                var models = [];\n                \n                if (imgAttrNameAndValueHint) {\n                    var measurements = CSSHintController.getMeasurementValues(layers);\n                    models = CSSHintController.getImgSrcNameAndValues(layers);\n                    models = models.concat(measurements);\n                } else if (imgSrcValueHint) {\n                    models = CSSHintController.getImgSrcValues(layers);\n                } else if (isInsideImgTag && isAttrValue) {\n                    models = CSSHintController.getMeasurementValues(layers, {\n                        measurmentType: this.tagInfo.attr.name\n                    });\n                }\n\n                hints = hints.concat(models);\n            }\n            \n            // Filter and sort\n            if (hints.length) {\n                if (query) {\n                    hints = hints.filter(function (model) {\n                        return model.get(context).indexOf(query) >= 0;\n                    });\n                }\n    \n                hints = hints.sort(this.hintModelCompare);\n    \n                // Convert to code hint view\n                hints = _.map(hints, function (model) {\n                    model.set("providerType", "html");\n\n                    var view = new CSSHintView({\n                        model: model,\n                        className: className\n                    });\n\n                    // Save HTMLCodeHints.tagHintProvider or HTMLCodeHints.attrHintProvider\n                    // to handle string insertion when hint is selected\n                    return view.$el.data("provider", provider);\n                });\n            }\n            \n            // Merge with delegate providers\n            if (convertedProviderHints) {\n                hints = hints.concat(convertedProviderHints);\n            }\n            \n            return {\n                hints: hints,\n                selectInitial: true\n            };\n        },\n        \n        _insertStringHint: function (hint) {\n            this.editor.document.replaceRange(hint, this.editor.getCursorPos());\n        },\n\n        /**\n         * Inserts a given HTML tag or attribute value hint into the current editor context. \n         * \n         * @param {String|jQuery} hint \n         * The hint to be inserted into the editor context.\n         * \n         * @return {Boolean} \n         * Indicates whether the manager should follow hint insertion with an\n         * additional explicit hint request.\n         */\n        insertHint: function ($hint) {\n            var self = this,\n                provider = $hint.data("provider"),\n                plainHint = $hint.data("plainHint"),\n                result = false,\n                toHint = (plainHint) ? function () { return $hint.text(); } : $hint.data("toHint"),\n                text = toHint(this.tagInfo.position.tokenType),\n                property = !plainHint && $hint.data("property"),\n                hintType = !plainHint && $hint.data("type"),\n                toDataURL = $hint.data("toDataURL"),\n                beforePos = this.editor.getCursorPos();\n\n            if (provider) {\n                // Delegate hint insertion to provider\n                result = provider.insertHint(text);\n            } else {\n                // Basic text insertion (textContent and src value) at current cursor position\n                this._insertStringHint(text);\n            }\n\n            if (plainHint) {\n                return result;\n            }\n\n            graphite.events.trigger("html-hint-insert", {\n                property: property,\n                context: this.tagInfo.position.tokenType,\n                hintType: hintType,\n                implicitChar: this._implicitChar !== null\n            });\n\n            // Enter linked mode when an image hint is selected\n            if (toDataURL) {\n                var line = this.editor.document.getLine(beforePos.line),\n                    indexOf = line.indexOf(text), /* FIXME edge case if the code hint text appears multiple times on this line */\n                    matches = line.match(RE_SRC),\n                    path = matches[2],\n                    leadingText = (matches && matches[1]) || "",\n                    fromCh = matches.index + leadingText.length,\n                    range = {\n                        from: new CodeMirror.Pos(beforePos.line, fromCh),\n                        to: new CodeMirror.Pos(beforePos.line, fromCh + path.length)\n                    },\n                    exitPos = this.editor.getCursorPos();\n\n                var keyMap = {\n                    name: "exitKeyMap",\n                    "\'\\"\'": function (cm, linkedMode, marker) {\n                        // Exit normally\n                        linkedMode.exit(true, true);\n                    },\n                    "\'>\'": function (cm, linkedMode, marker) {\n                        // Handle \'>\' within the src attr value\n                        var markerFind = linkedMode.exitPosition.marker.find(),\n                            markerRange = (markerFind.from) ? markerFind : { from: markerFind, to: markerFind },\n                            afterPos = { line: markerRange.to.line, ch: markerRange.to.ch + 1 };\n\n                        // This operation triggers an exiting change event\n                        self.editor.document.replaceRange(">", afterPos, afterPos);\n\n                        // Move cursor inserted exit char\n                        self.editor.setCursorPos({ line: afterPos.line, ch: afterPos.ch + 1 });\n                    }\n                };\n\n                // Make sure the range passed to link mode is valid.\n                // When the range is not parsed correctly, i.e. not valid, we will see \n                // path === line and leadingText === ""\n                if (matches) {\n                    // TODO update exitPos if matching \'>\' is found\n                    // Note that exitPos is a new position after calling insertHint() on the delegate provider\n                    var renamePromise = LinkedRenameController.enterLinkedMode(self.editor, path, toDataURL, range, exitPos, keyMap);\n                    renamePromise.done(function () {\n                        // TODO how to reload an img tag?\n                        //self._updateLivePreview();\n                    });\n                }\n            }\n\n            return false;\n        }\n    });\n    \n    // Get a reference to the default Brackets built-in HTML code hints provider\n    AppInit.appReady(function () {\n        var r = ExtensionLoader.getRequireContextForExtension("HTMLCodeHints");\n        HTMLCodeHints = r("main");\n    });\n\n    return HTMLHintProvider;\n});\n\n//# sourceURL=/./controllers/HTMLHintProvider.js'),eval('define(\'text!ext/views/templates/callout-view.html\',[],function () { return \'<script type="text/html" id="guided-tutorial-1">\\n    <div class="editor-callout-message"><%= GUIDED_TUTORIAL_1 %></%></div>\\n    <div class="dismiss-button"><%- NEXT %></div>\\n    <div class="tut-progress">\\n        <div class="circle full"/>\\n        <div class="circle"/>\\n        <div class="circle"/>\\n    </div>\\n    <div class="notch"></div>\\n</script>\\n\\n<script type="text/html" id="guided-tutorial-2">\\n    <div class="editor-callout-message"><%= GUIDED_TUTORIAL_2 %></div>\\n    <div class="dismiss-button"><%- NEXT %></div>\\n    <div class="tut-progress">\\n        <div class="circle"/>\\n        <div class="circle full"/>\\n        <div class="circle"/>\\n    </div>\\n    <div class="notch"></div>\\n</script>\\n\\n<script type="text/html" id="guided-tutorial-3">\\n    <div class="editor-callout-message"><%= GUIDED_TUTORIAL_3 %></div>\\n    <div class="dismiss-button"><%- GOT_IT %></div>\\n    <div class="tut-progress">\\n        <div class="circle"/>\\n        <div class="circle"/>\\n        <div class="circle full"/>\\n    </div>\\n    <div class="notch"></div>\\n</script>\';});\n\n//# sourceURL=/text!ext/views/templates/callout-view.html'),eval('/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4 */\n/*global define: true, brackets: true*/\n\ndefine(\'ext/views/CalloutView\',[\n    \'jquery\',\n    \'underscore\',\n    \'backbone\',\n    \'text!ext/views/templates/callout-view.html\',\n    \'ext/strings\'\n], function ($, _, Backbone, CalloutViewTemplate, Strings) {\n    "use strict";\n\n    var AnimationUtils  = brackets.getModule("utils/AnimationUtils"),\n        KeyEvent        = brackets.getModule("utils/KeyEvent"),\n        ViewUtils       = brackets.getModule("utils/ViewUtils");\n\n    var CalloutView = Backbone.View.extend({\n\n        templateId: null,\n        disableRemoveAnimation: false,\n\n        /**\n         * click .dismiss-button: trigger "dismiss" event\n         * click: remove callout from DOM\n         */\n        events: {\n            // FIXME https://git.corp.adobe.com/jhagenst/brackets-parfait-extension/issues/840\n            // Disable implicit removal, forcing user to dismiss callouts explicitly\n            //"click": "remove",\n            "click .dismiss-button": "_handleDismiss"\n        },\n\n        initialize: function (options) {\n            this.$targetElement = options.$targetElement;  // either a DOM element *or* an object with left/right/top/bottom fields\n            this.$viewport = options.$viewport;  // optional\n            this.templateId = options.templateId;\n            this.disableRemoveAnimation = options.disableRemoveAnimation || false;\n            this.dismissLabel = options.dismissLabel || Strings.GOT_IT;\n\n            this.render();\n        },\n\n        createTemplate: function () {\n            var srcHTML = $(CalloutViewTemplate).filter(this.templateId).html(),\n                template = _.template(srcHTML);\n\n            return template(_.extend({ dismissLabel: this.dismissLabel }, Strings)).trim();\n        },\n\n        render: function () {\n            this.$el.empty();\n            \n            // Adapted from Editor.displayErrorMessageAtCursor()\n            // Omits blur, change, cursorActivity, and update event handling\n            // Omits close animation\n            var arrowBelow, targetCoord, popoverRect,\n                top, left, arrowLeft,\n                $messagePopover,\n                POPOVER_MARGIN = 10,\n                POPOVER_ARROW_HALF_WIDTH = 10,\n                POPOVER_ARROW_HALF_BASE = POPOVER_ARROW_HALF_WIDTH + 3; // 3 is border radius\n            \n            targetCoord = this._findTargetPos();\n            this.targetCoord = targetCoord;  // save for later checks in updatePosition()\n            \n            // Determine if arrow is above or below\n            // Assume popover height is max of 2 lines\n            arrowBelow = (targetCoord.top > 100);\n            \n            // Text is dynamic, so build popover first so we can measure final width\n            $messagePopover = this.$el.addClass("e4b popover-message").appendTo($("body"));\n            if (!arrowBelow) {\n                $("<div/>").addClass("arrowAbove").appendTo($messagePopover);\n                this.$el.addClass("arrowAbove");\n            }\n            $("<div/>").addClass("text").appendTo($messagePopover).html(this.createTemplate());\n            if (arrowBelow) {\n                $("<div/>").addClass("arrowBelow").appendTo($messagePopover);\n                this.$el.addClass("arrowBelow");\n            }\n            \n            // Estimate where to position popover.\n            top = (arrowBelow) ? targetCoord.top - $messagePopover.height() - POPOVER_MARGIN\n                               : targetCoord.bottom + POPOVER_MARGIN;\n\n            // Horizontally center on target\n            var targetWidth = targetCoord.right - targetCoord.left;\n            left = targetCoord.left + ((targetWidth - $messagePopover.width()) / 2);\n            \n            popoverRect = {\n                top:    top,\n                left:   left,\n                height: $messagePopover.height(),\n                width:  $messagePopover.width()\n            };\n            \n            // Popover text and arrow are positioned individually\n            $messagePopover.css({"top": top, "left": left});\n            \n            // Position popover arrow centered\n            arrowLeft = ($messagePopover.width() / 2) - POPOVER_ARROW_HALF_WIDTH;\n\n            if (arrowBelow) {\n                $messagePopover.find(".arrowBelow").css({"margin-left": arrowLeft});\n            } else {\n                $messagePopover.find(".arrowAbove").css({"margin-left": arrowLeft});\n            }\n\n            // Animate open\n            AnimationUtils.animateUsingClass($messagePopover[0], "animateOpen").done(function () {\n                // Make sure we still have a popover\n                if ($messagePopover && $messagePopover.length > 0) {\n                    $messagePopover.addClass("open");\n                }\n            });\n\n            return this;\n        },\n        \n        _findTargetPos: function () {\n            var targetCoord;\n            if (this.$targetElement.jquery) {\n                targetCoord = this.$targetElement.offset();\n                targetCoord.bottom = targetCoord.top + this.$targetElement.height();\n                targetCoord.right = targetCoord.left + this.$targetElement.width();\n            } else {\n                // Handle explicit coordinates\n                targetCoord = this.$targetElement;\n            }\n            \n            if (this.$viewport) {\n                // If a viewport was provided, make sure the target is visible within it. If not, clip pos\n                // to the closest viewport edge.\n                var EDGE_THRESHOLD = 15;\n                var viewportBounds = this.$viewport.offset();\n                viewportBounds.bottom = viewportBounds.top + this.$viewport.height();\n                viewportBounds.right = viewportBounds.left + this.$viewport.width();\n                \n                if (targetCoord.right - viewportBounds.left < EDGE_THRESHOLD) {\n                    targetCoord.left = viewportBounds.left;\n                    targetCoord.right = targetCoord.left;\n                } else if (targetCoord.left - viewportBounds.right > -EDGE_THRESHOLD) {\n                    targetCoord.left = viewportBounds.right;\n                    targetCoord.right = targetCoord.left;\n                }\n                \n                if (targetCoord.bottom - viewportBounds.top < EDGE_THRESHOLD) {\n                    targetCoord.top = viewportBounds.top;\n                    targetCoord.bottom = targetCoord.top;\n                } else if (targetCoord.top - viewportBounds.bottom > -EDGE_THRESHOLD) {\n                    targetCoord.top = viewportBounds.bottom;\n                    targetCoord.bottom = targetCoord.top;\n                }\n            }\n            \n            return targetCoord;\n        },\n        \n        updatePosition: function () {\n            if (!this.targetCoord) {\n                // If we haven\'t finished our first render() yet, no need to do anything here\n                return;\n            }\n            \n            var currentTargetPos = this._findTargetPos();\n            if (currentTargetPos.left !== this.targetCoord.left || currentTargetPos.right !== this.targetCoord.right ||\n                    currentTargetPos.top !== this.targetCoord.top || currentTargetPos.bottom !== this.targetCoord.bottom) {\n                // Avoid re-rendering unless our position has really changed, since a spurious re-render in mid-click can\n                // prevent the click event from firing (mousedown/mouseup occur on differing DOM nodes)\n                this.render();\n            }\n        },\n\n        /**\n         * @private\n         * Triggered when .dismiss-button is clicked. Note that callout is\n         * removed from DOM via click handler for $el.\n         */\n        _handleDismiss: function () {\n            this.trigger("dismiss");\n        },\n\n        remove: function () {\n            var self = this,\n                doRemove = function () {\n                    var $messagePopover = self.$el;\n                    $messagePopover.remove();\n                    $messagePopover = null;\n                };\n\n            if (this.disableRemoveAnimation) {\n                doRemove();\n            } else {\n                AnimationUtils.animateUsingClass(this.el, "animateClose").always(doRemove);\n            }\n\n            this.trigger("remove");\n        }\n    });\n\n    return CalloutView;\n\n});\n//# sourceURL=/./views/CalloutView.js'),eval('define(\'text!ext/html/preferences-dialog.html\',[],function () { return \'<div class="e4b-preferences-dialog template modal hide">\\n    <div class="modal-header">\\n        <h1 class="dialog-title">{{Strings.PREF_DIALOG_TITLE}}</h1>\\n    </div>\\n    <div class="modal-body">\\n        <form class="form-horizontal">\\n            <div class="control-group">\\n                <p class="dialog-message"><strong>{{Strings.PREF_PRIVACY_TITLE}}</strong></p>\\n                <p class="dialog-message">{{{Strings.PREF_PRIVACY_MESSAGE}}}</p>\\n                <label>\\n                    <input type="checkbox" data-target="metricsEnabled" {{#settings.metricsEnabled}}checked{{/settings.metricsEnabled}} />\\n                    {{Strings.PREF_PRIVACY_CHECKBOX_LABEL}}\\n                </label>\\n            </div>\\n        </form>\\n    </div>\\n    <div class="modal-footer">\\n        <a href="{{Strings.EULA_URL}}" class="left">{{Strings.TERMS_OF_USE}}</a>\\n        <button class="dialog-button btn" data-button-id="cancel">{{Strings.CANCEL}}</button>\\n        <button class="dialog-button btn primary" data-button-id="save">{{Strings.DONE}}</button>\\n    </div>\\n</div>\';});\n\n//# sourceURL=/text!ext/html/preferences-dialog.html'),eval('/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4, regexp: true */\n/*global define, brackets, graphite, Mustache*/\ndefine(\'ext/command/CommandHandlers\',[\n    "jquery",\n    "underscore",\n    "backbone",\n    "ccweb.files.extract/main", /*graphite global dependency*/\n    "ccweb.files.extract/controllers/SelectionController",\n    "ext/Constants",\n    "ext/command/Commands",\n    "ext/controllers/CSSHintProvider",\n    "ext/controllers/HTMLHintProvider",\n    "ext/models/BracketsPreferencesModel",\n    "ext/views/CalloutView",\n    "text!ext/html/preferences-dialog.html",\n    "ext/strings"\n], function ($, _, Backbone, ExtractPlugin, SelectionController, Constants,\n        Commands, CSSHintProvider, HTMLHintProvider, BracketsPreferencesModel,\n        CalloutView, preferencesDialogHTML, Strings) {\n    "use strict";\n    \n    var BracketsCommands    = brackets.getModule("command/Commands"),\n        CodeHintManager     = brackets.getModule("editor/CodeHintManager"),\n        CommandManager      = brackets.getModule("command/CommandManager"),\n        Dialogs             = brackets.getModule("widgets/Dialogs"),\n        EditorManager       = brackets.getModule("editor/EditorManager"),\n        KeyBindingManager   = brackets.getModule("command/KeyBindingManager"),\n        Menus               = brackets.getModule("command/Menus");\n\n    var TUTORIAL_EVENT_HIDE = "tutorial-hide",\n        TUTORIAL_EVENT_SELECT_LAYER = "tutorial-select-layer",\n        TUTORIAL_EVENT_CODE_HINT = "tutorial-code-hint",\n        TUTORIAL_EVENT_MEASURE = "tutorial-measurement",\n        TUTORIAL_STEP_STATE_PENDING = "pending",\n        TUTORIAL_STEP_STATE_NEXT = "next",\n        TUTORIAL_STEP_STATE_COMPLETE = "completed",\n        TUTORIAL_STEP_STATE_REMOVED = "removed",\n        TUTORIAL_STEP_STATUS = "tutorial-step-status",\n        TUTORIAL_STEPS_CURRENT = "tutorial-steps-current",\n        TUTORIAL_STEPS_TOTAL = "tutorial-steps-total",\n        TUTORIAL_STEPS_COMPLETED = "tutorial-steps-completed",\n        TUTORIAL_NAVIGATED_RATE = "tutorial-navigated-rate",\n        TUTORIAL_COMPLETED_RATE = "tutorial-completed-rate";\n\n    var STEP_ORDER = [\n        TUTORIAL_EVENT_SELECT_LAYER,\n        TUTORIAL_EVENT_CODE_HINT,\n        TUTORIAL_EVENT_MEASURE\n    ];\n\n    var STEP_STATE_ORDER = [\n        TUTORIAL_STEP_STATE_PENDING,\n        TUTORIAL_STEP_STATE_REMOVED,\n        TUTORIAL_STEP_STATE_NEXT,\n        TUTORIAL_STEP_STATE_COMPLETE\n    ];\n    \n    var prefs = BracketsPreferencesModel.get("preferenceSystem"),\n        cmdGuidedTutorial,\n        tutorialState = _.extend({}, Backbone.Events),\n        tutorialCompletion,\n        $body;\n    \n    function _showSettingsDialog() {\n        var newSettings = {},\n            template = Mustache.render(preferencesDialogHTML, {settings: BracketsPreferencesModel.toJSON(), "Strings": Strings}),\n            dialogStarted = Date.now(),\n            $template = $(template);\n        \n        $template.on("change", "[data-target]:checkbox", function () {\n            var $target = $(this);\n            var attr = $target.attr("data-target");\n            newSettings[attr] = $target.is(":checked");\n        });\n        \n        // TODO other input/select/radio prefs\n//        $template.on("input", "[data-target]:text", function () {\n//            var $target = $(this);\n//            var attr = $target.attr("data-target");\n//            newSettings[attr] = $target.val();\n//        });\n//        $template.on("change", function () {\n//            var $target = $(":selected", this);\n//            var attr = $target.attr("data-target");\n//\n//            if (attr) {\n//                newSettings.set(attr, $target.val());\n//            }\n//        });\n        \n        Dialogs.showModalDialogUsingTemplate($template).done(function (id) {\n            var doSave = id === "save",\n                metricsEnabledValue = newSettings[BracketsPreferencesModel.METRICS_ENABLED];\n            \n            // Special handling for metrics opt-out to trigger final queue flush\n            // and uninstall metrics event handlers. This is intentionally done\n            // before preferences-dialog-closed so that there\'s no question\n            // if we log new events after the checkbox in the dialog is unchecked.\n            if (doSave && (metricsEnabledValue === false)) {\n                prefs.set(BracketsPreferencesModel.METRICS_ENABLED, false);\n                delete newSettings[BracketsPreferencesModel.METRICS_ENABLED];\n            }\n            \n            graphite.events.trigger("preferences-dialog-closed", {\n                duration: Date.now() - dialogStarted\n            });\n            \n            if (!doSave) {\n                return;\n            }\n            \n            // Go through each (non-opt-out) setting and apply it\n            Object.keys(newSettings).forEach(function (setting) {\n                var value = newSettings[setting];\n                \n                if (value !== undefined) {\n                    // Fire event first before saving to preference\n                    // This allows opt-out to be logged before changed\n                    graphite.events.trigger("preference-changed", {\n                        preferenceKey: setting,\n                        preferenceValue: value\n                    });\n\n                    prefs.set(setting, value);\n                }\n            });\n        });\n        \n        graphite.events.trigger("preferences-dialog-opened");\n    }\n\n    function _removeCurrentCallout() {\n        if (tutorialState.currentCallout) {\n            tutorialState.currentCallout.remove();\n            tutorialState.currentCallout = null;\n\n            return true;\n        }\n\n        return false;\n    }\n\n    function _updateCalloutPosition() {\n        if (tutorialState.currentCallout) {\n            tutorialState.currentCallout.updatePosition();\n        }\n    }\n\n    function _hideGuidedTutorial(reason) {\n        if (!_removeCurrentCallout()) {\n            return;\n        }\n\n        cmdGuidedTutorial.setChecked(false);\n\n        // Remove all callout event handlers\n        graphite.events.off("css-hint-show html-hint-show layer-select " +\n            "layerCompChangeComplete first-launch-call-to-action " +\n            "layers-panel-toggle " +\n            "main-toolbar-expanded main-toolbar-collapsed", null, tutorialState);\n        window.removeEventListener("resize", _updateCalloutPosition, true);\n\n        if ($body) {\n            $body.off("panelResizeUpdate", _updateCalloutPosition);\n        }\n\n        // Log metrics\n        var completion = _.extend({ "tutorial-hide-reason": reason }, tutorialCompletion);\n        graphite.events.trigger(TUTORIAL_EVENT_HIDE, completion);\n    }\n\n    function _toggleGuidedTutorial() {\n        if (tutorialState.currentCallout) {\n            // Toggle off\n            tutorialState.trigger(TUTORIAL_EVENT_HIDE, "toggle off");\n        } else {\n            var deferred = new $.Deferred();\n\n            if (tutorialState.drawPreviewFinishPromise) {\n                tutorialState.drawPreviewFinishPromise.then(deferred.resolve);\n            } else {\n                deferred.resolve();\n            }\n\n            deferred.done(function () {\n                // Hardcoded to position the popup on the "This is a PSD..." in\n                // the getting started PSD\n                var $targetElement = $("#layer98"),\n                    psdModel = SelectionController.getPSDModel(),\n                    isLocalContent = (psdModel && psdModel.get("localContent")) || false;\n\n                // Check for the getting started PSD\n                if ($targetElement.length && isLocalContent) {\n                    // Scroll to the top of the getting started PSD\n                    $(".psd-preview-view")[0].scrollTop = 0;\n                } else {\n                    // Target the help button since we can\'t target a user\'s PSD\n                    $targetElement = $(".e4b-help-button");\n                }\n\n                // Toggle on\n                tutorialState.trigger(TUTORIAL_EVENT_SELECT_LAYER, $targetElement);\n                \n                // Reposition callout if window and/or panel size changes\n                window.addEventListener("resize", _updateCalloutPosition, true);\n                $body.on("panelResizeUpdate", _updateCalloutPosition);\n                graphite.events.on("layers-panel-toggle main-toolbar-expanded main-toolbar-collapsed", _updateCalloutPosition, tutorialState);\n\n                cmdGuidedTutorial.setChecked(true);\n            });\n        }\n    }\n\n    function _updateLifetimeMetric(defaultParams, metricName, current) {\n        var previous = defaultParams[metricName],\n            max = Math.max(previous, current);\n\n        // Update tutorial pregression\n        defaultParams[metricName] = max;\n\n        return max;\n    }\n\n    function _logCalloutMetric(eventName, stepState) {\n        var defaultParams = prefs.get(BracketsPreferencesModel.METRICS_DEFAULT_PARAMS),\n            totalSteps = tutorialCompletion[TUTORIAL_STEPS_TOTAL],\n            navigatedSteps = tutorialCompletion[TUTORIAL_STEPS_CURRENT],\n            completedSteps = tutorialCompletion[TUTORIAL_STEPS_COMPLETED],\n            navigatedRate = navigatedSteps / totalSteps,\n            completedRate = completedSteps / totalSteps;\n\n        // Update rates for this tutorial session\n        tutorialCompletion[TUTORIAL_NAVIGATED_RATE] = navigatedRate;\n        tutorialCompletion[TUTORIAL_COMPLETED_RATE] = completedRate;\n\n        // Update max values\n        totalSteps = _updateLifetimeMetric(defaultParams, "tutorialMax.totalSteps", totalSteps);\n        navigatedSteps = _updateLifetimeMetric(defaultParams, "tutorialMax.navigatedSteps", navigatedSteps);\n        completedSteps = _updateLifetimeMetric(defaultParams, "tutorialMax.completedSteps", completedSteps);\n\n        // Update tutorial lifetime rates\n        _updateLifetimeMetric(defaultParams, "tutorialMax.navigatedRate", navigatedSteps / totalSteps);\n        _updateLifetimeMetric(defaultParams, "tutorialMax.completedRate", completedSteps / totalSteps);\n\n        // Update the furthest step reached\n        var maxNavigatedStep = STEP_ORDER[navigatedSteps - 1];\n        defaultParams["tutorialMax.lastNavigatedStep"] = maxNavigatedStep;\n\n        // Update the furthest state reached for this event step\n        var maxParamName = "tutorialMax." + eventName,\n            prevMaxState = defaultParams[maxParamName],\n            prevValue = prevMaxState ? STEP_STATE_ORDER.indexOf(prevMaxState) : 0,\n            currentValue = STEP_STATE_ORDER.indexOf(stepState);\n\n        if (currentValue >= prevValue) {\n            defaultParams[maxParamName] = stepState;\n        }\n\n        // Save prefs\n        prefs.set(BracketsPreferencesModel.METRICS_DEFAULT_PARAMS, defaultParams);\n\n        // Log metric\n        tutorialCompletion[TUTORIAL_STEP_STATUS] = tutorialCompletion[eventName] = stepState;\n        graphite.events.trigger(eventName, tutorialCompletion);\n    }\n    \n    /**\n     * @type {string} eventName\n     * @type {string} nextEventName\n     * @type {!jQueryObject|{left:number, right:number, top:number, bottom:number}} $targetElement\n     * @type {string} templateId\n     * @type {?string} dismissLabel\n     * @type {?string} $viewport\n     */\n    function _createCallout(eventName, nextEventName, $targetElement, templateId, dismissLabel, $viewport) {\n        _removeCurrentCallout();\n\n        var callout  = new CalloutView({\n            $targetElement: $targetElement,\n            $viewport: $viewport,\n            templateId: templateId,\n            disableRemoveAnimation: true,\n            dismissLabel: dismissLabel\n        });\n\n        var _goToNext = function () {\n            if (nextEventName) {\n                var reason = nextEventName === TUTORIAL_EVENT_HIDE ? "done" : undefined;\n                tutorialState.trigger(nextEventName, reason);\n            }\n        };\n\n        // Setup event handlers for metrics, i.e. next | complete | removed\n        callout.once("dismiss", function () {\n            tutorialCompletion[eventName] = TUTORIAL_STEP_STATE_NEXT;\n            _goToNext();\n        });\n\n        callout.once("complete", function () {\n            // When logging COMPLETE, we log whether the user completed all steps\n            tutorialCompletion[TUTORIAL_STEPS_COMPLETED]++;\n\n            tutorialCompletion[eventName] = TUTORIAL_STEP_STATE_COMPLETE;\n            _goToNext();\n        });\n\n        callout.once("remove", function () {\n            callout.off("complete dismiss");\n\n            // Update status when callout is removed\n            var stepState = tutorialCompletion[eventName];\n\n            if (stepState === TUTORIAL_STEP_STATE_PENDING) {\n                // Can only be PENDING if the user didn\'t hit NEXT/GOT_IT or didn\'t complete the task\n                stepState = TUTORIAL_STEP_STATE_REMOVED;\n            }\n\n            // Log metric when current callout is removed\n            _logCalloutMetric(eventName, stepState);\n        });\n\n        tutorialState.currentCallout = callout;\n\n        // Increment callout sequence number\n        tutorialCompletion[TUTORIAL_STEPS_CURRENT]++;\n\n        // Show extra page indicator when needed\n        if (tutorialCompletion[TUTORIAL_STEPS_TOTAL] >= 4) {\n            callout.$el.addClass("show-optional");\n        }\n\n        // Log metric when showing current callout, status = PENDING\n        _logCalloutMetric(eventName, TUTORIAL_STEP_STATE_PENDING);\n\n        return callout;\n    }\n\n    function _completeCallout() {\n        tutorialState.currentCallout.trigger("complete");\n    }\n\n    function _setupTutorial() {\n        var $targetElement;\n\n        // Remove current callout when the route changes\n        graphite.events.on("route-change", function (route) {\n            tutorialState.trigger(TUTORIAL_EVENT_HIDE, "route: " + route);\n            tutorialState.isAssetListView = (route === Constants.Routes.FOLDER);\n            tutorialState.isFirstLaunch = (route === Constants.Routes.FIRST_LAUNCH);\n\n            if (tutorialState.isFirstLaunch) {\n                var deferred = new $.Deferred(),\n                    prefHideFirstLaunchUI = prefs.get(BracketsPreferencesModel.HIDE_FIRST_LAUNCH_PSD);\n\n                tutorialState.drawPreviewFinishPromise = deferred.promise();\n\n                // Wait for PSD to render, then resolve\n                graphite.events.once("drawPreviewFinish", deferred.resolve);\n\n                // Show tutorial on first launch if the user hadn\'t already taken\n                // some call to action (open a psd button or creative url)\n                if (!prefHideFirstLaunchUI) {\n                    _toggleGuidedTutorial();\n                }\n            }\n\n            if (!$body) {\n                $body = $(window.document.body);\n            }\n        });\n\n        // Hide tutorial\n        tutorialState.on(TUTORIAL_EVENT_HIDE, _hideGuidedTutorial);\n\n        // 1 - Show "select layer" prompt\n        tutorialState.on(TUTORIAL_EVENT_SELECT_LAYER, function ($elem) {\n            $targetElement = $elem;\n\n            // Track completion\n            tutorialCompletion = {};\n            tutorialCompletion[TUTORIAL_STEPS_TOTAL] = tutorialState.isFirstLaunch ? 4 : 3;\n            tutorialCompletion[TUTORIAL_STEPS_COMPLETED] = 0;\n            tutorialCompletion[TUTORIAL_STEPS_CURRENT] = 0;\n\n            // Create and render the first callout (prompt to select a layer)\n            _createCallout(TUTORIAL_EVENT_SELECT_LAYER, TUTORIAL_EVENT_CODE_HINT, $targetElement, "#guided-tutorial-1", null, $(".psd-preview-view"));\n            \n            // Show the next callout when the user selects a layer\n            graphite.events.once("layer-select", _completeCallout, tutorialState);\n\n            // Reposition callout if layer comp drop down appears\n            graphite.events.once("layerCompChangeComplete", _updateCalloutPosition, tutorialState);\n        });\n\n        // 2 - Show "code hint" prompt\n        tutorialState.on(TUTORIAL_EVENT_CODE_HINT, function () {\n            // Target the active editor cursor, fallback to help button\n            var editor = EditorManager.getActiveEditor(),\n                target = $(".e4b-help-button");\n\n            if (editor) {\n                // Make sure cursor is in view\n                var cursorPos = editor.getCursorPos();\n                editor._codeMirror.scrollIntoView(cursorPos);\n                editor.focus();\n                \n                target = editor._codeMirror.charCoords(cursorPos);\n            }\n\n            // Prompt to show code hints\n            _createCallout(TUTORIAL_EVENT_CODE_HINT, TUTORIAL_EVENT_MEASURE, target, "#guided-tutorial-2");\n\n            graphite.events.once("css-hint-show html-hint-show", _completeCallout, tutorialState);\n        });\n\n        // 3 - Show "measurement" prompt\n        tutorialState.on(TUTORIAL_EVENT_MEASURE, function () {\n            // Target the current selected layer\n            var selectedLayers = SelectionController.getSelectedLayers(),\n                nextEventName = TUTORIAL_EVENT_HIDE,\n                dismissLabel = Strings.GOT_IT;\n\n            if (selectedLayers.length > 0) {\n                var currentLayer = selectedLayers[0];\n                $targetElement = $("#layer" + currentLayer.get("layerId"));\n            }\n\n            // Prompt to show measurement popup\n            _createCallout(TUTORIAL_EVENT_MEASURE, nextEventName, $targetElement, "#guided-tutorial-3", dismissLabel, $(".psd-preview-view"));\n\n            // End tutorial when user sees measurement popup\n            graphite.events.on("layer-select", function _multipleLayerSelect() {\n                if (SelectionController.getSelectedLayers().length > 1) {\n                    _completeCallout();\n                }\n            }, tutorialState);\n        });\n\n    }\n    \n    // (Hidden) Reset to first launch\n    Commands.register(Strings.RESET_TO_FIRST_LAUNCH, Commands.RESET_ALL, function () {\n        BracketsPreferencesModel.restoreDefaults();\n    });\n    KeyBindingManager.addBinding(Commands.RESET_ALL, "Ctrl-Alt-C");\n\n    // Guided Tutorial\n    cmdGuidedTutorial = Commands.register(Strings.CMD_GUIDED_TUTORIAL, Commands.GUIDED_TUTORIAL, function () {\n        // Navigate to /first_launch if currently on /files (AssetListView)\n        if (tutorialState.isAssetListView) {\n            // This will trigger a route-change, but not the tutorial due to\n            // HIDE_FIRST_LAUNCH_PSD being true (user is logged in)\n            Commands.execute(Commands.HELP_TUTORIAL);\n            return;\n        }\n\n        if (tutorialState.isFirstLaunch) {\n            // When in firstLaunch, running this command resets the tutorial instead of toggling\n            tutorialState.trigger(TUTORIAL_EVENT_HIDE, "reset");\n        }\n\n        _toggleGuidedTutorial();\n    });\n    _setupTutorial();\n    \n    // Preferences Dialog\n    Commands.register(Strings.PREF_DIALOG_TITLE, Commands.PREF_DIALOG, _showSettingsDialog);\n    \n    // Register code hints\n    CodeHintManager.registerHintProvider(new CSSHintProvider(), ["css", "scss", "less"], 10);\n    CodeHintManager.registerHintProvider(new HTMLHintProvider(), ["html"], 6); /* UrlCodeHints=5 */\n    \n    // Refresh code hints if open and PSD layer selection changes\n    // TODO determine the current provider is from PSD Lens\n    graphite.events.on("selection-changed", function () {\n        if (CodeHintManager.isOpen()) {\n            CommandManager.execute(BracketsCommands.SHOW_CODE_HINTS);\n        }\n    });\n});\n\n//# sourceURL=/./command/CommandHandlers.js'),
eval('define(\'text!ext/html/parfait-toolbar.html\',[],function () { return \'<a href="#" id="toolbar-parfait" title="{{EXPLORE_EXTRACT_FOR_BRACKETS}}">\';});\n\n//# sourceURL=/text!ext/html/parfait-toolbar.html'),eval('define(\'text!ext/html/parfait-popup.html\',[],function () { return \'<div id="psdl-firstlaunch-popup" class="e4b-firstlaunch-popup">\\n    {{{FIRSTLAUNCH_POPUP_MSG}}}\\n    <button class="btn primary">{{GOT_IT}}</button>\\n</div>\\n\';});\n\n//# sourceURL=/text!ext/html/parfait-popup.html'),eval('/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4, maxerr: 50 */\n/*global brackets, define, Mustache*/\n\ndefine(\'ext/ParfaitPopup\',[\n    "jquery",\n    "ext/command/Commands",\n    "ext/Constants",\n    "ext/models/ExtensionMetadata",\n    "ext/models/BracketsPreferencesModel",\n    "text!ext/html/parfait-toolbar.html",\n    "text!ext/html/parfait-popup.html",\n    "ext/strings"\n], function ($, Commands, Constants, ExtensionMetadata, BracketsPreferencesModel,\n    parfaitToolbarHtml, firstLaunchPopupHtml, Strings) {\n    "use strict";\n    \n    var MainViewManager     = brackets.getModule("view/MainViewManager");\n    \n    var prefs = BracketsPreferencesModel.get("preferenceSystem"),\n        $toolbarIcon = null,\n        cmdTogglePanel;\n    \n    function closeCallout() {\n        var $callout = $("#psdl-firstlaunch-popup");\n        \n        // Don\'t re-show toolbar callout on next launch (regardless of how it was dismissed)\n        prefs.set(BracketsPreferencesModel.HIDE_FIRST_LAUNCH_TOOLBAR_TOOLTIP, true);\n        \n        // Don\'t animate if already closed - we\'d never be triggered to remove "animateClose", preventing reopen later. Normally,\n        // AnimationUtils\' .is(":hidden") check serves this purpose, but it breaks the animation in this case (see below).\n        if (!$callout.hasClass("animateOpen")) {\n            return;\n        }\n        \n        // Animate out\n        $callout.removeClass("animateOpen");\n        $callout\n            .addClass("animateClose")\n            .one("webkitTransitionEnd", function () {\n                // Normally we\'d use AnimationUtils for this, but due to an apparent Chrome bug, calling .is(":hidden")\n                // causes the animation not to play (even though it returns false and that early-exit branch isn\'t taken).\n                $callout.removeClass("animateClose");\n                $callout.remove();\n            });\n    }\n    \n    function _handleCalloutClick() {\n        closeCallout();\n        MainViewManager.focusActivePane();\n    }\n    \n    function _handleIconClick() {\n        closeCallout();\n        Commands.execute(Commands.TOGGLE_PANEL);\n    }\n    \n    function _updateIconState() {\n        var active = cmdTogglePanel.getChecked();\n        if (active) {\n            $("#toolbar-parfait").addClass("active");\n        } else {\n            $("#toolbar-parfait").removeClass("active");\n        }\n    }\n    \n    function _showFirstLaunchTooltip() {\n        // Bail if we\'ve already shown the tooltip or if this is a bundled build\n        var hideTooltip = prefs.get(BracketsPreferencesModel.HIDE_FIRST_LAUNCH_TOOLBAR_TOOLTIP),\n            isBundledBuild = ExtensionMetadata.isBundledBuild();\n\n        if (hideTooltip || isBundledBuild) {\n            return;\n        }\n        \n        // Add first-launch callout next to toolbar icon (hidden)\n        var NOTCH_TIP_OFFSET = 6,\n            popupTop = $toolbarIcon.offset().top - NOTCH_TIP_OFFSET;\n        var $firstLaunchPopup = $(Mustache.render(firstLaunchPopupHtml, Strings));\n        $firstLaunchPopup.appendTo("body").hide()\n                         .css("top", popupTop)\n                         .find("button").click(_handleCalloutClick);\n        $firstLaunchPopup.show();\n        \n        // Animate in\n        // Must wait a cycle for the "display: none" to drop out before CSS transitions will work\n        setTimeout(function () {\n            $("#psdl-firstlaunch-popup").addClass("animateOpen");\n        }, 0);\n    }\n    \n    function _initParfaitControlsPopup() {\n        $toolbarIcon = $(Mustache.render(parfaitToolbarHtml, Strings));\n        $toolbarIcon.appendTo("#main-toolbar > .buttons");\n        $toolbarIcon.on("click", _handleIconClick);\n        \n        cmdTogglePanel = Commands.get(Commands.TOGGLE_PANEL);\n        $(cmdTogglePanel).on("checkedStateChange", _updateIconState);\n        \n        // Initialize first-launch callout based on preference\n        var firstLaunchTooltipPref = prefs.getPreference(BracketsPreferencesModel.HIDE_FIRST_LAUNCH_TOOLBAR_TOOLTIP);\n        firstLaunchTooltipPref.on("change", _showFirstLaunchTooltip);\n        _showFirstLaunchTooltip();\n    }\n\n    return {\n        initParfaitControlsPopup: _initParfaitControlsPopup\n    };\n});\n//# sourceURL=/./ParfaitPopup.js'),eval('define(\'text!ext/html/main-panel.html\',[],function () { return \'<div id="e4b-main-panel" class="bottom-panel vert-resizable top-resizer">\\n    <div style="overflow: hidden; position: fixed; width: 3px; height: 0px;">\\n        <textarea id="psd-details-input" style="position: absolute; padding: 0; width: 1px; height: 1em; outline: none; font-size: 4px;"></textarea>\\n    </div>\\n    <div class="resizable-content">\\n        <div id="toolbar-placeholder"></div>\\n        <div id="results"></div>\\n    </div>\\n</div>\\n\';});\n\n//# sourceURL=/text!ext/html/main-panel.html'),eval('define(\'text!ext/views/templates/mainToolbarTemplate.html\',[],function () { return \'<div id="get-started-panel" class="toolbar">\\n    <div class="section half">\\n        <div class="section full psd-details-view">\\n            <div id="browse-files"></div>\\n            <div class="title"></div>\\n            <div id="draganddropmessage"></div>\\n        </div>\\n        <div class="section spacer full asset-list-view">\\n            <div id="cc-logo" title="{{EXTENSION_NAME}}"></div>\\n            <div id="section-calltoaction-choice" class="section full-column">\\n                <div class="section full">\\n                    <div id="section-get-started" class="section first-run-section">\\n                        <button id="firstrun-upload-psd" class="btn primary">{{GET_STARTED}}</button>\\n                    </div>\\n\\n                </div>\\n                <div class="section expanded-section">\\n                    <div class="section half expanded-section-contents">\\n                        <div id="section-get-started" class="section first-run-section">\\n                            <p class="expanded-btn-label">{{GET_STARTED_DESCRIPTION}}</p>\\n                            <p class="expanded-btn-label">{{SIGN_UP}}\\n                                <a href="#" id="sign_up">{{SIGN_UP_LINK}}</a>\\n                            </p>\\n                        </div>\\n                    </div>\\n                </div>\\n            </div>\\n        </div>\\n    </div>\\n    <div class="section half">\\n        <div class="section end">\\n            <div class="e4b-main-panel-buttons">\\n                <a class="e4b-help-button" title="{{TOOLBAR_HIDE_HINT}}">&nbsp;</a>\\n                <div class="e4b-selectionbar-placeholder"></div>\\n                <a href="#" class="e4b-settings-icon" title="{{PREF_DIALOG_TITLE}}">&nbsp;</a>\\n                <a href="#" class="e4b-main-panel-close" title="{{CLOSE}}">&times;</a>\\n            </div>\\n        </div>\\n    </div>    \\n</div>\\n\';});\n\n//# sourceURL=/text!ext/views/templates/mainToolbarTemplate.html'),eval('define(\'text!ext/html/login-call-to-action-callout.html\',[],function () { return \'<div id="login-call-to-action-callout" class="e4b-firstlaunch-popup">\\n    <div class="call_to_action_header">\\n        <div class="cclogo"></div>\\n        <div class="call_to_action_title">{{{CALL_TO_ACTION_TITLE}}}</div>\\n    </div>\\n    <div>{{CALL_TO_ACTION_MESSAGE}}</div>\\n    <button class="btn primary">{{CALL_TO_ACTION_BUTTON}}</button>\\n</div>\\n\';});\n\n//# sourceURL=/text!ext/html/login-call-to-action-callout.html'),eval('/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4, maxerr: 50 */\n/*global define, brackets, graphite, Mustache, window */\n\ndefine(\'ext/views/MainToolbarView\',[\n    "jquery",\n    "underscore",\n    "backbone",\n    "ext/command/Commands",\n    "ext/strings",\n    "text!ext/views/templates/mainToolbarTemplate.html",\n    "text!ext/html/login-call-to-action-callout.html",\n    "ext/models/BracketsPreferencesModel",\n    "cceco/CollabServiceAPI",\n    "ext/ims/IMSLibWrapper",\n    "ext/ims/IMSLib",\n    "ext/utils/StatusBarUtil"\n], function ($, _, Backbone, Commands, Strings, MainToolbarTemplate, LoginCalloutTemplate,\n              BracketsPreferencesModel, CollabServiceAPI,\n              IMSLibWrapper, IMSLib, StatusBarUtil) {\n\n    "use strict";\n\n    var Dialogs             = brackets.getModule("widgets/Dialogs"),\n        DefaultDialogs      = brackets.getModule("widgets/DefaultDialogs"),\n        StringUtils         = brackets.getModule("utils/StringUtils");\n\n    var prefs = BracketsPreferencesModel.get("preferenceSystem");\n    \n    var timerTogglePanel,\n        $loginCallOutHTML;\n\n    var MainToolbarView = Backbone.View.extend({\n        \n        //--- Event Map\n        events: {\n            \'click .e4b-help-button\':                   \'_handleHelpButton\',\n            \'click #firstrun-upload-psd\':               \'_handlePSDUploadButton\',\n            \'click #sign_up\':                           \'_handleSignUp\'\n        },\n        \n        _handleHelpButton: function () {\n            Commands.execute(Commands.GUIDED_TUTORIAL);\n        },\n\n        _disableFirstLaunchHelperUI: function () {\n            // next time, don\'t show initial tutorial or expand the toolbar\n            prefs.set(BracketsPreferencesModel.HIDE_FIRST_LAUNCH_PSD, true);\n        },\n\n        // collapses the toolbar if currently expanded\n        _collapseExpandedToolbar: function () {\n            // collapse the expanded toolbar\n            if (this.$mainToolbar.hasClass(\'expanded\')) {\n                if (timerTogglePanel) {\n                    window.clearTimeout(timerTogglePanel);\n                }\n                this.$mainToolbar.removeClass(\'expanded\');\n            }\n        },\n\n        // initiates the first launch call to action\n        _handleCallToAction: function () {\n            var self = this;\n\n            graphite.events.trigger("first-launch-call-to-action");\n\n            this._collapseExpandedToolbar();\n\n            // call back into the main panel to show the files view\n            IMSLibWrapper.getAccessToken().done(function () {\n                self._disableFirstLaunchHelperUI();\n\n                Commands.execute(Commands.SHOW_ASSETS_ROOT);\n            });\n        },\n        \n        // show Sign In Popup\n        _showSignInPopUp: function () {\n            var self = this;\n\n            if (!$loginCallOutHTML) {\n                $loginCallOutHTML = $(Mustache.render(LoginCalloutTemplate, Strings));\n                $loginCallOutHTML.appendTo("body").hide();\n            }\n\n            var $mainPanel = $("#e4b-main-panel");\n            var $loginCallOutButton = $mainPanel.find("#firstrun-upload-psd");\n            var callToActionButtonOffset = $loginCallOutButton.offset();\n\n            // Show callout\n            $loginCallOutHTML.css("top", callToActionButtonOffset.top + $loginCallOutButton.height());\n            $loginCallOutHTML.css("left", callToActionButtonOffset.left);\n            $loginCallOutHTML.show();\n\n            // Animate in\n            // Must wait a cycle for the "display: none" to drop out before CSS transitions will work\n            setTimeout(function () {\n                $loginCallOutHTML.addClass("animateOpen");\n            }, 0);\n\n            $loginCallOutHTML.find("button").one("click", function () {\n            // Animate close\n                $loginCallOutHTML.addClass("animateClose");\n                $loginCallOutHTML.one("webkitTransitionEnd", function () {\n                    // Normally we\'d use AnimationUtils for this, but due to an apparent Chrome bug, calling .is(":hidden")\n                    // causes the animation not to play (even though it returns false and that early-exit branch isn\'t taken).\n                    $loginCallOutHTML.removeClass("animateClose");\n                    $loginCallOutHTML.hide();\n                });\n\n                // Navigate to AssetListView and force login\n                self._handleCallToAction();\n            });\n\n        },\n        \n        _handlePSDUploadButton: function () {\n            //If user is already signed in, dont show the sign-in popup\n\n            var isSignedIn = IMSLibWrapper.isSignedInUser() || IMSLib.isUserSignedIn(),\n                self = this;\n\n            if (isSignedIn) {\n                this._handleCallToAction();\n            } else if (IMSLib.isThorLoggedOut()) {\n                this._showSignInPopUp();\n            } else {\n                IMSLib.getAccessToken().done(function () {\n                    self._handleCallToAction();\n                }).fail(function () {\n                    self._showSignInPopUp();\n                });\n                \n            }\n        },\n        \n        // handle link to sign up for a new Adobe ID\n        _handleSignUp: function (event) {\n            IMSLibWrapper.signUp().done(function () {\n                Commands.execute(Commands.SHOW_ASSETS_ROOT);\n            });\n        },\n\n        _handlePanelHide: function () {\n            if ($loginCallOutHTML) {\n                $loginCallOutHTML.hide();\n            }\n        },\n        \n        //--- Interface methods\n\n        // show/hide the first-run toolbar controls\n        displayFirstRunSection: function (show) {\n            if (show) {\n                this.$mainToolbar.find(".first-run-section").show();\n            } else {\n                this.$mainToolbar.find(".first-run-section").hide();\n            }\n        },\n        \n        // configure the toolbar available with the Asset List view\n        displayAssetListToolbar: function () {\n            this.$mainToolbar.find(".asset-list-view").show();\n            this.$mainToolbar.find(".psd-details-view").hide();\n        },\n        \n        // configure the toolbar available with the PSD Details view\n        displayPSDDetailsToolbar: function () {\n            this.$mainToolbar.find(".asset-list-view").hide();\n            this.$mainToolbar.find(".psd-details-view").show();\n        },\n\n        // initialize the View\n        initialize: function () {\n            var self = this;\n\n            this.$mainToolbar = null;\n\n            this.render();\n\n            graphite.events.on("hide-panel", self._handlePanelHide);\n\n            // Setup event listener for guided tutorial\n            var cmdGuidedTutorial = Commands.get(Commands.GUIDED_TUTORIAL);\n            cmdGuidedTutorial.on("checkedStateChange", function () {\n                var $helpIcon = self.$el.find(".e4b-help-button");\n\n                if (cmdGuidedTutorial.getChecked()) {\n                    $helpIcon.addClass("active");\n                } else {\n                    $helpIcon.removeClass("active");\n                }\n            });\n        },\n\n        // render the View\n        render: function () {\n            // render the template with the localized strings\n            this.$el.html(Mustache.render(MainToolbarTemplate, Strings));\n\n            // remember DOM elements for later reference\n            this.$mainToolbar = this.$el.find("#get-started-panel");\n            \n            return this;\n        },\n\n        remove: function () {\n            this.$el.empty();\n            return Backbone.View.prototype.remove.call(this);\n        }\n\n    });\n\n    return MainToolbarView;\n\n});\n//# sourceURL=/./views/MainToolbarView.js'),eval('/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4, maxerr: 50 */\n/*global define, brackets, graphite, Mustache, window */\n\ndefine(\'ext/MainPanel\',[\n    "jquery",\n    "underscore",\n    "backbone",\n    "ext/command/Commands",\n    "ext/Constants",\n    "ext/ParfaitAPI",\n    "ccweb.files.extract/controllers/SelectionController",\n    "ext/models/BracketsPreferencesModel",\n    "ext/CacheManager",\n    "ext/models/ExtensionMetaData",\n    "ext/ims/IMSLibWrapper",\n    "ext/ims/IMSLib",\n    "text!ext/html/main-panel.html",\n    "ext/views/MainToolbarView",\n    "ccweb.files.extract/Constants",\n    "ext/strings"\n], function ($, _, Backbone, Commands, PSDLensConstants, ParfaitAPI,\n              SelectionController, BracketsPreferencesModel, CacheManager,\n              ExtensionMetaData, IMSLibWrapper, ImsLib, PanelTemplate, MainToolbarView,\n              Constants, Strings) {\n    "use strict";\n\n    var MainViewManager     = brackets.getModule("view/MainViewManager"),\n        Menus               = brackets.getModule("command/Menus"),\n        ProjectManager      = brackets.getModule("project/ProjectManager"),\n        WorkspaceManager    = brackets.getModule("view/WorkspaceManager"),\n        NativeApp           = brackets.getModule("utils/NativeApp");\n\n    var panel,\n        cmdTogglePanel,\n        cmdHelpTutorial,\n        currentRoute,\n        prefs = BracketsPreferencesModel.get("preferenceSystem");\n\n    var $mainPanel,\n        $mainPanelTitle,\n        $mainToolbar,\n        mainToolbarView;\n    \n    function _hideFilesView() {\n        if (!panel.isVisible()) {\n            return;\n        }\n\n        // Abandonment metric\n        graphite.events.trigger("hide-panel");\n        \n        // Hide the panel\n        panel.hide();\n        \n        // call router to destroy views\n        Backbone.history.navigate("hide", true);\n        \n        // Restore UI\n        cmdTogglePanel.setChecked(false);\n        MainViewManager.focusActivePane();\n        WorkspaceManager.recomputeLayout();\n        \n    }\n\n    function showFilesView(showFirstLaunchOverride) {\n        function _doShowPanel(showFirstLaunch) {\n            if (showFirstLaunch) {\n                Backbone.history.navigate("first_launch", true);\n            } else {\n                // navigate to the default route, which is the \n                // AssetListView.\n                // Pass a unique value to the Backbone history\n                // to ensure subsequent routes to AssetView always\n                // execute. This circumnavigates Backbones built in \n                // optimization to not execute a route if it\'s\n                // idenitical with the previous route.\n                Backbone.history.navigate("files/", true);\n            }\n            panel.show();\n            WorkspaceManager.recomputeLayout();\n            cmdTogglePanel.setChecked(true);\n        }\n\n        // check if this is first launch\n        var isAuthorized = graphite.authModel.isValid();\n\n        if (showFirstLaunchOverride || !isAuthorized) {\n            _doShowPanel(true);\n        } else {\n            ParfaitAPI.configureCCProxies().done(function () {\n                _doShowPanel(false);\n            });\n        }\n    }\n\n    function toggle() {\n        if (panel.isVisible()) {\n            _hideFilesView();\n        } else {\n            showFilesView();\n        }\n    }\n    \n    function navigateTo(route) {\n        Backbone.history.navigate(route, true);\n    }\n    \n    /**\n     * @private\n     * call to show either the `Back to Files` or the extension icon in the primary toolbar\n     *\n     * @param {Boolean} showBackBtn `true` to show the "back" button.  `false` to show the extension icon\n     * @param {string} route\n     */\n    function _showBackToFilesIcon(showBackBtn, route) {\n        var $psdlLogoBtn = $mainPanel.find("#cc-logo"),\n            $browseFilesBtn = $mainPanel.find("#browse-files");\n        \n        if (showBackBtn) {\n            $psdlLogoBtn.hide();\n            if (route) {\n                $browseFilesBtn[0].setAttribute("data-route", route);\n            }\n            $browseFilesBtn.show();\n        } else {\n            $psdlLogoBtn.show();\n            $browseFilesBtn.hide();\n        }\n    }\n        \n    function _getAssetCCPath() {\n        // FIXME https://git.corp.adobe.com/jhagenst/brackets-parfait-extension/issues/627\n        var path = Backbone.history.fragment || "files",\n            unencoded;\n\n        path = path.replace(/\\/$/, "");\n        unencoded = decodeURI(path);\n        return unencoded.substring(unencoded.indexOf("files/"), unencoded.length);\n    }\n\n    function _handleRouteChange(newRoute) {\n        var psdPath = _getAssetCCPath(),\n            showFirstRunUI = (newRoute === PSDLensConstants.Routes.FIRST_LAUNCH),\n            showBackToFiles = (newRoute === PSDLensConstants.Routes.ASSET || newRoute === PSDLensConstants.Routes.AUTHLESS_ASSET),\n            isSignedIn = IMSLibWrapper.isSignedInUser() || ImsLib.isUserSignedIn(),\n            title = showBackToFiles ? decodeURIComponent(psdPath.substring(psdPath.lastIndexOf("/") + 1, psdPath.length)) : "";\n        \n        $mainPanelTitle.off();\n        $mainPanelTitle.css("cursor", "default");\n        \n        if (showFirstRunUI) {\n            mainToolbarView.displayFirstRunSection(true);\n        } else {\n            mainToolbarView.displayFirstRunSection(false);\n        }\n\n        if (showBackToFiles) {\n            mainToolbarView.displayPSDDetailsToolbar();\n            // for asset view, delay showing icon until the preview is rendered\n            _showBackToFilesIcon(true, isSignedIn ? currentRoute : "first_launch");\n        } else {\n            mainToolbarView.displayAssetListToolbar();\n            _showBackToFilesIcon(false);\n        }\n\n        $mainPanelTitle.text(title);\n        if (title.match(Constants.RE_SHORT_URL)) {\n            $mainPanelTitle.css("cursor", "pointer");\n            $mainPanelTitle.click(function () {\n                NativeApp.openURLInDefaultBrowser(title);\n            });\n        }\n\n        currentRoute = Backbone.history.fragment;\n    }\n\n    function _handleSignOut() {\n        // TODO disable code hints when logged out\n        _hideFilesView();\n        // on logout clear any cached proxy content\n        CacheManager.purgeCache();\n    }\n\n    function registerMainPanel() {\n        // View > Show Extract for Brackets\n        cmdTogglePanel = Commands.register(Strings.SHOW_EXTRACT_FOR_BRACKETS, Commands.TOGGLE_PANEL, function () {\n            ExtensionMetaData.getAcceptedEULA().done(toggle);\n        });\n\n        // Internal command to show files view\n        // FIXME Use ccweb string for now\n        var rootLabel = "Creative Cloud Assets",\n            showAssetsRootLabel = Strings[rootLabel] || rootLabel;\n        \n        Commands.register(showAssetsRootLabel, Commands.SHOW_ASSETS_ROOT, function () {\n            ExtensionMetaData.getAcceptedEULA().done(showFilesView);\n        });\n        \n        // add Help commands and menu items\n        Commands.register(Strings.MENU_HELP_ONLINE, Commands.HELP_ONLINE, function () {\n            NativeApp.openURLInDefaultBrowser(Strings.HELP_ONLINE_URL);\n        });\n        cmdHelpTutorial = Commands.register(Strings.MENU_HELP_TUTORIAL, Commands.HELP_TUTORIAL, function () {\n            ExtensionMetaData.getAcceptedEULA().done(function () {\n                showFilesView(true);\n\n                // Force tutorial open (could be hidden due to HIDE_FIRST_LAUNCH_PSD pref)\n                Commands.execute(Commands.GUIDED_TUTORIAL);\n            });\n        });\n\n        var menu = Menus.getMenu(Menus.AppMenuBar.HELP_MENU);\n        menu.addMenuDivider();\n        menu.addMenuItem(Commands.HELP_ONLINE);\n        menu.addMenuItem(Commands.HELP_TUTORIAL);\n        menu.addMenuItem(Commands.TOGGLE_AUTH);\n\n        var viewMenu = Menus.getMenu(Menus.AppMenuBar.VIEW_MENU);\n        if (viewMenu) {\n            viewMenu.addMenuItem(Commands.TOGGLE_PANEL, [{\n                // Note: Brackets will write error message to console\n                // about key "Cmd-Alt-/" already being registered on mac.\n                key: "Ctrl-Alt-X"\n            }, {\n                // Define key again explicitly for mac to prevent Brackets\n                // from converting Ctrl to Cmd.\n                key: "Ctrl-Alt-X",\n                platform: "mac"\n            }]);\n        }\n\n        graphite.events.on("route-change", _handleRouteChange);\n        \n        // Add the HTML UI\n        var panelHtml = Mustache.render(PanelTemplate, Strings);\n\n        // AppInit.htmlReady() has already executed before extensions are loaded\n        // so, for now, we need to call this ourself\n        panel = WorkspaceManager.createBottomPanel("e4b.mainpanel", $(panelHtml), 200);\n        panel.hide();\n\n        $mainPanel = $("#e4b-main-panel");\n        \n        // Add the main toolbar view\n        mainToolbarView = new MainToolbarView();\n        $mainToolbar = $mainPanel.find("#toolbar-placeholder");\n        $mainToolbar.replaceWith(mainToolbarView.$el);\n        // Listen for events from toolbar\n        mainToolbarView.$el.on("navigateTo", function (event, url) {\n            navigateTo(url);\n        });\n\n        $mainPanelTitle = $mainPanel.find(".toolbar .title");\n        \n        $mainPanel.find("#browse-files").click(function (event) {\n            var route = event.target.attributes.getNamedItem("data-route").value;\n            navigateTo(route);\n        });\n        \n        // Don\'t let parfait steal focus from CodeMirror or otherwise break its state\n        $mainPanel.on("mouseup", function (event) {\n            if ((document.activeElement === document.body) &&\n                    ($(event.target).parents(".allow-focus").length === 0)) {\n                MainViewManager.focusActivePane();\n            }\n        });\n        \n        // enable close handler\n        $mainPanel.find(".e4b-main-panel-close").click(_hideFilesView);\n        \n        // settings\n        $mainPanel.find(".e4b-settings-icon").click(function () {\n            Commands.execute(Commands.PREF_DIALOG);\n        });\n        \n        SelectionController.clearDOMSelection = function () {};  // see bug #127\n        \n        $(ProjectManager).on("beforeProjectClose", _hideFilesView);\n\n        $(IMSLibWrapper).on("signOut", function () {\n            _handleSignOut();\n        });\n\n        $(ImsLib).on("signOut", function () {\n            _handleSignOut();\n        });\n    }\n\n    return {\n        registerMainPanel: registerMainPanel\n    };\n});\n//# sourceURL=/./MainPanel.js'),eval('/*jslint indent: 2, nomen: true, vars: true, plusplus: true*/\n/*global JSON, document, CodeMirror, console, brackets*/\n// declare global: JSON\n/**\n * Linked mode extension for CodeMirror.\n * Based on Eclipse http://help.eclipse.org/indigo/topic/org.eclipse.platform.doc.isv/reference/api/org/eclipse/jface/text/link/package-summary.html\n *\n * Define groups of ranges in one or more documents that are linked,\n * i.e. edits in one range are mirrored in all other ranges for that group.\n * When using multiple groups, the user may navigate through each group,\n * optionally cycling back to the original position. An optional exit position\n * defines where the cursor should move when editing is complete.\n *\n * Basic usage:\n *\n * // create linked positions/groups\n * var linkedPos1 = new CodeMirror.LinkedPositon(cm.doc, from1, to1);\n * var linkedGroup1 = new CodeMirror.LinkedPositionGroup([linkedPos1, ..., linkedPosN]);\n *\n * // create exit position (usually not a range, so `to` arg is omitted)\n * var exitPos = new CodeMirror.LinkedPosition(cm.doc, new CodeMirror.Pos(...));\n *\n * // create model\n * var model = new CodeMirror.LinkedModeModel([linkedGroup1, ..., linkedGroupN]);\n *\n * // register event handlers\n * // errorCallback(model:LinkedModeModel, err:string)\n * model.on("error", errorCallback);\n *\n * // TODO\n * // focusCallback(model:LinkedModeModel, linkedPosition:LinkedPosition, linkedGroup:LinkedGroup)\n * // cm.on("linkedModeFocus", focusCallback);\n *\n * // TODO\n * // blurCallback(model:LinkedModeModel, linkedPosition:LinkedPosition, linkedGroup:LinkedGroup)\n * // cm.on("linkedModeBlur", blurCallback);\n *\n * // exitCallback(model:LinkedModeModel, doit:boolean, results:array<{group:LinkedPositionGroup, ranges:array<{from:Pos, to:Pos}>, text:string}>)\n * model.on("exit", exitCallback);\n *\n * // enter linked mode\n * cm.enterLinkedMode(model);\n *\n * // exit options\n * cm.setExit(codeMirrorPosition);\n *\n * Advanced usage:\n * - Using LinkedPosition instance from different documents is supported\n * - By default, only the first position in a LinkedPositionGroup is allowed\n *   to be focused on TAB key travsersal. To enable all positions to be\n *   traversed, use the `stopOnAllPositions: boolean` option in the\n *   LinkedPositionGroup contstructor.\n * - LinkedModeModel contstructor options:\n *   - `noCycle: boolean` exit linked mode when the first or exit position is\n *      reached. Default: false.\n *   - `rangeClassName: string` CSS class for a LinkedPosition range.\n *      Default: CodeMirror-linkedmode-range.\n *   - `emptyClassName: string` CSS class for an empty LinkedPosition range.\n *      Default: CodeMirror-linkedmode-empty.\n *\n * Future plans:\n * - Nested linked modes\n * - Error checking for overlapping ranges\n * - linkedModeFocus and linkedModeBlur events\n * - Smart sorting based on LinkedPosition document\n * - Custom exit key codes (IExitPolicy)\n *\n * See demos/linkedmode.html for a more complete usage example.\n */\n(function (mod) {\n  "use strict";\n  // Use this block when running as a generic CodeMirror addon (must sit within the CodeMirror repo)\n  // if (typeof exports == "object" && typeof module == "object") // CommonJS\n  //   mod(require("../../lib/codemirror"));\n  // else if (typeof define == "function" && define.amd) // AMD\n  //   define(["../../lib/codemirror"], mod);\n  // else // Plain browser env\n  //   mod(CodeMirror);\n\n  // Use this when running inside a Brackets extension\n  mod(brackets.getModule("thirdparty/CodeMirror2/lib/codemirror"));\n})(function (CodeMirror) {\n  "use strict";\n  var _currentModel;\n\n  function eventMixin(ctor) {\n    ctor.prototype.on = function (type, f) { CodeMirror.on(this, type, f); };\n    ctor.prototype.off = function (type, f) { CodeMirror.off(this, type, f); };\n  }\n  function makeArray(arr) {\n    return Array.isArray(arr) ? arr : [arr];\n  }\n  function isRangeEmpty(from, to) {\n    if (!from || !to) {\n      return true;\n    }\n    return (from.line === to.line) && (from.ch === to.ch);\n  }\n  function emptyRangeSpan(className) {\n    var span = document.createElement("span");\n    span.className = className;\n    return span;\n  }\n  function findMarker(marker) {\n    var range = marker.find();\n\n    if (!range)\n      return false;\n\n    if (range.from)\n      return range;\n\n    // Convert a bookmark position to a range\n    return { from: range, to: range };\n  }\n  function getMarkerAt(doc, pos, type) {\n    var markers = doc.findMarksAt(pos),\n      found;\n\n    // linked mode markers will not overlap, return the first linked mode marker\n    markers.some(function (marker) {\n      if (marker.linkedPosition && (!type || (marker.type === type))) {\n        found = marker;\n        return true;\n      }\n\n      return false;\n    });\n\n    return found;\n  }\n  function getMarkerAtCursor(cm, type) {\n    return getMarkerAt(cm.getDoc(), cm.getCursor(), type);\n  }\n  function clearMarker(marker) {\n    marker.clear();\n    marker.off("hide");\n    marker.off("unhide");\n  }\n  function LinkedModeModel(groupArray, options) {\n    this.groups = makeArray(groupArray);\n    this.options = {\n      noCycle: (options && options.noCycle) || false,\n      rangeClassName: (options && options.positionClassName) || "CodeMirror-linkedmode-range",\n      emptyClassName: (options && options.exitClassName) || "CodeMirror-linkedmode-empty"\n    };\n\n    this._marks = [];\n    this._codeMirrorInstances = [];\n    this._mapPositionsToGroup = {};\n  }\n  LinkedModeModel.prototype = {\n    _createMarker: function (doc, from, to, linkedPos, index) {\n      var self = this,\n        marker,\n        isBookmark = isRangeEmpty(from, to),\n        editor = doc.getEditor(),\n        group = self._lookupGroup(linkedPos);\n\n      if (isBookmark) {\n        marker = doc.setBookmark(from, { widget: emptyRangeSpan(this.options.emptyClassName) });\n      } else {\n        marker = doc.markText(from, to, {\n          className: this.options.rangeClassName,\n          clearWhenEmpty: false,\n          inclusiveLeft: true,\n          inclusiveRight: true\n        });\n      }\n\n      // Track all CodeMirror instances\n      if (editor && (this._codeMirrorInstances.indexOf(editor) < 0))\n        this._codeMirrorInstances.push(editor);\n\n      // Save all TextMarkers to clear when we exit linked mode\n      this._marks.push(marker);\n\n      marker.linkedPosition = linkedPos;\n\n      // Restore the original marker on undo\n      if (!isBookmark) {\n        marker.on("unhide", function () {\n          linkedPos.marker = marker;\n          self._invalidateSortedPositions();\n        });\n\n        // Restore prior bookmarks\n        var previous = linkedPos.marker;\n        if (previous && previous.type === "bookmark") {\n          marker.on("hide", function () {\n            linkedPos.marker = previous;\n            self._invalidateSortedPositions();\n          });\n        }\n      }\n\n      // Stop on the first marker by default unless specified in options\n      linkedPos.isStop = (index === 0) || !group || (group.options && group.options.stopOnAllPositions);\n\n      return marker;\n    },\n    _handleTabKey: function (cm, dir) {\n      // TAB, move to next linked position\n      var marker = getMarkerAtCursor(cm),\n        nextPosition;\n\n      if (!marker) {\n        // tab key outside all linked positions, always go to first marker\n        nextPosition = this._getSortedPositions()[0];\n      } else {\n        nextPosition = this._nextPosition(marker.linkedPosition, dir);\n      }\n\n      if (nextPosition) {\n        this._goToMarker(nextPosition.marker);\n      } else {\n        this.exit(false, true);\n      }\n    },\n    _buildBaseKeyMap: function () {\n      return {\n        name: "linkedmode",\n        "Shift-Tab": function (cm, linkedMode) {\n          linkedMode._handleTabKey(cm, -1);\n        },\n        "Tab": function (cm, linkedMode) {\n          linkedMode._handleTabKey(cm, 1);\n        },\n        "Esc": function (cm, linkedMode) {\n          // ESC, exit linked mode without changing cursor\n          linkedMode.exit(false, false);\n        },\n        "Enter": function (cm, linkedMode, marker) {\n          // ENTER key, exit linked mode optionally at exit position\n          if (marker) {\n            // Prevent inserting line break, exit immediately\n            linkedMode.exit(true, true);\n          } else {\n            // Allow line break insertion, exit after change event fires\n            linkedMode._setPendingExit(false, true);\n            return CodeMirror.Pass;\n          }\n        }\n      };\n    },\n    addKeyMap: function (keyMap) {\n      var self = this;\n\n      // Wrap key map callbacks to return LinkedModeModel instance\n      Object.keys(keyMap).forEach(function (key) {\n        var mapFn = keyMap[key];\n\n        if (typeof mapFn === "function") {\n          keyMap[key] = function (cm) {\n            return mapFn(cm, self, getMarkerAtCursor(cm));\n          };\n        }\n      });\n\n      // Install keymap for all CodeMirror instances\n      this._codeMirrorInstances.forEach(function (cm) {\n        cm.addKeyMap(keyMap);\n      });\n\n      // Remove keymaps when linked mode exits\n      this.on("exit", function () {\n        self.removeKeyMap(keyMap);\n      });\n    },\n    removeKeyMap: function (keyMap) {\n      this._codeMirrorInstances.forEach(function (cm) {\n        cm.removeKeyMap(keyMap);\n      });\n    },\n    setExit: function (position) {\n      this.exitPosition = position;\n    },\n    _lookupGroup: function (linkedPos) {\n      return this._mapPositionsToGroup[linkedPos];\n    },\n    _setPendingExit: function (goToExit, doIt) {\n      this._pendingExit = {\n        goToExit: goToExit,\n        doIt: doIt\n      };\n    },\n    _onChange: function (cm, changeObj) {\n      if (!this._pendingExit) {\n        return;\n      }\n\n      var params = this._pendingExit;\n      this._pendingExit = null;\n\n      this.exit(params.goToExit, params.doIt);\n    },\n    _onBeforeChange: function (cm, changeObj) {\n      // Prevent overlapping edits\n      // Ignore undo/redo or changes with a line break\n      var self = this,\n        editDoc = cm.getDoc(),\n        hasLineBreak = changeObj.text.length > 1,\n        isUndo = changeObj.origin === "undo",\n        isRedo = changeObj.origin === "redo",\n        changeGeneration = (isUndo) ? self.changeGeneration - 1 : self.changeGeneration,\n        // FIXME editDoc.changeGeneration() is wrong after previous undo? Should use editDoc.isClean(changeGeneration) here\n        isClean = editDoc.changeGeneration() <= changeGeneration;\n\n      if (self.lock || isUndo || isRedo) {\n        // Exit if undoing linkedmode\n        if (isUndo && isClean) {\n          // Do not move to the the exit cursor position\n          self._setPendingExit(false, false);\n        }\n        return;\n      }\n\n      var toMarker = getMarkerAt(editDoc, changeObj.to),\n        fromMarker = getMarkerAt(editDoc, changeObj.from, toMarker && toMarker.type),\n        exitMarker = this.exitPosition.marker,\n        isExit = (fromMarker === exitMarker) || (toMarker === exitMarker),\n        isSameMarker = fromMarker && toMarker && (fromMarker === toMarker),\n        targetRange = fromMarker && findMarker(fromMarker);\n\n      // Exit if (1) changed position is the exit marker, (2) not in any\n      // marker or spans different markers, (3) target marker range is\n      // invalid or (4) change includes a line break\n      if (isExit || !isSameMarker || !targetRange || hasLineBreak) {\n        // Set doIt=false only if the change inserts a line break in a marker.\n        // This can only happen via PASTE. Pressing ENTER in a marker exits\n        // immediately\n        var doIt = true;\n\n        if (isSameMarker && hasLineBreak) {\n          doIt = false;\n        }\n\n        self._setPendingExit(false, doIt);\n        return;\n      }\n\n      // Prevent the new operation from creating an overlapping edit\n      self.lock = true;\n\n      // Update within a marker, cancel this change update update all markers in batch\n      changeObj.cancel();\n\n      // Assumes marker and change are on the same line\n      var group = self._lookupGroup(fromMarker.linkedPosition),\n        offsetStart = changeObj.from.ch - targetRange.from.ch,\n        offsetEnd = changeObj.to.ch - targetRange.to.ch,\n        doReplaceMarker = (offsetStart === 0 && offsetEnd === 0),\n        text = changeObj.text[0],\n        marker,\n        range,\n        from,\n        to;\n\n      // Update all markers in the group\n      cm.operation(function () {\n        group.positions.forEach(function (linkedPos, i) {\n          // We should only have valid ranges\n          marker = linkedPos.marker;\n          range = findMarker(marker);\n\n          if (!range)\n            return;\n\n          // Add offset to range\n          from = new CodeMirror.Pos(range.from.line, range.from.ch += offsetStart);\n          to   = new CodeMirror.Pos(range.to.line,   range.to.ch += offsetEnd);\n\n          marker.doc.replaceRange(text, from, to, changeObj.origin);\n\n          // Replace the old marker if it was hidden due to edits\n          if (doReplaceMarker) {\n            var updateRangeTo = new CodeMirror.Pos(range.from.line, range.from.ch + text.length),\n              replacementMarker = self._createMarker(linkedPos.doc, range.from, updateRangeTo, linkedPos, i);\n\n            linkedPos.marker = replacementMarker;\n          }\n        });\n\n        if (doReplaceMarker)\n          self._invalidateSortedPositions();\n\n        // Release lock\n        self.lock = false;\n      });\n    },\n    _nextPosition: function (currentPosition, dir) {\n      var linkedPos,\n        nextPosition,\n        sortedPositions = this._getSortedPositions(),\n        index = (dir > 0) ? 0 : sortedPositions.length - 1,\n        isExit = (currentPosition === this.exitPosition),\n        isFirst = (currentPosition === sortedPositions[0]);\n\n      if (this.options.noCycle) {\n        if ((isExit && (dir > 0)) || (isFirst && (dir < 0)))\n          return null;\n      }\n      \n      if (!isExit) {\n        index = sortedPositions.indexOf(currentPosition) + dir;\n      }\n\n      while (!nextPosition) {\n        linkedPos = sortedPositions[index];\n        index = index + dir;\n\n        if (!linkedPos) {\n          // No more positions, go to exit or first position if no exit specified\n          nextPosition = this.exitPosition || sortedPositions[0];\n        } else if (linkedPos.isStop) {\n          nextPosition = linkedPos;\n        }\n      }\n\n      return nextPosition;\n    },\n    _goToMarker: function (marker) {\n      var range = findMarker(marker);\n\n      if (range) {\n        marker.doc.setSelection(range.from, range.to);\n        marker.doc.getEditor().focus();\n      }\n    },\n    _invalidateSortedPositions: function () {\n      this._sortedPositions = null;\n    },\n    _getSortedPositions: function () {\n      if (this._sortedPositions)\n        return this._sortedPositions;\n\n      var _sortedPositions = [];\n      this._sortedPositions = _sortedPositions;\n\n      this.groups.forEach(function (group) {\n        group.positions.forEach(function (linkedPos) {\n          // Update start position in document\n          var range = findMarker(linkedPos.marker);\n          linkedPos._pos = (range && range.from) || { line: Number.MAX_VALUE, ch: Number.MAX_VALUE };\n\n          // flat list of all markers\n          _sortedPositions.push(linkedPos);\n        });\n      });\n\n      // TODO real sorting with markers from multiple documents\n      // sort markers by start position in document\n      _sortedPositions = _sortedPositions.sort(function (a, b) {\n        var docCompare = a.marker.doc.id - b.marker.doc.id;\n\n        if (docCompare !== 0)\n          return docCompare;\n\n        var lineCompare = a._pos.line - b._pos.line;\n\n        if (lineCompare !== 0)\n          return lineCompare;\n\n        return a._pos.ch - b._pos.ch;\n      });\n\n      return _sortedPositions;\n    },\n    _doEnter: function (cm) {\n      var self = this,\n        error = false;\n\n      // Save the original changeGeneration so we can exit linkedmode if undone\n      self.changeGeneration = cm.getDoc().changeGeneration(true);\n\n      function _tryCreateMarker(doc, from, to, linkedPos, index) {\n        var tryMarker;\n\n        try {\n          tryMarker = self._createMarker(doc, from, to, linkedPos, index);\n        } catch (err) {\n          error = true;\n          CodeMirror.signal(self, "error", self, err);\n        }\n\n        return tryMarker;\n      }\n\n      self.groups.forEach(function (group) {\n        group.positions.forEach(function (linkedPos, index) {\n          self._mapPositionsToGroup[linkedPos] = group;\n          linkedPos.marker = _tryCreateMarker(linkedPos.doc, linkedPos.from, linkedPos.to, linkedPos, index);\n        });\n      });\n\n      var sortedPositions = self._getSortedPositions(),\n        firstPos = sortedPositions[0];\n\n      if (!firstPos)\n        CodeMirror.signal(self, "error", self, "No LinkedPosition found");\n\n      // mark the exit position\n      if (self.exitPosition)\n        self.exitPosition.marker = _tryCreateMarker(self.exitPosition.doc, self.exitPosition.from, self.exitPosition.to, self.exitPosition);\n\n      if (error)\n        return false;\n\n      // use beforeChange events to detect which markers to repair\n      self._onBeforeChange = self._onBeforeChange.bind(self);\n\n      // wait for change event to fire exit event to clients\n      self._onChange = self._onChange.bind(self);\n\n      self._codeMirrorInstances.forEach(function (cm) {\n        cm.on("beforeChange", self._onBeforeChange);\n        cm.on("change", self._onChange);\n      });\n\n      // add key bindigns for all code mirror instances\n      this.addKeyMap(this._buildBaseKeyMap());\n\n      // Save current model\n      _currentModel = self;\n\n      // select the first marker\n      self._goToMarker(firstPos.marker);\n\n      return true;\n    },\n    _enter: function (cm) {\n      var doEnter = this._doEnter(cm);\n\n      if (!doEnter)\n        this.exit(false, false);\n\n      return doEnter;\n    },\n    exit: function (goToExit, doIt) {\n      var self = this,\n        allGroupResults = [],\n        range,\n        res;\n\n      self.groups.forEach(function (group) {\n        res = { group: group, ranges: [], text: null };\n\n        group.positions.forEach(function (linkedPos) {\n          range = findMarker(linkedPos.marker);\n\n          // Update positions\n          linkedPos.from = range.from;\n          linkedPos.to = range.to;\n\n          if (range && !res.text) {\n            res.ranges.push(range);\n            res.text = linkedPos.marker.doc.getRange(range.from, range.to);\n          }\n        });\n\n        allGroupResults.push(res);\n      });\n\n      // set selection at exit position\n      if (self.exitPosition && goToExit) {\n        // update exit postion\n        range = findMarker(self.exitPosition.marker);\n        self.exitPosition.from = range.from;\n        self.exitPosition.to = range.to;\n\n        // move selection to exit position\n        self._goToMarker(self.exitPosition.marker);\n      }\n\n      self._marks.forEach(function (marker) {\n        clearMarker(marker);\n      });\n\n      self._codeMirrorInstances.forEach(function (cm) {\n        cm.off("beforeChange", self._onBeforeChange);\n        cm.off("change", self._onChange);\n      });\n\n      // Pass ranges and text to "exit" event\n      allGroupResults.forEach(function (res) {\n        CodeMirror.signal(res.group, "exit", res.group, doIt, res);\n      });\n      CodeMirror.signal(self, "exit", self, doIt, allGroupResults);\n\n      // Remove all state\n      self._marks = [];\n      self._codeMirrorInstances = [];\n      self._mapPositionsToGroup = {};\n      _currentModel = null;\n    }\n  };\n  function LinkedPosition(doc, from, to) {\n    this.doc = doc;\n    this.from = from;\n    this.to = to;\n    this.marker = null;\n  }\n  LinkedPosition.prototype = {\n    toString: function () {\n      return this.doc.id + JSON.stringify(this.from) + JSON.stringify(this.to);\n    }\n  };\n  function LinkedPositionGroup(posArray, options) {\n    var self = this;\n    options = options || {};\n\n    // TODO sanity check that positions (1) don\'t overlap and (2) are on the same line\n    this.positions = [];\n\n    // Convert raw positions into LinkedPosition\n    makeArray(posArray).forEach(function (rangeOrPosition) {\n      var p;\n      if (rangeOrPosition instanceof LinkedPosition)\n        p = rangeOrPosition;\n      else\n        p = new LinkedPosition(options.doc, rangeOrPosition.from, rangeOrPosition.to);\n      self.positions.push(p);\n    });\n\n    this.options = {\n      stopOnAllPositions: options.stopOnAllPositions || false\n    };\n  }\n  function enterLinkedMode(model) {\n    console.assert(model);\n\n    // TODO support nested linked modes\n    if (_currentModel) /* && !_currentModel.options.allowNested */\n      _currentModel.exit(false, false);\n\n    model._enter(this);\n  }\n\n  // Add on and off methods to a constructor\'s prototype, to make\n  // registering events on such objects more convenient.\n  eventMixin(LinkedModeModel);\n  eventMixin(LinkedPositionGroup);\n\n  CodeMirror.LinkedPosition = LinkedPosition;\n  CodeMirror.LinkedModeModel = LinkedModeModel;\n  CodeMirror.LinkedPositionGroup = LinkedPositionGroup;\n  CodeMirror.defineExtension("enterLinkedMode", enterLinkedMode);\n});\n\n//# sourceURL=/./lib/linkedmode/linkedmode.js'),
define("ext/lib/linkedmode/linkedmode",function(){}),eval('/*\n * ADOBE CONFIDENTIAL\n *\n * Copyright (c) 2014 Adobe Systems Incorporated. All rights reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by trade secret or copyright law.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4, maxerr: 50 */\n/*global define, brackets, window, graphite, PathUtils*/\n\ndefine(\'main\',[\n    "module",\n    "jquery",\n    "underscore",\n    "backbone",\n    "modernizr",\n    "mixpanel",\n    "ccweb.files.extract/main", /*graphite global init*/\n    "ccweb.files.extract/Constants",\n    "routes/appRouter",\n    "ext/command/Commands",\n    "ext/command/CommandHandlers", /* init, don\'t remove seemingly unused CommandHandlers */\n    "ext/ParfaitPopup",\n    "ext/MainPanel",\n    "ext/lib/linkedmode/linkedmode",\n    "ext/models/BracketsPreferencesModel",\n    "ext/models/ExtensionMetadata",\n    "ext/CacheManager",\n    "ext/strings"\n], function (module, $, _, Backbone, Modernizr, mixpanel, ExtractPlugin,\n        ParfaitConstants, AppRouter, Commands, CommandHandlers, ParfaitPopup,\n        MainPanel, linkedmode, BracketsPreferencesModel, ExtensionMetadata,\n        CacheManager, Strings) {\n    "use strict";\n\n    // From Parfait app.js\n    window.graphite.routers = window.graphite.routers || {};\n    window.graphite.routers.main = new AppRouter();\n    Backbone.history.start();\n\n    // Restore global Underscore\n    _.noConflict();\n\n    // Brackets dependencies\n    var AppInit             = brackets.getModule("utils/AppInit"),\n        Async               = brackets.getModule("utils/Async"),\n        Dialogs             = brackets.getModule("widgets/Dialogs"),\n        DefaultDialogs      = brackets.getModule("widgets/DefaultDialogs"),\n        EditorManager       = brackets.getModule("editor/EditorManager"),\n        ExtensionManager    = brackets.getModule("extensibility/ExtensionManager"),\n        ExtensionUtils      = brackets.getModule("utils/ExtensionUtils"),\n        ProjectManager      = brackets.getModule("project/ProjectManager"),\n        StringUtils         = brackets.getModule("utils/StringUtils");\n    \n    // Log certain project open/close metrics only when active:\n    // - TOGGLE_PARFAIT_ID command triggered\n    // - Extension install\n    var _isExtensionActive;\n\n    var parfaitStyleSheets = [\n        "styles/topcoat_base.css",\n        "lib/graphite-api/public/css/application.css",\n        "styles/ccfiles.css"\n    ];\n\n    var extensionStyleSheets = [\n        "lib/linkedmode/linkedmode.css",\n        "styles/parfait-panel.less",\n        "styles/parfait-popup.less",\n        "styles/parfait-code-hints.less",\n        "styles/parfait-override.less"\n    ];\n\n    var _loadStyleSheet = function (path) {\n        return ExtensionUtils.loadStyleSheet(module, path);\n    };\n    \n    // Load parfait stylesheets first\n    var stylePromise = Async.doInParallel(parfaitStyleSheets, _loadStyleSheet);\n\n    // Load extension style sheets last\n    stylePromise = stylePromise.then(function () {\n        return Async.doInParallel(extensionStyleSheets, _loadStyleSheet);\n    });\n    \n    \n    function showRenderError(path) {\n        var dialog = Dialogs.showModalDialog(\n                DefaultDialogs.DIALOG_ID_ERROR,\n                Strings.ERROR_RENDER_TITLE,\n                StringUtils.format(\n                    Strings.ERROR_RENDER_MESSAGE,\n                    StringUtils.breakableUrl(decodeURI(path))\n                )\n            );\n\n        dialog.getPromise().done(function (id) {\n            var route = $("#browse-files")[0].attributes.getNamedItem("data-route").value;\n                            \n            Backbone.history.navigate(route, true);\n        });\n    }\n    \n    function _attachExtensionManagerListener() {\n        var hasAppCloseListener = false,\n            extensionID = ExtensionMetadata.get("id"),\n            markedForUpdate = false;\n        \n        // Listen for statusChange event for this extension\n        $(ExtensionManager).on("statusChange", function (event, id) {\n            if (id !== extensionID) {\n                return;\n            }\n            \n            markedForUpdate = ExtensionManager.isMarkedForUpdate(extensionID);\n            \n            if (hasAppCloseListener) {\n                return;\n            }\n            \n            // Wait until APP_RELOAD to verify extension status\n            $(ProjectManager).on("beforeAppClose", function () {\n                var installData = ExtensionManager.extensions[extensionID],\n                    wasRemoved = !installData.installInfo;\n\n                if (wasRemoved) {\n                    graphite.events.trigger("uninstall-complete");\n                } else if (markedForUpdate) {\n                    graphite.events.trigger("update-complete");\n                }\n            });\n            \n            hasAppCloseListener = true;\n        });\n    }\n    \n    function _attachListeners() {\n        var handleCCDirLoad = CacheManager.handleCCDirLoad.bind(CacheManager),\n            handleAssetDataLoaded = CacheManager.handleAssetDataLoaded.bind(CacheManager),\n            purgeCache = CacheManager.purgeCache.bind(CacheManager),\n            offlineAcknowledged = false,\n            offlineStart;\n        \n        graphite.events.on("cc-directory-load", handleCCDirLoad);\n        graphite.events.on("asset-data-loaded", handleAssetDataLoaded);\n        graphite.events.on("image-service-error", function (path) {\n            purgeCache(path);\n            showRenderError(path);\n        });\n        \n        // Track online/offline state\n        graphite.events.on("proxy-request-complete", function (params) {\n            // Ignore if we never went offline\n            if (!offlineAcknowledged) {\n                return;\n            }\n            \n            // Reset offline ack\n            offlineAcknowledged = false;\n            graphite.metricsProxyModel.setDefaultParam("isOffline", false);\n\n            // Log the first successful service call when returning online\n            graphite.events.trigger("offline-end", {\n                duration: Date.now() - offlineStart\n            });\n        });\n\n        // Each service call should handle errors explicitly\n        graphite.events.on("proxy-request-error", function (params) {\n            // Log all service call errors\n            graphite.events.trigger("proxy-request-error");\n        });\n\n        // Notify user when retrieving services from cache\n        graphite.events.on("cache-fallback-complete", function (params) {\n            if (offlineAcknowledged) {\n                return;\n            }\n\n            // Tell the user that we can use the cache\n            Dialogs.showModalDialog(\n                DefaultDialogs.DIALOG_ID_ERROR,\n                Strings.EXTENSION_NAME,\n                StringUtils.format(Strings.ERROR_OFFLINE_USE_CACHE_MESSAGE)\n            );\n\n            // Set flag so that we only show the cache dialog once\n            offlineStart = Date.now();\n            offlineAcknowledged = true;\n            graphite.metricsProxyModel.setDefaultParam("isOffline", true);\n            \n            // Log the first service call that hit the cache\n            graphite.events.trigger("offline-start");\n        });\n    }\n\n    function _logEditorDocumentType(editor) {\n        var language = editor && editor.document.getLanguage(),\n            languageName = "no-active-editor";\n\n        if (language && language.getName) {\n            languageName = language.getName();\n        }\n\n        // Save active editor language with all events\n        graphite.metricsProxyModel.setDefaultParam("language", languageName);\n    }\n\n    function _logProjectOpen(root) {\n        var isWelcomeProject = ProjectManager.isWelcomeProjectPath(root.fullPath);\n\n        // Save isWelcomeProject with all events\n        graphite.metricsProxyModel.setDefaultParam("isWelcomeProject", isWelcomeProject);\n\n        if (_isExtensionActive) {\n            graphite.events.trigger("project-open");\n        }\n    }\n    \n    function _saveDefaultParams() {\n        _logEditorDocumentType(EditorManager.getActiveEditor());\n        _logProjectOpen(ProjectManager.getProjectRoot());\n    }\n\n    function _setupAbandonmentEvents() {\n        $(ProjectManager).on("beforeAppClose", function () {\n            if (_isExtensionActive) {\n                graphite.events.trigger("app-close");\n            }\n        }).on("projectClose", function () {\n            if (_isExtensionActive) {\n                graphite.events.trigger("project-close");\n            }\n        }).on("projectOpen", function (event, projectRoot) {\n            _logProjectOpen(projectRoot);\n        });\n    }\n\n    function _appReadyHandler() {\n        // Use runtime metadata from ExtensionManager for version info\n        // instead of build-time metadata that does not contain extra build\n        // info (e.g. the git SHA)\n        var id = ExtensionMetadata.get("id");\n        ExtensionMetadata.set(ExtensionManager.extensions[id].installInfo.metadata);\n        \n        // Flag INSTALL_COMPLETE\n        var prefs = BracketsPreferencesModel.get("preferenceSystem");\n        if (!prefs.get(BracketsPreferencesModel.INSTALL_COMPLETE)) {\n            prefs.set(BracketsPreferencesModel.INSTALL_COMPLETE, true);\n\n            // Log bundled build info\n            var autoInstalledExtensions = BracketsPreferencesModel.getViewState("auto-install-extensions") || {},\n                bundledBuildVersion = autoInstalledExtensions[ExtensionMetadata.get("id")],\n                isBundledBuild = !!bundledBuildVersion;\n\n            graphite.metricsProxyModel.setDefaultParam("isBundledBuild", isBundledBuild);\n\n            if (isBundledBuild) {\n                graphite.metricsProxyModel.setDefaultParam("bundledBuildVersion", bundledBuildVersion);\n\n                // Only set bundled build version on first install\n                prefs.set(BracketsPreferencesModel.INSTALL_BUNDLED_BUILD_VERSION, bundledBuildVersion);\n            }\n\n            // Trigger INSTALL_COMPLETE after ExtensionMetadata populates\n            graphite.events.trigger("install-complete");\n            _isExtensionActive = true;\n        }\n\n        ParfaitConstants.Shortcut.HELP = 112; // F1 key\n        \n        // Create UI\n        MainPanel.registerMainPanel();\n        ParfaitPopup.initParfaitControlsPopup();\n\n        // TODO better event for detecting if extension is active?\n        $(Commands.get(Commands.TOGGLE_PANEL)).on("checkedStateChange", function () {\n            _isExtensionActive = true;\n        });\n        \n        _attachExtensionManagerListener();\n        _attachListeners();\n        _setupAbandonmentEvents();\n\n        // Other global metrics\n        $(EditorManager).on("activeEditorChange", function (event, current) {\n            _logEditorDocumentType(current);\n        });\n\n        // Initialize metrics\n        _saveDefaultParams();\n    }\n\n    // Initialize the extension after CSS loads and APP_READY fires\n    stylePromise.done(function () {\n        AppInit.appReady(_appReadyHandler);\n    });\n});\n\n//# sourceURL=/main.js'),function(e){var n=document,t="appendChild",r="styleSheet",i=n.createElement("style");i.type="text/css",n.getElementsByTagName("head")[0][t](i),i[r]?i[r].cssText=e:i[t](n.createTextNode(e))}('/* Intentionally empty. Overrides ccweb.files.extract/css/topcoat.css. *//**************************************\n/*   FIRST USER EXPERIENCE OVERLAY\n/**************************************/\n.first-user-exp-overlay {\n  color: #000;\n  font-size: 14px;\n  font-weight: 100;\n  background-color: rgba(255, 255, 255, 0.89);\n  left: 0px;\n  top: 0px;\n  width: 100%;\n  height: 100%;\n  position: absolute;\n  display: none; }\n\n.first-user-exp-overlay a,\n.first-user-exp-overlay u {\n  text-decoration: underline; }\n\n.first-user-exp-logo {\n  width: 175px;\n  height: 64px;\n  margin: 69px 10px 0 96px !important; }\n\n.first-user-exp-welcome-text {\n  color: #222;\n  position: absolute;\n  left: 96px;\n  top: 169px;\n  font-size: 15px;\n  width: 500px;\n  -webkit-font-smoothing: subpixel-antialiased; }\n  .first-user-exp-welcome-text p, .first-user-exp-welcome-text li {\n    font-size: 15px;\n    line-height: 1.6;\n    display: block;\n    margin: 1em 0; }\n  .first-user-exp-welcome-text ul {\n    padding-left: 40px !important;\n    list-style-image: none;\n    list-style-position: outside;\n    list-style-type: disc; }\n  .first-user-exp-welcome-text li {\n    display: list-item;\n    margin: 0;\n    list-style-image: none;\n    list-style-position: outside;\n    list-style-type: disc; }\n\n.first-user-exp-welcome-text .warning {\n  color: #000;\n  font-weight: bold;\n  font-style: italic;\n  font-size: 12px;\n  margin: 54px 0; }\n\n#firstUserExpCloseIcon {\n  position: absolute;\n  font-size: 60px;\n  font-weight: bold;\n  top: 40px;\n  right: 39px;\n  cursor: pointer; }\n\n#firstUserExpCloseIcon:hover {\n  color: #0083e8; }\n\n/*# sourceMappingURL=firstUserExp.css.map */\n/**************************************\n/*   FIRST USER EXPERIENCE OVERLAY\n/**************************************/\n.job-list-window-overlay {\n  color: #000;\n  font-weight: 100;\n  background-color: rgba(255, 255, 255, 0.8);\n  left: 0px;\n  top: 0px;\n  width: 100%;\n  height: 100%;\n  position: absolute;\n  display: none;\n  z-index: 9998; }\n\n.job-list-window-overlay a,\n.job-list-window-overlay u {\n  text-decoration: underline; }\n\n.job-list-window-wrapper {\n  width: 100%;\n  height: 100%; }\n\n.job-list-body {\n  color: #222;\n  bottom: 0;\n  left: 0;\n  top: 0;\n  right: 0;\n  position: absolute;\n  margin: auto;\n  width: 500px;\n  height: 500px;\n  -webkit-font-smoothing: subpixel-antialiased; }\n  .job-list-body .job-list-intro-text {\n    color: black; }\n  .job-list-body p {\n    font-size: 20px; }\n  .job-list-body p, .job-list-body li {\n    line-height: 1.6;\n    display: block;\n    margin: 1em 0; }\n  .job-list-body ul {\n    padding-left: 40px !important;\n    list-style-image: none;\n    list-style-position: outside;\n    list-style-type: disc; }\n  .job-list-body li {\n    display: list-item;\n    margin: 0;\n    list-style-image: none;\n    list-style-position: outside;\n    list-style-type: disc;\n    font-size: 18px;\n    font-style: italic; }\n\n#jobListingCloseIcon {\n  position: absolute;\n  font-size: 60px;\n  font-weight: bold;\n  top: 40px;\n  right: 39px;\n  cursor: pointer; }\n\n#jobListingCloseIcon:hover {\n  color: #0083e8; }\n\n/*# sourceMappingURL=jobListing.css.map */\n/* number must match PSDPreviewView center-helper template offset */\n/**************************************\n/* GENERAL\n/**************************************/\n#psdInfoSection,\n#psdAssetsSection {\n  border: none;\n  position: absolute;\n  top: 60px;\n  bottom: 0;\n  overflow: auto;\n  padding-right: 8px;\n  padding-left: 2px;\n  right: 0; }\n  #psdInfoSection span.desc, #psdInfoSection h6,\n  #psdAssetsSection span.desc,\n  #psdAssetsSection h6 {\n    font-size: 14px;\n    font-weight: 400;\n    margin-top: 24px;\n    color: #000 !important;\n    text-transform: none;\n    display: block;\n    line-height: 21px;\n    height: 21px; }\n  #psdInfoSection ul,\n  #psdAssetsSection ul {\n    list-style-type: none;\n    padding: 0px;\n    margin-top: 10px; }\n\n.section-wrapper {\n  padding: 10px 0; }\n\n.summary-separator {\n  height: 1px;\n  background-color: #d5d5d5; }\n\n.panel-rows {\n  color: #d5d5d5;\n  font-size: 12px;\n  margin: 10px 0 15px; }\n  .panel-rows li {\n    margin: 0 0 8px;\n    text-align: right; }\n  .panel-rows label {\n    font-size: 13px;\n    margin-right: 3px;\n    vertical-align: middle;\n    position: relative;\n    top: 3px; }\n\n#baseFontInput {\n  font-size: 12px;\n  width: 45px;\n  padding: 2px 3px !important;\n  height: 20px;\n  line-height: 1; }\n\n/**************************************\n/* CSS INSPECTOR\n/**************************************/\n.cssInspectorCopyAllButton {\n  float: right;\n  position: relative; }\n\n.cssInspectorCopyAllButton.zeroclipboard-is-hover {\n  background-image: -webkit-linear-gradient(#d7d7d7 0, #aeaeae 100%);\n  background-image: linear-gradient(to   , #aeaeae 100%); }\n\n.extract-plugin .css-properties * {\n  -webkit-user-select: text;\n  -moz-user-select: text;\n  -ms-user-select: text;\n  user-select: text; }\n\n.css-properties {\n  background: #f1f1f1;\n  border: 1px solid #d5d5d5;\n  border-radius: 0;\n  font-family: "Andale Mono", Monaco, Consolas, "Courier New", monospace;\n  height: 180px;\n  line-height: 18px;\n  margin: 5px 0 12px !important;\n  overflow: auto;\n  padding: 6px 9px !important; }\n  .css-properties > li {\n    white-space: nowrap; }\n  .css-properties > li.css-properties-message {\n    font-family: adobe-clean, source-sans-pro, \'Helvetica Neue\', Helvetica, Arial, sans-serif;\n    font-size: 14px;\n    padding-top: 65px;\n    text-align: center;\n    margin: 0 auto;\n    width: 200px;\n    color: #a9adab;\n    white-space: normal; }\n  .css-properties .color-chip {\n    width: 12px;\n    height: 12px;\n    border-radius: 0;\n    box-shadow: inset 0 0 1px 1px rgba(0, 0, 0, 0.12);\n    display: inline-block;\n    vertical-align: middle;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    -ms-user-select: none;\n    user-select: none; }\n  .css-properties .property {\n    color: #000;\n    font-size: 11px; }\n  .css-properties .comment {\n    color: #a9adab;\n    font-size: 11px; }\n  .css-properties .value {\n    color: #444;\n    font-size: 11px; }\n\n.base-font-input {\n  background: #fff;\n  border: 1px solid #d5d5d5;\n  color: #444;\n  height: 18px;\n  line-height: 1;\n  width: 48px; }\n\n/* CONTEXT MENU */\n.extract-plugin .context-menu {\n  top: 52px;\n  left: 0;\n  position: absolute;\n  padding: 4px 0;\n  background: #fff;\n  border: 1px solid #d5d5d5;\n  z-index: 2010;\n  text-align: left;\n  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);\n  font-weight: 400;\n  font-size: inherit;\n  letter-spacing: normal;\n  cursor: pointer;\n  line-height: inherit;\n  min-width: 30px; }\n.extract-plugin .context-menu a {\n  position: relative;\n  height: 19px;\n  line-height: inherit;\n  font-size: inherit;\n  padding: 0 10px 0 20px;\n  display: block;\n  color: #444;\n  font-weight: inherit;\n  text-decoration: none;\n  border-bottom: none; }\n.extract-plugin .context-menu a i {\n  background-position: -100px 2000px;\n  display: none; }\n.extract-plugin .context-menu a.active i {\n  display: inherit;\n  position: absolute;\n  top: 0;\n  left: 0;\n  background-position: -35px -1538px;\n  height: 26px; }\n.extract-plugin .context-menu a:hover {\n  background: #227ecb;\n  color: #fff; }\n.extract-plugin .context-menu a:hover i {\n  background-position: -4px -1718px; }\n\n/* FONT UNIT TYPE MENU */\n#psdInfoSection .fontUnit {\n  width: 24px; }\n\n/* DROP DOWN */\n.dropdown {\n  display: inline-block;\n  color: #444;\n  font-weight: normal;\n  line-height: normal;\n  font-size: 12px; }\n\n.dropdown-btn {\n  background-color: #e5e9e9;\n  color: #444;\n  font-weight: normal;\n  background-color: #eee;\n  background: -moz-linear-gradient(top, #f9f9f9 0%, #d9d9d9 100%);\n  background-image: -ms-linear-gradient(top, #f9f9f9 0%, #d9d9d9 100%);\n  background-image: -webkit-linear-gradient(#f9f9f9 0, #d9d9d9 100%);\n  background-image: linear-gradient(to   , #d9d9d9 100%);\n  padding-left: 6px;\n  padding-right: 20px;\n  line-height: 22px;\n  text-align: left;\n  border: 1px solid #aaa;\n  box-shadow: inset 0 1px 0 #fff;\n  text-shadow: 0 1px 0 #fff;\n  position: relative; }\n\n.dropdown-btn:after {\n  /* down triangle */\n  display: inline-block;\n  border-style: solid;\n  border-width: 4px 4px 0 4px;\n  border-color: #999 transparent transparent;\n  content: \'\';\n  position: absolute;\n  right: 6px;\n  top: 10px;\n  width: 0px; }\n\n/**************************************\n/* PREPROCESSOR SELECT\n/**************************************/\n/* HEADING */\n#psdInfoSection h4.preprocessor-header {\n  background: #fff;\n  padding-bottom: 6px;\n  border-bottom: 1px solid #d5d5d5;\n  color: #444;\n  font-size: 21px;\n  font-size: 1.3125rem;\n  font-weight: 300;\n  line-height: 28px;\n  padding-top: 24px;\n  margin-top: 0;\n  position: relative; }\n\n#psdInfoSection div.preprocessor {\n  display: inline-block; }\n\ndiv.menu-active {\n  cursor: pointer; }\n\n#psdInfoSection div.preprocessor.hide {\n  cursor: default; }\n\n#psdInfoSection div.preprocessor.hide em {\n  display: none; }\n\n#psdInfoSection div.preprocessor b {\n  text-transform: none;\n  font-weight: 300; }\n\n#psdInfoSection div.preprocessor em {\n  width: 0;\n  height: 0;\n  position: relative;\n  top: -2px;\n  border-style: solid;\n  border-width: 7px 5px 0 5px;\n  border-color: #999 transparent transparent;\n  margin-left: 6px;\n  display: inline-block; }\n\n/* PREPROCESSOR MENU */\n.extract-plugin .preprocessor-selector {\n  width: 150px;\n  min-width: 150px;\n  line-height: 32px;\n  padding: 0; }\n.extract-plugin .context-menu.preprocessor-selector a {\n  position: relative;\n  height: 32px;\n  font-size: .875rem;\n  padding: 0 5px 0 28px;\n  border-bottom: 1px #d5d5d5 solid; }\n.extract-plugin .context-menu.preprocessor-selector a.active i {\n  background-position: -30px -1530px; }\n.extract-plugin .context-menu.preprocessor-selector a:hover i {\n  background-position: 0 -1710px; }\n\n/**************************************\n/* COLORS\n/**************************************/\n.color-list, .solid-color-list, .gradient-list {\n  margin-top: 15px; }\n  .color-list li, .solid-color-list li, .gradient-list li {\n    float: left;\n    position: relative;\n    margin-top: 0px; }\n    .color-list li .color-chip, .solid-color-list li .color-chip, .gradient-list li .color-chip {\n      box-shadow: inset 0 0 2px rgba(0, 0, 0, 0.5);\n      border-radius: 0;\n      margin-bottom: 10px;\n      margin-right: 10px;\n      width: 27px;\n      height: 27px;\n      position: relative;\n      cursor: pointer; }\n    .color-list li:hover, .solid-color-list li:hover, .gradient-list li:hover, .color-list li.selected, .solid-color-list li.selected, .gradient-list li.selected, .color-list li.layer-over, .solid-color-list li.layer-over, .gradient-list li.layer-over {\n      background-color: transparent; }\n      .color-list li:hover .color-chip, .solid-color-list li:hover .color-chip, .gradient-list li:hover .color-chip, .color-list li.selected .color-chip, .solid-color-list li.selected .color-chip, .gradient-list li.selected .color-chip, .color-list li.layer-over .color-chip, .solid-color-list li.layer-over .color-chip, .gradient-list li.layer-over .color-chip {\n        outline: none; }\n    .color-list li.selected > .color-chip, .solid-color-list li.selected > .color-chip, .gradient-list li.selected > .color-chip {\n      outline: 2px solid #009df5; }\n\n.color-list .dropper-item .color-chip, .solid-color-list .dropper-item .color-chip, .gradient-list .dropper-item .color-chip {\n  border: 1px #bbb dashed;\n  box-sizing: border-box;\n  border-radius: 1px;\n  box-shadow: none; }\n\n.color-chip .dropper {\n  background-image: url("../../../../../..");\n  background-image: -webkit-image-set(url("../../../../../..") 1x, url("../../../../../..") 2x);\n  margin: 5px auto 0 6px;\n  width: 15px;\n  height: 15px;\n  background-size: 15px 15px;\n  opacity: 0.75; }\n\n.gradient-list {\n  margin-bottom: 26px; }\n\n/**************************************\n/* FONTS\n/**************************************/\n#psdInfoSection .font-list {\n  padding: 0;\n  margin-top: 0px; }\n\n/**** Font Family ****/\n.number-rect, .font-family-list-item .font-face-count, #psdInfoSection .font-face-list-item .text-style-size {\n  height: 20px;\n  padding-left: 4px;\n  padding-right: 4px;\n  min-width: number-rect-width;\n  background-color: #e7e7e7;\n  color: #000; }\n  .number-rect p, .font-family-list-item .font-face-count p, #psdInfoSection .font-face-list-item .text-style-size p {\n    text-align: center;\n    line-height: 21px;\n    font-size: 12px;\n    margin: 0px; }\n\n.font-family-list-item {\n  margin: 0px;\n  position: relative; }\n  .font-family-list-item .arrow {\n    border-bottom: 4px solid transparent;\n    border-left: 6px solid #7e8386;\n    border-top: 4px solid transparent;\n    width: 1px;\n    height: 1px;\n    position: absolute;\n    top: 12px;\n    left: 1px;\n    pointer-events: none;\n    -webkit-backface-visibility: hidden;\n    backface-visibility: hidden;\n    -webkit-transform: translateZ(0) rotate(90deg);\n    -moz-transform: translateZ(0) rotate(90deg);\n    -ms-transform: translateZ(0) rotate(90deg);\n    -o-transform: translateZ(0) rotate(90deg);\n    transform: translateZ(0) rotate(90deg);\n    -webkit-transition-property: -webkit-transform;\n    -moz-transition-property: -moz-transform;\n    transition-property: transform;\n    -webkit-transition-duration: 140ms;\n    -moz-transition-duration: 140ms;\n    transition-duration: 140ms; }\n  .font-family-list-item.closed .arrow {\n    -webkit-transform: translateZ(0) rotate(0deg);\n    -moz-transform: translateZ(0) rotate(0deg);\n    -ms-transform: translateZ(0) rotate(0deg);\n    -o-transform: translateZ(0) rotate(0deg);\n    transform: translateZ(0) rotate(0deg); }\n  .font-family-list-item .font-family-name {\n    margin: 0;\n    padding: 7px 0px 7px 41px;\n    float: left;\n    width: 100%;\n    box-sizing: border-box;\n    font-size: 14px;\n    width: 90%;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    -ms-user-select: none;\n    user-select: none;\n    cursor: pointer;\n    color: #444; }\n  .font-family-list-item .font-face-count {\n    top: 6px;\n    right: 1px;\n    padding: 0 6px;\n    position: absolute;\n    pointer-events: none;\n    border-radius: 0; }\n  .font-family-list-item .typekit-anchor {\n    background: url("../../../../../..") no-repeat scroll 0 50%;\n    background: -webkit-image-set(url("../../../../../..") 1x, url("../../../../../..") 2x) no-repeat scroll 0 50%;\n    position: absolute;\n    width: 20px;\n    height: 19px;\n    top: 6px;\n    left: 16px; }\n  .font-family-list-item .typekit-anchor:hover {\n    opacity: .8; }\n  .font-family-list-item.deactive .font-family-name {\n    opacity: .3; }\n  .font-family-list-item.layer-hover .font-family-name {\n    color: #e4f1f9; }\n\n/**** Font Face List ****/\n#psdInfoSection .font-list .font-face-list {\n  margin: 0px;\n  padding-bottom: 0px; }\n  #psdInfoSection .font-list .font-face-list .list-bottom-padding {\n    height: 10px; }\n\n#psdInfoSection .font-face-list-item ul {\n  width: 60%;\n  float: right;\n  margin: 0px; }\n#psdInfoSection .font-face-list-item .font-face-name {\n  color: #7e8386;\n  width: 37%;\n  float: left;\n  margin: 0px 0px 4px;\n  text-align: right;\n  font-size: 12px; }\n#psdInfoSection .font-face-list-item.deactive .font-face-name {\n  opacity: .3; }\n#psdInfoSection .font-face-list-item .text-style-size {\n  margin: 0px 0px 3px 0px;\n  padding: 0 5px;\n  display: inline-block;\n  border-radius: 0;\n  cursor: pointer; }\n  #psdInfoSection .font-face-list-item .text-style-size.selected, #psdInfoSection .font-face-list-item .text-style-size.layer-hover {\n    background-color: #009df5; }\n    #psdInfoSection .font-face-list-item .text-style-size.selected > p, #psdInfoSection .font-face-list-item .text-style-size.layer-hover > p {\n      color: #fff; }\n  #psdInfoSection .font-face-list-item .text-style-size.layer-hover {\n    background-color: #7e8386; }\n  #psdInfoSection .font-face-list-item .text-style-size.deactive {\n    pointer-events: none;\n    opacity: .3; }\n\n/**************************************\n/* DERIVED ASSETS\n/**************************************/\n.download-frame {\n  display: none; }\n\n#assetCounter {\n  background-color: #e7e7e7;\n  color: #000;\n  font-size: 11px;\n  padding: 2px 5px;\n  position: relative;\n  top: -1px;\n  left: 3px;\n  display: inline;\n  pointer-events: none;\n  -webkit-transition: 0.2s, linear;\n  -moz-transition: 0.2s, linear;\n  transition: 0.2s, linear;\n  -webkit-transition-property: background-color, color;\n  -moz-transition-property: background-color, color;\n  transition-property: background-color, color; }\n  #assetCounter.new_asset {\n    background-color: #00A2FF;\n    color: #FFF; }\n\n#psdAssetsSection .derived-assets-list {\n  padding-left: 0px;\n  padding-right: 0px;\n  width: 105%; }\n\n.disabledLabel {\n  opacity: 0.5; }\n\n.derived-asset-list-item {\n  height: 108px;\n  width: 108px;\n  margin: 0 3px 0 0;\n  padding: 10px 10px 25px;\n  float: left;\n  position: relative; }\n  .derived-asset-list-item:hover {\n    background-color: #e4f1f9; }\n    .derived-asset-list-item:hover .image-wrapper {\n      border: 1px solid transparent; }\n  .derived-asset-list-item.selected {\n    background-color: #e4f1f9; }\n  .derived-asset-list-item.pending-delete {\n    opacity: 0.5;\n    pointer-events: none; }\n  .derived-asset-list-item .image-wrapper {\n    width: 100%;\n    height: 100%;\n    float: left;\n    background-image: url("../../../../../..");\n    border: 1px solid #d5d5d5; }\n    .derived-asset-list-item .image-wrapper div {\n      background: #fff url("../../../../../..") center center no-repeat;\n      width: 100%;\n      height: 100%; }\n  .derived-asset-list-item p {\n    line-height: 108px;\n    margin: 0px 0px 0px 10px; }\n  .derived-asset-list-item .del-button {\n    width: 16px;\n    height: 16px;\n    background: #e4f1f9;\n    color: #009df5;\n    font-size: 16px;\n    line-height: 7px;\n    position: absolute;\n    text-align: center;\n    visibility: hidden;\n    right: 7px;\n    text-indent: 5px;\n    top: 10px;\n    cursor: pointer; }\n  .derived-asset-list-item .del-button:active {\n    color: #215c8d; }\n  .derived-asset-list-item .asset-label {\n    width: 100%;\n    text-align: center;\n    text-overflow: ellipsis;\n    overflow: hidden;\n    white-space: nowrap;\n    font-size: 11px !important;\n    font-weight: 400;\n    color: #444 !important;\n    display: block; }\n\n/**************************************\n/* PUBLIC ONE-UP\n/**************************************/\n.extract-plugin.public #psdInfoSection,\n.extract-plugin.public #psdAssetsSection,\n.extract-plugin.public #psdInspectSection {\n  top: 113px; }\n\n/*# sourceMappingURL=inspect.css.map */\n/* number must match PSDPreviewView center-helper template offset */\n#psdInspectSection {\n  border: none;\n  position: absolute;\n  top: 60px;\n  bottom: 0px;\n  right: 0px;\n  padding: 0 0 0 19px; }\n  #psdInspectSection .section-wrapper {\n    margin-top: 14px; }\n\n.layers-list {\n  padding: 0 0 50px 0;\n  overflow: auto;\n  margin-left: 20px; }\n\n.layers-list > div {\n  padding: 0 0 0 7px; }\n\n.layers-list .selected h4 {\n  color: #8FDDFF; }\n.layers-list .selected .image-wrapper-inset {\n  border: solid 5px #00a8ff; }\n\n.layers-list .layer-bg {\n  position: absolute;\n  left: 10px;\n  right: 0;\n  height: 42px;\n  margin-top: -5px; }\n\n.layer-item-row {\n  cursor: default; }\n\n.layer-item-row.selected > .layer-item > .layer-bg,\n.layer-item-row.selected > .layer-group-item > .layer-group-header > .layer-bg {\n  background-color: #e4f1f9; }\n\n.layer-group-header,\n.layer-item {\n  white-space: nowrap;\n  overflow: visible; }\n\n.layer-group-item {\n  padding: 5px 0 0; }\n\n.layer-item {\n  padding: 5px 0; }\n\n.layer-group-item .folder {\n  position: relative;\n  display: block;\n  float: left;\n  margin-right: 6px;\n  vertical-align: middle;\n  background-image: url("../../../../../..");\n  background-repeat: no-repeat;\n  background-position: 0 -120px;\n  width: 20px;\n  height: 20px;\n  margin-top: 7px;\n  opacity: 0.5; }\n.layer-group-item.closed .folder {\n  background-image: url("../../../../../..");\n  background-repeat: no-repeat;\n  background-position: 0 -100px;\n  width: 20px;\n  height: 20px; }\n\n.layer-group-header {\n  padding: 0 0 5px; }\n\n.children-list {\n  display: none; }\n\n.children-list-list > div > .layer-group-item,\n.children-list-list > div > .layer-item {\n  margin: 0 0 0 26px; }\n\n.layer-group-label,\n.layer-label {\n  display: block;\n  padding-right: 3px;\n  font-weight: normal;\n  font-size: 12px;\n  color: #444 !important;\n  vertical-align: middle;\n  line-height: 32px;\n  position: relative;\n  margin: 0;\n  margin-left: 42px; }\n\n.layer-group-label {\n  margin-left: 68px; }\n\n.selected .show-export .layer-group-label,\n.selected .show-export .layer-label,\n.layer-item.show-export:hover .layer-group-label,\n.layer-item.show-export:hover .layer-label {\n  padding-right: 30px; }\n\n/**************************************\n/* THUMB\n/**************************************/\n.layer-group-item .image-wrapper,\n.layer-item .image-wrapper {\n  display: block;\n  float: left;\n  margin-right: 7px;\n  vertical-align: middle;\n  border: 1px solid #BFC1C3;\n  border-radius: 0;\n  width: 40px;\n  height: 30px;\n  position: relative;\n  background-color: #fff;\n  background-image: url("../../../../../..");\n  background-size: 23%; }\n  .layer-group-item .image-wrapper img,\n  .layer-item .image-wrapper img {\n    width: 100%;\n    height: 100%; }\n  .layer-group-item .image-wrapper div.preview-warning,\n  .layer-item .image-wrapper div.preview-warning {\n    position: relative;\n    left: 15px;\n    top: -28px;\n    width: 15px !important;\n    height: 14px !important;\n    display: none;\n    background: url("../../../../../..") 0 -60px; }\n  .layer-group-item .image-wrapper div.layer-icon,\n  .layer-item .image-wrapper div.layer-icon {\n    background-color: #e7e7e7;\n    background-image: url("../../../../../..");\n    background-repeat: no-repeat;\n    width: 13px;\n    height: 13px;\n    position: absolute;\n    bottom: 0;\n    right: 0;\n    display: none; }\n  .layer-group-item .image-wrapper div.layer-icon.vector,\n  .layer-item .image-wrapper div.layer-icon.vector {\n    display: block;\n    background-position: 3px -17px; }\n  .layer-group-item .image-wrapper div.layer-icon.text,\n  .layer-item .image-wrapper div.layer-icon.text {\n    display: block;\n    background-position: 3px 3px; }\n\n/**************************************\n/* ASSET BUTTON\n/**************************************/\n.asset-button {\n  background: url("../../../../../..") no-repeat 2px -78px;\n  display: inline-block;\n  width: 18px;\n  height: 17px;\n  border-radius: 0;\n  line-height: 1;\n  margin-top: -24px;\n  position: absolute;\n  right: 10px; }\n  .asset-button .off-state {\n    opacity: .3; }\n  .asset-button:hover {\n    background-color: rgba(255, 255, 255, 0.7); }\n\n/**************************************\n/* VISIBILITY BUTTON\n/**************************************/\n.visible-button {\n  display: inline-block;\n  background: url("../../../../../..") no-repeat 0 -140px;\n  width: 17px;\n  height: 17px;\n  border-radius: 0;\n  line-height: 1;\n  position: absolute;\n  left: 19px;\n  margin-top: 10px;\n  opacity: 0.5; }\n  .visible-button .eye-icon {\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    -ms-user-select: none;\n    user-select: none; }\n\n.visible-button.off-state {\n  opacity: 0.2; }\n\n/**************************************\n/* EXPORT BUTTONS\n/**************************************/\n.export-buttons {\n  visibility: hidden;\n  -webkit-touch-callout: none;\n  -webkit-user-select: none;\n  -moz-user-select: none;\n  -ms-user-select: none;\n  user-select: none; }\n\n.layer-group-header.show-export .export-buttons,\n.layer-item.show-export .export-buttons {\n  visibility: visible; }\n\n/*# sourceMappingURL=layers.css.map */\n/* number must match PSDPreviewView center-helper template offset */\n/**************************************\n/* Aug21 Header\n/**************************************/\n.aug21Header {\n  display: none; }\n\n.aug21Header a {\n  color: #0074df; }\n\n.aug21Header.aug21 {\n  display: block;\n  background-color: #e0f0fa;\n  margin: 30px 30px 0;\n  padding: 17px 23px; }\n  .aug21Header.aug21 .aug21HeaderTextLarge {\n    font-size: 18px;\n    font-weight: 400;\n    color: #333333;\n    line-height: 24px; }\n  .aug21Header.aug21 .aug21HeaderTextSmall {\n    font-size: 14px;\n    font-weight: 400;\n    color: #333333;\n    line-height: 24px; }\n  .aug21Header.aug21 .aug21HeaderTextBlackBold {\n    color: #000000;\n    font-weight: 700; }\n\n#psdInfoSection .aug21Header {\n  display: none; }\n#psdInfoSection .aug21Header.aug21 {\n  display: block;\n  line-height: 18px;\n  margin: 10px 0 0; }\n#psdInfoSection .aug21HeaderTextLarge {\n  font-size: 12px;\n  font-weight: 400;\n  color: #333333;\n  line-height: 18px; }\n#psdInfoSection .aug21HeaderTextSmall {\n  font-size: 12px;\n  font-weight: 400;\n  color: #333333;\n  line-height: 18px; }\n#psdInfoSection .aug21HeaderTextBlackBold {\n  color: #000000;\n  font-weight: 700; }\n\n/**************************************\n/* CC Override\n/**************************************/\n.extract-plugin .media-container h4 {\n  margin-top: 24px;\n  margin-bottom: 14px;\n  padding-bottom: 6px;\n  border-bottom: 1px solid #d5d5d5;\n  color: #444;\n  font-size: 21px;\n  font-size: 1.3125rem;\n  font-weight: 300;\n  line-height: 28px; }\n\na {\n  font-weight: 400; }\n\n.extract-plugin {\n  background-color: #fff; }\n  .extract-plugin *, .extract-plugin *:before, .extract-plugin *:after {\n    -webkit-box-sizing: content-box;\n    -moz-box-sizing: content-box;\n    box-sizing: content-box; }\n  .extract-plugin input[type="button"], .extract-plugin input[type="submit"], .extract-plugin input[type="reset"], .extract-plugin button {\n    -webkit-box-sizing: border-box;\n    -moz-box-sizing: border-box;\n    box-sizing: border-box; }\n  .extract-plugin button {\n    height: auto; }\n\n/**************************************\n/* Selection Toolbar VIEW\n/**************************************/\n.selection-controlbar {\n  position: absolute;\n  right: 300px;\n  top: 0 !important;\n  width: auto;\n  height: 36px;\n  -webkit-user-select: none;\n  -moz-user-select: none;\n  -ms-user-select: none;\n  user-select: none; }\n  .selection-controlbar button {\n    line-height: 0;\n    color: #444;\n    border: 1px solid transparent;\n    border-radius: 0;\n    background: transparent;\n    padding: 6px 0 0 0;\n    margin: 0 0 0 0;\n    position: relative;\n    float: right;\n    bottom: -5px;\n    -webkit-tap-highlight-color: transparent;\n    -webkit-touch-callout: none;\n    -moz-box-sizing: border-box;\n    min-width: 24px;\n    min-height: 24px; }\n  .selection-controlbar button.active {\n    background-color: #d5d5d5;\n    border: 1px solid #a9adab;\n    box-shadow: inset 0 1px 0 rgba(0, 0, 0, 0.09);\n    cursor: default; }\n  .selection-controlbar i.icon-btn {\n    width: 18px;\n    height: 18px;\n    display: inline-block;\n    background-repeat: no-repeat;\n    background-size: auto; }\n    .selection-controlbar i.icon-btn:hover {\n      opacity: 1; }\n  .selection-controlbar .firstuser-shortcut-guide {\n    display: none;\n    height: 29px; }\n  .selection-controlbar .direct-select .icon-btn {\n    background-image: url("../../../../../..");\n    background-position: -3px -3px; }\n  .selection-controlbar .show-measurements-on-hover > .icon-btn {\n    background-image: url("../../../../../..");\n    background-position: -3px -1px; }\n  .selection-controlbar .keyboard-shortcut-guide {\n    margin-right: 3px;\n    height: 29px; }\n  .selection-controlbar .keyboard-shortcut-guide .icon-btn {\n    background-image: url("../../../../../..");\n    background-position: 0 -180px;\n    opacity: 0.5; }\n  .selection-controlbar .help-selector {\n    min-width: 150px;\n    line-height: 32px;\n    white-space: nowrap;\n    padding: 0; }\n  .selection-controlbar .help-selector a i.icon-btn {\n    display: none; }\n  .selection-controlbar .help-selector a {\n    position: relative;\n    height: 32px;\n    font-size: .875rem;\n    border-bottom: 1px #d5d5d5 solid; }\n  .selection-controlbar .zoom-input,\n  .selection-controlbar .zoom-fit-button,\n  .selection-controlbar .zoom-100-button {\n    cursor: pointer;\n    display: inline-block;\n    padding: 0 4px; }\n    .selection-controlbar .zoom-input.disabled,\n    .selection-controlbar .zoom-fit-button.disabled,\n    .selection-controlbar .zoom-100-button.disabled {\n      pointer-events: none;\n      opacity: .4; }\n  .selection-controlbar .zoom-100-button {\n    margin-right: 6px; }\n  .selection-controlbar .zoom-controls {\n    position: relative;\n    float: right;\n    top: 7px;\n    white-space: nowrap;\n    font-size: 13px;\n    font-weight: 400;\n    color: #000;\n    margin-right: 10px; }\n  .selection-controlbar .zoom-input {\n    cursor: text;\n    -webkit-user-select: text;\n    -moz-user-select: text;\n    -ms-user-select: text;\n    user-select: text;\n    height: 21px;\n    text-overflow: clip;\n    width: 40px;\n    vertical-align: baseline;\n    margin: 0 6px 0 10px; }\n  .selection-controlbar .file-dim {\n    color: #a9adab;\n    text-align: left;\n    display: inline-block;\n    font-weight: 400;\n    margin: 0 8px; }\n\n/**************************************\n/* LAYER COMP SELECT\n/**************************************/\n.layer-comp-select.disabled {\n  pointer-events: none;\n  opacity: 0.4;\n  -ms-filter: "progid:DXImageTransform.Microsoft.Alpha(Opacity=40)";\n  filter: alpha(opacity=40); }\n\n.layer-comp-controls {\n  position: relative;\n  float: right;\n  top: 10px;\n  margin-right: 10px; }\n\n.layer-comp-controls .header-separator {\n  position: absolute;\n  left: 223px;\n  top: 2px; }\n\n.layer-comp-select {\n  /* Size and position */\n  width: 145px;\n  margin: 0 8px 0 0;\n  padding: 0px 41px 0px 22px;\n  margin-top: 2px;\n  /* Styles */\n  cursor: pointer;\n  outline: none;\n  border: 1px solid #d8d8d8;\n  background-color: #fff;\n  background-image: url("../../../../../..");\n  background-repeat: no-repeat;\n  background-position: 5px 5px;\n  font-size: 12px;\n  line-height: 19px;\n  height: 19px;\n  color: #000;\n  font-weight: 400; }\n\n.layer-comp-select .label {\n  -o-text-overflow: ellipsis;\n  text-overflow: ellipsis;\n  overflow: hidden;\n  white-space: nowrap;\n  margin-right: 4px;\n  line-height: 20px; }\n\n.layer-comp-select:after {\n  content: "";\n  width: 0;\n  height: 0;\n  position: absolute;\n  right: 14px;\n  top: 13px;\n  margin-top: -2px;\n  border-width: 4px 4px 0 4px;\n  border-style: solid;\n  border-color: #808080 transparent; }\n\n.layerCompIndexLabel {\n  position: absolute;\n  top: 4px;\n  right: 27px;\n  color: #888;\n  font-size: 10px;\n  text-align: right;\n  white-space: nowrap; }\n\n.layer-comp-select .layerCompDropdownItem {\n  /* Size & position */\n  position: relative;\n  top: 1px;\n  left: -23px;\n  right: 0px;\n  margin: 0;\n  padding: 0;\n  width: 210px;\n  /* Styles */\n  background: #fff;\n  -webkit-transition-property: all;\n  -moz-transition-property: all;\n  transition-property: all;\n  -webkit-transition-duration: 0.3s;\n  -moz-transition-duration: 0.3s;\n  transition-duration: 0.3s;\n  -webkit-transition-timing-function: ease-out;\n  -moz-transition-timing-function: ease-out;\n  transition-timing-function: ease-out;\n  list-style: none;\n  /* Hiding */\n  opacity: 0;\n  -ms-filter: "progid:DXImageTransform.Microsoft.Alpha(Opacity=0)";\n  filter: alpha(opacity=0);\n  pointer-events: none; }\n\n.layer-comp-select.active .layerCompDropdownItem {\n  -webkit-box-shadow: 0px 1px 2px 0px rgba(0, 0, 0, 0.2);\n  box-shadow: 0px 1px 2px 0px rgba(0, 0, 0, 0.2); }\n\n.layer-comp-select.active .layerCompDropdownItem:last-child {\n  overflow: hidden; }\n\n.layer-comp-select .layerCompDropdownItem li a {\n  display: block;\n  text-decoration: none;\n  color: #444;\n  padding: 7px 8px;\n  -o-text-overflow: ellipsis;\n  text-overflow: ellipsis;\n  overflow: hidden;\n  white-space: nowrap;\n  border-bottom: 1px solid #d5d5d5; }\n\n.layer-comp-select .layerCompDropdownItem li i {\n  margin-right: 5px;\n  color: inherit;\n  vertical-align: middle; }\n\n/* Hover state */\n.layer-comp-select .layerCompDropdownItem li:hover a {\n  background: #227ECB;\n  color: #fff; }\n\n/* Active state */\n.layer-comp-select.active {\n  background-color: #e5e9e9; }\n\n.layer-comp-select.active:after {\n  border-width: 4px 4px 0 4px; }\n\n.layer-comp-select.active .layerCompDropdownItem {\n  opacity: 1;\n  -ms-filter: none;\n  filter: none;\n  pointer-events: auto; }\n\n/**************************************\n/* ASSET DETAILS VIEW\n/**************************************/\n#detail-panel {\n  padding: 24px 0 0 19px;\n  position: absolute;\n  float: right;\n  right: 0px;\n  width: 300px;\n  background-color: #fff;\n  top: 0;\n  bottom: 0px;\n  -webkit-backface-visibility: hidden;\n  backface-visibility: hidden;\n  -webkit-box-sizing: border-box;\n  -moz-box-sizing: border-box;\n  box-sizing: border-box; }\n  #detail-panel .upload-button {\n    display: none; }\n\n#detail-panel.tabs {\n  -webkit-user-select: none;\n  -moz-user-select: none;\n  -ms-user-select: none;\n  user-select: none; }\n  #detail-panel.tabs > section {\n    overflow-x: hidden;\n    background-color: #fff;\n    color: #7e8386; }\n    #detail-panel.tabs > section p,\n    #detail-panel.tabs > section span,\n    #detail-panel.tabs > section label {\n      color: #444; }\n  #detail-panel.tabs > nav {\n    border-right: none; }\n  #detail-panel.tabs > nav > a {\n    background: #fff;\n    font-weight: 400;\n    color: #7e8386;\n    text-decoration: none; }\n    #detail-panel.tabs > nav > a.active {\n      border-bottom: 2px solid #fff;\n      color: #000; }\n    #detail-panel.tabs > nav > a.disabled {\n      display: none; }\n\n/**************************************\n/* PSD HEADER VIEW\n/**************************************/\n.psd-header {\n  height: 36px;\n  background-color: #fff;\n  font-size: 14px;\n  color: #444; }\n  .psd-header .psd-header-nowrap {\n    white-space: nowrap;\n    width: auto;\n    overflow: hidden;\n    text-overflow: ellipsis; }\n  .psd-header a,\n  .psd-header span {\n    line-height: 36px; }\n  .psd-header .back-to-files {\n    display: none;\n    margin-left: 5px;\n    padding: 0 10px 10px;\n    cursor: pointer;\n    color: #000;\n    font-weight: 400; }\n    .psd-header .back-to-files:hover {\n      text-decoration: none;\n      color: #009df5; }\n  .psd-header .file-name {\n    display: none;\n    margin-left: 10px; }\n\n.header-separator {\n  width: 1px;\n  height: 20px;\n  background-color: #d5d5d5;\n  display: inline-block;\n  position: relative;\n  top: 6px; }\n\n.psd-header-nowrap .header-separator {\n  display: none; }\n\nbody.not-logged-in .psd-header .back-to-files,\nbody.not-logged-in .psd-header .header-separator {\n  display: none; }\nbody.not-logged-in .psd-header .file-name {\n  font-weight: 400;\n  margin-left: 20px; }\n\n/**************************************\n/* SIGN-IN/UP BUTTON STYLES\n/**************************************/\nbody.not-logged-in #signin-button,\nbody.not-logged-in #signup-button,\n.extract-plugin .upload-button {\n  background: #50a3e2;\n  background: -moz-linear-gradient(top, #50a3e2 0%, #247fcc 100%);\n  background: -webkit-gradient(linear, left top, left bottom, color-stop(0%, #50a3e2), color-stop(100%, #247fcc));\n  background: -webkit-linear-gradient(top, #50a3e2 0%, #247fcc 100%);\n  background: -o-linear-gradient(top, #50a3e2 0%, #247fcc 100%);\n  background: -ms-linear-gradient(top, #50a3e2 0%, #247fcc 100%);\n  background: linear-gradient(to bottom, #50a3e2 0%, #247fcc 100%);\n  border: 1px solid #527593 !important;\n  box-shadow: inset 0 1px rgba(255, 255, 255, 0.24);\n  text-shadow: 0 -1px rgba(0, 0, 0, 0.36);\n  color: #fff;\n  margin-top: 38px;\n  padding: 18px 25px;\n  border-radius: 0;\n  font-size: 17px;\n  font-weight: 400; }\n  body.not-logged-in #signin-button:hover,\n  body.not-logged-in #signup-button:hover,\n  .extract-plugin .upload-button:hover {\n    background: #2b85cf;\n    background: -moz-linear-gradient(top, #2b85cf 0%, #2970aa 100%);\n    background: -webkit-gradient(linear, left top, left bottom, color-stop(0%, #2b85cf), color-stop(100%, #2970aa));\n    background: -webkit-linear-gradient(top, #2b85cf 0%, #2970aa 100%);\n    background: -o-linear-gradient(top, #2b85cf 0%, #2970aa 100%);\n    background: -ms-linear-gradient(top, #2b85cf 0%, #2970aa 100%);\n    background: linear-gradient(to bottom, #2b85cf 0%, #2970aa 100%); }\n\n/**************************************\n/* FX\n/**************************************/\n.blur-background {\n  -webkit-filter: blur(6px); }\n\n/**************************************\n/* PUBLIC ONE-UP\n/**************************************/\n.extract-plugin.public #detail-panel .upload-button {\n  display: block;\n  position: relative;\n  padding: 14px 25px;\n  margin: -10px auto 0 auto;\n  display: block; }\n.extract-plugin.public .tabs > nav {\n  position: absolute;\n  top: 77px;\n  left: 19px;\n  right: 0px; }\n\n/**************************************\n/* MOBILE WARNING\n/**************************************/\n.mobile-warning .extract-icon {\n  background-image: url("../../../../../..");\n  margin: 0 auto 40px;\n  display: block;\n  width: 74px;\n  height: 82px; }\n\n.mobile-warning {\n  position: absolute;\n  font-size: 18px;\n  line-height: 25px;\n  font-family: \'adobe-clean\', sans-serif;\n  font-weight: 400;\n  margin: auto;\n  top: 0;\n  left: 0;\n  bottom: 0;\n  right: 0;\n  vertical-align: middle;\n  height: 275px;\n  color: #666;\n  text-align: center;\n  max-width: 492px;\n  min-height: 150px; }\n\n.mobile-centered-container {\n  display: none;\n  position: absolute;\n  top: 0;\n  left: 0px;\n  right: 0px;\n  bottom: 0px;\n  margin: 20px;\n  min-height: 250px; }\n\n@media only screen and (max-width: 800px) {\n  .psd-header,\n  .psd-preview-view,\n  #detail-panel,\n  .selection-controlbar {\n    display: none; }\n\n  .mobile-centered-container {\n    display: block; } }\n\n/*# sourceMappingURL=main.css.map */\n/* number must match PSDPreviewView center-helper template offset */\n/**************************************\n/* BASE\n/**************************************/\n.popup {\n  width: 260px;\n  background-color: #fff;\n  border: 1px solid rgba(0, 0, 0, 0.24);\n  position: absolute;\n  padding: 12px 15px;\n  border-radius: 0;\n  box-shadow: 0 3px 9px rgba(0, 0, 0, 0.12);\n  -webkit-backface-visibility: hidden;\n  backface-visibility: hidden; }\n  .popup .popup-footer {\n    display: block;\n    margin: 0; }\n  .popup .notch {\n    position: absolute;\n    width: 23px;\n    height: 15px;\n    overflow: hidden; }\n    .popup .notch:after {\n      content: "";\n      background-color: #fff;\n      width: 20px;\n      height: 20px;\n      display: block;\n      -webkit-transform: rotate(45deg);\n      -moz-transform: rotate(45deg);\n      -ms-transform: rotate(45deg);\n      -o-transform: rotate(45deg);\n      transform: rotate(45deg);\n      border: 1px solid rgba(0, 0, 0, 0.24); }\n  .popup.bottom {\n    margin-top: 0px; }\n    .popup.bottom > .notch {\n      top: -15px; }\n      .popup.bottom > .notch:after {\n        margin-top: 7.5px; }\n  .popup.top {\n    margin-top: -15px; }\n    .popup.top > .notch {\n      bottom: -15px; }\n      .popup.top > .notch:after {\n        margin-top: -14px; }\n  .popup .title {\n    color: #444;\n    margin: 0 0 4px;\n    font-size: 14px;\n    font-weight: 400;\n    text-shadow: 0 1px 0 #fff; }\n  .popup .subtitle {\n    margin: 10px 0 0 0;\n    font-size: 12px;\n    font-weight: 400; }\n  .popup .close-button {\n    display: none; }\n    .popup .close-button:hover {\n      background-color: #E6E6E6;\n      border-radius: 0; }\n  .popup .action-button,\n  .popup .action-button:hover {\n    background: #e5e9e8 !important;\n    border: 1px solid #aaa;\n    border-radius: 0;\n    color: #444;\n    font-size: 12px;\n    float: right;\n    min-width: 60px;\n    margin-top: 10px;\n    margin-bottom: 0px;\n    padding: 3px 10px;\n    text-shadow: 0 1px #fff; }\n  .popup .action-button:active {\n    background: #eee;\n    background-image: -webkit-linear-gradient(#f9f9f9 0, #d9d9d9 100%);\n    background-image: linear-gradient(to   , #d9d9d9 100%); }\n\n/**************************************\n/* EXTRACT CODE POPUP\n/**************************************/\n.extract-code-popup {\n  width: 235px; }\n  .extract-code-popup.expanded {\n    width: 460px; }\n  .extract-code-popup textarea,\n  .extract-code-popup .topcoat-textarea {\n    font-size: 12px;\n    line-height: 18px;\n    width: 100%;\n    height: 50px;\n    max-height: 200px;\n    padding: 2px 4px;\n    resize: none;\n    margin-bottom: 0px; }\n  .extract-code-popup .all-code {\n    float: left;\n    margin-top: 13px;\n    margin-bottom: 0px;\n    font-size: 12px; }\n    .extract-code-popup .all-code:hover {\n      color: #1397D0; }\n  .extract-code-popup .action-button.zeroclipboard-is-hover {\n    background-image: linear-gradient(to bottom, #a5a5a5, #a5a5a5); }\n  .extract-code-popup .action-button.copied {\n    background-image: linear-gradient(to bottom, #2da1e4, #0080cf);\n    border-color: rgba(30, 30, 30, 0.25);\n    pointer-events: none; }\n\n/**************************************\n/* EXTRACT ASSET POPUP\n/**************************************/\n.extract-asset-popup {\n  width: 230px;\n  pointer-events: auto; }\n  .extract-asset-popup.popup .notch:after {\n    background-color: #fff;\n    border: 1px solid rgba(0, 0, 0, 0.24); }\n  .extract-asset-popup .popup-contents .notch {\n    display: none;\n    visibility: hidden; }\n  .extract-asset-popup label {\n    color: #444;\n    display: block;\n    float: right;\n    font-size: 12px;\n    margin: 0 7px 0 0; }\n  .extract-asset-popup .file-name {\n    margin: 0px;\n    width: 96%;\n    font-size: 12px; }\n  .extract-asset-popup .optimize {\n    width: 100%;\n    min-height: 43px;\n    margin: 3px 0 10px 0; }\n  .extract-asset-popup .optimize-description {\n    background-color: #eef0f0;\n    border-radius: 0; }\n  .extract-asset-popup .format-description {\n    height: 100%;\n    font-size: 11px;\n    margin: 5px;\n    color: #444; }\n  .extract-asset-popup .optimize-range {\n    width: 75%;\n    float: left;\n    margin-top: 10px; }\n  .extract-asset-popup .optimize-percentage {\n    margin: 1px 0px 0 3px;\n    width: 37px;\n    font-size: 12px;\n    float: right; }\n  .extract-asset-popup .scale-factor {\n    width: 37px;\n    float: left;\n    margin-top: -3px; }\n  .extract-asset-popup .scale-enable-checkbox {\n    float: left; }\n  .extract-asset-popup input.scale-enable {\n    left: 0; }\n  .extract-asset-popup .scale label {\n    float: left;\n    margin: 0 7px;\n    font-weight: 400; }\n  .extract-asset-popup .scale-enable-checkbox:before {\n    background-color: #fff;\n    border: 1px solid #a9adab;\n    box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.12);\n    width: 15px;\n    height: 15px; }\n  .extract-asset-popup .scale-enable-checkbox:after {\n    border-color: #009df5;\n    left: 3px;\n    top: 1px; }\n  .extract-asset-popup .scale {\n    float: left;\n    margin: 4px 0 0;\n    position: relative; }\n    .extract-asset-popup .scale.disabled .scale-factor {\n      opacity: .4;\n      pointer-events: none; }\n    .extract-asset-popup .scale.incompatible {\n      opacity: .4;\n      pointer-events: none; }\n  .extract-asset-popup .popup-footer {\n    clear: right; }\n  .extract-asset-popup .extract-size {\n    float: left;\n    font-size: 12px;\n    line-height: 24px; }\n    .extract-asset-popup .extract-size #extract-size-value {\n      color: #d5d5d5;\n      font-size: 12px; }\n  .extract-asset-popup .topcoat-button--cta {\n    float: right;\n    overflow: visible;\n    padding: 1px 10px;\n    font-size: 14px;\n    text-shadow: 0 -1px rgba(0, 0, 0, 0.36);\n    color: #fff; }\n  .extract-asset-popup .select-file-type {\n    background-image: url("../../../../../..");\n    background-position: right 5px top 10px;\n    padding-left: 6px;\n    background-repeat: no-repeat; }\n  .extract-asset-popup .options {\n    border-radius: 0;\n    display: block;\n    margin-top: 10px;\n    margin-bottom: 10px;\n    margin-right: 4px;\n    position: relative;\n    white-space: nowrap;\n    font-size: 0; }\n    .extract-asset-popup .options input[type=radio] {\n      width: 100%;\n      height: 100%;\n      position: absolute;\n      cursor: pointer; }\n      .extract-asset-popup .options input[type=radio]:checked ~ p {\n        background-color: #0380e8;\n        background-image: -webkit-linear-gradient(#2a78b8 0, #009df5 100%);\n        background-image: linear-gradient(to   , #009df5 100%);\n        box-shadow: inset 0 1px 0 rgba(0, 0, 0, 0.12);\n        color: #fff; }\n    .extract-asset-popup .options .disabled {\n      opacity: 0.3; }\n    .extract-asset-popup .options div {\n      position: relative;\n      display: inline-block; }\n      .extract-asset-popup .options div p {\n        border: 1px solid #aaa;\n        border-right: none;\n        display: inline-block;\n        background-color: #eee;\n        background-image: -webkit-linear-gradient(#f9f9f9 0, #d9d9d9 100%);\n        background-image: linear-gradient(to   , #d9d9d9 100%);\n        padding: 3px 10px 2px;\n        margin: 0px;\n        font-size: 12px;\n        color: #444;\n        min-width: 24px;\n        text-align: center; }\n      .extract-asset-popup .options div:first-child p {\n        border-left: 1px solid #aaa; }\n      .extract-asset-popup .options div:last-child p {\n        border-right: 1px solid #aaa; }\n\n/**************************************\n/* COLOR CHIP POPUP\n/**************************************/\n.color-chip-popup {\n  width: auto;\n  padding: 10px; }\n  .color-chip-popup textarea,\n  .color-chip-popup .topcoat-textarea {\n    font-size: 12px;\n    width: 157px;\n    height: 23px;\n    margin: 1px;\n    resize: none;\n    white-space: nowrap;\n    overflow: hidden;\n    padding: 0 2px; }\n  .color-chip-popup .color-format {\n    display: inline-block;\n    font-size: 12px;\n    margin-right: 3px; }\n  .color-chip-popup .alpha-list .opacities-label {\n    display: inline-block;\n    width: 67px;\n    font-size: 12px;\n    margin: 0px; }\n  .color-chip-popup .alpha-list ul {\n    list-style: none;\n    margin: 8px 0px 0px 0px;\n    padding: 0px;\n    display: inline-block; }\n    .color-chip-popup .alpha-list ul .color-alpha {\n      height: 20px;\n      background-color: #eee;\n      display: inline-block;\n      margin: 0px 3px 0px 0px;\n      border-radius: 0;\n      padding: 0px 5px;\n      min-width: 15px;\n      cursor: pointer; }\n      .color-chip-popup .alpha-list ul .color-alpha p {\n        text-align: center;\n        line-height: 20px;\n        font-size: 12px;\n        margin: 0px;\n        color: #444; }\n      .color-chip-popup .alpha-list ul .color-alpha:hover {\n        background-color: #e4f1f9; }\n      .color-chip-popup .alpha-list ul .color-alpha.selected {\n        background-color: #009df5; }\n        .color-chip-popup .alpha-list ul .color-alpha.selected > p {\n          color: #fff !important; }\n\n/**************************************\n/* MEASUREMENT POPUP\n/**************************************/\n.measurementTooltip {\n  position: absolute;\n  overflow: hidden;\n  background-color: rgba(0, 0, 0, 0.76);\n  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.24);\n  color: #fff;\n  width: auto;\n  font-size: 12px;\n  font-weight: 400;\n  border-radius: 0;\n  padding: 10px 12px 9px 12px; }\n  .measurementTooltip .measurementElementInfoPos {\n    border-right: none;\n    padding: 0 0 0 10px; }\n\n.measurementPreferredUnits {\n  vertical-align: top;\n  display: inline-block;\n  white-space: nowrap;\n  height: auto;\n  overflow: hidden;\n  padding-right: 8px;\n  cursor: pointer; }\n  .measurementPreferredUnits span {\n    display: inline-block;\n    font-size: 12px;\n    color: #215c8d;\n    background-color: #3CB8FD;\n    width: 18px;\n    text-align: center;\n    margin-bottom: 1px; }\n  .measurementPreferredUnits span.selectedUnit {\n    color: #fff;\n    background-color: #215c8d; }\n\n.measurementElementInfoDim {\n  vertical-align: top;\n  display: inline-block;\n  white-space: nowrap;\n  height: auto;\n  overflow: hidden;\n  padding-right: 8px; }\n\n.measurementElementInfoPos {\n  display: inline-block;\n  vertical-align: top;\n  height: auto;\n  white-space: nowrap;\n  overflow: hidden;\n  border-width: 1px;\n  border-style: none solid none solid;\n  padding: 0 8px 0 8px; }\n\n.measurementElementAssetExtract {\n  vertical-align: top;\n  margin-top: 6px;\n  background-image: url("../../../../../..");\n  background-position: -60px 0px;\n  background-repeat: no-repeat;\n  width: 23px;\n  height: 25px;\n  display: inline-block;\n  overflow: hidden;\n  pointer-events: auto; }\n\n.measurementElementAssetExtract:hover {\n  background-image: url("../../../../../..");\n  background-position: -60px -40px;\n  cursor: pointer; }\n\n.measurementElementCopyControls {\n  height: auto;\n  vertical-align: top;\n  display: inline-block;\n  overflow: hidden;\n  padding: 0 0 0 10px;\n  pointer-events: auto;\n  margin-right: 10px; }\n  .measurementElementCopyControls > span {\n    color: #fff;\n    font-size: 12px;\n    cursor: pointer; }\n  .measurementElementCopyControls .disabled {\n    opacity: 0.3;\n    pointer-events: none !important; }\n\n#notificationTooltip {\n  position: absolute;\n  border: none !important;\n  background-color: #004A7E;\n  font-size: 12px !important;\n  padding: 6px 12px !important;\n  margin: 0 -1px -6px -13px; }\n  #notificationTooltip > span {\n    color: #fff !important; }\n\n.measurementPopup,\n.interceptBinary {\n  background-color: #009df5;\n  border: 1px solid #009df5;\n  overflow: visible; }\n  .measurementPopup .notch:after,\n  .interceptBinary .notch:after {\n    background-color: #009df5;\n    border: none; }\n  .measurementPopup .measurementElementInfoPos,\n  .interceptBinary .measurementElementInfoPos {\n    border-color: #007FFF; }\n  .measurementPopup .measurementElementAssetExtract,\n  .interceptBinary .measurementElementAssetExtract {\n    border-color: #007FFF; }\n  .measurementPopup .control-is-hover,\n  .interceptBinary .control-is-hover {\n    color: #004A7E;\n    cursor: pointer; }\n  .measurementPopup .popup-close,\n  .interceptBinary .popup-close {\n    position: absolute;\n    top: -9px;\n    right: -12px;\n    font-size: 13px;\n    font-weight: bold;\n    cursor: pointer; }\n  .measurementPopup .popup-close:hover,\n  .interceptBinary .popup-close:hover {\n    color: #215c8d; }\n  .measurementPopup .popup-footer,\n  .interceptBinary .popup-footer {\n    margin-top: 10px; }\n\n.interceptBinary span {\n  color: #fff; }\n\n#interceptPopupBinary {\n  margin-right: 5px;\n  position: relative; }\n\n#measurementPopupInfo {\n  white-space: nowrap;\n  line-height: 1.5em; }\n  #measurementPopupInfo .copyable {\n    color: #fff;\n    font-size: 12px;\n    cursor: pointer; }\n  #measurementPopupInfo .zeroclipboard-is-hover {\n    color: #004A7E;\n    cursor: pointer; }\n\n.measurementOffsetsBox {\n  position: absolute;\n  left: 100px;\n  top: 200px;\n  overflow: visible;\n  border: 1px dotted #000;\n  -webkit-transform: translate3d(0, 0, 0);\n  -moz-transform: translate3d(0, 0, 0);\n  -ms-transform: translate3d(0, 0, 0);\n  -o-transform: translate3d(0, 0, 0);\n  transform: translate3d(0, 0, 0);\n  -webkit-filter: drop-shadow(1px 1px 0.5px rgba(255, 255, 255, 0.2));\n  filter: drop-shadow(1px 1px 0.5px rgba(255, 255, 255, 0.2));\n  opacity: 1; }\n  .measurementOffsetsBox .measurementOffsetsCanvas {\n    position: absolute;\n    opacity: 1; }\n\n.measurementOffsetsBanner {\n  padding: 6px 10px;\n  opacity: 1;\n  background-color: #000;\n  border: 1px solid #000;\n  font-size: 10px;\n  font-weight: 400; }\n  .measurementOffsetsBanner > span {\n    color: #fff;\n    font-size: 12px; }\n  .measurementOffsetsBanner .copyable {\n    cursor: pointer; }\n  .measurementOffsetsBanner .notch {\n    height: 5px; }\n  .measurementOffsetsBanner .notch:after {\n    margin-top: 5px;\n    background-color: #000; }\n  .measurementOffsetsBanner .noWrap {\n    white-space: nowrap; }\n\n.xOffsetIcon,\n.yOffsetIcon {\n  background: url(../../../../../..) no-repeat;\n  display: inline-block;\n  width: 13px;\n  height: 13px;\n  margin-right: 5px;\n  position: relative;\n  top: 3px; }\n\n.xOffsetIcon {\n  background-position: 0 3px; }\n\n.yOffsetIcon {\n  background-position: 0 -12px; }\n\n/**************************************\n/*   KEYBOARD SHORTCUTS HELP DIALOG\n/**************************************/\n.keystroke-window-overlay {\n  background-color: rgba(0, 0, 0, 0.5);\n  left: 0px;\n  top: 0px;\n  width: 100%;\n  height: 100%;\n  position: absolute; }\n\n.keystroke-window-wrapper {\n  background-color: #fff;\n  position: absolute;\n  top: 5%;\n  width: 400px;\n  max-height: 88%;\n  left: 0;\n  right: 0;\n  overflow-x: hidden;\n  overflow-y: auto;\n  margin-left: auto;\n  margin-right: auto;\n  padding: 0px 10px 10px 7px;\n  border: 1px solid rgba(0, 0, 0, 0.7);\n  border-radius: 0;\n  box-shadow: inset 0 1px 0 #fff, 0 6px 18px rgba(0, 0, 0, 0.24); }\n\n.keystroke-header {\n  width: 100%;\n  padding-top: 20px;\n  padding-bottom: 5px;\n  padding-left: 20px; }\n\n.keystroke-header-title {\n  color: #444;\n  font-size: 21px;\n  font-weight: 400; }\n\n.keystroke-info-icon {\n  background-image: url("../../../../../..");\n  background-position: 0 -180px;\n  display: inline-block;\n  width: 18px;\n  height: 18px;\n  background-size: auto;\n  background-repeat: no-repeat;\n  margin: 0 3px 0 0;\n  position: relative;\n  top: 2px; }\n\n.keystroke-main-col {\n  padding: 5px 20px 20px; }\n\n.keystroke-item {\n  margin-top: 5px;\n  position: relative;\n  display: block; }\n\n.keystroke-separator {\n  border-bottom: 1px solid #dfdfdf;\n  margin-bottom: 10px;\n  padding-bottom: 10px; }\n\n.keystroke-item-title {\n  color: #444;\n  font-size: 12px;\n  line-height: 1em;\n  font-weight: 700; }\n\n.keystroke-item-text {\n  color: #444;\n  font-size: 11px;\n  font-weight: 400;\n  margin-top: 9px;\n  margin-right: 55px;\n  padding-top: 0px; }\n\n.keystroke-item-keys {\n  display: inline-block;\n  margin: 0 5px 0 0;\n  color: #444;\n  font-size: 12px;\n  line-height: 1em;\n  font-weight: 700; }\n\n.keystroke-item img {\n  margin-left: -5px;\n  height: 24px;\n  width: 24px; }\n\n.keystroke-item-key {\n  display: inline;\n  background: #fff;\n  border-radius: 0;\n  border: 1px solid #aaa;\n  box-shadow: 0 1px 1px rgba(0, 0, 0, 0.12);\n  color: #000000;\n  cursor: default;\n  font-size: 12px;\n  font-weight: 400;\n  padding: 1px 6px 1px 6px; }\n\n/**************************************\n/* LAYER THUMB POPUP\n/**************************************/\n.layer-thumb-popup {\n  width: auto;\n  height: auto;\n  padding: 10px 10px 4px;\n  font-size: 12px; }\n  .layer-thumb-popup .layer-thumb {\n    max-width: 240px; }\n\n.sprite_preview {\n  background: url("../../../../../..");\n  border: 1px solid #c4c4c4; }\n\n/**************************************\n/* Transitions\n/**************************************/\n.color-chip-popup.top,\n.extract-code-popup.top,\n.layer-thumb-popup.top,\n.extract-asset-popup.top,\n.measurementPopup.top,\n.measurementPopup {\n  -webkit-animation: popup 210ms cubic-bezier(0.01, 0.91, 0, 0.99) 1;\n  -moz-animation: popup 210ms cubic-bezier(0.01, 0.91, 0, 0.99) 1;\n  animation: popup 210ms cubic-bezier(0.01, 0.91, 0, 0.99) 1;\n  -webkit-transform-origin: 50% 100%;\n  -moz-transform-origin: 50% 100%;\n  -ms-transform-origin: 50% 100%;\n  -o-transform-origin: 50% 100%;\n  transform-origin: 50% 100%; }\n\n.color-chip-popup.bottom,\n.extract-code-popup.bottom,\n.layer-thumb-popup.bottom,\n.extract-asset-popup.bottom,\n.measurementPopup.bottom {\n  -webkit-animation: popup 210ms cubic-bezier(0.01, 0.91, 0, 0.99) 1;\n  -moz-animation: popup 210ms cubic-bezier(0.01, 0.91, 0, 0.99) 1;\n  animation: popup 210ms cubic-bezier(0.01, 0.91, 0, 0.99) 1;\n  -webkit-transform-origin: 50% 0;\n  -moz-transform-origin: 50% 0;\n  -ms-transform-origin: 50% 0;\n  -o-transform-origin: 50% 0;\n  transform-origin: 50% 0; }\n\n.measurementOffsetsBox {\n  -webkit-animation: popup 210ms cubic-bezier(0.01, 0.91, 0, 0.99) 1;\n  -moz-animation: popup 210ms cubic-bezier(0.01, 0.91, 0, 0.99) 1;\n  animation: popup 210ms cubic-bezier(0.01, 0.91, 0, 0.99) 1;\n  -webkit-transform-origin: 50% 50%;\n  -moz-transform-origin: 50% 50%;\n  -ms-transform-origin: 50% 50%;\n  -o-transform-origin: 50% 50%;\n  transform-origin: 50% 50%; }\n\n.keystroke-window-overlay {\n  -webkit-animation: overlay 300ms 1;\n  -moz-animation: overlay 300ms 1;\n  animation: overlay 300ms 1;\n  -webkit-transform-origin: 50% 50%;\n  -moz-transform-origin: 50% 50%;\n  -ms-transform-origin: 50% 50%;\n  -o-transform-origin: 50% 50%;\n  transform-origin: 50% 50%; }\n\n@-webkit-keyframes popup {\n  0% {\n    opacity: 0.6;\n    -webkit-transform: translate3d(0, 0, 0) scale(0.6); }\n  100% {\n    opacity: 1;\n    -webkit-transform: translate3d(0, 0, 0) scale(1); } }\n@-moz-keyframes popup {\n  0% {\n    opacity: 0.6;\n    -moz-transform: translate3d(0, 0, 0) scale(0.6); }\n  100% {\n    opacity: 1;\n    -moz-transform: translate3d(0, 0, 0) scale(1); } }\n@keyframes popup {\n  0% {\n    opacity: 0.6;\n    -webkit-transform: translate3d(0, 0, 0) scale(0.6);\n    -moz-transform: translate3d(0, 0, 0) scale(0.6);\n    -ms-transform: translate3d(0, 0, 0) scale(0.6);\n    -o-transform: translate3d(0, 0, 0) scale(0.6);\n    transform: translate3d(0, 0, 0) scale(0.6); }\n  100% {\n    opacity: 1;\n    -webkit-transform: translate3d(0, 0, 0) scale(1);\n    -moz-transform: translate3d(0, 0, 0) scale(1);\n    -ms-transform: translate3d(0, 0, 0) scale(1);\n    -o-transform: translate3d(0, 0, 0) scale(1);\n    transform: translate3d(0, 0, 0) scale(1); } }\n@-webkit-keyframes overlay {\n  0% {\n    opacity: 0;\n    -webkit-transform: translate3d(0, 0, 0); }\n  100% {\n    opacity: 1;\n    -webkit-transform: translate3d(0, 0, 0); } }\n@-moz-keyframes overlay {\n  0% {\n    opacity: 0;\n    -moz-transform: translate3d(0, 0, 0); }\n  100% {\n    opacity: 1;\n    -moz-transform: translate3d(0, 0, 0); } }\n@keyframes overlay {\n  0% {\n    opacity: 0;\n    -webkit-transform: translate3d(0, 0, 0);\n    -moz-transform: translate3d(0, 0, 0);\n    -ms-transform: translate3d(0, 0, 0);\n    -o-transform: translate3d(0, 0, 0);\n    transform: translate3d(0, 0, 0); }\n  100% {\n    opacity: 1;\n    -webkit-transform: translate3d(0, 0, 0);\n    -moz-transform: translate3d(0, 0, 0);\n    -ms-transform: translate3d(0, 0, 0);\n    -o-transform: translate3d(0, 0, 0);\n    transform: translate3d(0, 0, 0); } }\n.popup-button {\n  background: #2a78b8;\n  color: #fff;\n  font-size: 12px;\n  padding: 2px 7px;\n  margin: 0 5px 0 0; }\n\n.popup-button:hover {\n  background: #215c8d;\n  color: #fff; }\n\n/*# sourceMappingURL=popup.css.map */\n/* number must match PSDPreviewView center-helper template offset */\n.extract-plugin {\n  height: 100%; }\n\n.extract-plugin * {\n  -webkit-user-select: none;\n  -moz-user-select: none;\n  -ms-user-select: none;\n  user-select: none; }\n\n.extract-plugin input,\n.extract-plugin textarea {\n  -webkit-user-select: text;\n  -moz-user-select: text;\n  -ms-user-select: text;\n  user-select: text;\n  border: 1px solid #d8d8d8; }\n\n.psd-preview-view {\n  position: absolute;\n  left: 0px;\n  right: 312px;\n  top: 40px;\n  /* see height of .psd-header */\n  bottom: 0px;\n  overflow: auto;\n  -webkit-backface-visibility: hidden;\n  backface-visibility: hidden; }\n  .psd-preview-view .center-helper {\n    float: left;\n    height: 50%; }\n  .psd-preview-view .preview-container {\n    clear: both;\n    position: relative;\n    left: 0px;\n    right: 0px;\n    margin: auto;\n    padding-top: 7px;\n    -webkit-transition-property: width;\n    -moz-transition-property: width;\n    transition-property: width;\n    -webkit-transition-duration: 380ms;\n    -moz-transition-duration: 380ms;\n    transition-duration: 380ms;\n    -webkit-transition-timing-function: ease-out;\n    -moz-transition-timing-function: ease-out;\n    transition-timing-function: ease-out; }\n  .psd-preview-view.has-error .preview-container {\n    display: none; }\n\n#psdpreview_root {\n  background: url("../../../../../..");\n  box-shadow: 0 0 3px rgba(0, 0, 0, 0.24);\n  overflow: hidden;\n  position: relative;\n  -webkit-transition-property: -webkit-transform;\n  -moz-transition-property: -moz-transform;\n  transition-property: transform;\n  -webkit-transition-duration: 380ms;\n  -moz-transition-duration: 380ms;\n  transition-duration: 380ms;\n  -webkit-transition-timing-function: ease-out;\n  -moz-transition-timing-function: ease-out;\n  transition-timing-function: ease-out; }\n\n#selection-overlay {\n  position: absolute;\n  overflow: hidden;\n  top: 7px; }\n\n#tempPreview {\n  position: absolute;\n  overflow: hidden;\n  top: 7px; }\n\n.psd-layer,\n.psd-layer-group {\n  position: absolute;\n  pointer-events: none; }\n\n.defocused {\n  position: absolute;\n  display: block;\n  width: 100%;\n  height: 100%;\n  top: 0;\n  left: 0;\n  background-color: rgba(0, 0, 0, 0.75);\n  pointer-events: none; }\n\n.psd-preview-view .spinner {\n  position: fixed;\n  top: 50%;\n  left: 50%;\n  margin: -16px 0 0 -166px;\n  display: none;\n  width: 32px;\n  height: 32px;\n  background-image: url("../../../../../.."); }\n.psd-preview-view.worker-progress-shown .spinner {\n  visibility: hidden; }\n\n#workerProgress {\n  background-color: #fff;\n  box-shadow: 0px 0px 9px 0px rgba(0, 0, 0, 0.36);\n  width: 194px;\n  min-height: 91px;\n  padding: 20px;\n  position: fixed;\n  top: 50%;\n  left: 50%;\n  margin: -64px 0 0 -267px; }\n  #workerProgress .worker-status {\n    color: #000;\n    font-size: 13px;\n    font-weight: 400;\n    position: relative; }\n  #workerProgress .worker-status-tip {\n    color: #444;\n    font-size: 13px;\n    font-weight: 400;\n    position: relative;\n    margin: 0 4px; }\n\n#workerProgress .worker-progress-base {\n  position: relative;\n  margin: 10px 0;\n  width: 100%;\n  height: 19px;\n  background: #eee; }\n\n#workerProgress .worker-progress-bar {\n  position: relative;\n  width: 0;\n  height: 100%;\n  background-color: #5bc0de;\n  background-image: -webkit-gradient(linear, 0 100%, 100% 0, color-stop(0.25, rgba(255, 255, 255, 0.15)), color-stop(0.25, transparent), color-stop(0.5, transparent), color-stop(0.5, rgba(255, 255, 255, 0.15)), color-stop(0.75, rgba(255, 255, 255, 0.15)), color-stop(0.75, transparent), to(transparent));\n  background-image: -webkit-linear-gradient(-45deg, rgba(255, 255, 255, 0.15) 25%, transparent 25%, transparent 50%, rgba(255, 255, 255, 0.15) 50%, rgba(255, 255, 255, 0.15) 75%, transparent 75%, transparent);\n  background-image: -moz-linear-gradient(-45deg, rgba(255, 255, 255, 0.15) 25%, transparent 25%, transparent 50%, rgba(255, 255, 255, 0.15) 50%, rgba(255, 255, 255, 0.15) 75%, transparent 75%, transparent);\n  background-image: -ms-linear-gradient(-45deg, rgba(255, 255, 255, 0.15) 25%, transparent 25%, transparent 50%, rgba(255, 255, 255, 0.15) 50%, rgba(255, 255, 255, 0.15) 75%, transparent 75%, transparent);\n  background-image: -o-linear-gradient(-45deg, rgba(255, 255, 255, 0.15) 25%, transparent 25%, transparent 50%, rgba(255, 255, 255, 0.15) 50%, rgba(255, 255, 255, 0.15) 75%, transparent 75%, transparent);\n  background-image: linear-gradient(-45deg, rgba(255, 255, 255, 0.15) 25%, transparent 25%, transparent 50%, rgba(255, 255, 255, 0.15) 50%, rgba(255, 255, 255, 0.15) 75%, transparent 75%, transparent);\n  -webkit-background-size: 40px 40px;\n  -moz-background-size: 40px 40px;\n  -o-background-size: 40px 40px;\n  background-size: 40px 40px;\n  -webkit-box-shadow: inset 0 -1px 0 rgba(0, 0, 0, 0.15);\n  -moz-box-shadow: inset 0 -1px 0 rgba(0, 0, 0, 0.15);\n  box-shadow: inset 0 -1px 0 rgba(0, 0, 0, 0.15);\n  -webkit-box-sizing: border-box;\n  -moz-box-sizing: border-box;\n  box-sizing: border-box;\n  -webkit-transition: width 0.6s ease;\n  -moz-transition: width 0.6s ease;\n  -ms-transition: width 0.6s ease;\n  -o-transition: width 0.6s ease;\n  transition: width 0.6s ease;\n  -webkit-animation: progress-bar-stripes 2s linear infinite;\n  -moz-animation: progress-bar-stripes 2s linear infinite;\n  -o-animation: progress-bar-stripes 2s linear infinite;\n  -ms-animation: progress-bar-stripes 2s linear infinite;\n  animation: progress-bar-stripes 2s linear infinite; }\n\n/**************************************\n/* HOVER\n/**************************************/\n.hover {\n  outline: 1px solid #000;\n  position: absolute;\n  -webkit-transform: translate3d(0, 0, 0);\n  -moz-transform: translate3d(0, 0, 0);\n  -ms-transform: translate3d(0, 0, 0);\n  -o-transform: translate3d(0, 0, 0);\n  transform: translate3d(0, 0, 0);\n  -webkit-filter: drop-shadow(0px 0px 0.5px rgba(255, 255, 255, 0.75));\n  filter: drop-shadow(0px 0px 0.5px rgba(255, 255, 255, 0.75)); }\n\n/**************************************\n/* SELECTION\n/**************************************/\n.selection {\n  outline: 1px solid #00A2FF;\n  position: absolute;\n  -webkit-transform: translate3d(0, 0, 0);\n  -moz-transform: translate3d(0, 0, 0);\n  -ms-transform: translate3d(0, 0, 0);\n  -o-transform: translate3d(0, 0, 0);\n  transform: translate3d(0, 0, 0); }\n\n.selectionBorder {\n  position: absolute; }\n\n/**************************************\n/* STYLE INSPECTION\n/**************************************/\n#inspectStyleOverlay {\n  position: absolute;\n  top: 7px; }\n\n.style-callout, .font-callout, .color-callout {\n  background-clip: content-box !important;\n  display: inline-block;\n  min-width: 12px;\n  height: 12px;\n  position: absolute;\n  margin-left: -5px;\n  border: 2px solid #000;\n  border-radius: 0;\n  box-sizing: content-box;\n  box-shadow: inset 0 1px 0 rgba(0, 0, 0, 0.12), inset 0 -1px 0 rgba(255, 255, 255, 0.12);\n  -webkit-filter: drop-shadow(0px 0px 1px rgba(255, 255, 255, 0.7));\n  filter: drop-shadow(0px 0px 1px rgba(255, 255, 255, 0.7)); }\n  .style-callout .callout-notch, .font-callout .callout-notch, .color-callout .callout-notch {\n    position: absolute;\n    top: -2px;\n    right: -9px;\n    width: 0px;\n    height: 0px;\n    border-top: 8px solid transparent;\n    border-bottom: 8px solid transparent;\n    border-left: 7px solid #000; }\n  .style-callout.invisible, .invisible.font-callout, .invisible.color-callout {\n    border: 2px solid rgba(0, 0, 0, 0.69); }\n    .style-callout.invisible .callout-notch, .invisible.font-callout .callout-notch, .invisible.color-callout .callout-notch {\n      border-left: 7px solid rgba(0, 0, 0, 0.69); }\n\n.font-callout {\n  font-size: 11px;\n  font-weight: bold;\n  background-color: #000; }\n  .font-callout p {\n    margin: 0px;\n    line-height: 13px;\n    text-align: center;\n    color: #fff; }\n\n.color-callout .alpha-value {\n  color: #fff;\n  font-size: 11px;\n  line-height: 13px;\n  margin: 0px;\n  padding: 0 3px 0 2px;\n  text-align: right;\n  text-shadow: 1px 1px 1px rgba(0, 0, 0, 0.69); }\n.color-callout.defocused {\n  opacity: .6; }\n\n#inspectStyleOverlay canvas.inspectable-layer {\n  display: none;\n  position: absolute; }\n\n/**************************************\n/* MEASUREMENT INSPECTION\n/**************************************/\n#measurementOverlay {\n  position: absolute;\n  top: 7px;\n  width: 100%;\n  height: 100%;\n  pointer-events: auto;\n  background: rgba(0, 0, 0, 0.01); }\n\n/**************************************\n/* CURSORS\n/**************************************/\n.extract-plugin.dropper-tool,\n.extract-plugin.dropper-tool .dropper-item .color-chip {\n  cursor: url("../../../../../..") 2 15, auto;\n  cursor: -webkit-image-set(url("../../../../../..") 1x, url("../../../../../..") 2x) 2 15, auto; }\n\n.extract-plugin.dropper-tool .psd-preview-view {\n  cursor: none !important; }\n\n.extract-plugin.measure-pending .psd-preview-view {\n  cursor: url("../../../../../..") 1 1, auto;\n  cursor: -webkit-image-set(url("../../../../../..") 1x, url("../../../../../..") 2x) 1 1, auto; }\n\n/**************************************\n/* ERROR NOTIFICATION\n/**************************************/\n.error-notification {\n  position: absolute;\n  width: 100%;\n  height: 100%; }\n  .error-notification .centered-wrapper {\n    top: 0;\n    bottom: 0;\n    left: 0;\n    right: 0;\n    margin: auto;\n    vertical-align: middle;\n    position: absolute;\n    height: 200px;\n    width: 506px; }\n  .error-notification .error-icon {\n    position: absolute;\n    width: 68px;\n    height: 64px;\n    top: 3px;\n    background: url("../../../../../..") no-repeat;\n    background: -webkit-image-set(url("../../../../../..") 1x, url("../../../../../..") 2x) no-repeat; }\n  .error-notification .error-msg {\n    position: absolute;\n    left: 85px;\n    width: 440px;\n    height: auto;\n    color: #8a8f91; }\n\n/**************************************\n/* DROPPER\n/**************************************/\n.lens {\n  position: absolute;\n  width: 70px;\n  height: 70px;\n  margin-top: -45px;\n  margin-left: -45px;\n  border-radius: 50%;\n  border: 10px solid rgba(0, 0, 0, 0.5);\n  overflow: hidden;\n  box-shadow: 0px 4px 12px 0px rgba(0, 0, 0, 0.36);\n  pointer-events: none; }\n\n.lens .center {\n  border: black 1px solid;\n  width: 10px;\n  height: 10px;\n  box-sizing: border-box;\n  position: absolute;\n  top: 30px;\n  left: 30px; }\n\n.lens .inner {\n  border-radius: 50%;\n  position: absolute;\n  overflow: hidden;\n  width: 70px;\n  height: 70px; }\n\n/**************************************\n/* TRANSITIONS\n/**************************************/\n.notransition {\n  transition: none !important; }\n\n.font-callout,\n.color-callout {\n  -webkit-animation: popup 300ms cubic-bezier(0.61, 0.02, 0.95, 0.73) 1;\n  -moz-animation: popup 300ms cubic-bezier(0.61, 0.02, 0.95, 0.73) 1;\n  animation: popup 300ms cubic-bezier(0.61, 0.02, 0.95, 0.73) 1;\n  -webkit-transform-origin: 100% 50%;\n  -moz-transform-origin: 100% 50%;\n  -ms-transform-origin: 100% 50%;\n  -o-transform-origin: 100% 50%;\n  transform-origin: 100% 50%; }\n\n@-webkit-keyframes popup {\n  0% {\n    opacity: 0.6;\n    -webkit-transform: translate3d(0, 0, 0) scale(0); }\n  100% {\n    opacity: 1;\n    -webkit-transform: translate3d(0, 0, 0) scale(1); } }\n@-moz-keyframes popup {\n  0% {\n    opacity: 0.6;\n    -moz-transform: translate3d(0, 0, 0) scale(0); }\n  100% {\n    opacity: 1;\n    -moz-transform: translate3d(0, 0, 0) scale(1); } }\n@keyframes popup {\n  0% {\n    opacity: 0.6;\n    -webkit-transform: translate3d(0, 0, 0) scale(0);\n    -moz-transform: translate3d(0, 0, 0) scale(0);\n    -ms-transform: translate3d(0, 0, 0) scale(0);\n    -o-transform: translate3d(0, 0, 0) scale(0);\n    transform: translate3d(0, 0, 0) scale(0); }\n  100% {\n    opacity: 1;\n    -webkit-transform: translate3d(0, 0, 0) scale(1);\n    -moz-transform: translate3d(0, 0, 0) scale(1);\n    -ms-transform: translate3d(0, 0, 0) scale(1);\n    -o-transform: translate3d(0, 0, 0) scale(1);\n    transform: translate3d(0, 0, 0) scale(1); } }\n@-webkit-keyframes progress-bar-stripes {\n  from {\n    background-position: 0 0; }\n  to {\n    background-position: 40px 0; } }\n@-moz-keyframes progress-bar-stripes {\n  from {\n    background-position: 0 0; }\n  to {\n    background-position: 40px 0; } }\n@keyframes progress-bar-stripes {\n  from {\n    background-position: 0 0; }\n  to {\n    background-position: 40px 0; } }\n\n/*# sourceMappingURL=preview.css.map */\n/**************************************\n/* z-indexes from firstUserExp.scss\n/**************************************/\n.first-user-exp-overlay {\n  z-index: 9998; }\n\n/**************************************\n/* z-indexes from inspect.scss\n/**************************************/\n.color-list li:hover, .color-list li.selected, .color-list li.layer-over {\n  z-index: 300; }\n\n/**************************************\n/* z-indexes from main.scss\n/**************************************/\n.selection-controlbar {\n  z-index: 4000; }\n\n#detail-panel {\n  z-index: 2; }\n\n/**************************************\n/* z-indexes from popup.scss\n/**************************************/\n.popup {\n  z-index: 3000; }\n\n.measurementTooltip {\n  z-index: 800; }\n\n.keystroke-window-overlay {\n  z-index: 9997; }\n\n.layer-thumb-popup {\n  z-index: 4000; }\n\n#notificationTooltip {\n  z-index: 5000; }\n\n/**************************************\n/* z-indexes from preview.scss\n/**************************************/\n.psd-preview-view .spinner {\n  z-index: 3000; }\n\n#tempPreview {\n  z-index: 2000; }\n\n.focused {\n  z-index: 2001; }\n\n#workerProgress {\n  z-index: 3000; }\n\n#inspectStyleOverlay {\n  z-index: 3000; }\n\n.style-callout {\n  z-index: 10; }\n  .style-callout .callout-notch {\n    z-index: 15; }\n  .style-callout.invisible {\n    z-index: 2; }\n\n#measurementOverlay {\n  z-index: 3000; }\n\n/**************************************\n/* z-indexes from userProfile.scss\n/**************************************/\n.user-profile-popup {\n  z-index: 4500; }\n\n/**************************************\n/* z-indexes from topcoat.scss\n/**************************************/\n.button-bar__item > input {\n  z-index: 1; }\n\n.topcoat-button-bar__item > input {\n  z-index: 1; }\n\n.topcoat-button-bar__button:focus,\n.topcoat-button-bar__button--large:focus {\n  z-index: 1; }\n\ninput[type="checkbox"] {\n  z-index: 1; }\n\ninput[type="radio"] {\n  z-index: 1; }\n\n.switch__input {\n  z-index: 1; }\n\n.switch__toggle:before,\n.switch__toggle:after {\n  z-index: -1; }\n\n.switch__input,\n.topcoat-switch__input {\n  z-index: 1; }\n\n.switch__toggle:before,\n.switch__toggle:after,\n.topcoat-switch__toggle:before,\n.topcoat-switch__toggle:after {\n  z-index: -1; }\n\n.button-bar__item > input,\n.topcoat-tab-bar__item > input {\n  z-index: 1; }\n\n.topcoat-tab-bar__button:focus,\n.topcoat-tab-bar__button--large:focus {\n  z-index: 1; }\n\n.habla_window_div_base {\n  z-index: 2999 !important; }\n\n.layer-group-item .folder {\n  z-index: 1; }\n\n/*# sourceMappingURL=zIndex.css.map */\n');
//# sourceMappingURL=main.js.map